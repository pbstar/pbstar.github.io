"use strict";(self["webpackChunkvue2_pbstar_admin"]=self["webpackChunkvue2_pbstar_admin"]||[]).push([[846],{3846:function(t,e,s){s.r(e),s.d(e,{default:function(){return T}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"box"},[e("div",{staticClass:"top"},[e("div",{staticClass:"signatureBox"},[e("signature",{ref:"signature",attrs:{width:360,height:200}})],1),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"},on:{click:t.toClear}},[t._v("清除")]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.toSave}},[t._v("保存")])],1),e("div",{staticClass:"mid"},[t._l(t.list,(function(t,s){return e("div",{key:s,staticClass:"imgBox"},[e("img",{attrs:{src:t,alt:""}})])})),e("el-empty",{directives:[{name:"show",rawName:"v-show",value:0==t.list.length,expression:"list.length == 0"}],staticStyle:{margin:"0 auto"},attrs:{"image-size":100,description:"暂无保存签名"}})],2)])])},a=[],n=(s(7658),function(){var t=this,e=t._self._c;return e("div",[e("vueEsign",{ref:"esign",staticClass:"box",attrs:{width:t.width,height:t.height,lineWidth:t.lineWidth,lineColor:t.lineColor,bgColor:t.bgColor}})],1)}),r=[],h=(s(2801),s(3767),s(8585),s(8696),function(){var t=this,e=t._self._c;return e("canvas",{ref:"canvas",on:{mousedown:t.mouseDown,mousemove:t.mouseMove,mouseup:t.mouseUp,touchstart:t.touchStart,touchmove:t.touchMove,touchend:t.touchEnd}})}),o=[],l={props:{width:{type:Number,default:800},height:{type:Number,default:300},lineWidth:{type:Number,default:4},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""},isCrop:{type:Boolean,default:!1},isClearBgColor:{type:Boolean,default:!0},format:{type:String,default:"image/png"},quality:{type:Number,default:1}},data(){return{hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1}},computed:{ratio(){return this.height/this.width},stageInfo(){return this.$refs.canvas.getBoundingClientRect()},myBg(){return this.bgColor?this.bgColor:"rgba(255, 255, 255, 0)"}},watch:{myBg:function(t){this.$refs.canvas.style.background=t}},beforeMount(){window.addEventListener("resize",this.$_resizeHandler)},beforeDestroy(){window.removeEventListener("resize",this.$_resizeHandler)},mounted(){const t=this.$refs.canvas;t.height=this.height,t.width=this.width,t.style.background=this.myBg,this.$_resizeHandler(),document.onmouseup=()=>{this.isDrawing=!1}},methods:{$_resizeHandler(){const t=this.$refs.canvas;t.style.width=this.width+"px";const e=parseFloat(window.getComputedStyle(t).width);t.style.height=this.ratio*e+"px",this.canvasTxt=t.getContext("2d"),this.canvasTxt.scale(1*this.sratio,1*this.sratio),this.sratio=e/this.width,this.canvasTxt.scale(1/this.sratio,1/this.sratio)},mouseDown(t){t=t||event,t.preventDefault(),this.isDrawing=!0,this.hasDrew=!0;let e={x:t.offsetX,y:t.offsetY};this.drawStart(e)},mouseMove(t){if(t=t||event,t.preventDefault(),this.isDrawing){let e={x:t.offsetX,y:t.offsetY};this.drawMove(e)}},mouseUp(t){t=t||event,t.preventDefault();let e={x:t.offsetX,y:t.offsetY};this.drawEnd(e),this.isDrawing=!1},touchStart(t){if(t=t||event,t.preventDefault(),this.hasDrew=!0,1===t.touches.length){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawStart(e)}},touchMove(t){if(t=t||event,t.preventDefault(),1===t.touches.length){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawMove(e)}},touchEnd(t){if(t=t||event,t.preventDefault(),1===t.touches.length){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawEnd(e)}},drawStart(t){this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)},drawMove(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.strokeStyle=this.lineColor,this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},generate(t){let e=t&&t.format?t.format:this.format,s=t&&t.quality?t.quality:this.quality;const i=new Promise(((t,i)=>{if(this.hasDrew){var a=this.canvasTxt.getImageData(0,0,this.$refs.canvas.width,this.$refs.canvas.height);this.canvasTxt.globalCompositeOperation="destination-over",this.canvasTxt.fillStyle=this.myBg,this.canvasTxt.fillRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.resultImg=this.$refs.canvas.toDataURL(e,s);var n=this.resultImg;if(this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.canvasTxt.putImageData(a,0,0),this.canvasTxt.globalCompositeOperation="source-over",this.isCrop){const t=this.getCropArea(a.data);var r=document.createElement("canvas");const i=r.getContext("2d");r.width=t[2]-t[0],r.height=t[3]-t[1];const h=this.canvasTxt.getImageData(...t);i.globalCompositeOperation="destination-over",i.putImageData(h,0,0),i.fillStyle=this.myBg,i.fillRect(0,0,r.width,r.height),n=r.toDataURL(e,s),r=null}t(n)}else i("Warning: Not Signned!")}));return i},reset(){this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.isClearBgColor&&(this.$emit("update:bgColor",""),this.$refs.canvas.style.background="rgba(255, 255, 255, 0)"),this.points=[],this.hasDrew=!1,this.resultImg=""},getCropArea(t){for(var e=this.$refs.canvas.width,s=0,i=this.$refs.canvas.height,a=0,n=0;n<this.$refs.canvas.width;n++)for(var r=0;r<this.$refs.canvas.height;r++){var h=4*(n+this.$refs.canvas.width*r);(t[h]>0||t[h+1]>0||t[h+2]||t[h+3]>0)&&(a=Math.max(r,a),s=Math.max(n,s),i=Math.min(r,i),e=Math.min(n,e))}e++,s++,i++,a++;const o=[e,i,s,a];return o}}},c=l,u=s(1001),v=(0,u.Z)(c,h,o,!1,null,"a1968bcc",null),g=v.exports;g.install=function(t){this.installed||(this.installed=!0,t.component("vueEsign",g))};var d=g,f={name:"signature",props:{width:{type:Number,default:300},height:{type:Number,default:120},lineWidth:{type:Number,default:3},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""}},components:{vueEsign:d},methods:{toClear(){this.$refs.esign.reset()},toSave(){function t(t){let e=t.split(","),s=e[0].match(/:(.*?);/)[1],i=atob(e[1]),a=i.length,n=new Uint8Array(a);while(a--)n[a]=i.charCodeAt(a);return new File([n],"signature.png",{type:s})}return this.$refs.esign.generate().then((e=>{let s={base64:e,file:t(e)};return Promise.resolve(s)})).catch((t=>Promise.resolve("NotSignned")))}}},p=f,m=(0,u.Z)(p,n,r,!1,null,"7675cb45",null),x=m.exports,w={name:"adminModuleSignature",components:{signature:x},data(){return{list:[]}},methods:{toClear(){this.$refs.signature.toClear()},toSave(){this.$refs.signature.toSave().then((t=>{"NotSignned"!=t?(this.list.push(t.base64),this.$refs.signature.toClear()):this.$message.warning("签名内容为空！")}))}}},y=w,C=(0,u.Z)(y,i,a,!1,null,"c0c145a8",null),T=C.exports}}]);