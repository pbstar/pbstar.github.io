(self["webpackChunkmcchat"]=self["webpackChunkmcchat"]||[]).push([[504],{9504:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return El}});var i=function(){var e=this,t=e._self._c;return t("div",[t("router-view",{on:{call:e.call}}),t("TUICallKit",{staticClass:"kitBox"})],1)},r=[],o=(n(7658),n(1344)),a=n(6369);(function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('.tui-call-kit[data-v-742172c1]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-742172c1]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-742172c1]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-742172c1]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-742172c1]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-742172c1]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-742172c1],#local-group[data-v-742172c1]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-742172c1]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-742172c1]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-742172c1]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-742172c1]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-742172c1]{text-align:center}.control-wrapper[data-v-742172c1]:hover{z-index:13}.control-item[data-v-742172c1]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-742172c1]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-742172c1]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-742172c1]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-742172c1]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-742172c1]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-742172c1]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-742172c1]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-742172c1]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-742172c1]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-742172c1]{margin-bottom:6px;font-size:16px}.device-select[data-v-742172c1]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-742172c1]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-742172c1]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-742172c1]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-742172c1]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-742172c1]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-742172c1]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-742172c1]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-742172c1]{display:none}.group-calling-container[data-v-742172c1]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-742172c1]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-742172c1]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-742172c1]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-742172c1]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-742172c1]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-742172c1]{width:14px;height:23px}.right[data-v-742172c1]{right:0}.microphone-icon-container[data-v-742172c1]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-742172c1]{width:100%;height:100%}.group-calling-container-1[data-v-742172c1]{height:100%}.group-user-view-2[data-v-742172c1]{width:50%;height:100%}.group-calling-container-2[data-v-742172c1]{height:50%}.group-user-view-3[data-v-742172c1],.group-user-view-4[data-v-742172c1]{width:50%;height:50%}.group-calling-container-3[data-v-742172c1],.group-calling-container-4[data-v-742172c1]{height:100%}.group-user-view-5[data-v-742172c1],.group-user-view-6[data-v-742172c1]{width:33.333%;height:50%}.group-calling-container-5[data-v-742172c1],.group-calling-container-6[data-v-742172c1]{height:66%}.user-view-user-id-1[data-v-742172c1]{font-size:24px}.user-view-user-id-2[data-v-742172c1],.user-view-user-id-3[data-v-742172c1],.user-view-user-id-4[data-v-742172c1]{font-size:22px}.user-view-user-id-5[data-v-742172c1],.user-view-user-id-6[data-v-742172c1],.user-view-user-id-7[data-v-742172c1],.user-view-user-id-8[data-v-742172c1],.user-view-user-id-9[data-v-742172c1]{font-size:18px}.float-control-panel[data-v-742172c1]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-742172c1]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-742172c1]{margin-left:10px}.float-control-item-icon[data-v-742172c1]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-742172c1]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-742172c1]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-e94995a7]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-e94995a7]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-e94995a7]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-e94995a7]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-e94995a7]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-e94995a7]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-e94995a7],#local-group[data-v-e94995a7]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-e94995a7]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-e94995a7]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-e94995a7]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-e94995a7]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-e94995a7]{text-align:center}.control-wrapper[data-v-e94995a7]:hover{z-index:13}.control-item[data-v-e94995a7]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-e94995a7]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-e94995a7]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-e94995a7]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-e94995a7]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-e94995a7]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-e94995a7]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-e94995a7]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-e94995a7]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-e94995a7]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-e94995a7]{margin-bottom:6px;font-size:16px}.device-select[data-v-e94995a7]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-e94995a7]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-e94995a7]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-e94995a7]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-e94995a7]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-e94995a7]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-e94995a7]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-e94995a7]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-e94995a7]{display:none}.group-calling-container[data-v-e94995a7]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-e94995a7]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-e94995a7]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-e94995a7]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-e94995a7]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-e94995a7]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-e94995a7]{width:14px;height:23px}.right[data-v-e94995a7]{right:0}.microphone-icon-container[data-v-e94995a7]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-e94995a7]{width:100%;height:100%}.group-calling-container-1[data-v-e94995a7]{height:100%}.group-user-view-2[data-v-e94995a7]{width:50%;height:100%}.group-calling-container-2[data-v-e94995a7]{height:50%}.group-user-view-3[data-v-e94995a7],.group-user-view-4[data-v-e94995a7]{width:50%;height:50%}.group-calling-container-3[data-v-e94995a7],.group-calling-container-4[data-v-e94995a7]{height:100%}.group-user-view-5[data-v-e94995a7],.group-user-view-6[data-v-e94995a7]{width:33.333%;height:50%}.group-calling-container-5[data-v-e94995a7],.group-calling-container-6[data-v-e94995a7]{height:66%}.user-view-user-id-1[data-v-e94995a7]{font-size:24px}.user-view-user-id-2[data-v-e94995a7],.user-view-user-id-3[data-v-e94995a7],.user-view-user-id-4[data-v-e94995a7]{font-size:22px}.user-view-user-id-5[data-v-e94995a7],.user-view-user-id-6[data-v-e94995a7],.user-view-user-id-7[data-v-e94995a7],.user-view-user-id-8[data-v-e94995a7],.user-view-user-id-9[data-v-e94995a7]{font-size:18px}.float-control-panel[data-v-e94995a7]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-e94995a7]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-e94995a7]{margin-left:10px}.float-control-item-icon[data-v-e94995a7]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-e94995a7]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-e94995a7]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-68085ea8]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-68085ea8]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-68085ea8]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-68085ea8]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-68085ea8]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-68085ea8]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-68085ea8],#local-group[data-v-68085ea8]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-68085ea8]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-68085ea8]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-68085ea8]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-68085ea8]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-68085ea8]{text-align:center}.control-wrapper[data-v-68085ea8]:hover{z-index:13}.control-item[data-v-68085ea8]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-68085ea8]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-68085ea8]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-68085ea8]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-68085ea8]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-68085ea8]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-68085ea8]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-68085ea8]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-68085ea8]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-68085ea8]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-68085ea8]{margin-bottom:6px;font-size:16px}.device-select[data-v-68085ea8]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-68085ea8]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-68085ea8]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-68085ea8]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-68085ea8]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-68085ea8]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-68085ea8]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-68085ea8]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-68085ea8]{display:none}.group-calling-container[data-v-68085ea8]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-68085ea8]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-68085ea8]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-68085ea8]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-68085ea8]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-68085ea8]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-68085ea8]{width:14px;height:23px}.right[data-v-68085ea8]{right:0}.microphone-icon-container[data-v-68085ea8]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-68085ea8]{width:100%;height:100%}.group-calling-container-1[data-v-68085ea8]{height:100%}.group-user-view-2[data-v-68085ea8]{width:50%;height:100%}.group-calling-container-2[data-v-68085ea8]{height:50%}.group-user-view-3[data-v-68085ea8],.group-user-view-4[data-v-68085ea8]{width:50%;height:50%}.group-calling-container-3[data-v-68085ea8],.group-calling-container-4[data-v-68085ea8]{height:100%}.group-user-view-5[data-v-68085ea8],.group-user-view-6[data-v-68085ea8]{width:33.333%;height:50%}.group-calling-container-5[data-v-68085ea8],.group-calling-container-6[data-v-68085ea8]{height:66%}.user-view-user-id-1[data-v-68085ea8]{font-size:24px}.user-view-user-id-2[data-v-68085ea8],.user-view-user-id-3[data-v-68085ea8],.user-view-user-id-4[data-v-68085ea8]{font-size:22px}.user-view-user-id-5[data-v-68085ea8],.user-view-user-id-6[data-v-68085ea8],.user-view-user-id-7[data-v-68085ea8],.user-view-user-id-8[data-v-68085ea8],.user-view-user-id-9[data-v-68085ea8]{font-size:18px}.float-control-panel[data-v-68085ea8]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-68085ea8]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-68085ea8]{margin-left:10px}.float-control-item-icon[data-v-68085ea8]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-68085ea8]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-68085ea8]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-936e18a2]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-936e18a2]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-936e18a2]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-936e18a2]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-936e18a2]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-936e18a2]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-936e18a2],#local-group[data-v-936e18a2]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-936e18a2]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-936e18a2]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-936e18a2]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-936e18a2]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-936e18a2]{text-align:center}.control-wrapper[data-v-936e18a2]:hover{z-index:13}.control-item[data-v-936e18a2]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-936e18a2]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-936e18a2]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-936e18a2]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-936e18a2]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-936e18a2]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-936e18a2]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-936e18a2]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-936e18a2]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-936e18a2]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-936e18a2]{margin-bottom:6px;font-size:16px}.device-select[data-v-936e18a2]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-936e18a2]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-936e18a2]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-936e18a2]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-936e18a2]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-936e18a2]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-936e18a2]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-936e18a2]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-936e18a2]{display:none}.group-calling-container[data-v-936e18a2]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-936e18a2]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-936e18a2]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-936e18a2]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-936e18a2]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-936e18a2]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-936e18a2]{width:14px;height:23px}.right[data-v-936e18a2]{right:0}.microphone-icon-container[data-v-936e18a2]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-936e18a2]{width:100%;height:100%}.group-calling-container-1[data-v-936e18a2]{height:100%}.group-user-view-2[data-v-936e18a2]{width:50%;height:100%}.group-calling-container-2[data-v-936e18a2]{height:50%}.group-user-view-3[data-v-936e18a2],.group-user-view-4[data-v-936e18a2]{width:50%;height:50%}.group-calling-container-3[data-v-936e18a2],.group-calling-container-4[data-v-936e18a2]{height:100%}.group-user-view-5[data-v-936e18a2],.group-user-view-6[data-v-936e18a2]{width:33.333%;height:50%}.group-calling-container-5[data-v-936e18a2],.group-calling-container-6[data-v-936e18a2]{height:66%}.user-view-user-id-1[data-v-936e18a2]{font-size:24px}.user-view-user-id-2[data-v-936e18a2],.user-view-user-id-3[data-v-936e18a2],.user-view-user-id-4[data-v-936e18a2]{font-size:22px}.user-view-user-id-5[data-v-936e18a2],.user-view-user-id-6[data-v-936e18a2],.user-view-user-id-7[data-v-936e18a2],.user-view-user-id-8[data-v-936e18a2],.user-view-user-id-9[data-v-936e18a2]{font-size:18px}.float-control-panel[data-v-936e18a2]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-936e18a2]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-936e18a2]{margin-left:10px}.float-control-item-icon[data-v-936e18a2]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-936e18a2]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-936e18a2]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-d7638336]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-d7638336]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-d7638336]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-d7638336]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-d7638336]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-d7638336]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-d7638336],#local-group[data-v-d7638336]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-d7638336]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-d7638336]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-d7638336]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-d7638336]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-d7638336]{text-align:center}.control-wrapper[data-v-d7638336]:hover{z-index:13}.control-item[data-v-d7638336]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-d7638336]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-d7638336]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-d7638336]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-d7638336]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-d7638336]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-d7638336]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-d7638336]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-d7638336]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-d7638336]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-d7638336]{margin-bottom:6px;font-size:16px}.device-select[data-v-d7638336]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-d7638336]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-d7638336]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-d7638336]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-d7638336]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-d7638336]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-d7638336]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-d7638336]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-d7638336]{display:none}.group-calling-container[data-v-d7638336]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-d7638336]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-d7638336]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-d7638336]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-d7638336]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-d7638336]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-d7638336]{width:14px;height:23px}.right[data-v-d7638336]{right:0}.microphone-icon-container[data-v-d7638336]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-d7638336]{width:100%;height:100%}.group-calling-container-1[data-v-d7638336]{height:100%}.group-user-view-2[data-v-d7638336]{width:50%;height:100%}.group-calling-container-2[data-v-d7638336]{height:50%}.group-user-view-3[data-v-d7638336],.group-user-view-4[data-v-d7638336]{width:50%;height:50%}.group-calling-container-3[data-v-d7638336],.group-calling-container-4[data-v-d7638336]{height:100%}.group-user-view-5[data-v-d7638336],.group-user-view-6[data-v-d7638336]{width:33.333%;height:50%}.group-calling-container-5[data-v-d7638336],.group-calling-container-6[data-v-d7638336]{height:66%}.user-view-user-id-1[data-v-d7638336]{font-size:24px}.user-view-user-id-2[data-v-d7638336],.user-view-user-id-3[data-v-d7638336],.user-view-user-id-4[data-v-d7638336]{font-size:22px}.user-view-user-id-5[data-v-d7638336],.user-view-user-id-6[data-v-d7638336],.user-view-user-id-7[data-v-d7638336],.user-view-user-id-8[data-v-d7638336],.user-view-user-id-9[data-v-d7638336]{font-size:18px}.float-control-panel[data-v-d7638336]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-d7638336]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-d7638336]{margin-left:10px}.float-control-item-icon[data-v-d7638336]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-d7638336]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-d7638336]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-9e9f40b5]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-9e9f40b5]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-9e9f40b5]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-9e9f40b5]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-9e9f40b5]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-9e9f40b5]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-9e9f40b5],#local-group[data-v-9e9f40b5]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-9e9f40b5]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-9e9f40b5]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-9e9f40b5]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-9e9f40b5]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-9e9f40b5]{text-align:center}.control-wrapper[data-v-9e9f40b5]:hover{z-index:13}.control-item[data-v-9e9f40b5]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-9e9f40b5]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-9e9f40b5]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-9e9f40b5]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-9e9f40b5]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-9e9f40b5]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-9e9f40b5]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-9e9f40b5]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-9e9f40b5]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-9e9f40b5]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-9e9f40b5]{margin-bottom:6px;font-size:16px}.device-select[data-v-9e9f40b5]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-9e9f40b5]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-9e9f40b5]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-9e9f40b5]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-9e9f40b5]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-9e9f40b5]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-9e9f40b5]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-9e9f40b5]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-9e9f40b5]{display:none}.group-calling-container[data-v-9e9f40b5]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-9e9f40b5]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-9e9f40b5]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-9e9f40b5]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-9e9f40b5]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-9e9f40b5]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-9e9f40b5]{width:14px;height:23px}.right[data-v-9e9f40b5]{right:0}.microphone-icon-container[data-v-9e9f40b5]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-9e9f40b5]{width:100%;height:100%}.group-calling-container-1[data-v-9e9f40b5]{height:100%}.group-user-view-2[data-v-9e9f40b5]{width:50%;height:100%}.group-calling-container-2[data-v-9e9f40b5]{height:50%}.group-user-view-3[data-v-9e9f40b5],.group-user-view-4[data-v-9e9f40b5]{width:50%;height:50%}.group-calling-container-3[data-v-9e9f40b5],.group-calling-container-4[data-v-9e9f40b5]{height:100%}.group-user-view-5[data-v-9e9f40b5],.group-user-view-6[data-v-9e9f40b5]{width:33.333%;height:50%}.group-calling-container-5[data-v-9e9f40b5],.group-calling-container-6[data-v-9e9f40b5]{height:66%}.user-view-user-id-1[data-v-9e9f40b5]{font-size:24px}.user-view-user-id-2[data-v-9e9f40b5],.user-view-user-id-3[data-v-9e9f40b5],.user-view-user-id-4[data-v-9e9f40b5]{font-size:22px}.user-view-user-id-5[data-v-9e9f40b5],.user-view-user-id-6[data-v-9e9f40b5],.user-view-user-id-7[data-v-9e9f40b5],.user-view-user-id-8[data-v-9e9f40b5],.user-view-user-id-9[data-v-9e9f40b5]{font-size:18px}.float-control-panel[data-v-9e9f40b5]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-9e9f40b5]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-9e9f40b5]{margin-left:10px}.float-control-item-icon[data-v-9e9f40b5]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-9e9f40b5]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-9e9f40b5]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-b7cabd07]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-b7cabd07]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-b7cabd07]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-b7cabd07]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-b7cabd07]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-b7cabd07]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-b7cabd07],#local-group[data-v-b7cabd07]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-b7cabd07]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-b7cabd07]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-b7cabd07]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-b7cabd07]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-b7cabd07]{text-align:center}.control-wrapper[data-v-b7cabd07]:hover{z-index:13}.control-item[data-v-b7cabd07]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-b7cabd07]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-b7cabd07]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-b7cabd07]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-b7cabd07]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-b7cabd07]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-b7cabd07]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-b7cabd07]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-b7cabd07]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-b7cabd07]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-b7cabd07]{margin-bottom:6px;font-size:16px}.device-select[data-v-b7cabd07]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-b7cabd07]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-b7cabd07]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-b7cabd07]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-b7cabd07]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-b7cabd07]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-b7cabd07]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-b7cabd07]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-b7cabd07]{display:none}.group-calling-container[data-v-b7cabd07]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-b7cabd07]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-b7cabd07]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-b7cabd07]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-b7cabd07]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-b7cabd07]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-b7cabd07]{width:14px;height:23px}.right[data-v-b7cabd07]{right:0}.microphone-icon-container[data-v-b7cabd07]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-b7cabd07]{width:100%;height:100%}.group-calling-container-1[data-v-b7cabd07]{height:100%}.group-user-view-2[data-v-b7cabd07]{width:50%;height:100%}.group-calling-container-2[data-v-b7cabd07]{height:50%}.group-user-view-3[data-v-b7cabd07],.group-user-view-4[data-v-b7cabd07]{width:50%;height:50%}.group-calling-container-3[data-v-b7cabd07],.group-calling-container-4[data-v-b7cabd07]{height:100%}.group-user-view-5[data-v-b7cabd07],.group-user-view-6[data-v-b7cabd07]{width:33.333%;height:50%}.group-calling-container-5[data-v-b7cabd07],.group-calling-container-6[data-v-b7cabd07]{height:66%}.user-view-user-id-1[data-v-b7cabd07]{font-size:24px}.user-view-user-id-2[data-v-b7cabd07],.user-view-user-id-3[data-v-b7cabd07],.user-view-user-id-4[data-v-b7cabd07]{font-size:22px}.user-view-user-id-5[data-v-b7cabd07],.user-view-user-id-6[data-v-b7cabd07],.user-view-user-id-7[data-v-b7cabd07],.user-view-user-id-8[data-v-b7cabd07],.user-view-user-id-9[data-v-b7cabd07]{font-size:18px}.float-control-panel[data-v-b7cabd07]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-b7cabd07]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-b7cabd07]{margin-left:10px}.float-control-item-icon[data-v-b7cabd07]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-b7cabd07]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-b7cabd07]:hover{background:rgba(218,218,218,.3)}.tui-call-kit[data-v-66c9ea30]{width:100%;height:100%;position:relative;border-radius:inherit}.calling-wrapper[data-v-66c9ea30]{position:relative;width:100%;height:100%;border-radius:inherit;background:rgba(0,24,60,.7);backdrop-filter:blur(34px);display:flex;flex-direction:column;justify-content:center;overflow:hidden;z-index:12}.calling-wrapper[data-v-66c9ea30]:hover{z-index:inherit;transition:all .5s ease-in-out}.dialing-wrapper[data-v-66c9ea30]{background:#00183C;color:#fff;opacity:.7;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;border-radius:inherit;top:0;left:0;z-index:10;overflow:hidden}.dialing-local[data-v-66c9ea30]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.dialing-content[data-v-66c9ea30]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;position:relative;top:-3rem}#local-dialing[data-v-66c9ea30],#local-group[data-v-66c9ea30]{background:black;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWRhc2hhcnJheT0iMTUiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNSIKCQlzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTEyIDNDMTYuOTcwNiAzIDIxIDcuMDI5NDQgMjEgMTIiPgoJCTxhbmltYXRlIGZpbGw9ImZyZWV6ZSIgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIGR1cj0iMC4zcyIgdmFsdWVzPSIxNTswIiAvPgoJCTxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgZHVyPSIxLjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKCQkJdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgMTIgMTI7MzYwIDEyIDEyIiAvPgoJPC9wYXRoPgo8L3N2Zz4=);background-repeat:no-repeat;background-size:auto;background-position-x:center;background-position-y:calc(50% + 10px)}.dialing-user-id[data-v-66c9ea30]{font-style:normal;font-weight:600;font-size:40px;width:100%;line-height:56px;display:flex;align-items:center;justify-content:center}.dialing-info[data-v-66c9ea30]{font-style:normal;font-weight:400;font-size:14px;line-height:20px}.control-wrapper[data-v-66c9ea30]{transform:translate(-50%);position:absolute;bottom:0;padding-bottom:40px;left:50%;width:100%;color:#fff;border-radius:inherit;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.4) 100%);display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;z-index:11;user-select:none}.panel-button-area[data-v-66c9ea30]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin:30px 0}.panel-dialing-info[data-v-66c9ea30]{text-align:center}.control-wrapper[data-v-66c9ea30]:hover{z-index:13}.control-item[data-v-66c9ea30]{display:flex;flex-direction:column;width:100px;margin:0 20px}.control-item-h5[data-v-66c9ea30]{display:flex;flex-direction:column;width:100px;margin:0}.control-item-text[data-v-66c9ea30]{margin-top:5px;white-space:nowrap;font-weight:400;font-size:14px;line-height:20px;text-align:center}.control-item-icon[data-v-66c9ea30]{width:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;position:relative}.control-item-icon-container-small[data-v-66c9ea30]{background:rgba(218,218,218,.3);border-radius:40px;width:40px;height:40px;margin:8px;cursor:pointer}.control-item-icon-container-medium[data-v-66c9ea30]{background:rgba(0,0,0,.3);border-radius:56px;width:56px;height:56px;margin:8px;cursor:pointer}.control-item-icon-container-large[data-v-66c9ea30]{background:rgba(0,0,0,.3);border-radius:68px;width:68px;height:68px;margin:8px;cursor:pointer}.control-item-summary[data-v-66c9ea30]{height:40px;width:12px;right:0;display:flex;justify-content:center;align-items:center;cursor:pointer}.control-item-summary[data-v-66c9ea30]:hover{background:rgba(0,0,0,.4)}.control-item-detail[data-v-66c9ea30]{width:300px;border-radius:4px;background:#FEFEFF;box-shadow:#0000003d 0 3px 8px;color:#000;padding:20px;position:absolute;transform:translate(28px);bottom:110%}.control-item-detail-row[data-v-66c9ea30]{margin-bottom:6px;font-size:16px}.device-select[data-v-66c9ea30]{height:32px;width:100%;border:1px solid #DEE0E3;padding-left:6px;padding-top:6px;padding-bottom:6px;margin-top:10px;margin-bottom:10px;font-size:14px;color:#596174}.control-item-detail[data-v-66c9ea30]:before{content:"";width:0;height:0;border-width:10px;border-style:solid;border-color:#FEFEFF transparent transparent;bottom:-3px;margin-left:-9px;position:absolute;left:50%;border-color:#fff;border-radius:4px;transform:rotate(60deg) skew(30deg)}.tag[data-v-66c9ea30]{color:#fff;z-index:inherit;background:rgba(0,0,0,.6);padding:2px 10px;border-top-right-radius:inherit;border-bottom-left-radius:inherit;font-size:14px;position:absolute;left:0;bottom:0;z-index:11;display:flex;align-items:center}.tag .microphone-icon-container[data-v-66c9ea30]{margin-left:0;margin-right:2px;width:20px;background-color:transparent}.switch-large-small[data-v-66c9ea30]{position:absolute;right:12px;top:12px;width:16px;height:16px;z-index:inherit;cursor:pointer}.small-h5[data-v-66c9ea30]{position:absolute;width:94px;height:160px;min-height:100px;max-height:60%;top:30px;right:10px;z-index:2;overflow:hidden;background:#000;border-radius:4px}.small[data-v-66c9ea30]{position:absolute;width:260px;height:170px;min-height:100px;max-height:60%;top:30px;left:30px;z-index:2;overflow:hidden;resize:both;background:#000;border-radius:4px}.large[data-v-66c9ea30]{min-height:100px;width:100%;height:100%;z-index:1;border-radius:inherit;overflow:hidden}.large .switch-large-small[data-v-66c9ea30]{display:none}.group-calling-container[data-v-66c9ea30]{width:100%;height:100%;display:flex;flex-wrap:wrap;justify-content:center}.group-user-view[data-v-66c9ea30]{width:33.333%;height:33.333%;position:relative;background:rgba(32,32,32,.45);backdrop-filter:blur(34px);color:#fff;overflow:hidden}.user-view-text-container[data-v-66c9ea30]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;display:flex;flex-direction:column;justify-content:center;align-items:center;transform:translateY(-20px)}.user-view-user-id[data-v-66c9ea30]{font-family:PingFang SC;font-style:normal;font-weight:600;font-size:24px;line-height:34px}.user-view-info[data-v-66c9ea30]{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:12px;line-height:17px}.page-turn[data-v-66c9ea30]{width:40px;height:86px;border-radius:4.21px;background:rgba(0,0,0,.2);position:absolute;top:50%;transform:translateY(-50%);z-index:11;display:flex;justify-content:center;align-items:center;cursor:pointer}.turn-icon-container[data-v-66c9ea30]{width:14px;height:23px}.right[data-v-66c9ea30]{right:0}.microphone-icon-container[data-v-66c9ea30]{width:24px;height:24px;background:rgba(0,0,0,.4);border-radius:12px;display:flex;justify-content:center;align-items:center;margin-left:8px}.group-user-view-1[data-v-66c9ea30]{width:100%;height:100%}.group-calling-container-1[data-v-66c9ea30]{height:100%}.group-user-view-2[data-v-66c9ea30]{width:50%;height:100%}.group-calling-container-2[data-v-66c9ea30]{height:50%}.group-user-view-3[data-v-66c9ea30],.group-user-view-4[data-v-66c9ea30]{width:50%;height:50%}.group-calling-container-3[data-v-66c9ea30],.group-calling-container-4[data-v-66c9ea30]{height:100%}.group-user-view-5[data-v-66c9ea30],.group-user-view-6[data-v-66c9ea30]{width:33.333%;height:50%}.group-calling-container-5[data-v-66c9ea30],.group-calling-container-6[data-v-66c9ea30]{height:66%}.user-view-user-id-1[data-v-66c9ea30]{font-size:24px}.user-view-user-id-2[data-v-66c9ea30],.user-view-user-id-3[data-v-66c9ea30],.user-view-user-id-4[data-v-66c9ea30]{font-size:22px}.user-view-user-id-5[data-v-66c9ea30],.user-view-user-id-6[data-v-66c9ea30],.user-view-user-id-7[data-v-66c9ea30],.user-view-user-id-8[data-v-66c9ea30],.user-view-user-id-9[data-v-66c9ea30]{font-size:18px}.float-control-panel[data-v-66c9ea30]{width:168px;height:56px;background:white;z-index:13;position:fixed;top:20px;right:20px;display:flex;flex-wrap:nowrap;justify-content:center;border-radius:40px;box-shadow:#00000029 0 3px 6px,#0000003b 0 3px 6px}.function-buttons[data-v-66c9ea30]{position:absolute;right:12px;top:12px;z-index:13;cursor:pointer;display:flex;flex-direction:row;justify-content:flex-start}.minimize[data-v-66c9ea30]{margin-left:10px}.float-control-item-icon[data-v-66c9ea30]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:56px;height:56px;position:relative}.float-control-item-icon-container[data-v-66c9ea30]{border-radius:40px;width:40px;height:40px;margin:.5rem;cursor:pointer;display:flex;flex-direction:row;justify-content:center;align-items:center}.float-control-item-icon-container[data-v-66c9ea30]:hover{background:rgba(218,218,218,.3)}')),document.head.appendChild(e)}}catch(xi){console.error("vite-plugin-css-injected-by-js",xi)}})();var s=Object.defineProperty,c=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t,n)=>(c(e,"symbol"!=typeof t?t+"":t,n),n),l=(e=>(e.CONTAIN="contain",e.COVER="cover",e.FILL="fill",e))(l||{}),d=(e=>(e.RESOLUTION_480P="480p",e.RESOLUTION_720P="720p",e.RESOLUTION_1080P="1080p",e))(d||{});let h,p=0;const f=(0,a.ref)("");function g(){return 0===p&&(h=setInterval((()=>{p+=1,f.value=v()}),1e3),!0)}function _(){clearInterval(h),p=0}function v(){const e=Math.floor(p/3600),t=Math.floor(p/60%60),n=Math.floor(p%60);let i=`${n}`;return n<10&&(i=`0${n}`),i=`${t}:${i}`,t<10&&(i=`0${i}`),e>10?i=`${e}:${i}`:e>0&&(i=`0${e}:${i}`),i}const m={IDLE:"idle",BE_INVITED:"be-invited",DIALING_C2C:"dialing-c2c",DIALING_GROUP:"dialing-group",CALLING_C2C_AUDIO:"calling-c2c-audio",CALLING_C2C_VIDEO:"calling-c2c-video",CALLING_GROUP_AUDIO:"calling-group-audio",CALLING_GROUP_VIDEO:"calling-group-video"},y={REJECT:"change-status-because-of-rejected",NO_RESPONSE:"change-status-because-of-no-response",LINE_BUSY:"change-status-because-of-line-busy",CALLING_CANCEL:"change-status-because-of-calling-cancel",CALLING_TIMEOUT:"change-status-because-of-calling-timeout",CALL_TYPE_CHANGED:"call-type-changed",ACCEPT_DEVICE_ERROR:"accept-device-error",ACCEPT_ERROR:"accept-error",CALL_ERROR:"call-error"},I={VIDEO:"call-type-string-video",AUDIO:"call-type-string-audio"},T={en:{call:"call","video-call":"video call","audio-call":"audio call",search:"search","search-result":"search result","no-user":"user not found","member-not-added":"member not added","input-phone-userID":"phone number or userID","not-login":"not logged in","login-status-expire":"login status is invalid, please refresh the page and try again","experience-multi-call":"experience multi-person calls, please download the full-featured demo: ","not-support-multi-call":"multi-person call interface is not open",userID:"userID","already-enter":"entered the call",waiting:"Calling...",hangup:"Hang up",reject:"Decline",accept:"Accept","camera-opened":"Camera on","camera-closed":"Camera off","microphone-opened":"Mic on","microphone-closed":"Mic off",camera:"Camera",microphone:"Microphone","image-resolution":"Resolution","default-image-resolution":"Default","invited-person":"Invite","video-to-audio":"Switch to audio",me:"(me)","start-voice-call":"Audio call from ","start-video-call":"Video call from ","be-rejected":"Call declined, ","be-no-response":"No response, ","be-line-busy":"Line busy, ","be-canceled":"The call is canceled, ",timeout:"The call timed out","voice-call-end":"Voice call ended","video-call-end":"Video call ended","method-call-failed":"Failed to sync the operation","failed-to-obtain-permission":"Failed to obtain permissions","environment-detection-failed":"Failed to check the environment","call-failed":"call method failed","microphone-unavailable":"No mic found","ban-device":"Device access denied","not-supported-webrtc":"Your current environment does not support WebRTC","is-already-calling":"TUICallKit is already on a call","need-init":"Before initiating a call with TUICallKit, ensure that the TUICallKitServer.init() method has executed successfully. ","can't call yourself":"Can't call yourself","Use-phone-and-computer":"Use your mobile phone and computer to experience video calls","Wechat scan right QR code":"Wechat scan right QR code",try:"try","Scan the QR code above":"Scan the QR code above","Make video calls yourself":"Make video calls yourself","accept-error":"Accept failed","accept-device-error":"Accept failed, unable to auth calling device","call-error":"Start call failed"},"zh-cn":{call:"通话","video-call":"视频通话","audio-call":"音频通话",search:"搜索","search-result":"搜索结果","Wechat scan right QR code":"微信扫右二维码","Use-phone-and-computer":"用手机与电脑互打体验视频通话",try:"试试","Scan the QR code above":"扫描上方二维码","Make video calls yourself":"自己玩转视频通话","no-user":"未搜索到用户","member-not-added":"未添加成员","not-login":"未登录","login-status-expire":"登录状态已失效，请刷新网页重试","experience-multi-call":"体验多人通话请下载全功能demo:","not-support-multi-call":"多人通话接口未开放","input-phone-userID":"请输入手机号/用户ID",userID:"用户ID","already-enter":"已经进入当前通话",waiting:"等待接听...",hangup:"挂断",reject:"拒绝",accept:"接受","camera-opened":"摄像头已开","camera-closed":"摄像头已关","microphone-opened":"麦克风已开","microphone-closed":"麦克风已关",camera:"摄像头",microphone:"麦克风","image-resolution":"分辨率","default-image-resolution":"默认分辨率","invited-person":"添加成员","video-to-audio":"视频转语音",me:"（我）","start-voice-call":"发起的语音通话","start-video-call":"发起的视频通话","be-rejected":"对方已拒绝，","be-no-response":"对方无应答，","be-line-busy":"对方忙线中，","be-canceled":"对方已取消",timeout:"本次通话超时未应答","voice-call-end":"语音通话结束","video-call-end":"视频通话结束","method-call-failed":"同步操作失败","failed-to-obtain-permission":"权限获取失败","environment-detection-failed":"环境检测失败","call-failed":"调用失败","microphone-unavailable":"没有可用的麦克风设备","ban-device":"用户禁止使用设备","not-supported-webrtc":"当前环境不支持 WebRTC","is-already-calling":"TUICallKit 已在通话状态","need-init":"TUICallKit 发起通话前需保证 TUICallKitServer.init() 方法执行成功","can't call yourself":"不能呼叫自己","accept-error":"接通失败","accept-device-error":"接通失败，通话设备获取失败","call-error":"发起通话失败"}},C=(0,a.ref)(null),S=(0,a.ref)("zh-cn"),E=(0,a.ref)(l.COVER),b=(0,a.ref)(d.RESOLUTION_480P),M=(0,a.ref)([]),k=(0,a.ref)([]),w=(0,a.ref)(""),D=(0,a.ref)(""),A=(0,a.ref)(new Set),R=(0,a.ref)(m.IDLE),L=(0,a.ref)(!1),O=(0,a.ref)("waiting"),N=(0,a.ref)(),x=(0,a.ref)(!1),P=(0,a.ref)([]),U=(0,a.ref)(new Map),G=(0,a.ref)({userID:"",isEntered:!0,microphone:!0,camera:!0});function V(...e){"function"==typeof C.value?(C.value(...e),console.log("[TUICallKit] trigger event",...e)):console.error("[TUICallKit] emit event error: componentEmits is not a function",C.value)}function F(e){S.value=e}function B(e){var t;for(const i in T)if(i===S.value){const t=T[i];for(const n in t)if(n===e)return t[n]}const n=null==(t=e.en)?void 0:t.key;return console.error("translation is not found: ",e),n}async function j(e,t="",n=0){if(console.log("TUICallKit changeStatus",e,t,n),R.value!==e){switch(t!==y.CALL_TYPE_CHANGED&&(console.log("TUICallKit timerClear"),_()),t){case y.REJECT:Y(`${B("be-rejected")}${N.value===I.AUDIO?B("voice-call-end"):B("video-call-end")}`);break;case y.NO_RESPONSE:Y(`${B("be-no-response")}${N.value===I.AUDIO?B("voice-call-end"):B("video-call-end")}`);break;case y.LINE_BUSY:Y(`${B("be-line-busy")}${N.value===I.AUDIO?B("voice-call-end"):B("video-call-end")}`);break;case y.CALLING_CANCEL:Y(B("be-canceled"));break;case y.CALLING_TIMEOUT:Y(B("timeout"));break;case y.ACCEPT_DEVICE_ERROR:Y(B("accept-device-error"));break;case y.CALL_ERROR:Y(B("call-error"));break;default:Y("");break}return new Promise((t=>{setTimeout((()=>{Li.statusChanged&&Li.statusChanged({oldStatus:R.value,newStatus:e}),V("status-changed",{oldStatus:R.value,newStatus:e}),console.log(`TUICallKit status changed: ${R.value} -> ${e}`),R.value=e,t()}),n)}))}console.log("TUICallKit already be this status: "+e)}function q(e){const t=P.value.findIndex((t=>t.userID===e));t>=0?P.value[t].isEntered=!0:Q([...P.value,{userID:e,isEntered:!0}])}function H(e){let t=P.value.findIndex((t=>t.userID===e));if(t>=0){const e=P.value;e.splice(t,1),Q([...e])}return A.value.delete(e),P.value.length}function z(e,t,n){const i=P.value.findIndex((t=>t.userID===e));i>=0&&(t===I.VIDEO?P.value[i].camera=n:t===I.AUDIO&&(P.value[i].microphone=n))}function K(e,t){const n=P.value.findIndex((t=>t.userID===e));n>=0&&(P.value[n].isReadyRender=t)}function W(e){e.forEach((e=>{const{userId:t,audioVolume:n}=e;U.value.set(t,n)}))}function Y(e){O.value=e}function J(e){switch(e){case o.TUICallType.AUDIO_CALL:N.value=I.AUDIO;break;case o.TUICallType.VIDEO_CALL:N.value=I.VIDEO;break;default:return void console.error("TUICallKit changeCallType: unknown call type value ",e)}R.value===m.CALLING_C2C_VIDEO&&N.value===I.AUDIO&&j(m.CALLING_C2C_AUDIO,y.CALL_TYPE_CHANGED),R.value===m.CALLING_C2C_AUDIO&&N.value===I.VIDEO&&j(m.CALLING_C2C_VIDEO,y.CALL_TYPE_CHANGED),R.value===m.BE_INVITED&&Y(N.value===I.AUDIO?B("start-voice-call"):B("start-video-call"))}function Z(e){x.value=e}async function X(e){const t=Li.getTim();if(!t)return console.warn("TUICallKit request nick name error, reason: tim is empty/null"),e;let n=e;const{data:i}=await t.getUserProfile({userIDList:[e]})||{};return i&&i.length>0&&(n=i[0].nick),""===n&&(n=e),n}async function Q(e){P.value=e;for(const t of P.value)null!=t&&t.nick||(t.nick=await X(t.userID),(0,a.triggerRef)(P))}async function $(e){G.value=e,G.value.nick=await X(e.userID),(0,a.triggerRef)(G)}function ee(e){L.value=e}function te(e){return U.value.get(e)||0}(0,a.watch)(f,(()=>{Y(f.value)})),(0,a.watch)(R,(()=>{R.value===m.BE_INVITED&&Y(N.value===I.AUDIO?B("start-voice-call"):B("start-video-call")),"dialing"===R.value.split("-")[0]&&Y(B("waiting")),"calling"===R.value.split("-")[0]&&(Y(""),g()),R.value===m.IDLE&&(G.value.microphone=!0,G.value.camera=!0,L.value=!1,Y(""),Q([]),Li.afterCalling&&Li.afterCalling())}));const ne="@tencentcloud/call-uikit-vue",ie="2.1.0",re="dist/tuicall-uikit-vue.umd.js",oe="dist/tuicall-uikit-vue.es.js",ae="dist/types/src/index.d.ts",se="An Open-source Voice & Video Calling UI Component Based on Tencent Cloud Service.",ce="https://cloud.tencent.com/document/product/647/78731",ue="longyuqi <longyuqi@tencent.com>",le="ISC",de={type:"git",url:"https://github.com/tencentyun/TUICallKit.git",directory:"Web"},he={build:"vite build && npm run build:types","build-only":"vite build","build:types":"vue-tsc --project tsconfig.build-types.json --declaration --emitDeclarationOnly --outDir dist/types",typecheck:"vue-tsc --project tsconfig.build-types.json --noEmit",npm:"npm publish --access public"},pe={url:"https://github.com/tencentyun/TUICallKit/issues"},fe=["uikit","call","vue3","tencent","chat","vue","vue2","video","audio","voice","callkit","语音","视频","电话","通话"],ge={"tim-js-sdk":"^2.26.6","trtc-js-sdk":"^4.15.6",tsignaling:"^1.0.5","tuicall-engine-webrtc":"^1.3.9"},_e={"@babel/types":"^7.20.7","@types/node":"^18.11.18","@vitejs/plugin-vue":"^4.0.0","@vue/tsconfig":"^0.1.3",sass:"^1.57.1",typescript:"^4.9.5",vite:"^4.0.4","vite-plugin-css-injected-by-js":"^2.4.0",vue:"^3.2.47","vue-tsc":"^1.0.24"},ve={name:ne,version:ie,main:re,module:oe,types:ae,description:se,homepage:ce,author:ue,license:le,repository:de,scripts:he,bugs:pe,keywords:fe,dependencies:ge,devDependencies:_e};class me{constructor(){u(this,"SDKAppID"),u(this,"tuiCallEngine"),u(this,"TUICore"),u(this,"version"),u(this,"beforeCalling"),u(this,"afterCalling"),u(this,"onMinimized"),u(this,"onMessageSentByMe"),u(this,"statusChanged"),u(this,"error"),u(this,"tim"),u(this,"userID"),this.TUICore=null,this.tuiCallEngine=null,this.SDKAppID=0,this.version=ve.version,this.userID="",console.log("[TUICallKit] version: "+this.version)}async init(e){let{SDKAppID:t,tim:n}=e;const{userID:i,userSig:r,assetsPath:a}=e;this.TUICore&&(t=this.TUICore.SDKAppID,n=this.TUICore.tim),this.tim=n,this.SDKAppID=t,this.userID=i;try{null!==this.tuiCallEngine&&this.unbindTIMEvent(),this.tuiCallEngine=o.TUICallEngine.createInstance({SDKAppID:t,tim:n}),this.bindTIMEvent(),await this.tuiCallEngine.login({userID:i,userSig:r,assetsPath:a}),console.log("[TUICallKit] init successful")}catch(Ui){throw console.error("[TUICallKit] init failed",null==Ui?void 0:Ui.message),Ui}}async call(e){this.checkStatus();const{userID:t,type:n,timeout:i,offlinePushInfo:r}=e;try{Q([{userID:t,isEntered:!1}]),J(n),Z(!1),j(m.DIALING_C2C),await this.tuiCallEngine.call({userID:t,type:n,timeout:i,offlinePushInfo:r}),await this.setDefaultDevice({camera:n===o.TUICallType.VIDEO_CALL}),await this.renderLocal(),this.beforeCalling&&this.beforeCalling("call")}catch(Bi){throw this.error&&this.beforeCalling&&this.beforeCalling("call",this.error),this.error=null,console.error("[TUICallKit] call error: ",null==Bi?void 0:Bi.message),await j(m.IDLE,y.CALL_ERROR,1e3),Bi}}async groupCall(e){this.checkStatus();const{userIDList:t,type:n,groupID:i,timeout:r,offlinePushInfo:a,roomID:s}=e;try{const e=t.map((e=>({userID:e,isEntered:!1})));Q(e),J(n),Z(!0),j(m.DIALING_GROUP),await this.tuiCallEngine.groupCall({userIDList:t,type:n,groupID:i,timeout:r,offlinePushInfo:a,roomID:s}),await this.setDefaultDevice({camera:n===o.TUICallType.VIDEO_CALL}),await this.renderLocal(),this.beforeCalling&&this.beforeCalling("groupCall")}catch(Ki){throw this.error&&this.beforeCalling&&this.beforeCalling("groupCall",this.error),this.error=null,j(m.IDLE),console.error("[TUICallKit] groupCall error: "+(null==Ki?void 0:Ki.message)),Ki}}async joinInGroupCall(e){const{roomID:t,type:n,groupID:i}=e;await this.tuiCallEngine.joinInGroupCall({roomID:t,type:n,groupID:i}),this.beforeCalling&&this.beforeCalling("groupCall"),j(m.DIALING_GROUP),J(n),Z(!0),this.getIntoCallingStatus()}checkStatus(){if(R.value!==m.IDLE)throw console.error("[TUICallKit] call/groupCall error:",B("is-already-calling")),new Error(B("is-already-calling"));if(!this.tuiCallEngine)throw console.error("[TUICallKit] call/groupCall error:",B("need-init")),new Error(B("need-init"))}async updateCameraList(){M.value=await this.tuiCallEngine.getDeviceList("camera"),console.log("[TUICallKit] updateDevice camera",M.value)}async updateMicrophoneList(){k.value=await this.tuiCallEngine.getDeviceList("microphones"),console.log("[TUICallKit] updateDevice microphones",k.value)}async setDefaultDevice(e){var t,n;try{await this.updateMicrophoneList(),k.value.length>0&&(-1===k.value.findIndex((e=>e.deviceId===w.value))||""===D.value)&&await this.switchDevice("audio",null==(t=k.value[0])?void 0:t.deviceId)}catch(Gi){console.error("[TUICallKit] set default microphone error",null==Gi?void 0:Gi.message)}try{if(!e.camera)return;await this.updateCameraList(),M.value.length>0&&(-1===M.value.findIndex((e=>e.deviceId===w.value))||""===w.value)&&await this.switchDevice("video",null==(n=M.value[0])?void 0:n.deviceId)}catch(Gi){console.error("[TUICallKit] set default camera error",null==Gi?void 0:Gi.message)}}async switchDevice(e,t){console.log("[TUICallKit] switchDevice deviceType deviceId",e,t);try{await this.tuiCallEngine.switchDevice({deviceType:e,deviceId:t}),"video"===e&&(w.value=t),"audio"===e&&(D.value=t),await this.setVideoQuality(b.value)}catch(Vi){console.error("[TUICallKit] switchDevice error",null==Vi?void 0:Vi.message)}}bindTUICore(e){this.TUICore=e}setCallback(e){const{beforeCalling:t,afterCalling:n,onMinimized:i,onMessageSentByMe:r}=e;t&&(this.beforeCalling=t),n&&(this.afterCalling=n),i&&(this.onMinimized=i),r&&(this.onMessageSentByMe=r)}setLanguage(e){console.log("[TUICallKit] change language: ",e),"en"!==e&&"zh-cn"!==e&&(console.warn("[TUICallKit] change language warning: ",`${e} in not supported, has changed to default English`),e="en"),F(e)}toggleMinimize(){console.log("[TUICallKit] toggleMinimize called",L.value,"->",!L.value),this.onMinimized&&this.onMinimized(L.value,!L.value),ee(!L.value)}async accept(){if(R.value!==m.BE_INVITED)throw new Error("[TUICallKit] accept() should be called when be invited. 此接口应该在收到通话邀请时使用。");try{await this.tuiCallEngine.accept(),this.getIntoCallingStatus(),await this.setDefaultDevice({camera:N.value===I.VIDEO})}catch(xi){throw console.error("[TUICallKit] accept error catch:",null==xi?void 0:xi.message),"TUICallEngine.accept failed, error: Error: NotAllowedError: Permission denied"===(null==xi?void 0:xi.message)?await j(m.IDLE,y.ACCEPT_DEVICE_ERROR,1e3):await j(m.IDLE,y.ACCEPT_ERROR,1e3),await this.tuiCallEngine.reject(),xi}}async reject(){if(R.value!==m.BE_INVITED)throw new Error("[TUICallKit] reject() should be called when be invited. 此接口应该在收到通话邀请时使用。");try{await this.tuiCallEngine.reject()}catch(xi){console.error("[TUICallKit] reject error catch: ",null==xi?void 0:xi.message)}j(m.IDLE)}async startLocalView(e){console.log("[TUICallKit] startLocalView"),await this.tuiCallEngine.startLocalView({userID:G.value.userID,videoViewDomID:e})}async stopLocalView(){await this.tuiCallEngine.stopLocalView({userID:G.value.userID})}async startRemoteView(e){if(e)if(document.getElementById(e))try{await this.tuiCallEngine.startRemoteView({userID:e,videoViewDomID:e,options:{objectFit:E.value}}),console.log("[TUICallKit] startRemoteView success",e)}catch(Pi){console.warn("[TUICallKit] startRemoteView error",Pi,e)}else console.log("[TUICallKit] startRemoteView can't find HTMLElement id =",e);else console.log("[TUICallKit] startRemoteView userID is empty")}async stopRemoteView(e){await this.tuiCallEngine.stopRemoteView({userID:e})}async hangup(){if(R.value==m.BE_INVITED||R.value===m.IDLE)throw new Error("[TUICallKit] hangup() should be called when be dialing or calling status. 此接口应该在呼叫状态或在接通状态使用。");try{await this.tuiCallEngine.hangup()}catch(xi){throw console.error("[TUICallKit] hangup error catch: ",null==xi?void 0:xi.message),xi}j(m.IDLE)}async renderLocal(){if(R.value!==m.IDLE){if(G.value.microphone?this.openMicrophone():this.closeMicrophone(),N.value===I.VIDEO){let e=x.value?"local-group":"local-c2c";R.value===m.DIALING_C2C&&(e="local-dialing"),G.value.camera?this.openCamera(e):this.closeCamera()}}else console.log("[TUICallKit] renderLocal not working because status is idle")}async renderRemoteWaitList(){for(console.log("[TUICallKit] renderRemoteWaitList",A.value);A.value.size>0;){const e=A.value.values().next().value;await this.startRemoteView(e),A.value.delete(e)}}async renderRemoteList(e){console.log("[TUICallKit] renderRemoteList",e);for(let t=0;t<e.length;t++){const{userID:n,isEntered:i,isReadyRender:r}=e[t];i&&r&&await this.startRemoteView(n)}}async openCamera(e){console.log("[TUICallKit] openCamera",e);try{await this.tuiCallEngine.openCamera(e),$(Object.assign(G.value,{camera:!0}))}catch(Pi){console.error("[TUICallKit] openCamera error:",Pi)}}async closeCamera(){try{await this.tuiCallEngine.closeCamera(),$(Object.assign(G.value,{camera:!1}))}catch(xi){console.error("[TUICallKit] closeCamera error:",null==xi?void 0:xi.message)}}async openMicrophone(){try{await this.tuiCallEngine.openMicrophone(),$(Object.assign(G.value,{microphone:!0}))}catch(xi){console.error("[TUICallKit] openMicrophone error:",xi),$(Object.assign(G.value,{microphone:!1}))}}async closeMicrophone(){try{await this.tuiCallEngine.closeMicrophone(),$(Object.assign(G.value,{microphone:!1}))}catch(xi){console.error("[TUICallKit] closeMicrophone error:",null==xi?void 0:xi.message)}}async setVideoQuality(e){await this.tuiCallEngine.setVideoQuality(e),b.value=e}async switchCallMediaType(){console.log("[TUICallKit] switchCallMediaType",o.TUICallType.AUDIO_CALL);try{await this.tuiCallEngine.switchCallMediaType(o.TUICallType.AUDIO_CALL)}catch(xi){console.error("[TUICallKit] switchCallMediaType error:",null==xi?void 0:xi.message)}}onStatusChanged(e){this.statusChanged=e}async enableAIVoice(e){try{this.tuiCallEngine.enableAIVoice(e),console.log("[TUICallKit] enableAIVoice:",e)}catch(Pi){throw console.error("[TUICallKit] enableAIVoice failed",Pi.message),Pi}}async inviteUser(e){const{userIDList:t=[]}=e;console.log("[TUICallKit] inviteUser",e);try{const n=this.tuiCallEngine&&await this.tuiCallEngine.inviteUser(e),i=P.value;t.forEach((e=>{i.push({userID:e,isEntered:!1})})),Q(i),console.log("[TUICallKit] inviteUser success: ",n)}catch(Vi){throw console.error("[TUICallKit] inviteUser error: "+(null==Vi?void 0:Vi.message)),Vi}}getTim(){return this.tim?this.tim:this.tuiCallEngine?this.tuiCallEngine.tim:(console.warn("[TUICallKit] getTim warning: tuiCallEngine Instance is not available"),null)}async destroyed(){try{if(R.value!==m.IDLE)throw new Error(`please destroyed when status is calling end (idle), now status: ${R.value}`);this.unbindTIMEvent(),this.tuiCallEngine&&await this.tuiCallEngine.destroyInstance(),console.log("[TUICallKit] destroyInstance success")}catch(xi){throw console.error("[TUICallKit] destroyed error:",xi),xi}}getIntoCallingStatus(){!x.value&&N.value===I.AUDIO&&j(m.CALLING_C2C_AUDIO),!x.value&&N.value===I.VIDEO&&j(m.CALLING_C2C_VIDEO),x.value&&N.value===I.AUDIO&&j(m.CALLING_GROUP_AUDIO),x.value&&N.value===I.VIDEO&&j(m.CALLING_GROUP_VIDEO)}bindTIMEvent(){this.tuiCallEngine.on(o.TUICallEvent.ERROR,this.handleError,this),this.tuiCallEngine.on(o.TUICallEvent.SDK_READY,this.handleSDKReady,this),this.tuiCallEngine.on(o.TUICallEvent.INVITED,this.handleInvited,this),this.tuiCallEngine.on(o.TUICallEvent.USER_ACCEPT,this.handleUserAccept,this),this.tuiCallEngine.on(o.TUICallEvent.USER_ENTER,this.handleUserEnter,this),this.tuiCallEngine.on(o.TUICallEvent.USER_LEAVE,this.handleUserLeave,this),this.tuiCallEngine.on(o.TUICallEvent.REJECT,this.handleReject,this),this.tuiCallEngine.on(o.TUICallEvent.NO_RESP,this.handleNoResponse,this),this.tuiCallEngine.on(o.TUICallEvent.LINE_BUSY,this.handleLineBusy,this),this.tuiCallEngine.on(o.TUICallEvent.CALLING_CANCEL,this.handleCallingCancel,this),this.tuiCallEngine.on(o.TUICallEvent.KICKED_OUT,this.handleKickedOut,this),this.tuiCallEngine.on(o.TUICallEvent.CALLING_TIMEOUT,this.handleCallingTimeOut,this),this.tuiCallEngine.on(o.TUICallEvent.CALLING_END,this.handleCallingEnd,this),this.tuiCallEngine.on(o.TUICallEvent.USER_VIDEO_AVAILABLE,this.handleUserVideoAvailable,this),this.tuiCallEngine.on(o.TUICallEvent.USER_AUDIO_AVAILABLE,this.handleUserAudioAvailable,this),this.tuiCallEngine.on(o.TUICallEvent.USER_VOICE_VOLUME,this.handleUserVoiceVolume,this),this.tuiCallEngine.on(o.TUICallEvent.CALL_TYPE_CHANGED,this.handleCallTypeChanged,this),this.tuiCallEngine.on(o.TUICallEvent.MESSAGE_SENT_BY_ME,this.handleMessageSentByMe,this)}unbindTIMEvent(){this.tuiCallEngine.off(o.TUICallEvent.ERROR,this.handleError,this),this.tuiCallEngine.off(o.TUICallEvent.SDK_READY,this.handleSDKReady,this),this.tuiCallEngine.off(o.TUICallEvent.INVITED,this.handleInvited),this.tuiCallEngine.off(o.TUICallEvent.USER_ACCEPT,this.handleUserAccept),this.tuiCallEngine.off(o.TUICallEvent.USER_ENTER,this.handleUserEnter,this),this.tuiCallEngine.off(o.TUICallEvent.USER_LEAVE,this.handleUserLeave,this),this.tuiCallEngine.off(o.TUICallEvent.REJECT,this.handleReject,this),this.tuiCallEngine.off(o.TUICallEvent.NO_RESP,this.handleNoResponse,this),this.tuiCallEngine.off(o.TUICallEvent.LINE_BUSY,this.handleLineBusy,this),this.tuiCallEngine.off(o.TUICallEvent.CALLING_CANCEL,this.handleCallingCancel,this),this.tuiCallEngine.off(o.TUICallEvent.KICKED_OUT,this.handleKickedOut,this),this.tuiCallEngine.off(o.TUICallEvent.CALLING_TIMEOUT,this.handleCallingTimeOut,this),this.tuiCallEngine.off(o.TUICallEvent.CALLING_END,this.handleCallingEnd,this),this.tuiCallEngine.off(o.TUICallEvent.USER_VIDEO_AVAILABLE,this.handleUserVideoAvailable,this),this.tuiCallEngine.off(o.TUICallEvent.USER_AUDIO_AVAILABLE,this.handleUserAudioAvailable,this),this.tuiCallEngine.off(o.TUICallEvent.USER_VOICE_VOLUME,this.handleUserVoiceVolume,this),this.tuiCallEngine.off(o.TUICallEvent.CALL_TYPE_CHANGED,this.handleCallTypeChanged,this),this.tuiCallEngine.off(o.TUICallEvent.MESSAGE_SENT_BY_ME,this.handleMessageSentByMe,this)}handleError(e){const{code:t}=e;switch(this.error={code:t,type:"",message:""},t){case 60001:this.error.type=B("method-call-failed"),this.error.message=`switchToAudioCall ${B("call-failed")}`;break;case 60002:this.error.type=B("method-call-failed"),this.error.message=`switchToVideoCall ${B("call-failed")}`;break;case 60003:this.error.type=B("failed-to-obtain-permission"),this.error.message=B("microphone-unavailable");break;case 60004:this.error.type=B("failed-to-obtain-permission"),this.error.message=B("camera-unavailable");break;case 60005:this.error.type=B("failed-to-obtain-permission"),this.error.message=B("ban-device");break;case 60006:this.error.type=B("environment-detection-failed"),this.error.message=B("not-supported-webrtc");break}console.error("[TUICallKit] Error",JSON.stringify(this.error)),R.value===m.BE_INVITED&&this.beforeCalling&&this.beforeCalling("invited",this.error),j(m.IDLE)}handleSDKReady(e){console.log("[TUICallKit] SDK is ready.",e),$(Object.assign(G.value,{userID:this.userID}))}handleKickedOut(e){console.error("[TUICallKit] Kicked Out",e),this.unbindTIMEvent(),V("kicked-out",e),j(m.IDLE)}async handleUserVideoAvailable(e){console.log("[TUICallKit] handleUserVideoAvailable",e);const{userID:t,isVideoAvailable:n}=e;K(t,!0),z(t,I.VIDEO,n),n&&(document.getElementById(t)?await this.startRemoteView(t):(console.log("[TUICallKit] add remoteWaitList",t),A.value.add(t)))}handleUserAudioAvailable(e){console.log("[TUICallKit] handleUserAudioAvailable",e);const{userID:t,isAudioAvailable:n}=e;z(t,I.AUDIO,n)}handleUserVoiceVolume(e){const{volumeMap:t}=e;W(t)}handleInvited(e){if(console.log("[TUICallKit] handleInvited",e),this.beforeCalling&&this.beforeCalling("invited",this.error),this.error)return this.reject(),void(this.error=null);const{sponsor:t,isFromGroup:n,inviteData:i}=e,{callType:r}=i;j(m.BE_INVITED),Q([{userID:t,isEntered:!1}]),J(r),Z(n)}handleUserAccept(e){console.log("[TUICallKit] handleUserAccept",e);const{userID:t}=e;R.value!==m.BE_INVITED?this.getIntoCallingStatus():console.log(`TUICallKit userID=${t} accept the call`)}handleUserEnter(e){console.log("[TUICallKit] handleUserEnter",e);const{userID:t}=e;q(t)}handleUserLeave(e){console.log("[TUICallKit] handleUserLeave",e);const{userID:t}=e;H(t)}handleReject(e){console.log("[TUICallKit] handleReject",e);const{userID:t}=e;if(R.value!==m.BE_INVITED){if(R.value===m.CALLING_GROUP_AUDIO||R.value===m.CALLING_GROUP_VIDEO||R.value===m.DIALING_GROUP)return void H(t);j(m.IDLE,y.REJECT,1e3)}}handleNoResponse(e){console.log("[TUICallKit] handleNoResponse",e);const{userIDList:t}=e;t.forEach((e=>{H(e)<=0&&j(m.IDLE,y.NO_RESPONSE,x.value?0:1e3)}))}handleLineBusy(e){console.log("[TUICallKit] handleLineBusy",e);const{userID:t}=e;H(t)<=0&&j(m.IDLE,y.LINE_BUSY,x.value?0:1e3)}handleCallingCancel(e){console.log("[TUICallKit] handleCallingCancel",e),j(m.IDLE,y.CALLING_CANCEL,1e3)}handleCallingTimeOut(e){console.log("[TUICallKit] handleCallingTimeOut",e);const{userIDList:t}=e;t.forEach((e=>{(H(e)<=0||e===G.value.userID)&&j(m.IDLE,y.CALLING_TIMEOUT,x.value?0:1e3)}))}handleCallingEnd(e){console.log("[TUICallKit] handleCallingEnd",e),j(m.IDLE)}handleCallTypeChanged(e){console.log("[TUICallKit] handleCallTypeChanged",e);const{newCallType:t}=e;J(t)}handleMessageSentByMe(e){const t=null==e?void 0:e.data;console.log("[TUICallKit] MessageSentByMe",t),this.onMessageSentByMe&&this.onMessageSentByMe(t)}}const ye=(0,a.defineComponent)({__name:"MicrophoneIcon",props:{volume:null},setup(e){const t=e,{volume:n}=(0,a.toRefs)(t);return{__sfc:!0,props:t,volume:n}}});function Ie(e,t,n,i,r,o,a,s){var c,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),o&&(u._scopeId="data-v-"+o),a?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!e&&typeof __VUE_SSR_CONTEXT__<"u"&&(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=c):r&&(c=s?function(){r.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:r),c)if(u.functional){u._injectStyles=c;var l=u.render;u.render=function(e,t){return c.call(t),l(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:u}}var Te=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"}},[n.volume&&n.volume>0?t("g",[t("path",{attrs:{d:"M8.62462 7.17395C8.90076 7.17395 9.12462 7.38807 9.12462 7.65221C9.12462 7.89434 8.93651 8.09444 8.69246 8.12611L8.62462 8.13047H7.3335C7.05735 8.13047 6.8335 7.91635 6.8335 7.65221C6.8335 7.41009 7.0216 7.20998 7.26565 7.17832L7.3335 7.17395H8.62462Z",fill:"#43D92B"}})]):e._e(),n.volume&&n.volume>5?t("g",[t("path",{attrs:{d:"M8.62462 5.57971C8.90076 5.57971 9.12462 5.79384 9.12462 6.05797C9.12462 6.3001 8.93651 6.5002 8.69246 6.53187L8.62462 6.53623H7.3335C7.05735 6.53623 6.8335 6.32211 6.8335 6.05797C6.8335 5.81585 7.0216 5.61575 7.26565 5.58408L7.3335 5.57971H8.62462Z",fill:"#43D92B"}})]):e._e(),n.volume&&n.volume>10?t("g",[t("path",{attrs:{d:"M8.62462 3.98547C8.90076 3.98547 9.12462 4.1996 9.12462 4.46373C9.12462 4.70586 8.93651 4.90596 8.69246 4.93763L8.62462 4.942H7.3335C7.05735 4.942 6.8335 4.72787 6.8335 4.46373C6.8335 4.22161 7.0216 4.02151 7.26565 3.98984L7.3335 3.98547H8.62462Z",fill:"#43D92B"}})]):e._e(),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.3301 3.45938C11.2517 1.89175 9.77808 0.658081 8 0.658081C6.17253 0.658081 4.66667 1.96123 4.66667 3.59077V7.72539L4.66994 7.85678C4.7483 9.42442 6.22192 10.6581 8 10.6581C9.82747 10.6581 11.3333 9.35493 11.3333 7.72539V3.59077L11.3301 3.45938ZM6.0035 3.54179C6.06337 2.69234 6.92083 1.99146 8.00016 1.99146C9.11947 1.99146 10.0002 2.74521 10.0002 3.63675V7.67949L9.99682 7.77446C9.93695 8.62391 9.07949 9.32479 8.00016 9.32479C6.88086 9.32479 6.00016 8.57103 6.00016 7.67949V3.63675L6.0035 3.54179ZM8.33333 15.3333C8.51743 15.3333 8.66667 15.1841 8.66667 15V13.2964C11.5402 12.9793 14 10.6655 14 8.27322V7.68092C14 7.49682 13.8508 7.34758 13.6667 7.34758H13C12.8159 7.34758 12.6667 7.49682 12.6667 7.68092V8.27322L12.6634 8.39309C12.5681 10.1524 10.3982 11.9979 8.00396 12C8.00264 12 8.00132 12 8 12C7.99868 12 7.99736 12 7.99604 12C5.54737 11.9979 3.33333 10.0675 3.33333 8.27322L3.33043 7.65652C3.32956 7.47164 3.17839 7.32278 2.99352 7.32477L2.32975 7.33191C2.14706 7.33387 2 7.48252 2 7.66522V8.27322L2.00292 8.4162C2.09825 10.757 4.51708 12.9856 7.33333 13.2964V15C7.33333 15.1841 7.48257 15.3333 7.66667 15.3333H8.33333Z",fill:"#fff"}})])},Ce=[],Se=Ie(ye,Te,Ce,!1,null,"742172c1",null,null);const Ee=Se.exports,be={};var Me=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.82825 12.4759C5.58172 12.9048 6.43742 13.1978 7.33333 13.2967V15.0002C7.33333 15.1843 7.48257 15.3335 7.66667 15.3335H8.33333C8.51743 15.3335 8.66667 15.1843 8.66667 15.0002V13.2967C11.5402 12.9796 14 10.6658 14 8.27347V7.68116C14 7.49707 13.8508 7.34783 13.6667 7.34783H13C12.8159 7.34783 12.6667 7.49707 12.6667 7.68116V8.27347L12.6634 8.39333C12.5681 10.1526 10.3982 11.9982 8.00396 12.0002L8 12.0002L7.99604 12.0002C7.22514 11.9996 6.47749 11.8078 5.81487 11.4893L4.82825 12.4759ZM6.83168 10.4725C7.196 10.5927 7.5899 10.6583 8 10.6583C9.82747 10.6583 11.3333 9.35517 11.3333 7.72563V5.97083L6.83168 10.4725ZM10.9068 2.1547L4.73629 8.32524C4.70043 8.17327 4.67793 8.01689 4.66994 7.85702L4.66667 7.72563V3.59102C4.66667 1.96148 6.17253 0.658325 8 0.658325C9.24072 0.658325 10.3332 1.25901 10.9068 2.1547ZM3.62455 9.43698L2.64622 10.4153C2.26208 9.78985 2.03108 9.10804 2.00292 8.41644L2 8.27347V7.66546C2 7.48277 2.14706 7.33411 2.32975 7.33215L2.99352 7.32502C3.17839 7.32303 3.32956 7.47188 3.33043 7.65676L3.33333 8.27347C3.33333 8.66191 3.4371 9.05672 3.62455 9.43698Z",fill:"#fff"}}),t("rect",{attrs:{x:".609863",y:"13.4514",width:"19.0127",height:"1.5",rx:".75",transform:"rotate(-45 .609863 13.4514)",fill:"#FE3C44"}})])},ke=[],we=Ie(be,Me,ke,!1,null,null,null,null);const De=we.exports,Ae=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Re=()=>{},Le=(Object.assign,Array.isArray),Oe=e=>"function"==typeof e,Ne=e=>"symbol"==typeof e;let xe;function Pe(e,t=xe){t&&t.active&&t.effects.push(e)}const Ue=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Ge=e=>(e.w&qe)>0,Ve=e=>(e.n&qe)>0,Fe=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=qe},Be=e=>{const{deps:t}=e;if(t.length){let n=0;for(let i=0;i<t.length;i++){const r=t[i];Ge(r)&&!Ve(r)?r.delete(e):t[n++]=r,r.w&=~qe,r.n&=~qe}t.length=n}};let je=0,qe=1;const He=30;let ze;Symbol(""),Symbol("");class Ke{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,Pe(this,n)}run(){if(!this.active)return this.fn();let e=ze,t=Ye;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=ze,ze=this,Ye=!0,qe=1<<++je,je<=He?Fe(this):We(this),this.fn()}finally{je<=He&&Be(this),qe=1<<--je,ze=this.parent,Ye=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){ze===this?this.deferStop=!0:this.active&&(We(this),this.onStop&&this.onStop(),this.active=!1)}}function We(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let Ye=!0;function Je(e,t){let n=!1;je<=He?Ve(e)||(e.n|=qe,n=!Ge(e)):n=!e.has(ze),n&&(e.add(ze),ze.deps.push(e))}function Ze(e,t){const n=Le(e)?e:[...e];for(const i of n)i.computed&&Xe(i,t);for(const i of n)i.computed||Xe(i,t)}function Xe(e,t){(e!==ze||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}function Qe(e){const t=e&&e.__v_raw;return t?Qe(t):e}function $e(e){Ye&&ze&&(e=Qe(e),Je(e.dep||(e.dep=Ue())))}function et(e,t){e=Qe(e);const n=e.dep;n&&Ze(n)}var tt;new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(Ne));class nt{constructor(e,t,n,i){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[tt]=!1,this._dirty=!0,this.effect=new Ke(e,(()=>{this._dirty||(this._dirty=!0,et(this))})),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const e=Qe(this);return $e(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function it(e,t,n=!1){let i,r;const o=Oe(e);o?(i=e,r=Re):(i=e.get,r=e.set);const a=new nt(i,r,o||!r,n);return a}tt="__v_isReadonly";const rt=(0,a.defineComponent)({__name:"Dialing",setup(e){return{__sfc:!0,opacityValue:it((()=>R.value===m.DIALING_C2C&&N.value===I.VIDEO?"1":"0.7")),status:R,remoteList:P,dialingInfo:O,callType:N,getVolumeByUserID:te,STATUS:m,CALL_TYPE_STRING:I,MicrophoneIcon:Ee,MicrophoneClosedSVG:De,isMobile:Ae}}});var ot=function(){var e,t,n=this,i=n._self._c,r=n._self._setupProxy;return i("div",{staticClass:"dialing-wrapper",style:`opacity: ${r.opacityValue}`},[r.status===r.STATUS.DIALING_C2C&&r.callType===r.CALL_TYPE_STRING.VIDEO?i("div",{staticClass:"dialing-local",attrs:{id:"local-dialing"}}):n._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!(r.isMobile&&r.status===r.STATUS.DIALING_C2C&&r.callType===r.CALL_TYPE_STRING.VIDEO),expression:"!(isMobile && status === STATUS.DIALING_C2C && callType === CALL_TYPE_STRING.VIDEO)"}],staticClass:"dialing-content"},[i("div",{staticClass:"dialing-user-id"},[r.remoteList.length>=1?[n._v(" "+n._s(null==(e=r.remoteList[0])?void 0:e.nick)+" ")]:n._e(),r.status===r.STATUS.CALLING_C2C_AUDIO?i("div",{staticClass:"microphone-icon-container"},[null!=(t=r.remoteList[0])&&t.microphone?i(r.MicrophoneIcon,{attrs:{volume:r.getVolumeByUserID(r.remoteList[0].userID)}}):i(r.MicrophoneClosedSVG)],1):n._e()],2),i("div",{staticClass:"dialing-info"},[n._v(" "+n._s(r.dialingInfo)+" ")])])])},at=[],st=Ie(rt,ot,at,!1,null,"e94995a7",null,null);const ct=st.exports,ut={};var lt=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 12"}},[t("path",{attrs:{opacity:".01",transform:"matrix(1 0 0 -1 0 12)",fill:"#000",d:"M0 0H12V12H0z"}}),t("path",{attrs:{d:"M9.14646 7.14643C9.46144 7.46141 9.23835 7.99998 8.7929 7.99998L3.20712 7.99998C2.76167 7.99998 2.53859 7.4614 2.85357 7.14642L5.6465 4.35355C5.84177 4.15829 6.15835 4.15829 6.35361 4.35355L9.14646 7.14643Z",fill:"#fff"}})])},dt=[],ht=Ie(ut,lt,dt,!1,null,null,null,null);const pt=ht.exports,ft=(0,a.defineComponent)({__name:"ControlPanelItem",props:{action:null,hasDetail:{type:Boolean,default:!1},size:{default:"small"},isMobile:{type:Boolean,default:!1}},setup(e){const t=e,n=(0,a.ref)(!1),{action:i,hasDetail:r,isMobile:o,size:s}=(0,a.toRefs)(t),c=(0,a.computed)((()=>`control-item-icon-container-${s.value}`));async function u(){await(0,a.nextTick)();const e=document.getElementsByClassName("control-item-detail");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(e=>e.stopPropagation()))}async function l(e){e.stopPropagation(),u(),n.value=!n.value}return(0,a.onMounted)((()=>{document.documentElement.addEventListener("click",(e=>{n.value=!1}))})),{__sfc:!0,openDetail:n,props:t,action:i,hasDetail:r,isMobile:o,size:s,controlItemIconContainerClass:c,stayFocus:u,toggleDetail:l,TriangleSVG:pt}}});var gt=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t("div",{class:n.isMobile?"control-item-h5":"control-item"},[t("div",{staticClass:"control-item-icon"},[t("div",{class:n.controlItemIconContainerClass,on:{click:n.action}},[e._t("icon")],2),n.hasDetail?t("div",{staticClass:"control-item-summary",on:{click:n.toggleDetail}},[t(n.TriangleSVG)],1):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:n.openDetail,expression:"openDetail"}],staticClass:"control-item-detail"},[e._t("detail")],2)]),t("div",{staticClass:"control-item-text"},[e._t("text")],2)])},_t=[],vt=Ie(ft,gt,_t,!1,null,"68085ea8",null,null);const mt=vt.exports,yt={};var It=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20Z",fill:"#FE3C44"}}),t("path",{attrs:{d:"M25.4437 20.449C25.4437 22.1142 25.2336 23.3515 28.5089 23.7126C31.7875 24.0737 31.3666 21.6794 31.3662 20.0669C31.3649 18.2061 27.0602 15.619 20.2726 15.6173C13.4866 15.6173 9.1789 18.205 9.17888 20.067C9.17887 21.68 8.75621 24.0726 12.0332 23.7123C15.3101 23.3537 15.1 22.1155 15.0984 20.4495C15.1013 19.2862 17.7587 19.0316 20.2725 19.0298C22.7863 19.0281 25.4454 19.2844 25.4437 20.449Z",fill:"#fff"}})])},Tt=[],Ct=Ie(yt,It,Tt,!1,null,null,null,null);const St=Ct.exports,Et={};var bt=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0V0C31.0457 0 40 8.95431 40 20V20C40 31.0457 31.0457 40 20 40V40C8.95431 40 0 31.0457 0 20V20Z",fill:"#19D255"}}),t("path",{attrs:{d:"M23.5397 16.9535C24.7172 18.131 25.4436 19.1544 28.0149 17.0938C30.5885 15.0308 28.5979 13.6354 27.4573 12.4955C26.1407 11.1806 21.2674 12.3951 16.4667 17.1935C11.6683 21.9919 10.4521 26.8677 11.7687 28.1844C12.9092 29.3249 14.3022 31.3156 16.3646 28.7437C18.4282 26.173 17.4041 25.446 16.2248 24.2691C15.4043 23.4444 17.1034 21.3853 18.8797 19.6066C20.656 17.8278 22.7174 16.1288 23.5397 16.9535Z",fill:"white"}})])},Mt=[],kt=Ie(Et,bt,Mt,!1,null,null,null,null);const wt=kt.exports,Dt={};var At=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20Z",fill:"#19D255"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24.0421 14.8129C23.8814 14.0792 23.3684 13.5231 22.7291 13.3902C21.6674 13.2126 20.3495 13 17.6667 13C14.7319 13 13.5011 13.2009 12.5263 13.3669C11.9235 13.5295 11.4484 14.0688 11.2926 14.7675C11.153 15.6419 11 17.8298 11 19.6667C11 21.4724 11.1481 23.6461 11.2912 24.5205C11.4519 25.2542 11.9649 25.8103 12.6042 25.9431C13.666 26.1207 14.9839 26.3333 17.6667 26.3333C20.3495 26.3333 21.6674 26.1207 22.7305 25.9522C23.3726 25.8194 23.8891 25.26 24.0512 24.5231C24.1853 23.6461 24.3333 21.4724 24.3333 19.6667C24.3333 17.8609 24.1853 15.6872 24.0421 14.8129ZM12.6667 15.5C12.6667 15.0398 13.0398 14.6667 13.5 14.6667H14.3333C14.7936 14.6667 15.1667 15.0398 15.1667 15.5C15.1667 15.9602 14.7936 16.3333 14.3333 16.3333H13.5C13.0398 16.3333 12.6667 15.9602 12.6667 15.5ZM28.5 14.6667C27.0942 14.6667 26 16.547 26 17.6429V21.6905C26 22.9804 26.8008 24.6667 28.5 24.6667C29.2858 24.6667 29.3333 21.4524 29.3333 19.6667C29.3333 17.881 29.3333 14.6667 28.5 14.6667Z",fill:"#fff"}})])},Rt=[],Lt=Ie(Dt,At,Rt,!1,null,null,null,null);const Ot=Lt.exports,Nt={};var xt=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("rect",{attrs:{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20 12C19.4477 12 19 12.4477 19 13V19H13C12.4477 19 12 19.4477 12 20C12 20.5523 12.4477 21 13 21H19V27C19 27.5523 19.4477 28 20 28C20.5523 28 21 27.5523 21 27V21H27C27.5523 21 28 20.5523 28 20C28 19.4477 27.5523 19 27 19H21V13C21 12.4477 20.5523 12 20 12Z",fill:"#fff"}})])},Pt=[],Ut=Ie(Nt,xt,Pt,!1,null,null,null,null);const Gt=Ut.exports,Vt={};var Ft=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("rect",{attrs:{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24.0164 14.5395C23.8498 13.7141 23.3182 13.0884 22.6556 12.939C21.5553 12.7392 20.1895 12.5 17.4091 12.5C14.3676 12.5 13.092 12.726 12.0818 12.9127C11.4571 13.0957 10.9647 13.7024 10.8033 14.4884C10.6585 15.4721 10.5 17.9335 10.5 20C10.5 22.0315 10.6535 24.4769 10.8018 25.4605C10.9684 26.2859 11.5 26.9116 12.1625 27.061C13.2629 27.2608 14.6287 27.5 17.4091 27.5C20.1895 27.5 21.5553 27.2608 22.6571 27.0712C23.3225 26.9218 23.8578 26.2925 24.0258 25.4634C24.1647 24.4769 24.3182 22.0315 24.3182 20C24.3182 17.9685 24.1647 15.5231 24.0164 14.5395ZM12.2273 15.2083C12.2273 14.7481 12.6004 14.375 13.0606 14.375H13.9848C14.4451 14.375 14.8182 14.7481 14.8182 15.2083V15.4167C14.8182 15.8769 14.4451 16.25 13.9848 16.25H13.0606C12.6004 16.25 12.2273 15.8769 12.2273 15.4167V15.2083ZM28.6364 14.375C27.1794 14.375 26.0455 16.4904 26.0455 17.7232V22.2768C26.0455 23.7279 26.8754 25.625 28.6364 25.625C29.4508 25.625 29.5 22.0089 29.5 20C29.5 17.9911 29.5 14.375 28.6364 14.375Z",fill:"#fff"}})])},Bt=[],jt=Ie(Vt,Ft,Bt,!1,null,null,null,null);const qt=jt.exports,Ht={};var zt=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("rect",{attrs:{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16.6665 14.1667C16.6665 12.3284 18.1615 10.8334 19.9998 10.8334C21.8382 10.8334 23.3332 12.3284 23.3332 14.1667V19.1667C23.3332 21.005 21.8382 22.5 19.9998 22.5C18.1615 22.5 16.6665 21.005 16.6665 19.1667V14.1667ZM16.6665 28.3334C16.6665 27.8725 17.0398 27.5 17.4998 27.5H22.4998C22.9607 27.5 23.3332 27.8725 23.3332 28.3334C23.3332 28.7942 22.9607 29.1667 22.4998 29.1667H17.4998C17.0398 29.1667 16.6665 28.7942 16.6665 28.3334Z",fill:"#fff"}}),t("path",{attrs:{d:"M25.8332 18.3512V19.5083C25.8332 22.0811 23.2215 25 19.9998 25C16.7782 25 14.1665 22.0811 14.1665 19.5083V18.3334",stroke:"#fff","stroke-width":"1.66667","stroke-linecap":"round"}})])},Kt=[],Wt=Ie(Ht,zt,Kt,!1,null,null,null,null);const Yt=Wt.exports,Jt={};var Zt=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("rect",{attrs:{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"}}),t("path",{attrs:{d:"M17.7311 15.7485C17.7311 15.4339 18.1333 15.289 18.3596 15.507L22.9808 19.6831C23.1314 19.828 23.1314 20.0453 22.9808 20.166L18.3341 24.3435C18.1086 24.5608 17.7063 24.3917 17.7063 24.102V22.3396C17.7063 22.1464 17.5303 22.0016 17.3296 22.0016C14.2147 22.074 12.4319 22.8707 10.649 24.5366C10.3726 24.778 9.89538 24.5366 10.0205 24.1986C11.1007 21.1565 12.9345 18.4042 17.7311 17.8006V15.7485Z",fill:"#fff"}}),t("path",{attrs:{d:"M24.7603 17.0411C26.4103 18.6911 26.4328 21.3438 24.8106 22.9661C24.5788 23.1978 24.1999 23.1946 23.9642 22.9589C23.7284 22.7232 23.7252 22.3442 23.957 22.1124C25.1157 20.9537 25.0996 19.0589 23.9211 17.8803C23.6853 17.6446 23.6821 17.2656 23.9139 17.0339C24.1456 16.8021 24.5246 16.8053 24.7603 17.0411Z",fill:"#fff"}}),t("path",{attrs:{d:"M26.8765 14.925C29.7051 17.7536 29.7437 22.3011 26.9627 25.0821C26.731 25.3138 26.352 25.3106 26.1163 25.0749C25.8806 24.8392 25.8773 24.4602 26.1091 24.2285C28.4266 21.911 28.3944 18.1214 26.0373 15.7642C25.8016 15.5285 25.7983 15.1495 26.0301 14.9178C26.2618 14.686 26.6408 14.6893 26.8765 14.925Z",fill:"#fff"}})])},Xt=[],Qt=Ie(Jt,Zt,Xt,!1,null,null,null,null);const $t=Qt.exports,en={};var tn=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20Z",fill:"#FE3C44"}}),t("path",{attrs:{d:"M25.4437 20.449C25.4437 22.1142 25.2336 23.3515 28.5089 23.7126C31.7875 24.0737 31.3666 21.6794 31.3662 20.0669C31.3649 18.2061 27.0602 15.619 20.2726 15.6173C13.4866 15.6173 9.1789 18.205 9.17888 20.067C9.17887 21.68 8.75621 24.0726 12.0332 23.7123C15.3101 23.3537 15.1 22.1155 15.0984 20.4495C15.1013 19.2862 17.7587 19.0316 20.2725 19.0298C22.7863 19.0281 25.4454 19.2844 25.4437 20.449Z",fill:"#fff"}})])},nn=[],rn=Ie(en,tn,nn,!1,null,null,null,null);const on=rn.exports,an={};var sn=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("rect",{attrs:{opacity:".3",width:"40",height:"40",rx:"20",fill:"#fff"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20 11.5C18.0697 11.5 16.5 12.9678 16.5 14.7727V19.6818C16.5 20.2623 16.6623 20.8078 16.9468 21.281L23.4997 14.7281C23.4741 12.9437 21.9143 11.5 20 11.5ZM23.5 18.9704L19.5436 22.9269C19.693 22.9451 19.8453 22.9545 20 22.9545C21.9303 22.9545 23.5 21.4867 23.5 19.6818V18.9704ZM15.7321 22.4957C15.1207 21.7452 14.75 20.8727 14.75 20.0171V18.8636L14.7432 18.761C14.6892 18.3575 14.3211 18.0454 13.875 18.0454C13.3918 18.0454 13 18.4117 13 18.8636V20.0171L13.0047 20.2215C13.0611 21.4647 13.6284 22.6883 14.5245 23.7033L15.7321 22.4957ZM16.9482 25.5222L18.2094 24.261C18.7777 24.4715 19.3834 24.5909 20 24.5909C22.6589 24.5909 25.1138 22.3716 25.2445 20.1981L25.25 20.0171V18.8811C25.25 18.4293 25.6418 18.0629 26.125 18.0629C26.5711 18.0629 26.9392 18.3751 26.9932 18.7785L27 18.8811V20.0171C27 23.1518 23.6976 26.2272 20 26.2272C18.9256 26.2272 17.8845 25.9676 16.9482 25.5222ZM16.5 28.6818C16.5 28.2294 16.892 27.8636 17.375 27.8636H22.625C23.1089 27.8636 23.5 28.2294 23.5 28.6818C23.5 29.1343 23.1089 29.5 22.625 29.5H17.375C16.892 29.5 16.5 29.1343 16.5 28.6818Z",fill:"#fff"}}),t("rect",{attrs:{x:"27.249",y:"11.7688",width:"1.5",height:"22",rx:".75",transform:"rotate(45 27.249 11.7688)",fill:"#FE3C44"}})])},cn=[],un=Ie(an,sn,cn,!1,null,null,null,null);const ln=un.exports,dn={};var hn=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 40"}},[t("rect",{attrs:{width:"40",height:"40",rx:"20",fill:"#DADADA","fill-opacity":".3"}}),t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M22.7221 12.9557C22.7001 12.9496 22.6779 12.944 22.6556 12.939C21.5553 12.7392 20.1895 12.5 17.4091 12.5C14.3676 12.5 13.092 12.726 12.0818 12.9127C11.4571 13.0957 10.9647 13.7024 10.8033 14.4884C10.6585 15.4721 10.5 17.9335 10.5 20C10.5 21.7343 10.6118 23.7703 10.7369 24.9409L22.7221 12.9557ZM12.755 27.1654C13.7704 27.3355 15.1033 27.5 17.4091 27.5C20.1658 27.5 21.5319 27.2649 22.6289 27.0761L22.6571 27.0712C23.3225 26.9218 23.8578 26.2925 24.0258 25.4634C24.1647 24.4769 24.3182 22.0315 24.3182 20C24.3182 18.5797 24.2432 16.957 24.1473 15.773L12.755 27.1654ZM13.0606 14.375C12.6004 14.375 12.2273 14.7481 12.2273 15.2083V15.4167C12.2273 15.8769 12.6004 16.25 13.0606 16.25H13.9848C14.4451 16.25 14.8182 15.8769 14.8182 15.4167V15.2083C14.8182 14.7481 14.4451 14.375 13.9848 14.375H13.0606ZM26.0455 17.7232C26.0455 16.4904 27.1794 14.375 28.6364 14.375C29.5 14.375 29.5 17.9911 29.5 20C29.5 22.0089 29.4508 25.625 28.6364 25.625C26.8754 25.625 26.0455 23.7279 26.0455 22.2768V17.7232Z",fill:"#fff"}}),t("rect",{attrs:{x:"24.8574",y:"11.8564",width:"1.5",height:"22",rx:".75",transform:"rotate(45 24.8574 11.8564)",fill:"#FE3C44"}})])},pn=[],fn=Ie(dn,hn,pn,!1,null,null,null,null);const gn=fn.exports,_n=(0,a.defineComponent)({__name:"ControlPanel",setup(e){const t=(0,a.ref)(!1),n=(0,a.ref)(!1);async function i(){await Li.hangup()}function r(){Li.switchDevice("video",w.value),t.value=!1}function o(){Li.switchDevice("audio",D.value),n.value=!1}async function s(){var e;if(null!=(e=G.value)&&e.camera)await Li.closeCamera();else{const e=x.value?"local-group":"local-c2c";await Li.openCamera(e)}}async function c(){var e;null!=(e=G.value)&&e.microphone?await Li.closeMicrophone():await Li.openMicrophone()}async function u(){await Li.setVideoQuality(b.value)}async function l(){await Li.switchCallMediaType()}function h(){Q([...P.value,{userID:`qerTest${P.value.length}`,isEntered:!1,microphone:!0,camera:!0}])}function p(){Li.accept()}function f(){Li.reject()}return(0,a.onMounted)((()=>{document.documentElement.addEventListener("click",(e=>{t.value=!1,n.value=!1}))})),{__sfc:!0,openCameraDetail:t,openMicrophoneDetail:n,hangup:i,switchCameraDevice:r,switchMicrophoneDevice:o,toggleCamera:s,toggleMicrophone:c,setVideoQuality:u,switchCallMediaType:l,addPerson_debug:h,accept:p,reject:f,TUICallKitServer:Li,ControlPanelItem:mt,profile:G,callType:N,status:R,t:B,dialingInfo:O,cameraList:M,microphoneList:k,currentCamera:w,currentMicrophone:D,currentVideoResolution:b,STATUS:m,CALL_TYPE_STRING:I,RejectSVG:St,AcceptAudioSVG:wt,AcceptVideoSVG:Ot,AddSVG:Gt,CameraSVG:qt,MicrophoneSVG:Yt,SwitchSVG:$t,HangupSVG:on,MicrophoneClosedBigSVG:ln,CameraClosedBigSVG:gn,isMobile:Ae,VideoResolution:d}}});var vn=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t("div",{staticClass:"control-wrapper"},[t("div",{directives:[{name:"show",rawName:"v-show",value:n.isMobile&&n.status===n.STATUS.DIALING_C2C&&n.callType===n.CALL_TYPE_STRING.VIDEO,expression:"isMobile && status === STATUS.DIALING_C2C && callType === CALL_TYPE_STRING.VIDEO"}]},[e._v(" "+e._s(n.dialingInfo)+" ")]),t("div",{staticClass:"panel-button-area"},[n.status===n.STATUS.BE_INVITED?[t(n.ControlPanelItem,{attrs:{action:n.reject,isMobile:n.isMobile,size:n.isMobile?"medium":"small"},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(n.t("reject"))+" ")]},proxy:!0},{key:"icon",fn:function(){return[t(n.RejectSVG)]},proxy:!0}],null,!1,3198043600)}),t(n.ControlPanelItem,{attrs:{action:n.accept,isMobile:n.isMobile,size:n.isMobile?"medium":"small"},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(n.t("accept"))+" ")]},proxy:!0},{key:"icon",fn:function(){return[n.callType===n.CALL_TYPE_STRING.AUDIO?[t(n.AcceptAudioSVG)]:n.callType===n.CALL_TYPE_STRING.VIDEO?[t(n.AcceptVideoSVG)]:e._e()]},proxy:!0}],null,!1,3474110228)})]:"idle"!==n.status?[n.callType===n.CALL_TYPE_STRING.VIDEO?t(n.ControlPanelItem,{attrs:{action:n.toggleCamera,hasDetail:!n.isMobile,isMobile:n.isMobile,size:n.isMobile?"medium":"small"},scopedSlots:e._u([{key:"text",fn:function(){var t;return[e._v(" "+e._s(null!=(t=n.profile)&&t.camera?n.t("camera-opened"):n.t("camera-closed"))+" ")]},proxy:!0},{key:"icon",fn:function(){var i,r;return[null!=(i=n.profile)&&i.camera?t(n.CameraSVG):e._e(),null!=(r=n.profile)&&r.camera?e._e():t(n.CameraClosedBigSVG)]},proxy:!0},{key:"detail",fn:function(){var i;return[t("div",{staticClass:"control-item-detail-row"},[t("div",[e._v(" "+e._s(n.t("camera"))+" ")]),t("select",{directives:[{name:"model",rawName:"v-model",value:n.currentCamera,expression:"currentCamera"}],staticClass:"device-select",on:{change:[function(e){var t=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));n.currentCamera=e.target.multiple?t:t[0]},n.switchCameraDevice],click:function(e){return n.TUICallKitServer.updateCameraList()}}},[t("option",{attrs:{value:"",selected:"",disabled:"",hidden:""}},[e._v(e._s(n.cameraList&&(null==(i=n.cameraList[0])?void 0:i.label)))]),e._l(n.cameraList,(function(n){return t("option",{key:n.deviceId,domProps:{value:n.deviceId}},[e._v(" "+e._s(n.label)+" ")])}))],2)]),n.status===n.STATUS.DIALING_C2C?t("div",[t("div",[e._v(" "+e._s(n.t("image-resolution"))+" ")]),t("select",{directives:[{name:"model",rawName:"v-model",value:n.currentVideoResolution,expression:"currentVideoResolution"}],staticClass:"device-select",on:{change:[function(e){var t=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));n.currentVideoResolution=e.target.multiple?t:t[0]},n.setVideoQuality]}},[t("option",{attrs:{value:"",selected:"",disabled:"",hidden:""}},[e._v(e._s(n.t("default-image-resolution"))+" ")]),t("option",{attrs:{selected:""},domProps:{value:n.VideoResolution.RESOLUTION_480P}},[e._v(" 480p ")]),t("option",{attrs:{selected:""},domProps:{value:n.VideoResolution.RESOLUTION_720P}},[e._v(" 720p ")]),t("option",{attrs:{selected:""},domProps:{value:n.VideoResolution.RESOLUTION_1080P}},[e._v(" 1080p ")])])]):e._e()]},proxy:!0}],null,!1,3164272144)}):e._e(),t(n.ControlPanelItem,{attrs:{action:n.toggleMicrophone,hasDetail:!n.isMobile,isMobile:n.isMobile,size:n.isMobile?"medium":"small"},scopedSlots:e._u([{key:"text",fn:function(){var t;return[e._v(" "+e._s(null!=(t=n.profile)&&t.microphone?n.t("microphone-opened"):n.t("microphone-closed"))+" ")]},proxy:!0},{key:"icon",fn:function(){var i,r;return[null!=(i=n.profile)&&i.microphone?t(n.MicrophoneSVG):e._e(),null!=(r=n.profile)&&r.microphone?e._e():t(n.MicrophoneClosedBigSVG)]},proxy:!0},{key:"detail",fn:function(){var i;return[t("div",[e._v(" "+e._s(n.t("microphone"))+" "),t("select",{directives:[{name:"model",rawName:"v-model",value:n.currentMicrophone,expression:"currentMicrophone"}],staticClass:"device-select",on:{change:[function(e){var t=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));n.currentMicrophone=e.target.multiple?t:t[0]},n.switchMicrophoneDevice],click:function(e){return n.TUICallKitServer.updateMicrophoneList()}}},[t("option",{attrs:{value:"",selected:"",disabled:"",hidden:""}},[e._v(e._s(n.microphoneList&&(null==(i=n.microphoneList[0])?void 0:i.label)))]),e._l(n.microphoneList,(function(n){return t("option",{key:n.deviceId,domProps:{value:n.deviceId}},[e._v(" "+e._s(n.label)+" ")])}))],2)])]},proxy:!0}])}),e._e(),"calling-c2c-video"===n.status?t(n.ControlPanelItem,{directives:[{name:"show",rawName:"v-show",value:!n.isMobile,expression:"!isMobile"}],attrs:{action:n.switchCallMediaType},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(n.t("video-to-audio"))+" ")]},proxy:!0},{key:"icon",fn:function(){return[t(n.SwitchSVG)]},proxy:!0}],null,!1,73422974)}):e._e(),t(n.ControlPanelItem,{directives:[{name:"show",rawName:"v-show",value:!n.isMobile,expression:"!isMobile"}],attrs:{action:n.hangup},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(n.isMobile?"":n.t("hangup"))+" ")]},proxy:!0},{key:"icon",fn:function(){return[t(n.HangupSVG)]},proxy:!0}])})]:e._e()],2),n.status!==n.STATUS.IDLE&&n.status!==n.STATUS.BE_INVITED?t("div",{staticClass:"panel-hangup"},[t(n.ControlPanelItem,{directives:[{name:"show",rawName:"v-show",value:n.isMobile,expression:"isMobile"}],attrs:{action:n.hangup,size:n.isMobile?"large":"small"},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(n.isMobile?"":n.t("hangup"))+" ")]},proxy:!0},{key:"icon",fn:function(){return[t(n.HangupSVG)]},proxy:!0}],null,!1,1170238159)})],1):e._e()])},mn=[],yn=Ie(_n,vn,mn,!1,null,"936e18a2",null,null);const In=yn.exports,Tn={};var Cn=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 15 24"}},[t("path",{attrs:{d:"M13.8431 1.14248C14.6564 1.93792 14.7145 3.1923 14.0174 4.0533L13.8431 4.24463L5.91455 11.9997L13.8431 19.7554C14.6564 20.5508 14.7145 21.8052 14.0174 22.6662L13.8431 22.8575C13.0299 23.653 11.7475 23.7098 10.8672 23.028L10.6716 22.8575L1.15685 13.5511C0.343607 12.7556 0.285517 11.5013 0.982587 10.6402L1.15685 10.4489L10.6716 1.14248C11.5474 0.285841 12.9673 0.285841 13.8431 1.14248Z",fill:"#fff"}})])},Sn=[],En=Ie(Tn,Cn,Sn,!1,null,null,null,null);const bn=En.exports,Mn={};var kn=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 15 24"}},[t("path",{attrs:{d:"M1.15685 1.14248C0.343606 1.93792 0.285517 3.1923 0.982587 4.0533L1.15685 4.24463L9.08545 11.9997L1.15685 19.7554C0.343606 20.5508 0.285517 21.8052 0.982587 22.6662L1.15685 22.8575C1.9701 23.653 3.25255 23.7098 4.13282 23.028L4.32843 22.8575L13.8431 13.5511C14.6564 12.7556 14.7145 11.5013 14.0174 10.6402L13.8431 10.4489L4.32843 1.14248C3.45262 0.285841 2.03266 0.285841 1.15685 1.14248Z",fill:"#fff"}})])},wn=[],Dn=Ie(Mn,kn,wn,!1,null,null,null,null);const An=Dn.exports,Rn=(0,a.defineComponent)({__name:"Calling-Group",setup(e){const t=(0,a.ref)(1),n=(0,a.ref)([]),i=(0,a.ref)("group-user-view"),r=(0,a.ref)("group-calling-container"),o=(0,a.ref)("user-view-user-id");async function s(){let e=[];for(let n=8*(t.value-1);n<8*t.value&&n<P.value.length;n++)e.push(P.value[n]);n.value=e}function c(){t.value>1&&t.value--}function u(){t.value<Math.floor((P.value.length-1)/8+1)&&t.value++}return(0,a.onMounted)((async()=>{(R.value===m.CALLING_GROUP_VIDEO||R.value===m.CALLING_GROUP_AUDIO)&&await Li.renderLocal(),await Li.renderRemoteWaitList()})),(0,a.watch)(n,(async()=>{const e=n.value.length+1;i.value=`group-user-view group-user-view-${e}`,r.value=`group-calling-container group-calling-container-${e}`,o.value=`user-view-user-id user-view-user-id-${e}`,Li.renderRemoteList(n.value)}),{flush:"post",deep:!0}),(0,a.watchEffect)((async()=>{await s()})),{__sfc:!0,currentPage:t,currentPageRemoteList:n,groupUserViewClass:i,groupCallingContainerClass:r,userViewUserId:o,refreshCurrentPageRemoteList:s,pageReduce:c,pageIncrease:u,isFromGroup:x,remoteList:P,callType:N,profile:G,t:B,getVolumeByUserID:te,MicrophoneIcon:Ee,CALL_TYPE_STRING:I,LeftSVG:bn,RightSVG:An,MicrophoneClosedSVG:De}}});var Ln=function(){var e,t,n=this,i=n._self._c,r=n._self._setupProxy;return i("div",{staticClass:"calling-wrapper"},[r.remoteList.length>8?[i("div",{staticClass:"page-turn left",on:{click:r.pageReduce}},[i("div",{staticClass:"turn-icon-container"},[i(r.LeftSVG)],1)]),i("div",{staticClass:"page-turn right",on:{click:r.pageIncrease}},[i("div",{staticClass:"turn-icon-container"},[i(r.RightSVG)],1)])]:n._e(),i("div",{class:r.groupCallingContainerClass},[i("div",{class:r.groupUserViewClass,attrs:{id:"local-group"}},[i("span",{staticClass:"tag"},[i("div",{staticClass:"microphone-icon-container"},[null!=(e=r.profile)&&e.microphone?i(r.MicrophoneIcon,{attrs:{volume:r.getVolumeByUserID(r.profile.userID)}}):i(r.MicrophoneClosedSVG)],1),n._v(" "+n._s(`${null==(t=r.profile)?void 0:t.nick} ${r.t("me")}`)+" ")])]),n._l(r.currentPageRemoteList,(function(e){return i("div",{key:e.userID,class:r.groupUserViewClass,attrs:{id:e.userID}},[!e.isEntered||r.isFromGroup&&r.callType===r.CALL_TYPE_STRING.AUDIO?[i("div",{staticClass:"user-view-text-container"},[i("div",{class:r.userViewUserId},[n._v(" "+n._s(null==e?void 0:e.nick)+" ")]),i("div",{staticClass:"user-view-info"},[n._v(" "+n._s(e.isEntered?r.t("already-enter"):r.t("waiting"))+" ")])])]:n._e(),i("span",{staticClass:"tag"},[i("div",{staticClass:"microphone-icon-container"},[null!=e&&e.microphone?i(r.MicrophoneIcon,{attrs:{volume:r.getVolumeByUserID(null==e?void 0:e.userID)}}):i(r.MicrophoneClosedSVG)],1),n._v(" "+n._s(null==e?void 0:e.nick)+" ")])],2)}))],2)],2)},On=[],Nn=Ie(Rn,Ln,On,!1,null,"d7638336",null,null);const xn=Nn.exports,Pn={};var Un=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"design-iconfont",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"}},[t("path",{attrs:{d:"M13.733 6.99996C13.7997 6.99996 13.933 6.99996 13.9997 6.93329C14.133 6.86663 14.2663 6.73329 14.333 6.59996C14.3997 6.46663 14.3997 6.26663 14.333 6.06663C14.2663 5.99996 14.2663 5.93329 14.1997 5.86663L10.1997 1.86663C9.93301 1.59996 9.53301 1.59996 9.26634 1.86663C8.99967 2.13329 8.99967 2.53329 9.26634 2.79996L12.133 5.66663H1.99967C1.59967 5.66663 1.33301 5.93329 1.33301 6.33329C1.33301 6.73329 1.59967 6.99996 1.99967 6.99996H13.733ZM13.9997 8.99996H2.26634C2.19967 8.99996 2.06634 8.99996 1.99967 9.06663C1.86634 9.13329 1.73301 9.26663 1.66634 9.39996C1.59967 9.53329 1.59967 9.73329 1.66634 9.93329C1.73301 9.99996 1.73301 10.0666 1.79967 10.1333L5.79967 14.1333C5.93301 14.2666 6.13301 14.3333 6.26634 14.3333C6.39967 14.3333 6.59967 14.2666 6.73301 14.1333C6.99967 13.8666 6.99967 13.4666 6.73301 13.2L3.86634 10.3333H13.9997C14.3997 10.3333 14.6663 10.0666 14.6663 9.66663C14.6663 9.26663 14.3997 8.99996 13.9997 8.99996Z",fill:"#fff"}})])},Gn=[],Vn=Ie(Pn,Un,Gn,!1,null,null,null,null);const Fn=Vn.exports,Bn=(0,a.defineComponent)({__name:"Calling-C2CVideo",setup(e){(0,a.onMounted)((async()=>{await Li.renderLocal(),await Li.renderRemoteWaitList()}));const t=(0,a.ref)("small"),n=(0,a.ref)("small-h5"),i=(0,a.ref)("large"),r=async()=>{if(Ae)[n.value,i.value]=[i.value,n.value];else{[t.value,i.value]=[i.value,t.value],await(0,a.nextTick)();const e=document.getElementsByClassName("large")[0],n=document.getElementsByClassName("small")[0];n.style.height="170px",n.style.width="260px",e.style.height="100%",e.style.width="100%"}};return{__sfc:!0,localClass:t,localClassH5:n,remoteClass:i,switchUserView:r,h5SwitchUserView:async()=>{!Ae||r()},remoteList:P,profile:G,t:B,getVolumeByUserID:te,MicrophoneIcon:Ee,Switch2SVG:Fn,MicrophoneClosedSVG:De,isMobile:Ae}}});var jn=function(){var e,t,n,i,r,o=this,a=o._self._c,s=o._self._setupProxy;return a("div",{staticClass:"calling-wrapper"},[a("div",{class:s.isMobile?s.localClassH5:s.localClass,attrs:{id:"local-c2c"},on:{click:s.h5SwitchUserView}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!s.isMobile,expression:"!isMobile"}],staticClass:"tag"},[a("div",{staticClass:"microphone-icon-container"},[null!=(e=s.profile)&&e.microphone?a(s.MicrophoneIcon,{attrs:{volume:s.getVolumeByUserID(s.profile.userID)}}):a(s.MicrophoneClosedSVG)],1),o._v(" "+o._s(`${null==(t=s.profile)?void 0:t.nick} ${s.t("me")}`)+" ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:!s.isMobile,expression:"!isMobile"}],staticClass:"switch-large-small",on:{click:s.switchUserView}},[a(s.Switch2SVG)],1)]),s.remoteList.length>=1?[a("div",{class:s.remoteClass,attrs:{id:s.remoteList[0].userID},on:{click:s.h5SwitchUserView}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!s.isMobile,expression:"!isMobile"}],staticClass:"tag"},[a("div",{staticClass:"microphone-icon-container"},[null!=(n=s.remoteList[0])&&n.microphone?a(s.MicrophoneIcon,{attrs:{volume:s.getVolumeByUserID(null==(i=s.remoteList[0])?void 0:i.userID)}}):a(s.MicrophoneClosedSVG)],1),o._v(" "+o._s(null==(r=s.remoteList[0])?void 0:r.nick)+" ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:!s.isMobile,expression:"!isMobile"}],staticClass:"switch-large-small",on:{click:s.switchUserView}},[a(s.Switch2SVG)],1)])]:o._e()],2)},qn=[],Hn=Ie(Bn,jn,qn,!1,null,"9e9f40b5",null,null);const zn=Hn.exports,Kn={};var Wn=function(){var e=this,t=e._self._c;return t("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("rect",{attrs:{x:"0.769231",y:"0.769231",width:"18.4615",height:"18.4615",rx:"0.769231",stroke:"white","stroke-width":"1.53846"}}),t("path",{attrs:{d:"M11.5385 12.3077C11.5385 11.8829 11.8829 11.5385 12.3077 11.5385H19.2308V18.4615C19.2308 18.8864 18.8864 19.2308 18.4616 19.2308H11.5385V12.3077Z",stroke:"white","stroke-width":"1.53846"}}),t("path",{attrs:{d:"M0.769287 0.769226L8.9723 8.92412",stroke:"white","stroke-width":"1.53846"}}),t("path",{attrs:{d:"M9.4967 4.71716V9.4486H4.74146",stroke:"white","stroke-width":"1.53846","stroke-linecap":"round","stroke-linejoin":"round"}})])},Yn=[],Jn=Ie(Kn,Wn,Yn,!1,null,null,null,null);const Zn=Jn.exports,Xn={};var Qn=function(){var e=this,t=e._self._c;return t("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.66683 9.33337H3.3335V4.00004C3.3335 3.63185 3.63197 3.33337 4.00016 3.33337L9.3335 3.33337V4.66671H5.60963L9.8049 8.86199L8.86209 9.8048L4.66683 5.60952V9.33337ZM15.3333 10.6667H16.6667V16C16.6667 16.3682 16.3682 16.6667 16 16.6667L10.6667 16.6667L10.6667 15.3333H14.3905L10.1953 11.138L11.1381 10.1952L15.3333 14.3905V10.6667Z",fill:"white"}}),t("path",{attrs:{d:"M0.666667 1.33333C0.666667 0.965144 0.965144 0.666667 1.33333 0.666667H18.6667C19.0349 0.666667 19.3333 0.965144 19.3333 1.33333V18.6667C19.3333 19.0349 19.0349 19.3333 18.6667 19.3333H1.33333C0.965143 19.3333 0.666667 19.0349 0.666667 18.6667V1.33333Z",stroke:"white","stroke-width":"1.33333"}})])},$n=[],ei=Ie(Xn,Qn,$n,!1,null,null,null,null);const ti=ei.exports,ni=(0,a.defineComponent)({__name:"TUICallKit",props:{beforeCalling:null,afterCalling:null,onMinimized:null,onMessageSentByMe:null,allowedMinimized:{type:Boolean,default:!1},allowedFullScreen:{type:Boolean,default:!0},videoDisplayMode:{default:l.COVER},videoResolution:{default:d.RESOLUTION_480P},lang:{default:"zh-cn"}},emits:["kicked-out","status-changed"],setup(e,{emit:t}){const n=e;C.value=t;const{beforeCalling:i,afterCalling:r,onMinimized:o,onMessageSentByMe:s,allowedMinimized:c,allowedFullScreen:u,videoDisplayMode:l,videoResolution:d}=(0,a.toRefs)(n);function h(){document.fullscreenElement&&document.exitFullscreen(),Li.toggleMinimize()}function p(){let e=document.getElementById("tui-call-kit-id");document.fullscreenElement?document.exitFullscreen():e.requestFullscreen().catch((e=>{alert(`Error attempting to enable fullscreen mode: ${e.message} (${e.name})`)}))}return(0,a.watchEffect)((()=>{Li.setCallback({beforeCalling:i&&i.value,afterCalling:r&&r.value,onMinimized:o&&o.value,onMessageSentByMe:s&&s.value}),E.value=l.value,b.value=d.value})),{__sfc:!0,emits:t,props:n,beforeCalling:i,afterCalling:r,onMinimized:o,onMessageSentByMe:s,allowedMinimized:c,allowedFullScreen:u,videoDisplayMode:l,videoResolution:d,toggleMinimize:h,toggleFullscreen:p,Dialing:ct,ControlPanel:In,CallingGroup:xn,CallingC2CVideo:zn,status:R,isMinimized:L,STATUS:m,MinimizeSVG:Zn,fullScreenSVG:ti}}});var ii=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return n.status!==n.STATUS.IDLE?t("div",{directives:[{name:"show",rawName:"v-show",value:!n.isMinimized,expression:"!isMinimized"}],staticClass:"tui-call-kit",attrs:{id:"tui-call-kit-id"}},[t("div",{staticClass:"function-buttons"},[n.status!==n.STATUS.IDLE&&!0===n.allowedMinimized&&n.status!==n.STATUS.DIALING_C2C&&n.status!==n.STATUS.DIALING_GROUP&&n.status!==n.STATUS.BE_INVITED?t("div",{staticClass:"minimize",on:{click:n.toggleMinimize}},[t(n.MinimizeSVG)],1):e._e(),!0===n.allowedFullScreen?t("div",{staticClass:"minimize",on:{click:n.toggleFullscreen}},[t(n.fullScreenSVG)],1):e._e()]),n.status===n.STATUS.BE_INVITED||n.status===n.STATUS.DIALING_C2C||n.status===n.STATUS.CALLING_C2C_AUDIO?t(n.Dialing):e._e(),n.status===n.STATUS.CALLING_C2C_VIDEO?t(n.CallingC2CVideo):e._e(),n.status===n.STATUS.DIALING_GROUP||n.status===n.STATUS.CALLING_GROUP_AUDIO||n.status===n.STATUS.CALLING_GROUP_VIDEO?t(n.CallingGroup):e._e(),n.status!==n.STATUS.IDLE?t(n.ControlPanel):e._e()],1):e._e()},ri=[],oi=Ie(ni,ii,ri,!1,null,"b7cabd07",null,null);const ai=oi.exports,si={};var ci=function(){var e=this,t=e._self._c;return t("svg",{attrs:{width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M18.4437 12.449C18.4437 14.1142 18.2336 15.3515 21.5089 15.7126C24.7875 16.0737 24.3666 13.6794 24.3662 12.0669C24.3649 10.2061 20.0602 7.61895 13.2726 7.6173C6.48662 7.61735 2.1789 10.205 2.17888 12.067C2.17887 13.68 1.75621 16.0726 5.03315 15.7123C8.31009 15.3537 8.10005 14.1155 8.09837 12.4495C8.10134 11.2862 10.7587 11.0316 13.2725 11.0298C15.7863 11.0281 18.4454 11.2844 18.4437 12.449Z",fill:"#FE3C44"}})])},ui=[],li=Ie(si,ci,ui,!1,null,null,null,null);const di=li.exports,hi={};var pi=function(){var e=this,t=e._self._c;return t("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66666 4.16668C6.66666 2.32834 8.16166 0.833344 9.99999 0.833344C11.8383 0.833344 13.3333 2.32834 13.3333 4.16668V9.16668C13.3333 11.005 11.8383 12.5 9.99999 12.5C8.16166 12.5 6.66666 11.005 6.66666 9.16668V4.16668ZM6.66666 18.3333C6.66666 17.8725 7.03999 17.5 7.49999 17.5H12.5C12.9608 17.5 13.3333 17.8725 13.3333 18.3333C13.3333 18.7942 12.9608 19.1667 12.5 19.1667H7.49999C7.03999 19.1667 6.66666 18.7942 6.66666 18.3333Z",fill:"#101419"}}),t("path",{attrs:{d:"M15.8333 8.3512V9.50825C15.8333 12.081 13.2217 15 9.99999 15C6.77833 15 4.16666 12.081 4.16666 9.50825V8.33334",stroke:"#101419","stroke-width":"1.66667","stroke-linecap":"round"}})])},fi=[],gi=Ie(hi,pi,fi,!1,null,null,null,null);const _i=gi.exports,vi={};var mi=function(){var e=this,t=e._self._c;return t("svg",{attrs:{width:"15",height:"21",viewBox:"0 0 15 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.6247 0.719168C14.1934 0.374158 13.5641 0.44408 13.2191 0.875342L10.8168 3.83203C10.1789 3.02455 9.15387 2.50004 8.00001 2.50004C6.06976 2.50004 4.50001 3.96785 4.50001 5.77276V10.6819C4.50001 10.9563 4.5363 11.2229 4.60463 11.4778L3.388 12.9752C2.98449 12.3433 2.75001 11.6522 2.75001 10.9717V9.81819L2.74319 9.71556C2.6892 9.31213 2.32108 9.00001 1.87501 9.00001C1.39176 9.00001 1.00001 9.36632 1.00001 9.81819V10.9717L1.00466 11.1761C1.05557 12.2968 1.52161 13.4016 2.26939 14.3519L0.219137 16.8753L0.146861 16.9782C-0.112977 17.4017 -0.0227767 17.9624 0.375311 18.2809C0.806573 18.6259 1.43587 18.556 1.78088 18.1247L3.71661 15.7423C3.71849 15.7437 3.72038 15.745 3.72227 15.7464L4.2997 15.0246L8.28088 10.1247L14.7809 2.12473L14.8532 2.02191C15.113 1.59834 15.0228 1.03764 14.6247 0.719168ZM7.72499 13.9446L11.5 9.22582V10.6819C11.5 12.4868 9.93026 13.9546 8.00001 13.9546C7.90746 13.9546 7.81575 13.9512 7.72499 13.9446ZM6.60445 15.3453L5.50798 16.7159C6.29225 17.0136 7.13532 17.1818 8.00001 17.1818C11.6976 17.1818 15 14.1064 15 10.9717V9.83572L14.9932 9.73309C14.9392 9.32966 14.5711 9.01754 14.125 9.01754C13.6418 9.01754 13.25 9.38385 13.25 9.83572V10.9717L13.2445 11.1527C13.1138 13.3262 10.6589 15.5455 8.00001 15.5455C7.52424 15.5455 7.05501 15.4744 6.60445 15.3453ZM5.37501 18.8637C4.89201 18.8637 4.50001 19.2294 4.50001 19.6819C4.50001 20.1343 4.89201 20.5 5.37501 20.5H10.625C11.1089 20.5 11.5 20.1343 11.5 19.6819C11.5 19.2294 11.1089 18.8637 10.625 18.8637H5.37501Z",fill:"#101419"}})])},yi=[],Ii=Ie(vi,mi,yi,!1,null,null,null,null);const Ti=Ii.exports,Ci={};var Si=function(){var e=this,t=e._self._c;return t("svg",{attrs:{width:"21",height:"21",viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.33337 9.33331H0.333374V0.99998C0.333374 0.63179 0.631851 0.333313 1.00004 0.333313L9.33338 0.333313V2.33331H3.74758L10.0405 8.62624L8.62627 10.0404L2.33337 3.74753V9.33331ZM18.3331 11.3333H20.3331V19.6666C20.3331 20.0348 20.0347 20.3333 19.6665 20.3333L11.3331 20.3333L11.3331 18.3333H16.9189L10.626 12.0403L12.0402 10.6261L18.3331 16.919V11.3333Z",fill:"#101419"}})])},Ei=[],bi=Ie(Ci,Si,Ei,!1,null,null,null,null);const Mi=bi.exports,ki=(0,a.defineComponent)({__name:"TUICallKitMini",setup(e){function t(){Li.toggleMinimize()}async function n(){await Li.hangup()}async function i(){var e;null!=(e=G.value)&&e.microphone?await Li.closeMicrophone():await Li.openMicrophone()}return{__sfc:!0,toggleMinimize:t,hangup:n,toggleMicrophone:i,profile:G,status:R,isMinimized:L,STATUS:m,FloatCallEnd:di,FloatMicrophoneSVG:_i,FloatMicrophoneClosedSVG:Ti,FloatFullScreenSVG:Mi}}});var wi=function(){var e,t,n=this,i=n._self._c,r=n._self._setupProxy;return r.status!==r.STATUS.IDLE?i("div",{directives:[{name:"show",rawName:"v-show",value:r.isMinimized,expression:"isMinimized"}],staticClass:"float-control-panel"},[i("div",{staticClass:"float-control-item-icon"},[i("div",{staticClass:"float-control-item-icon-container",on:{click:r.hangup}},[i(r.FloatCallEnd)],1)]),i("div",{staticClass:"float-control-item-icon"},[i("div",{staticClass:"float-control-item-icon-container",on:{click:r.toggleMicrophone}},[null!=(e=r.profile)&&e.microphone?i(r.FloatMicrophoneSVG):n._e(),null!=(t=r.profile)&&t.microphone?n._e():i(r.FloatMicrophoneClosedSVG)],1)]),i("div",{staticClass:"float-control-item-icon"},[i("div",{staticClass:"float-control-item-icon-container",on:{click:r.toggleMinimize}},[i(r.FloatFullScreenSVG)],1)])]):n._e()},Di=[],Ai=Ie(ki,wi,Di,!1,null,"66c9ea30",null,null);const Ri=Ai.exports,Li=new me,Oi=e=>(e.component("TUICallKit",{server:Li}),e.component("TUICallKitMini",{server:Li}),Li.bindTUICore(e),ai),Ni=e=>{e.component("TUICallKitMini",Ri),e.component("TUICallKit",ai),console.log("TUICallKit&mini installed",e)};ai.plugin=Oi,ai.install=Ni;Li.version;n(1439),n(7585),n(5315),n(2087);var xi="undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Pi=[],Ui=[],Gi="undefined"!=typeof Uint8Array?Uint8Array:Array,Vi=!1;function Fi(){Vi=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)Pi[t]=e[t],Ui[e.charCodeAt(t)]=t;Ui["-".charCodeAt(0)]=62,Ui["_".charCodeAt(0)]=63}function Bi(e,t,n){for(var i,r,o=[],a=t;a<n;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(Pi[(r=i)>>18&63]+Pi[r>>12&63]+Pi[r>>6&63]+Pi[63&r]);return o.join("")}function ji(e){var t;Vi||Fi();for(var n=e.length,i=n%3,r="",o=[],a=0,s=n-i;a<s;a+=16383)o.push(Bi(e,a,a+16383>s?s:a+16383));return 1===i?(t=e[n-1],r+=Pi[t>>2],r+=Pi[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=Pi[t>>10],r+=Pi[t>>4&63],r+=Pi[t<<2&63],r+="="),o.push(r),o.join("")}function qi(e,t,n,i,r){var o,a,s=8*r-i-1,c=(1<<s)-1,u=c>>1,l=-7,d=n?r-1:0,h=n?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=i;l>0;a=256*a+e[t+d],d+=h,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=u}return(p?-1:1)*a*Math.pow(2,o-i)}function Hi(e,t,n,i,r,o){var a,s,c,u=8*o-r-1,l=(1<<u)-1,d=l>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*c-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+p]=255&a,p+=f,a/=256,u-=8);e[n+p-f]|=128*g}var zi={}.toString,Ki=Array.isArray||function(e){return"[object Array]"==zi.call(e)};function Wi(){return Ji.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Yi(e,t){if(Wi()<t)throw new RangeError("Invalid typed array length");return Ji.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Ji.prototype:(null===e&&(e=new Ji(t)),e.length=t),e}function Ji(e,t,n){if(!(Ji.TYPED_ARRAY_SUPPORT||this instanceof Ji))return new Ji(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Qi(this,e)}return Zi(this,e,t,n)}function Zi(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),Ji.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Ji.prototype:e=$i(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Ji.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|nr(t,n),r=(e=Yi(e,i)).write(t,n);return r!==i&&(e=e.slice(0,r)),e}(e,t,n):function(e,t){if(tr(t)){var n=0|er(t.length);return 0===(e=Yi(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?Yi(e,0):$i(e,t);if("Buffer"===t.type&&Ki(t.data))return $i(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Xi(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Qi(e,t){if(Xi(t),e=Yi(e,t<0?0:0|er(t)),!Ji.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function $i(e,t){var n=t.length<0?0:0|er(t.length);e=Yi(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function er(e){if(e>=Wi())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Wi().toString(16)+" bytes");return 0|e}function tr(e){return!(null==e||!e._isBuffer)}function nr(e,t){if(tr(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Dr(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Ar(e).length;default:if(i)return Dr(e).length;t=(""+t).toLowerCase(),i=!0}}function ir(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return mr(this,t,n);case"utf8":case"utf-8":return fr(this,t,n);case"ascii":return _r(this,t,n);case"latin1":case"binary":return vr(this,t,n);case"base64":return pr(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yr(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function rr(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function or(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=Ji.from(t,i)),tr(t))return 0===t.length?-1:ar(e,t,n,i,r);if("number"==typeof t)return t&=255,Ji.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):ar(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function ar(e,t,n,i,r){var o,a=1,s=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var l=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(u(e,o+h)!==u(t,h)){d=!1;break}if(d)return o}return-1}function sr(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function cr(e,t,n,i){return Rr(Dr(t,e.length-n),e,n,i)}function ur(e,t,n,i){return Rr(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function lr(e,t,n,i){return ur(e,t,n,i)}function dr(e,t,n,i){return Rr(Ar(t),e,n,i)}function hr(e,t,n,i){return Rr(function(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function pr(e,t,n){return 0===t&&n===e.length?ji(e):ji(e.slice(t,n))}function fr(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,c,u=e[r],l=null,d=u>239?4:u>223?3:u>191?2:1;if(r+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[r+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),r+=d}return function(e){var t=e.length;if(t<=gr)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=gr));return n}(i)}Ji.TYPED_ARRAY_SUPPORT=void 0===xi.TYPED_ARRAY_SUPPORT||xi.TYPED_ARRAY_SUPPORT,Ji.poolSize=8192,Ji._augment=function(e){return e.__proto__=Ji.prototype,e},Ji.from=function(e,t,n){return Zi(null,e,t,n)},Ji.TYPED_ARRAY_SUPPORT&&(Ji.prototype.__proto__=Uint8Array.prototype,Ji.__proto__=Uint8Array),Ji.alloc=function(e,t,n){return function(e,t,n,i){return Xi(t),t<=0?Yi(e,t):void 0!==n?"string"==typeof i?Yi(e,t).fill(n,i):Yi(e,t).fill(n):Yi(e,t)}(null,e,t,n)},Ji.allocUnsafe=function(e){return Qi(null,e)},Ji.allocUnsafeSlow=function(e){return Qi(null,e)},Ji.isBuffer=Lr,Ji.compare=function(e,t){if(!tr(e)||!tr(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},Ji.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ji.concat=function(e,t){if(!Ki(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Ji.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=Ji.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!tr(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},Ji.byteLength=nr,Ji.prototype._isBuffer=!0,Ji.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)rr(this,t,t+1);return this},Ji.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)rr(this,t,t+3),rr(this,t+1,t+2);return this},Ji.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)rr(this,t,t+7),rr(this,t+1,t+6),rr(this,t+2,t+5),rr(this,t+3,t+4);return this},Ji.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?fr(this,0,e):ir.apply(this,arguments)},Ji.prototype.equals=function(e){if(!tr(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Ji.compare(this,e)},Ji.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Ji.prototype.compare=function(e,t,n,i,r){if(!tr(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(i,r),u=e.slice(t,n),l=0;l<s;++l)if(c[l]!==u[l]){o=c[l],a=u[l];break}return o<a?-1:a<o?1:0},Ji.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Ji.prototype.indexOf=function(e,t,n){return or(this,e,t,n,!0)},Ji.prototype.lastIndexOf=function(e,t,n){return or(this,e,t,n,!1)},Ji.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return sr(this,e,t,n);case"utf8":case"utf-8":return cr(this,e,t,n);case"ascii":return ur(this,e,t,n);case"latin1":case"binary":return lr(this,e,t,n);case"base64":return dr(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return hr(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Ji.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var gr=4096;function _r(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function vr(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function mr(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=wr(e[o]);return r}function yr(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function Ir(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Tr(e,t,n,i,r,o){if(!tr(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function Cr(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function Sr(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function Er(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function br(e,t,n,i,r){return r||Er(e,0,n,4),Hi(e,t,n,i,23,4),n+4}function Mr(e,t,n,i,r){return r||Er(e,0,n,8),Hi(e,t,n,i,52,8),n+8}Ji.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),Ji.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Ji.prototype;else{var r=t-e;n=new Ji(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},Ji.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Ir(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},Ji.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Ir(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},Ji.prototype.readUInt8=function(e,t){return t||Ir(e,1,this.length),this[e]},Ji.prototype.readUInt16LE=function(e,t){return t||Ir(e,2,this.length),this[e]|this[e+1]<<8},Ji.prototype.readUInt16BE=function(e,t){return t||Ir(e,2,this.length),this[e]<<8|this[e+1]},Ji.prototype.readUInt32LE=function(e,t){return t||Ir(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Ji.prototype.readUInt32BE=function(e,t){return t||Ir(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Ji.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Ir(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},Ji.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Ir(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},Ji.prototype.readInt8=function(e,t){return t||Ir(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Ji.prototype.readInt16LE=function(e,t){t||Ir(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Ji.prototype.readInt16BE=function(e,t){t||Ir(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Ji.prototype.readInt32LE=function(e,t){return t||Ir(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Ji.prototype.readInt32BE=function(e,t){return t||Ir(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Ji.prototype.readFloatLE=function(e,t){return t||Ir(e,4,this.length),qi(this,e,!0,23,4)},Ji.prototype.readFloatBE=function(e,t){return t||Ir(e,4,this.length),qi(this,e,!1,23,4)},Ji.prototype.readDoubleLE=function(e,t){return t||Ir(e,8,this.length),qi(this,e,!0,52,8)},Ji.prototype.readDoubleBE=function(e,t){return t||Ir(e,8,this.length),qi(this,e,!1,52,8)},Ji.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||Tr(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},Ji.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||Tr(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},Ji.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,1,255,0),Ji.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Ji.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,2,65535,0),Ji.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Cr(this,e,t,!0),t+2},Ji.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,2,65535,0),Ji.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Cr(this,e,t,!1),t+2},Ji.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,4,4294967295,0),Ji.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Sr(this,e,t,!0),t+4},Ji.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,4,4294967295,0),Ji.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Sr(this,e,t,!1),t+4},Ji.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);Tr(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},Ji.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);Tr(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},Ji.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,1,127,-128),Ji.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Ji.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,2,32767,-32768),Ji.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Cr(this,e,t,!0),t+2},Ji.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,2,32767,-32768),Ji.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Cr(this,e,t,!1),t+2},Ji.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,4,2147483647,-2147483648),Ji.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Sr(this,e,t,!0),t+4},Ji.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Tr(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Ji.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Sr(this,e,t,!1),t+4},Ji.prototype.writeFloatLE=function(e,t,n){return br(this,e,t,!0,n)},Ji.prototype.writeFloatBE=function(e,t,n){return br(this,e,t,!1,n)},Ji.prototype.writeDoubleLE=function(e,t,n){return Mr(this,e,t,!0,n)},Ji.prototype.writeDoubleBE=function(e,t,n){return Mr(this,e,t,!1,n)},Ji.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!Ji.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},Ji.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Ji.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=tr(e)?e:Dr(new Ji(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var kr=/[^+\/0-9A-Za-z-_]/g;function wr(e){return e<16?"0"+e.toString(16):e.toString(16)}function Dr(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Ar(e){return function(e){var t,n,i,r,o,a;Vi||Fi();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[s-2]?2:"="===e[s-1]?1:0,a=new Gi(3*s/4-o),i=o>0?s-4:s;var c=0;for(t=0,n=0;t<i;t+=4,n+=3)r=Ui[e.charCodeAt(t)]<<18|Ui[e.charCodeAt(t+1)]<<12|Ui[e.charCodeAt(t+2)]<<6|Ui[e.charCodeAt(t+3)],a[c++]=r>>16&255,a[c++]=r>>8&255,a[c++]=255&r;return 2===o?(r=Ui[e.charCodeAt(t)]<<2|Ui[e.charCodeAt(t+1)]>>4,a[c++]=255&r):1===o&&(r=Ui[e.charCodeAt(t)]<<10|Ui[e.charCodeAt(t+1)]<<4|Ui[e.charCodeAt(t+2)]>>2,a[c++]=r>>8&255,a[c++]=255&r),a}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(kr,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Rr(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function Lr(e){return null!=e&&(!!e._isBuffer||Or(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Or(e.slice(0,0))}(e))}function Or(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function Nr(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var xr=Nr((function(e,t){var n;e.exports=(n=n||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},o=r.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<r;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=a<<24-(i+o)%4*8}else for(o=0;o<r;o+=4)t[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=function(t){var n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var s=r(4294967296*(n||e.random()));n=987654071*s(),i.push(4294967296*s()|0)}return new a.init(i,t)}}),s=i.enc={},c=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new a.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,s=4*o,c=r/s,u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*o,l=e.min(4*u,r);if(u){for(var d=0;d<u;d+=o)this._doProcessBlock(i,d);var h=i.splice(0,u);n.sigBytes-=l}return new a.init(h,l)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(r.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math),n)})),Pr=(Nr((function(e,t){var n,i,r,o,a,s;e.exports=(r=(i=n=xr).lib,o=r.Base,a=r.WordArray,(s=i.x64={}).Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var r=e[i];n.push(r.high),n.push(r.low)}return a.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}}),n)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,i=[],r=0;r<n;r++)i[r>>>2]|=e[r]<<24-r%4*8;t.call(this,i,n)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib.WordArray,i=e.enc;function r(e){return e<<8&4278255360|e>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r+=2){var o=t[r>>>2]>>>16-r%4*8&65535;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var n=e.length,i=[],r=0;r<n;r++)i[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return t.create(i,2*n)}},i.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o+=2){var a=r(t[o>>>2]>>>16-o%4*8&65535);i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var n=e.length,i=[],o=0;o<n;o++)i[o>>>1]|=r(e.charCodeAt(o)<<16-o%2*16);return t.create(i,2*n)}}}(),n.enc.Utf16)})),Nr((function(e,t){var n,i,r;e.exports=(r=(i=n=xr).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],o=0;o<n;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<n;s++)r.push(i.charAt(a>>>6*(3-s)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<n.length;o++)i[n.charCodeAt(o)]=o}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,n){for(var i=[],o=0,a=0;a<t;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2,c=n[e.charCodeAt(a)]>>>6-a%4*2;i[o>>>2]|=(s|c)<<24-o%4*8,o++}return r.create(i,o)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),Nr((function(e,t){var n;e.exports=(n=xr,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],p=e[t+2],f=e[t+3],g=e[t+4],_=e[t+5],v=e[t+6],m=e[t+7],y=e[t+8],I=e[t+9],T=e[t+10],C=e[t+11],S=e[t+12],E=e[t+13],b=e[t+14],M=e[t+15],k=o[0],w=o[1],D=o[2],A=o[3];k=u(k,w,D,A,a,7,s[0]),A=u(A,k,w,D,c,12,s[1]),D=u(D,A,k,w,p,17,s[2]),w=u(w,D,A,k,f,22,s[3]),k=u(k,w,D,A,g,7,s[4]),A=u(A,k,w,D,_,12,s[5]),D=u(D,A,k,w,v,17,s[6]),w=u(w,D,A,k,m,22,s[7]),k=u(k,w,D,A,y,7,s[8]),A=u(A,k,w,D,I,12,s[9]),D=u(D,A,k,w,T,17,s[10]),w=u(w,D,A,k,C,22,s[11]),k=u(k,w,D,A,S,7,s[12]),A=u(A,k,w,D,E,12,s[13]),D=u(D,A,k,w,b,17,s[14]),k=l(k,w=u(w,D,A,k,M,22,s[15]),D,A,c,5,s[16]),A=l(A,k,w,D,v,9,s[17]),D=l(D,A,k,w,C,14,s[18]),w=l(w,D,A,k,a,20,s[19]),k=l(k,w,D,A,_,5,s[20]),A=l(A,k,w,D,T,9,s[21]),D=l(D,A,k,w,M,14,s[22]),w=l(w,D,A,k,g,20,s[23]),k=l(k,w,D,A,I,5,s[24]),A=l(A,k,w,D,b,9,s[25]),D=l(D,A,k,w,f,14,s[26]),w=l(w,D,A,k,y,20,s[27]),k=l(k,w,D,A,E,5,s[28]),A=l(A,k,w,D,p,9,s[29]),D=l(D,A,k,w,m,14,s[30]),k=d(k,w=l(w,D,A,k,S,20,s[31]),D,A,_,4,s[32]),A=d(A,k,w,D,y,11,s[33]),D=d(D,A,k,w,C,16,s[34]),w=d(w,D,A,k,b,23,s[35]),k=d(k,w,D,A,c,4,s[36]),A=d(A,k,w,D,g,11,s[37]),D=d(D,A,k,w,m,16,s[38]),w=d(w,D,A,k,T,23,s[39]),k=d(k,w,D,A,E,4,s[40]),A=d(A,k,w,D,a,11,s[41]),D=d(D,A,k,w,f,16,s[42]),w=d(w,D,A,k,v,23,s[43]),k=d(k,w,D,A,I,4,s[44]),A=d(A,k,w,D,S,11,s[45]),D=d(D,A,k,w,M,16,s[46]),k=h(k,w=d(w,D,A,k,p,23,s[47]),D,A,a,6,s[48]),A=h(A,k,w,D,m,10,s[49]),D=h(D,A,k,w,b,15,s[50]),w=h(w,D,A,k,_,21,s[51]),k=h(k,w,D,A,S,6,s[52]),A=h(A,k,w,D,f,10,s[53]),D=h(D,A,k,w,T,15,s[54]),w=h(w,D,A,k,c,21,s[55]),k=h(k,w,D,A,y,6,s[56]),A=h(A,k,w,D,M,10,s[57]),D=h(D,A,k,w,v,15,s[58]),w=h(w,D,A,k,E,21,s[59]),k=h(k,w,D,A,g,6,s[60]),A=h(A,k,w,D,C,10,s[61]),D=h(D,A,k,w,p,15,s[62]),w=h(w,D,A,k,I,21,s[63]),o[0]=o[0]+k|0,o[1]=o[1]+w|0,o[2]=o[2]+D|0,o[3]=o[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var o=e.floor(i/4294967296),a=i;n[15+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,i,r,o,a){var s=e+(t&n|~t&i)+r+a;return(s<<o|s>>>32-o)+t}function l(e,t,n,i,r,o,a){var s=e+(t&i|n&~i)+r+a;return(s<<o|s>>>32-o)+t}function d(e,t,n,i,r,o,a){var s=e+(t^n^i)+r+a;return(s<<o|s>>>32-o)+t}function h(e,t,n,i,r,o,a){var s=e+(n^(t|~i))+r+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),n.MD5)})),Nr((function(e,t){var n,i,r,o,a,s,c,u;e.exports=(r=(i=n=xr).lib,o=r.WordArray,a=r.Hasher,s=i.algo,c=[],u=s.SHA1=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(i<<5|i>>>27)+s+c[u];d+=u<20?1518500249+(r&o|~r&a):u<40?1859775393+(r^o^a):u<60?(r&o|r&a|o&a)-1894007588:(r^o^a)-899497514,s=a,a=o,o=r<<30|r>>>2,r=i,i=d}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=a._createHelper(u),i.HmacSHA1=a._createHmacHelper(u),n.SHA1)})),Nr((function(e,t){var n;e.exports=(n=xr,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,r=0;r<64;)t(i)&&(r<8&&(s[r]=n(e.pow(i,.5))),c[r]=n(e.pow(i,1/3)),r++),i++}();var u=[],l=a.SHA256=o.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],h=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var f=u[p-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,_=u[p-2],v=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[p]=g+u[p-7]+v+u[p-16]}var m=i&r^i&o^r&o,y=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),I=h+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+c[p]+u[p];h=d,d=l,l=s,s=a+I|0,a=o,o=r,r=i,i=I+(y+m)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),n.SHA256)})),Nr((function(e,t){var n,i,r,o,a,s;e.exports=(r=(i=n=xr).lib.WordArray,o=i.algo,a=o.SHA256,s=o.SHA224=a.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),i.SHA224=a._createHelper(s),i.HmacSHA224=a._createHmacHelper(s),n.SHA224)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib.Hasher,i=e.x64,r=i.Word,o=i.WordArray,a=e.algo;function s(){return r.create.apply(r,arguments)}var c=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=s()}();var l=a.SHA512=t.extend({_doReset:function(){this._hash=new o.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],h=n[7],p=i.high,f=i.low,g=r.high,_=r.low,v=o.high,m=o.low,y=a.high,I=a.low,T=s.high,C=s.low,S=l.high,E=l.low,b=d.high,M=d.low,k=h.high,w=h.low,D=p,A=f,R=g,L=_,O=v,N=m,x=y,P=I,U=T,G=C,V=S,F=E,B=b,j=M,q=k,H=w,z=0;z<80;z++){var K=u[z];if(z<16)var W=K.high=0|e[t+2*z],Y=K.low=0|e[t+2*z+1];else{var J=u[z-15],Z=J.high,X=J.low,Q=(Z>>>1|X<<31)^(Z>>>8|X<<24)^Z>>>7,$=(X>>>1|Z<<31)^(X>>>8|Z<<24)^(X>>>7|Z<<25),ee=u[z-2],te=ee.high,ne=ee.low,ie=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,re=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),oe=u[z-7],ae=oe.high,se=oe.low,ce=u[z-16],ue=ce.high,le=ce.low;W=(W=(W=Q+ae+((Y=$+se)>>>0<$>>>0?1:0))+ie+((Y+=re)>>>0<re>>>0?1:0))+ue+((Y+=le)>>>0<le>>>0?1:0),K.high=W,K.low=Y}var de,he=U&V^~U&B,pe=G&F^~G&j,fe=D&R^D&O^R&O,ge=A&L^A&N^L&N,_e=(D>>>28|A<<4)^(D<<30|A>>>2)^(D<<25|A>>>7),ve=(A>>>28|D<<4)^(A<<30|D>>>2)^(A<<25|D>>>7),me=(U>>>14|G<<18)^(U>>>18|G<<14)^(U<<23|G>>>9),ye=(G>>>14|U<<18)^(G>>>18|U<<14)^(G<<23|U>>>9),Ie=c[z],Te=Ie.high,Ce=Ie.low,Se=q+me+((de=H+ye)>>>0<H>>>0?1:0),Ee=ve+ge;q=B,H=j,B=V,j=F,V=U,F=G,U=x+(Se=(Se=(Se=Se+he+((de+=pe)>>>0<pe>>>0?1:0))+Te+((de+=Ce)>>>0<Ce>>>0?1:0))+W+((de+=Y)>>>0<Y>>>0?1:0))+((G=P+de|0)>>>0<P>>>0?1:0)|0,x=O,P=N,O=R,N=L,R=D,L=A,D=Se+(_e+fe+(Ee>>>0<ve>>>0?1:0))+((A=de+Ee|0)>>>0<de>>>0?1:0)|0}f=i.low=f+A,i.high=p+D+(f>>>0<A>>>0?1:0),_=r.low=_+L,r.high=g+R+(_>>>0<L>>>0?1:0),m=o.low=m+N,o.high=v+O+(m>>>0<N>>>0?1:0),I=a.low=I+P,a.high=y+x+(I>>>0<P>>>0?1:0),C=s.low=C+G,s.high=T+U+(C>>>0<G>>>0?1:0),E=l.low=E+F,l.high=S+V+(E>>>0<F>>>0?1:0),M=d.low=M+j,d.high=b+B+(M>>>0<j>>>0?1:0),w=h.low=w+H,h.high=k+q+(w>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(i+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)})),Nr((function(e,t){var n,i,r,o,a,s,c,u;e.exports=(r=(i=n=xr).x64,o=r.Word,a=r.WordArray,s=i.algo,c=s.SHA512,u=s.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),i.SHA384=c._createHelper(u),i.HmacSHA384=c._createHmacHelper(u),n.SHA384)})),Nr((function(e,t){var n;e.exports=(n=xr,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.x64.Word,s=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var i=(2*e+3*t)%5;e=t%5,t=i}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,o=0;o<24;o++){for(var s=0,d=0,h=0;h<7;h++){if(1&r){var p=(1<<h)-1;p<32?d^=1<<p:s^=1<<p-32}128&r?r=r<<1^113:r<<=1}l[o]=a.create(s,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=a.create()}();var h=s.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,i=this.blockSize/2,r=0;r<i;r++){var o=e[t+2*r],a=e[t+2*r+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(w=n[r]).high^=a,w.low^=o}for(var s=0;s<24;s++){for(var h=0;h<5;h++){for(var p=0,f=0,g=0;g<5;g++)p^=(w=n[h+5*g]).high,f^=w.low;var _=d[h];_.high=p,_.low=f}for(h=0;h<5;h++){var v=d[(h+4)%5],m=d[(h+1)%5],y=m.high,I=m.low;for(p=v.high^(y<<1|I>>>31),f=v.low^(I<<1|y>>>31),g=0;g<5;g++)(w=n[h+5*g]).high^=p,w.low^=f}for(var T=1;T<25;T++){var C=(w=n[T]).high,S=w.low,E=c[T];E<32?(p=C<<E|S>>>32-E,f=S<<E|C>>>32-E):(p=S<<E-32|C>>>64-E,f=C<<E-32|S>>>64-E);var b=d[u[T]];b.high=p,b.low=f}var M=d[0],k=n[0];for(M.high=k.high,M.low=k.low,h=0;h<5;h++)for(g=0;g<5;g++){var w=n[T=h+5*g],D=d[T],A=d[(h+1)%5+5*g],R=d[(h+2)%5+5*g];w.high=D.high^~A.high&R.high,w.low=D.low^~A.low&R.low}w=n[0];var L=l[s];w.high^=L.high,w.low^=L.low}},_doFinalize:function(){var t=this._data,n=t.words,i=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;n[i>>>5]|=1<<24-i%32,n[(e.ceil((i+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,s=this.cfg.outputLength/8,c=s/8,u=[],l=0;l<c;l++){var d=a[l],h=d.high,p=d.low;h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),u.push(p),u.push(h)}return new r.init(u,s)},clone:function(){for(var e=o.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=o._createHelper(h),t.HmacSHA3=o._createHmacHelper(h)}(Math),n.SHA3)})),Nr((function(e,t){var n;e.exports=(n=xr,function(e){var t=n,i=t.lib,r=i.WordArray,o=i.Hasher,a=t.algo,s=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=r.create([0,1518500249,1859775393,2400959708,2840853838]),h=r.create([1352829926,1548603684,1836072691,2053994217,0]),p=a.RIPEMD160=o.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,r=e[i];e[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var o,a,p,I,T,C,S,E,b,M,k,w=this._hash.words,D=d.words,A=h.words,R=s.words,L=c.words,O=u.words,N=l.words;for(C=o=w[0],S=a=w[1],E=p=w[2],b=I=w[3],M=T=w[4],n=0;n<80;n+=1)k=o+e[t+R[n]]|0,k+=n<16?f(a,p,I)+D[0]:n<32?g(a,p,I)+D[1]:n<48?_(a,p,I)+D[2]:n<64?v(a,p,I)+D[3]:m(a,p,I)+D[4],k=(k=y(k|=0,O[n]))+T|0,o=T,T=I,I=y(p,10),p=a,a=k,k=C+e[t+L[n]]|0,k+=n<16?m(S,E,b)+A[0]:n<32?v(S,E,b)+A[1]:n<48?_(S,E,b)+A[2]:n<64?g(S,E,b)+A[3]:f(S,E,b)+A[4],k=(k=y(k|=0,N[n]))+M|0,C=M,M=b,b=y(E,10),E=S,S=k;k=w[1]+p+b|0,w[1]=w[2]+I+M|0,w[2]=w[3]+T+C|0,w[3]=w[4]+o+S|0,w[4]=w[0]+a+E|0,w[0]=k},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,o=r.words,a=0;a<5;a++){var s=o[a];o[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return r},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function _(e,t,n){return(e|~t)^n}function v(e,t,n){return e&n|t&~n}function m(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=o._createHelper(p),t.HmacRIPEMD160=o._createHmacHelper(p)}(),n.RIPEMD160)})),Nr((function(e,t){var n,i,r,o,a,s;e.exports=(i=(n=xr).lib,r=i.Base,o=n.enc,a=o.Utf8,s=n.algo,void(s.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),o=this._iKey=t.clone(),s=r.words,c=o.words,u=0;u<n;u++)s[u]^=1549556828,c[u]^=909522486;r.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var i=t.finalize(this._oKey.clone().concat(n));return i}})))})),Nr((function(e,t){var n,i,r,o,a,s,c,u,l;e.exports=(r=(i=n=xr).lib,o=r.Base,a=r.WordArray,s=i.algo,c=s.SHA1,u=s.HMAC,l=s.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=u.create(n.hasher,e),r=a.create(),o=a.create([1]),s=r.words,c=o.words,l=n.keySize,d=n.iterations;s.length<l;){var h=i.update(t).finalize(o);i.reset();for(var p=h.words,f=p.length,g=h,_=1;_<d;_++){g=i.finalize(g),i.reset();for(var v=g.words,m=0;m<f;m++)p[m]^=v[m]}r.concat(h),c[0]++}return r.sigBytes=4*l,r}}),i.PBKDF2=function(e,t,n){return l.create(n).compute(e,t)},n.PBKDF2)})),Nr((function(e,t){var n,i,r,o,a,s,c,u;e.exports=(r=(i=n=xr).lib,o=r.Base,a=r.WordArray,s=i.algo,c=s.MD5,u=s.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=n.hasher.create(),r=a.create(),o=r.words,s=n.keySize,c=n.iterations;o.length<s;){u&&i.update(u);var u=i.update(e).finalize(t);i.reset();for(var l=1;l<c;l++)u=i.finalize(u),i.reset();r.concat(u)}return r.sigBytes=4*s,r}}),i.EvpKDF=function(e,t,n){return u.create(n).compute(e,t)},n.EvpKDF)})),Nr((function(e,t){var n,i,r,o,a,s,c,u,l,d,h,p,f,g,_,v,m,y,I,T,C,S,E,b;e.exports=void((n=xr).lib.Cipher||(r=n,o=r.lib,a=o.Base,s=o.WordArray,c=o.BufferedBlockAlgorithm,u=r.enc,u.Utf8,l=u.Base64,d=r.algo,h=d.EvpKDF,p=o.Cipher=c.extend({cfg:a.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?b:C}return function(t){return{encrypt:function(n,i,r){return e(i).encrypt(t,n,i,r)},decrypt:function(n,i,r){return e(i).decrypt(t,n,i,r)}}}}()}),o.StreamCipher=p.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),f=r.mode={},g=o.BlockCipherMode=a.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),_=f.CBC=function(){var e=g.extend();function t(e,t,n){var r=this._iv;if(r){var o=r;this._iv=i}else o=this._prevBlock;for(var a=0;a<n;a++)e[t+a]^=o[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize;t.call(this,e,n,r),i.encryptBlock(e,n),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=e.slice(n,n+r);i.decryptBlock(e,n),t.call(this,e,n,r),this._prevBlock=o}}),e}(),v=r.pad={},m=v.Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,r=i<<24|i<<16|i<<8|i,o=[],a=0;a<i;a+=4)o.push(r);var c=s.create(o,i);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},o.BlockCipher=p.extend({cfg:p.cfg.extend({mode:_,padding:m}),reset:function(){p.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=n.createEncryptor;else{i=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==i?this._mode.init(this,t&&t.words):(this._mode=i.call(n,this,t&&t.words),this._mode.__creator=i)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),y=o.CipherParams=a.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),I=r.format={},T=I.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var i=s.create([1398893684,1701076831]).concat(n).concat(t);else i=t;return i.toString(l)},parse:function(e){var t=l.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var i=s.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return y.create({ciphertext:t,salt:i})}},C=o.SerializableCipher=a.extend({cfg:a.extend({format:T}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i),o=r.finalize(t),a=r.cfg;return y.create({ciphertext:o,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var r=e.createDecryptor(n,i).finalize(t.ciphertext);return r},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),S=r.kdf={},E=S.OpenSSL={execute:function(e,t,n,i){i||(i=s.random(8));var r=h.create({keySize:t+n}).compute(e,i),o=s.create(r.words.slice(t),4*n);return r.sigBytes=4*t,y.create({key:r,iv:o,salt:i})}},b=o.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:E}),encrypt:function(e,t,n,i){var r=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize);i.iv=r.iv;var o=C.encrypt.call(this,e,t,r.key,i);return o.mixIn(r),o},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var r=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);i.iv=r.iv;var o=C.decrypt.call(this,e,t,r.key,i);return o}})))})),Nr((function(e,t){var n;e.exports=((n=xr).mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,n,i){var r=this._iv;if(r){var o=r.slice(0);this._iv=void 0}else o=this._prevBlock;i.encryptBlock(o,0);for(var a=0;a<n;a++)e[t+a]^=o[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize;t.call(this,e,n,r,i),this._prevBlock=e.slice(n,n+r)}}),e.Decryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=e.slice(n,n+r);t.call(this,e,n,r,i),this._prevBlock=o}}),e}(),n.mode.CFB)})),Nr((function(e,t){var n,i,r;e.exports=((n=xr).mode.CTR=(i=n.lib.BlockCipherMode.extend(),r=i.Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=this._iv,o=this._counter;r&&(o=this._counter=r.slice(0),this._iv=void 0);var a=o.slice(0);n.encryptBlock(a,0),o[i-1]=o[i-1]+1|0;for(var s=0;s<i;s++)e[t+s]^=a[s]}}),i.Decryptor=r,i),n.mode.CTR)})),Nr((function(e,t){var n;e.exports=((n=xr).mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}var i=e.Encryptor=e.extend({processBlock:function(e,n){var i=this._cipher,r=i.blockSize,o=this._iv,a=this._counter;o&&(a=this._counter=o.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(a);var s=a.slice(0);i.encryptBlock(s,0);for(var c=0;c<r;c++)e[n+c]^=s[c]}});return e.Decryptor=i,e}(),n.mode.CTRGladman)})),Nr((function(e,t){var n,i,r;e.exports=((n=xr).mode.OFB=(i=n.lib.BlockCipherMode.extend(),r=i.Encryptor=i.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=this._iv,o=this._keystream;r&&(o=this._keystream=r.slice(0),this._iv=void 0),n.encryptBlock(o,0);for(var a=0;a<i;a++)e[t+a]^=o[a]}}),i.Decryptor=r,i),n.mode.OFB)})),Nr((function(e,t){var n,i;e.exports=((n=xr).mode.ECB=((i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),n.mode.ECB)})),Nr((function(e,t){var n;e.exports=((n=xr).pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,i=4*t,r=i-n%i,o=n+r-1;e.clamp(),e.words[o>>>2]|=r<<24-o%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)})),Nr((function(e,t){var n;e.exports=((n=xr).pad.Iso10126={pad:function(e,t){var i=4*t,r=i-e.sigBytes%i;e.concat(n.lib.WordArray.random(r-1)).concat(n.lib.WordArray.create([r<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)})),Nr((function(e,t){var n;e.exports=((n=xr).pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)})),Nr((function(e,t){var n;e.exports=((n=xr).pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},n.pad.ZeroPadding)})),Nr((function(e,t){var n;e.exports=((n=xr).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),Nr((function(e,t){var n,i,r,o;e.exports=(r=(i=n=xr).lib.CipherParams,o=i.enc.Hex,i.format.Hex={stringify:function(e){return e.ciphertext.toString(o)},parse:function(e){var t=o.parse(e);return r.create({ciphertext:t})}},n.format.Hex)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib.BlockCipher,i=e.algo,r=[],o=[],a=[],s=[],c=[],u=[],l=[],d=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,i=0;for(t=0;t<256;t++){var f=i^i<<1^i<<2^i<<3^i<<4;f=f>>>8^255&f^99,r[n]=f,o[f]=n;var g=e[n],_=e[g],v=e[_],m=257*e[f]^16843008*f;a[n]=m<<24|m>>>8,s[n]=m<<16|m>>>16,c[n]=m<<8|m>>>24,u[n]=m,m=16843009*v^65537*_^257*g^16843008*n,l[f]=m<<24|m>>>8,d[f]=m<<16|m>>>16,h[f]=m<<8|m>>>24,p[f]=m,n?(n=g^e[e[e[v^g]]],i^=e[e[i]]):n=i=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],g=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,i=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],a=0;a<i;a++)if(a<n)o[a]=t[a];else{var s=o[a-1];a%n?n>6&&a%n==4&&(s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s]):(s=r[(s=s<<8|s>>>24)>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s],s^=f[a/n|0]<<24),o[a]=o[a-n]^s}for(var c=this._invKeySchedule=[],u=0;u<i;u++)a=i-u,s=u%4?o[a]:o[a-4],c[u]=u<4||a<=4?s:l[r[s>>>24]]^d[r[s>>>16&255]]^h[r[s>>>8&255]]^p[r[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,c,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,h,p,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,o,a,s){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],h=e[t+3]^n[3],p=4,f=1;f<c;f++){var g=i[u>>>24]^r[l>>>16&255]^o[d>>>8&255]^a[255&h]^n[p++],_=i[l>>>24]^r[d>>>16&255]^o[h>>>8&255]^a[255&u]^n[p++],v=i[d>>>24]^r[h>>>16&255]^o[u>>>8&255]^a[255&l]^n[p++],m=i[h>>>24]^r[u>>>16&255]^o[l>>>8&255]^a[255&d]^n[p++];u=g,l=_,d=v,h=m}g=(s[u>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&h])^n[p++],_=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[h>>>8&255]<<8|s[255&u])^n[p++],v=(s[d>>>24]<<24|s[h>>>16&255]<<16|s[u>>>8&255]<<8|s[255&l])^n[p++],m=(s[h>>>24]<<24|s[u>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^n[p++],e[t]=g,e[t+1]=_,e[t+2]=v,e[t+3]=m},keySize:8});e.AES=t._createHelper(g)}(),n.AES)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib,i=t.WordArray,r=t.BlockCipher,o=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=r.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var i=a[n]-1;t[n]=e[i>>>5]>>>31-i%32&1}for(var r=this._subKeys=[],o=0;o<16;o++){var u=r[o]=[],l=c[o];for(n=0;n<24;n++)u[n/6|0]|=t[(s[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(s[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=r[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],h.call(this,4,252645135),h.call(this,16,65535),p.call(this,2,858993459),p.call(this,8,16711935),h.call(this,1,1431655765);for(var i=0;i<16;i++){for(var r=n[i],o=this._lBlock,a=this._rBlock,s=0,c=0;c<8;c++)s|=u[c][((a^r[c])&l[c])>>>0];this._lBlock=a,this._rBlock=o^s}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,h.call(this,1,1431655765),p.call(this,8,16711935),p.call(this,2,858993459),h.call(this,16,65535),h.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function h(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function p(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=r._createHelper(d);var f=o.TripleDES=r.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(i.create(e.slice(0,2))),this._des2=d.createEncryptor(i.create(e.slice(2,4))),this._des3=d.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=r._createHelper(f)}(),n.TripleDES)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,r=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,i=this._S=[],r=0;r<256;r++)i[r]=r;r=0;for(var o=0;r<256;r++){var a=r%n,s=t[a>>>2]>>>24-a%4*8&255;o=(o+i[r]+s)%256;var c=i[r];i[r]=i[o],i[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var e=this._S,t=this._i,n=this._j,i=0,r=0;r<4;r++){n=(n+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[n],e[n]=o,i|=e[(e[t]+e[n])%256]<<24-8*r}return this._i=t,this._j=n,i}e.RC4=t._createHelper(r);var a=i.RC4Drop=r.extend({cfg:r.cfg.extend({drop:192}),_doReset:function(){r._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)o.call(this)}});e.RC4Drop=t._createHelper(a)}(),n.RC4)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,r=[],o=[],a=[],s=i.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)r[n]^=i[n+4&7];if(t){var o=t.words,a=o[0],s=o[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&l,h=l<<16|65535&u;for(r[0]^=u,r[1]^=d,r[2]^=l,r[3]^=h,r[4]^=u,r[5]^=d,r[6]^=l,r[7]^=h,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)r[i]=16711935&(r[i]<<8|r[i]>>>24)|4278255360&(r[i]<<24|r[i]>>>8),e[t+i]^=r[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)o[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],r=65535&i,s=i>>>16,c=((r*r>>>17)+r*s>>>15)+s*s,u=((4294901760&i)*i|0)+((65535&i)*i|0);a[n]=c^u}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=t._createHelper(s)}(),n.Rabbit)})),Nr((function(e,t){var n;e.exports=(n=xr,function(){var e=n,t=e.lib.StreamCipher,i=e.algo,r=[],o=[],a=[],s=i.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(t){var o=t.words,a=o[0],s=o[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&l,h=l<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=l,i[3]^=h,i[4]^=u,i[5]^=d,i[6]^=l,i[7]^=h,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)r[i]=16711935&(r[i]<<8|r[i]>>>24)|4278255360&(r[i]<<24|r[i]>>>8),e[t+i]^=r[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)o[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,n=0;n<8;n++){var i=e[n]+t[n],r=65535&i,s=i>>>16,c=((r*r>>>17)+r*s>>>15)+s*s,u=((4294901760&i)*i|0)+((65535&i)*i|0);a[n]=c^u}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=t._createHelper(s)}(),n.RabbitLegacy)})),Nr((function(e,t){e.exports=xr})));function Ur(){throw new Error("setTimeout has not been defined")}function Gr(){throw new Error("clearTimeout has not been defined")}var Vr=Ur,Fr=Gr;function Br(e){if(Vr===setTimeout)return setTimeout(e,0);if((Vr===Ur||!Vr)&&setTimeout)return Vr=setTimeout,setTimeout(e,0);try{return Vr(e,0)}catch(Pi){try{return Vr.call(null,e,0)}catch(Pi){return Vr.call(this,e,0)}}}"function"==typeof xi.setTimeout&&(Vr=setTimeout),"function"==typeof xi.clearTimeout&&(Fr=clearTimeout);var jr,qr=[],Hr=!1,zr=-1;function Kr(){Hr&&jr&&(Hr=!1,jr.length?qr=jr.concat(qr):zr=-1,qr.length&&Wr())}function Wr(){if(!Hr){var e=Br(Kr);Hr=!0;for(var t=qr.length;t;){for(jr=qr,qr=[];++zr<t;)jr&&jr[zr].run();zr=-1,t=qr.length}jr=null,Hr=!1,function(e){if(Fr===clearTimeout)return clearTimeout(e);if((Fr===Gr||!Fr)&&clearTimeout)return Fr=clearTimeout,clearTimeout(e);try{Fr(e)}catch(t){try{return Fr.call(null,e)}catch(t){return Fr.call(this,e)}}}(e)}}function Yr(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];qr.push(new Jr(e,t)),1!==qr.length||Hr||Br(Wr)}function Jr(e,t){this.fun=e,this.array=t}Jr.prototype.run=function(){this.fun.apply(null,this.array)};var Zr=xi.performance||{};function Xr(){}function Qr(){Qr.init.call(this)}function $r(e){return void 0===e._maxListeners?Qr.defaultMaxListeners:e._maxListeners}function eo(e,t,n){if(t)e.call(n);else for(var i=e.length,r=co(e,i),o=0;o<i;++o)r[o].call(n)}function to(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=co(e,r),a=0;a<r;++a)o[a].call(n,i)}function no(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,a=co(e,o),s=0;s<o;++s)a[s].call(n,i,r)}function io(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var a=e.length,s=co(e,a),c=0;c<a;++c)s[c].call(n,i,r,o)}function ro(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=co(e,r),a=0;a<r;++a)o[a].apply(n,i)}function oo(e,t,n,i){var r,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new Xr,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(r=$r(e))&&r>0&&a.length>r){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s=c,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function ao(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function so(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function co(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Zr.now||Zr.mozNow||Zr.msNow||Zr.oNow||Zr.webkitNow,Xr.prototype=Object.create(null),Qr.EventEmitter=Qr,Qr.usingDomains=!1,Qr.prototype.domain=void 0,Qr.prototype._events=void 0,Qr.prototype._maxListeners=void 0,Qr.defaultMaxListeners=10,Qr.init=function(){this.domain=null,Qr.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Xr,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Qr.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Qr.prototype.getMaxListeners=function(){return $r(this)},Qr.prototype.emit=function(e){var t,n,i,r,o,a,s,c="error"===e;if(a=this._events)c=c&&null==a.error;else if(!c)return!1;if(s=this.domain,c){if(t=arguments[1],!s){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:eo(n,l,this);break;case 2:to(n,l,this,arguments[1]);break;case 3:no(n,l,this,arguments[1],arguments[2]);break;case 4:io(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];ro(n,l,this,r)}return!0},Qr.prototype.addListener=function(e,t){return oo(this,e,t,!1)},Qr.prototype.on=Qr.prototype.addListener,Qr.prototype.prependListener=function(e,t){return oo(this,e,t,!0)},Qr.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,ao(this,e,t)),this},Qr.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,ao(this,e,t)),this},Qr.prototype.removeListener=function(e,t){var n,i,r,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Xr:(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Xr,this;delete i[e]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(n,r);i.removeListener&&this.emit("removeListener",e,a||t)}return this},Qr.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Xr,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Xr:delete n[e]),this;if(0===arguments.length){for(var i,r=Object.keys(n),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new Xr,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Qr.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Qr.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):so.call(e,t)},Qr.prototype.listenerCount=so,Qr.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var uo="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},lo=/%[sdj%]/g;function ho(e){if(!Eo(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(_o(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,r=i.length,o=String(e).replace(lo,(function(e){if("%%"===e)return"%";if(n>=r)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),a=i[n];n<r;a=i[++n])So(a)||!ko(a)?o+=" "+a:o+=" "+_o(a);return o}function po(e,t){if(bo(xi.process))return function(){return po(e,t).apply(this,arguments)};var n=!1;return function(){return n||(console.error(t),n=!0),e.apply(this,arguments)}}var fo,go={};function _o(e,t){var n={seen:[],stylize:mo};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),Co(t)?n.showHidden=t:t&&function(e,t){if(!t||!ko(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]]}(n,t),bo(n.showHidden)&&(n.showHidden=!1),bo(n.depth)&&(n.depth=2),bo(n.colors)&&(n.colors=!1),bo(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=vo),yo(n,e,n.depth)}function vo(e,t){var n=_o.styles[t];return n?"["+_o.colors[n][0]+"m"+e+"["+_o.colors[n][1]+"m":e}function mo(e,t){return e}function yo(e,t,n){if(e.customInspect&&t&&Ao(t.inspect)&&t.inspect!==_o&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return Eo(i)||(i=yo(e,i,n)),i}var r=function(e,t){if(bo(t))return e.stylize("undefined","undefined");if(Eo(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return i=t,"number"==typeof i?e.stylize(""+t,"number"):Co(t)?e.stylize(""+t,"boolean"):So(t)?e.stylize("null","null"):void 0;var i}(e,t);if(r)return r;var o=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),Do(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return Io(t);if(0===o.length){if(Ao(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(Mo(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(wo(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Do(t))return Io(t)}var c,u,l="",d=!1,h=["{","}"];return c=t,Array.isArray(c)&&(d=!0,h=["[","]"]),Ao(t)&&(l=" [Function"+(t.name?": "+t.name:"")+"]"),Mo(t)&&(l=" "+RegExp.prototype.toString.call(t)),wo(t)&&(l=" "+Date.prototype.toUTCString.call(t)),Do(t)&&(l=" "+Io(t)),0!==o.length||d&&0!=t.length?n<0?Mo(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=d?function(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)Lo(t,String(a))?o.push(To(e,t,n,i,String(a),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(To(e,t,n,i,r,!0))})),o}(e,t,n,a,o):o.map((function(i){return To(e,t,n,a,i,d)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(u,l,h)):h[0]+l+h[1]}function Io(e){return"["+Error.prototype.toString.call(e)+"]"}function To(e,t,n,i,r,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),Lo(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(c.value)<0?(s=So(n)?yo(e,c.value,null):yo(e,c.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),bo(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function Co(e){return"boolean"==typeof e}function So(e){return null===e}function Eo(e){return"string"==typeof e}function bo(e){return void 0===e}function Mo(e){return ko(e)&&"[object RegExp]"===Ro(e)}function ko(e){return"object"==typeof e&&null!==e}function wo(e){return ko(e)&&"[object Date]"===Ro(e)}function Do(e){return ko(e)&&("[object Error]"===Ro(e)||e instanceof Error)}function Ao(e){return"function"==typeof e}function Ro(e){return Object.prototype.toString.call(e)}function Lo(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Oo(){this.head=null,this.tail=null,this.length=0}_o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},_o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},Oo.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Oo.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},Oo.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},Oo.prototype.clear=function(){this.head=this.tail=null,this.length=0},Oo.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},Oo.prototype.concat=function(e){if(0===this.length)return Ji.alloc(0);if(1===this.length)return this.head.data;for(var t=Ji.allocUnsafe(e>>>0),n=this.head,i=0;n;)n.data.copy(t,i),i+=n.data.length,n=n.next;return t};var No=Ji.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function xo(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!No(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=Uo;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Go;break;default:return void(this.write=Po)}this.charBuffer=new Ji(6),this.charReceived=0,this.charLength=0}function Po(e){return e.toString(this.encoding)}function Uo(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Go(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}xo.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i,r=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),r=(t+=e.toString(this.encoding,0,r)).length-1,(i=t.charCodeAt(r))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,r)}return t},xo.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},xo.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,r=this.encoding;t+=i.slice(0,n).toString(r)}return t},Bo.ReadableState=Fo;var Vo=function(e){return bo(fo)&&(fo=""),e=e.toUpperCase(),go[e]||(new RegExp("\\b"+e+"\\b","i").test(fo)?go[e]=function(){var t=ho.apply(null,arguments);console.error("%s %d: %s",e,0,t)}:go[e]=function(){}),go[e]}("stream");function Fo(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof ga&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new Oo,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new xo(e.encoding),this.encoding=e.encoding)}function Bo(e){if(!(this instanceof Bo))return new Bo(e);this._readableState=new Fo(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Qr.call(this)}function jo(e,t,n,i,r){var o=function(e,t){var n=null;return Lr(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,zo(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!r){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&r){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else{var c;!t.decoder||r||i||(n=t.decoder.write(n),c=!t.objectMode&&0===n.length),r||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&zo(e))),function(e,t){t.readingMore||(t.readingMore=!0,Yr(Wo,e,t))}(e,t)}else r||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}uo(Bo,Qr),Bo.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=Ji.from(e,t),t=""),jo(this,n,e,t,!1)},Bo.prototype.unshift=function(e){return jo(this,this._readableState,e,"",!0)},Bo.prototype.isPaused=function(){return!1===this._readableState.flowing},Bo.prototype.setEncoding=function(e){return this._readableState.decoder=new xo(e),this._readableState.encoding=e,this};var qo=8388608;function Ho(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=qo?e=qo:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function zo(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(Vo("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Yr(Ko,e):Ko(e))}function Ko(e){Vo("emit readable"),e.emit("readable"),Zo(e)}function Wo(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(Vo("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function Yo(e){Vo("readable nexttick read 0"),e.read(0)}function Jo(e,t){t.reading||(Vo("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),Zo(e),t.flowing&&!t.reading&&e.read(0)}function Zo(e){var t=e._readableState;for(Vo("flow",t.flowing);t.flowing&&null!==e.read(););}function Xo(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;for(e-=r.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(a===o.length?r+=o:r+=o.slice(0,e),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=Ji.allocUnsafe(e),i=t.head,r=1;for(i.data.copy(n),e-=i.data.length;i=i.next;){var o=i.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0===(e-=a)){a===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(a));break}++r}return t.length-=r,n}(e,t),i}(e,t.buffer,t.decoder),n);var n}function Qo(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Yr($o,t,e))}function $o(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function ea(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function ta(){}function na(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function ia(e,t){Object.defineProperty(this,"buffer",{get:po((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof ga&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?Yr(r,i):r(i),e._writableState.errorEmitted=!0,e.emit("error",i)}(e,n,i,t,r);else{var o=ca(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||sa(e,n),i?Yr(aa,e,n,o,r):aa(e,n,o,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new da(this)}function ra(e){if(!(this instanceof ra||this instanceof ga))return new ra(e);this._writableState=new ia(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Qr.call(this)}function oa(e,t,n,i,r,o,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function aa(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),la(e,t)}function sa(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)r[a]=n,n=n.next,a+=1;oa(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new da(t)}else{for(;n;){var s=n.chunk,c=n.encoding,u=n.callback;if(oa(e,t,!1,t.objectMode?1:s.length,s,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function ca(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function ua(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function la(e,t){var n=ca(t);return n&&(0===t.pendingcb?(ua(e,t),t.finished=!0,e.emit("finish")):ua(e,t)),n}function da(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var i=t.entry;for(t.entry=null;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}Bo.prototype.read=function(e){Vo("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return Vo("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Qo(this):zo(this),null;if(0===(e=Ho(e,t))&&t.ended)return 0===t.length&&Qo(this),null;var i,r=t.needReadable;return Vo("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&Vo("length less than watermark",r=!0),t.ended||t.reading?Vo("reading or ended",r=!1):r&&(Vo("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=Ho(n,t))),null===(i=e>0?Xo(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&Qo(this)),null!==i&&this.emit("data",i),i},Bo.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Bo.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,Vo("pipe count=%d opts=%j",i.pipesCount,t);var r=t&&!1===t.end?u:a;function o(e){Vo("onunpipe"),e===n&&u()}function a(){Vo("onend"),e.end()}i.endEmitted?Yr(r):n.once("end",r),e.on("unpipe",o);var s=function(e){return function(){var t=e._readableState;Vo("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,Zo(e))}}(n);e.on("drain",s);var c=!1;function u(){Vo("cleanup"),e.removeListener("close",p),e.removeListener("finish",f),e.removeListener("drain",s),e.removeListener("error",h),e.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",u),n.removeListener("data",d),c=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||s()}var l=!1;function d(t){Vo("ondata"),l=!1,!1!==e.write(t)||l||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==ea(i.pipes,e))&&!c&&(Vo("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,l=!0),n.pause())}function h(t){var n;Vo("onerror",t),g(),e.removeListener("error",h),0===(n="error",e.listeners(n).length)&&e.emit("error",t)}function p(){e.removeListener("finish",f),g()}function f(){Vo("onfinish"),e.removeListener("close",p),g()}function g(){Vo("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",p),e.once("finish",f),e.emit("pipe",n),i.flowing||(Vo("pipe resume"),n.resume()),e},Bo.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;r<i;r++)n[r].emit("unpipe",this);return this}var o=ea(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},Bo.prototype.on=function(e,t){var n=Qr.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&zo(this):Yr(Yo,this))}return n},Bo.prototype.addListener=Bo.prototype.on,Bo.prototype.resume=function(){var e=this._readableState;return e.flowing||(Vo("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Yr(Jo,e,t))}(this,e)),this},Bo.prototype.pause=function(){return Vo("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(Vo("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Bo.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;for(var r in e.on("end",(function(){if(Vo("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)})),e.on("data",(function(r){Vo("wrapped data"),t.decoder&&(r=t.decoder.write(r)),t.objectMode&&null==r||(t.objectMode||r&&r.length)&&(i.push(r)||(n=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));return function(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n],n)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,i.emit.bind(i,t))})),i._read=function(t){Vo("wrapped _read",t),n&&(n=!1,e.resume())},i},Bo._fromList=Xo,ra.WritableState=ia,uo(ra,Qr),ia.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},ra.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},ra.prototype.write=function(e,t,n){var i=this._writableState,r=!1;return"function"==typeof t&&(n=t,t=null),Ji.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=ta),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),Yr(t,n)}(this,n):function(e,t,n,i){var r=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):Ji.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),Yr(i,o),r=!1),r}(this,i,e,n)&&(i.pendingcb++,r=function(e,t,n,i,r){n=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Ji.from(t,n)),t}(t,n,i),Ji.isBuffer(n)&&(i="buffer");var o=t.objectMode?1:n.length;t.length+=o;var a=t.length<t.highWaterMark;if(a||(t.needDrain=!0),t.writing||t.corked){var s=t.lastBufferedRequest;t.lastBufferedRequest=new na(n,i,r),s?s.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else oa(e,t,!1,o,n,i,r);return a}(this,i,e,t,n)),r},ra.prototype.cork=function(){this._writableState.corked++},ra.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||sa(this,e))},ra.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},ra.prototype._write=function(e,t,n){n(new Error("not implemented"))},ra.prototype._writev=null,ra.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,la(e,t),n&&(t.finished?Yr(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,i,n)},uo(ga,Bo);for(var ha=Object.keys(ra.prototype),pa=0;pa<ha.length;pa++){var fa=ha[pa];ga.prototype[fa]||(ga.prototype[fa]=ra.prototype[fa])}function ga(e){if(!(this instanceof ga))return new ga(e);Bo.call(this,e),ra.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",_a)}function _a(){this.allowHalfOpen||this._writableState.ended||Yr(va,this)}function va(e){e.end()}function ma(e){this.afterTransform=function(t,n){return function(e,t,n){var i=e._transformState;i.transforming=!1;var r=i.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!=n&&e.push(n),r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function ya(e){if(!(this instanceof ya))return new ya(e);ga.call(this,e),this._transformState=new ma(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){Ia(t,e)})):Ia(t)}))}function Ia(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function Ta(e){if(!(this instanceof Ta))return new Ta(e);ya.call(this,e)}function Ca(){Qr.call(this)}uo(ya,ga),ya.prototype.push=function(e,t){return this._transformState.needTransform=!1,ga.prototype.push.call(this,e,t)},ya.prototype._transform=function(e,t,n){throw new Error("Not implemented")},ya.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},ya.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},uo(Ta,ya),Ta.prototype._transform=function(e,t,n){n(null,e)},uo(Ca,Qr),Ca.Readable=Bo,Ca.Writable=ra,Ca.Duplex=ga,Ca.Transform=ya,Ca.PassThrough=Ta,Ca.Stream=Ca,Ca.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function r(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",r),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",s));var o=!1;function a(){o||(o=!0,e.end())}function s(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===Qr.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",r),n.removeListener("end",a),n.removeListener("close",s),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var Sa={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Ea(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function ba(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]}var Ma=Uint8Array,ka=Uint16Array,wa=Int32Array,Da=4,Aa=0,Ra=1,La=2;function Oa(e){for(var t=e.length;--t>=0;)e[t]=0}var Na=0,xa=1,Pa=2,Ua=29,Ga=256,Va=Ga+1+Ua,Fa=30,Ba=19,ja=2*Va+1,qa=15,Ha=16,za=7,Ka=256,Wa=16,Ya=17,Ja=18,Za=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Xa=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Qa=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],$a=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],es=new Array(2*(Va+2));Oa(es);var ts=new Array(2*Fa);Oa(ts);var ns=new Array(512);Oa(ns);var is=new Array(256);Oa(is);var rs=new Array(Ua);Oa(rs);var os,as,ss,cs=new Array(Fa);function us(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function ls(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function ds(e){return e<256?ns[e]:ns[256+(e>>>7)]}function hs(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function ps(e,t,n){e.bi_valid>Ha-n?(e.bi_buf|=t<<e.bi_valid&65535,hs(e,e.bi_buf),e.bi_buf=t>>Ha-e.bi_valid,e.bi_valid+=n-Ha):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function fs(e,t,n){ps(e,n[2*t],n[2*t+1])}function gs(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function _s(e,t,n){var i,r,o=new Array(qa+1),a=0;for(i=1;i<=qa;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=gs(o[s]++,s))}}function vs(e){var t;for(t=0;t<Va;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Fa;t++)e.dyn_dtree[2*t]=0;for(t=0;t<Ba;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Ka]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function ms(e){e.bi_valid>8?hs(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ys(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function Is(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&ys(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!ys(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function Ts(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?fs(e,r,t):(fs(e,(o=is[r])+Ga+1,t),0!==(a=Za[o])&&ps(e,r-=rs[o],a),fs(e,o=ds(--i),n),0!==(a=Xa[o])&&ps(e,i-=cs[o],a))}while(s<e.last_lit);fs(e,Ka,t)}function Cs(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=ja,n=0;n<c;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)Is(e,o,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Is(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,Is(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=qa;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<ja;n++)(o=c[2*c[2*(i=e.heap[n])+1]+1]+1)>f&&(o=f,g++),c[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=p&&(a=h[i-p]),s=c[2*i],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(l[2*i+1]+a)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>u||(c[2*r+1]!==o&&(e.opt_len+=(o-c[2*r+1])*c[2*r],c[2*r+1]=o),i--)}}(e,t),_s(o,u,e.bl_count)}function Ss(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<c&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*Wa]++):s<=10?e.bl_tree[2*Ya]++:e.bl_tree[2*Ja]++,s=0,o=r,0===a?(c=138,u=3):r===a?(c=6,u=3):(c=7,u=4))}function Es(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(s<u)do{fs(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(fs(e,r,e.bl_tree),s--),fs(e,Wa,e.bl_tree),ps(e,s-3,2)):s<=10?(fs(e,Ya,e.bl_tree),ps(e,s-3,3)):(fs(e,Ja,e.bl_tree),ps(e,s-11,7));s=0,o=r,0===a?(c=138,u=3):r===a?(c=6,u=3):(c=7,u=4)}}Oa(cs);var bs=!1;function Ms(e){bs||(function(){var e,t,n,i,r,o=new Array(qa+1);for(n=0,i=0;i<Ua-1;i++)for(rs[i]=n,e=0;e<1<<Za[i];e++)is[n++]=i;for(is[n-1]=i,r=0,i=0;i<16;i++)for(cs[i]=r,e=0;e<1<<Xa[i];e++)ns[r++]=i;for(r>>=7;i<Fa;i++)for(cs[i]=r<<7,e=0;e<1<<Xa[i]-7;e++)ns[256+r++]=i;for(t=0;t<=qa;t++)o[t]=0;for(e=0;e<=143;)es[2*e+1]=8,e++,o[8]++;for(;e<=255;)es[2*e+1]=9,e++,o[9]++;for(;e<=279;)es[2*e+1]=7,e++,o[7]++;for(;e<=287;)es[2*e+1]=8,e++,o[8]++;for(_s(es,Va+1,o),e=0;e<Fa;e++)ts[2*e+1]=5,ts[2*e]=gs(e,5);os=new us(es,Za,Ga+1,Va,qa),as=new us(ts,Xa,0,Fa,qa),ss=new us(new Array(0),Qa,0,Ba,za)}(),bs=!0),e.l_desc=new ls(e.dyn_ltree,os),e.d_desc=new ls(e.dyn_dtree,as),e.bl_desc=new ls(e.bl_tree,ss),e.bi_buf=0,e.bi_valid=0,vs(e)}function ks(e,t,n,i){ps(e,(Na<<1)+(i?1:0),3),function(e,t,n,i){ms(e),i&&(hs(e,n),hs(e,~n)),ba(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}function ws(e){ps(e,xa<<1,3),fs(e,Ka,es),function(e){16===e.bi_valid?(hs(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}function Ds(e,t,n,i){var r,o,a=0;e.level>0?(e.strm.data_type===La&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return Aa;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Ra;for(t=32;t<Ga;t++)if(0!==e.dyn_ltree[2*t])return Ra;return Aa}(e)),Cs(e,e.l_desc),Cs(e,e.d_desc),a=function(e){var t;for(Ss(e,e.dyn_ltree,e.l_desc.max_code),Ss(e,e.dyn_dtree,e.d_desc.max_code),Cs(e,e.bl_desc),t=Ba-1;t>=3&&0===e.bl_tree[2*$a[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?ks(e,t,n,i):e.strategy===Da||o===r?(ps(e,(xa<<1)+(i?1:0),3),Ts(e,es,ts)):(ps(e,(Pa<<1)+(i?1:0),3),function(e,t,n,i){var r;for(ps(e,t-257,5),ps(e,n-1,5),ps(e,i-4,4),r=0;r<i;r++)ps(e,e.bl_tree[2*$a[r]+1],3);Es(e,e.dyn_ltree,t-1),Es(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),Ts(e,e.dyn_ltree,e.dyn_dtree)),vs(e),i&&ms(e)}function As(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(is[n]+Ga+1)]++,e.dyn_dtree[2*ds(t)]++),e.last_lit===e.lit_bufsize-1}function Rs(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}var Ls=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function Os(e,t,n,i){var r=Ls,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}var Ns,xs=0,Ps=1,Us=3,Gs=4,Vs=5,Fs=0,Bs=1,js=-2,qs=-3,Hs=-5,zs=-1,Ks=1,Ws=2,Ys=3,Js=4,Zs=2,Xs=8,Qs=9,$s=286,ec=30,tc=19,nc=2*$s+1,ic=15,rc=3,oc=258,ac=oc+rc+1,sc=32,cc=42,uc=69,lc=73,dc=91,hc=103,pc=113,fc=666,gc=1,_c=2,vc=3,mc=4,yc=3;function Ic(e,t){return e.msg=Sa[t],t}function Tc(e){return(e<<1)-(e>4?9:0)}function Cc(e){for(var t=e.length;--t>=0;)e[t]=0}function Sc(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(ba(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function Ec(e,t){Ds(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Sc(e.strm)}function bc(e,t){e.pending_buf[e.pending++]=t}function Mc(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function kc(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-ac?e.strstart-(e.w_size-ac):0,u=e.window,l=e.w_mask,d=e.prev,h=e.strstart+oc,p=u[o+a-1],f=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+a]===f&&u[n+a-1]===p&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<h);if(i=oc-(h-o),o=h-oc,i>a){if(e.match_start=t,a=i,i>=s)break;p=u[o+a-1],f=u[o+a]}}}while((t=d[t&l])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead}function wc(e){var t,n,i,r,o,a,s,c,u,l,d=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-ac)){ba(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=d?i-d:0}while(--n);t=n=d;do{i=e.prev[--t],e.prev[t]=i>=d?i-d:0}while(--n);r+=d}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,c=e.strstart+e.lookahead,u=r,l=void 0,(l=a.avail_in)>u&&(l=u),n=0===l?0:(a.avail_in-=l,ba(s,a.input,a.next_in,l,c),1===a.state.wrap?a.adler=Rs(a.adler,s,l,c):2===a.state.wrap&&(a.adler=Os(a.adler,s,l,c)),a.next_in+=l,a.total_in+=l,l),e.lookahead+=n,e.lookahead+e.insert>=rc)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+rc-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<rc)););}while(e.lookahead<ac&&0!==e.strm.avail_in)}function Dc(e,t){for(var n,i;;){if(e.lookahead<ac){if(wc(e),e.lookahead<ac&&t===xs)return gc;if(0===e.lookahead)break}if(n=0,e.lookahead>=rc&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+rc-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ac&&(e.match_length=kc(e,n)),e.match_length>=rc)if(i=As(e,e.strstart-e.match_start,e.match_length-rc),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=rc){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+rc-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=As(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Ec(e,!1),0===e.strm.avail_out))return gc}return e.insert=e.strstart<rc-1?e.strstart:rc-1,t===Gs?(Ec(e,!0),0===e.strm.avail_out?vc:mc):e.last_lit&&(Ec(e,!1),0===e.strm.avail_out)?gc:_c}function Ac(e,t){for(var n,i,r;;){if(e.lookahead<ac){if(wc(e),e.lookahead<ac&&t===xs)return gc;if(0===e.lookahead)break}if(n=0,e.lookahead>=rc&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+rc-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=rc-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ac&&(e.match_length=kc(e,n),e.match_length<=5&&(e.strategy===Ks||e.match_length===rc&&e.strstart-e.match_start>4096)&&(e.match_length=rc-1)),e.prev_length>=rc&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-rc,i=As(e,e.strstart-1-e.prev_match,e.prev_length-rc),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+rc-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=rc-1,e.strstart++,i&&(Ec(e,!1),0===e.strm.avail_out))return gc}else if(e.match_available){if((i=As(e,0,e.window[e.strstart-1]))&&Ec(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return gc}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=As(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<rc-1?e.strstart:rc-1,t===Gs?(Ec(e,!0),0===e.strm.avail_out?vc:mc):e.last_lit&&(Ec(e,!1),0===e.strm.avail_out)?gc:_c}function Rc(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function Lc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Xs,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ka(2*nc),this.dyn_dtree=new ka(2*(2*ec+1)),this.bl_tree=new ka(2*(2*tc+1)),Cc(this.dyn_ltree),Cc(this.dyn_dtree),Cc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ka(ic+1),this.heap=new ka(2*$s+1),Cc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ka(2*$s+1),Cc(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Oc(e){var t,n=function(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Zs,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?cc:pc,e.adler=2===t.wrap?0:1,t.last_flush=xs,Ms(t),Fs):Ic(e,js)}(e);return n===Fs&&((t=e.state).window_size=2*t.w_size,Cc(t.head),t.max_lazy_match=Ns[t.level].max_lazy,t.good_match=Ns[t.level].good_length,t.nice_match=Ns[t.level].nice_length,t.max_chain_length=Ns[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=rc-1,t.match_available=0,t.ins_h=0),n}function Nc(e,t){var n,i,r,o;if(!e||!e.state||t>Vs||t<0)return e?Ic(e,js):js;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===fc&&t!==Gs)return Ic(e,0===e.avail_out?Hs:js);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===cc)if(2===i.wrap)e.adler=0,bc(i,31),bc(i,139),bc(i,8),i.gzhead?(bc(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),bc(i,255&i.gzhead.time),bc(i,i.gzhead.time>>8&255),bc(i,i.gzhead.time>>16&255),bc(i,i.gzhead.time>>24&255),bc(i,9===i.level?2:i.strategy>=Ws||i.level<2?4:0),bc(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(bc(i,255&i.gzhead.extra.length),bc(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Os(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=uc):(bc(i,0),bc(i,0),bc(i,0),bc(i,0),bc(i,0),bc(i,9===i.level?2:i.strategy>=Ws||i.level<2?4:0),bc(i,yc),i.status=pc);else{var a=Xs+(i.w_bits-8<<4)<<8;a|=(i.strategy>=Ws||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=sc),a+=31-a%31,i.status=pc,Mc(i,a),0!==i.strstart&&(Mc(i,e.adler>>>16),Mc(i,65535&e.adler)),e.adler=1}if(i.status===uc)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(e.adler=Os(e.adler,i.pending_buf,i.pending-r,r)),Sc(e),r=i.pending,i.pending!==i.pending_buf_size));)bc(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=Os(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=lc)}else i.status=lc;if(i.status===lc)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Os(e.adler,i.pending_buf,i.pending-r,r)),Sc(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,bc(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=Os(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.gzindex=0,i.status=dc)}else i.status=dc;if(i.status===dc)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Os(e.adler,i.pending_buf,i.pending-r,r)),Sc(e),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,bc(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(e.adler=Os(e.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.status=hc)}else i.status=hc;if(i.status===hc&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Sc(e),i.pending+2<=i.pending_buf_size&&(bc(i,255&e.adler),bc(i,e.adler>>8&255),e.adler=0,i.status=pc)):i.status=pc),0!==i.pending){if(Sc(e),0===e.avail_out)return i.last_flush=-1,Fs}else if(0===e.avail_in&&Tc(t)<=Tc(n)&&t!==Gs)return Ic(e,Hs);if(i.status===fc&&0!==e.avail_in)return Ic(e,Hs);if(0!==e.avail_in||0!==i.lookahead||t!==xs&&i.status!==fc){var s=i.strategy===Ws?function(e,t){for(var n;;){if(0===e.lookahead&&(wc(e),0===e.lookahead)){if(t===xs)return gc;break}if(e.match_length=0,n=As(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Ec(e,!1),0===e.strm.avail_out))return gc}return e.insert=0,t===Gs?(Ec(e,!0),0===e.strm.avail_out?vc:mc):e.last_lit&&(Ec(e,!1),0===e.strm.avail_out)?gc:_c}(i,t):i.strategy===Ys?function(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=oc){if(wc(e),e.lookahead<=oc&&t===xs)return gc;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=rc&&e.strstart>0&&(i=a[r=e.strstart-1])===a[++r]&&i===a[++r]&&i===a[++r]){o=e.strstart+oc;do{}while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=oc-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=rc?(n=As(e,1,e.match_length-rc),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=As(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Ec(e,!1),0===e.strm.avail_out))return gc}return e.insert=0,t===Gs?(Ec(e,!0),0===e.strm.avail_out?vc:mc):e.last_lit&&(Ec(e,!1),0===e.strm.avail_out)?gc:_c}(i,t):Ns[i.level].func(i,t);if(s!==vc&&s!==mc||(i.status=fc),s===gc||s===vc)return 0===e.avail_out&&(i.last_flush=-1),Fs;if(s===_c&&(t===Ps?ws(i):t!==Vs&&(ks(i,0,0,!1),t===Us&&(Cc(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Sc(e),0===e.avail_out))return i.last_flush=-1,Fs}return t!==Gs?Fs:i.wrap<=0?Bs:(2===i.wrap?(bc(i,255&e.adler),bc(i,e.adler>>8&255),bc(i,e.adler>>16&255),bc(i,e.adler>>24&255),bc(i,255&e.total_in),bc(i,e.total_in>>8&255),bc(i,e.total_in>>16&255),bc(i,e.total_in>>24&255)):(Mc(i,e.adler>>>16),Mc(i,65535&e.adler)),Sc(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Fs:Bs)}Ns=[new Rc(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(wc(e),0===e.lookahead&&t===xs)return gc;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Ec(e,!1),0===e.strm.avail_out))return gc;if(e.strstart-e.block_start>=e.w_size-ac&&(Ec(e,!1),0===e.strm.avail_out))return gc}return e.insert=0,t===Gs?(Ec(e,!0),0===e.strm.avail_out?vc:mc):(e.strstart>e.block_start&&(Ec(e,!1),e.strm.avail_out),gc)})),new Rc(4,4,8,4,Dc),new Rc(4,5,16,8,Dc),new Rc(4,6,32,32,Dc),new Rc(4,4,16,16,Ac),new Rc(8,16,32,32,Ac),new Rc(8,16,128,128,Ac),new Rc(8,32,128,256,Ac),new Rc(32,128,258,1024,Ac),new Rc(32,258,258,4096,Ac)];var xc=30,Pc=12;function Uc(e,t){var n,i,r,o,a,s,c,u,l,d,h,p,f,g,_,v,m,y,I,T,C,S,E,b,M;n=e.state,i=e.next_in,b=e.input,r=i+(e.avail_in-5),o=e.next_out,M=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,d=n.wnext,h=n.window,p=n.hold,f=n.bits,g=n.lencode,_=n.distcode,v=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{f<15&&(p+=b[i++]<<f,f+=8,p+=b[i++]<<f,f+=8),y=g[p&v];t:for(;;){if(p>>>=I=y>>>24,f-=I,0===(I=y>>>16&255))M[o++]=65535&y;else{if(!(16&I)){if(0==(64&I)){y=g[(65535&y)+(p&(1<<I)-1)];continue t}if(32&I){n.mode=Pc;break e}e.msg="invalid literal/length code",n.mode=xc;break e}T=65535&y,(I&=15)&&(f<I&&(p+=b[i++]<<f,f+=8),T+=p&(1<<I)-1,p>>>=I,f-=I),f<15&&(p+=b[i++]<<f,f+=8,p+=b[i++]<<f,f+=8),y=_[p&m];n:for(;;){if(p>>>=I=y>>>24,f-=I,!(16&(I=y>>>16&255))){if(0==(64&I)){y=_[(65535&y)+(p&(1<<I)-1)];continue n}e.msg="invalid distance code",n.mode=xc;break e}if(C=65535&y,f<(I&=15)&&(p+=b[i++]<<f,(f+=8)<I&&(p+=b[i++]<<f,f+=8)),(C+=p&(1<<I)-1)>c){e.msg="invalid distance too far back",n.mode=xc;break e}if(p>>>=I,f-=I,C>(I=o-a)){if((I=C-I)>l&&n.sane){e.msg="invalid distance too far back",n.mode=xc;break e}if(S=0,E=h,0===d){if(S+=u-I,I<T){T-=I;do{M[o++]=h[S++]}while(--I);S=o-C,E=M}}else if(d<I){if(S+=u+d-I,(I-=d)<T){T-=I;do{M[o++]=h[S++]}while(--I);if(S=0,d<T){T-=I=d;do{M[o++]=h[S++]}while(--I);S=o-C,E=M}}}else if(S+=d-I,I<T){T-=I;do{M[o++]=h[S++]}while(--I);S=o-C,E=M}for(;T>2;)M[o++]=E[S++],M[o++]=E[S++],M[o++]=E[S++],T-=3;T&&(M[o++]=E[S++],T>1&&(M[o++]=E[S++]))}else{S=o-C;do{M[o++]=M[S++],M[o++]=M[S++],M[o++]=M[S++],T-=3}while(T>2);T&&(M[o++]=M[S++],T>1&&(M[o++]=M[S++]))}break}}break}}while(i<r&&o<s);i-=T=f>>3,p&=(1<<(f-=T<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=f}var Gc=15,Vc=852,Fc=592,Bc=0,jc=1,qc=2,Hc=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],zc=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Kc=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Wc=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Yc(e,t,n,i,r,o,a,s){var c,u,l,d,h,p,f,g,_,v=s.bits,m=0,y=0,I=0,T=0,C=0,S=0,E=0,b=0,M=0,k=0,w=null,D=0,A=new ka(Gc+1),R=new ka(Gc+1),L=null,O=0;for(m=0;m<=Gc;m++)A[m]=0;for(y=0;y<i;y++)A[t[n+y]]++;for(C=v,T=Gc;T>=1&&0===A[T];T--);if(C>T&&(C=T),0===T)return r[o++]=20971520,r[o++]=20971520,s.bits=1,0;for(I=1;I<T&&0===A[I];I++);for(C<I&&(C=I),b=1,m=1;m<=Gc;m++)if(b<<=1,(b-=A[m])<0)return-1;if(b>0&&(e===Bc||1!==T))return-1;for(R[1]=0,m=1;m<Gc;m++)R[m+1]=R[m]+A[m];for(y=0;y<i;y++)0!==t[n+y]&&(a[R[t[n+y]]++]=y);if(e===Bc?(w=L=a,p=19):e===jc?(w=Hc,D-=257,L=zc,O-=257,p=256):(w=Kc,L=Wc,p=-1),k=0,y=0,m=I,h=o,S=C,E=0,l=-1,d=(M=1<<C)-1,e===jc&&M>Vc||e===qc&&M>Fc)return 1;for(;;){f=m-E,a[y]<p?(g=0,_=a[y]):a[y]>p?(g=L[O+a[y]],_=w[D+a[y]]):(g=96,_=0),c=1<<m-E,I=u=1<<S;do{r[h+(k>>E)+(u-=c)]=f<<24|g<<16|_|0}while(0!==u);for(c=1<<m-1;k&c;)c>>=1;if(0!==c?(k&=c-1,k+=c):k=0,y++,0==--A[m]){if(m===T)break;m=t[n+a[y]]}if(m>C&&(k&d)!==l){for(0===E&&(E=C),h+=I,b=1<<(S=m-E);S+E<T&&!((b-=A[S+E])<=0);)S++,b<<=1;if(M+=1<<S,e===jc&&M>Vc||e===qc&&M>Fc)return 1;r[l=k&d]=C<<24|S<<16|h-o|0}}return 0!==k&&(r[h+k]=m-E<<24|64<<16|0),s.bits=C,0}var Jc=0,Zc=1,Xc=2,Qc=4,$c=5,eu=6,tu=0,nu=1,iu=2,ru=-2,ou=-3,au=-4,su=-5,cu=8,uu=1,lu=2,du=3,hu=4,pu=5,fu=6,gu=7,_u=8,vu=9,mu=10,yu=11,Iu=12,Tu=13,Cu=14,Su=15,Eu=16,bu=17,Mu=18,ku=19,wu=20,Du=21,Au=22,Ru=23,Lu=24,Ou=25,Nu=26,xu=27,Pu=28,Uu=29,Gu=30,Vu=31,Fu=32,Bu=852,ju=592;function qu(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Hu(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ka(320),this.work=new ka(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function zu(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,function(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=uu,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new wa(Bu),t.distcode=t.distdyn=new wa(ju),t.sane=1,t.back=-1,tu):ru}(e)):ru}function Ku(e,t){var n,i;return e?(i=new Hu,e.state=i,i.window=null,(n=function(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ru:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,zu(e))):ru}(e,t))!==tu&&(e.state=null),n):ru}var Wu,Yu,Ju=!0;function Zu(e){if(Ju){var t;for(Wu=new wa(512),Yu=new wa(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Yc(Zc,e.lens,0,288,Wu,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Yc(Xc,e.lens,0,32,Yu,0,e.work,{bits:5}),Ju=!1}e.lencode=Wu,e.lenbits=9,e.distcode=Yu,e.distbits=5}function Xu(e,t){var n,i,r,o,a,s,c,u,l,d,h,p,f,g,_,v,m,y,I,T,C,S,E,b,M=0,k=new Ma(4),w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ru;(n=e.state).mode===Iu&&(n.mode=Tu),a=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,u=n.hold,l=n.bits,d=s,h=c,S=tu;e:for(;;)switch(n.mode){case uu:if(0===n.wrap){n.mode=Tu;break}for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(2&n.wrap&&35615===u){n.check=0,k[0]=255&u,k[1]=u>>>8&255,n.check=Os(n.check,k,2,0),u=0,l=0,n.mode=lu;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=Gu;break}if((15&u)!==cu){e.msg="unknown compression method",n.mode=Gu;break}if(l-=4,C=8+(15&(u>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=Gu;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&u?mu:Iu,u=0,l=0;break;case lu:for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(n.flags=u,(255&n.flags)!==cu){e.msg="unknown compression method",n.mode=Gu;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Gu;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=Os(n.check,k,2,0)),u=0,l=0,n.mode=du;case du:for(;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,k[2]=u>>>16&255,k[3]=u>>>24&255,n.check=Os(n.check,k,4,0)),u=0,l=0,n.mode=hu;case hu:for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=Os(n.check,k,2,0)),u=0,l=0,n.mode=pu;case pu:if(1024&n.flags){for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=Os(n.check,k,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=fu;case fu:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),ba(n.head.extra,i,o,p,C)),512&n.flags&&(n.check=Os(n.check,i,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=gu;case gu:if(2048&n.flags){if(0===s)break e;p=0;do{C=i[o+p++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C))}while(C&&p<s);if(512&n.flags&&(n.check=Os(n.check,i,p,o)),s-=p,o+=p,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=_u;case _u:if(4096&n.flags){if(0===s)break e;p=0;do{C=i[o+p++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C))}while(C&&p<s);if(512&n.flags&&(n.check=Os(n.check,i,p,o)),s-=p,o+=p,C)break e}else n.head&&(n.head.comment=null);n.mode=vu;case vu:if(512&n.flags){for(;l<16;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Gu;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Iu;break;case mu:for(;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}e.adler=n.check=qu(u),u=0,l=0,n.mode=yu;case yu:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,iu;e.adler=n.check=1,n.mode=Iu;case Iu:if(t===$c||t===eu)break e;case Tu:if(n.last){u>>>=7&l,l-=7&l,n.mode=xu;break}for(;l<3;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=Cu;break;case 1:if(Zu(n),n.mode=wu,t===eu){u>>>=2,l-=2;break e}break;case 2:n.mode=bu;break;case 3:e.msg="invalid block type",n.mode=Gu}u>>>=2,l-=2;break;case Cu:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Gu;break}if(n.length=65535&u,u=0,l=0,n.mode=Su,t===eu)break e;case Su:n.mode=Eu;case Eu:if(p=n.length){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;ba(r,i,o,p,a),s-=p,o+=p,c-=p,a+=p,n.length-=p;break}n.mode=Iu;break;case bu:for(;l<14;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Gu;break}n.have=0,n.mode=Mu;case Mu:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.lens[w[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[w[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},S=Yc(Jc,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,S){e.msg="invalid code lengths set",n.mode=Gu;break}n.have=0,n.mode=ku;case ku:for(;n.have<n.nlen+n.ndist;){for(;v=(M=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&M,!((_=M>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(m<16)u>>>=_,l-=_,n.lens[n.have++]=m;else{if(16===m){for(b=_+2;l<b;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(u>>>=_,l-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=Gu;break}C=n.lens[n.have-1],p=3+(3&u),u>>>=2,l-=2}else if(17===m){for(b=_+3;l<b;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}l-=_,C=0,p=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(b=_+7;l<b;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}l-=_,C=0,p=11+(127&(u>>>=_)),u>>>=7,l-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Gu;break}for(;p--;)n.lens[n.have++]=C}}if(n.mode===Gu)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Gu;break}if(n.lenbits=9,E={bits:n.lenbits},S=Yc(Zc,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,S){e.msg="invalid literal/lengths set",n.mode=Gu;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},S=Yc(Xc,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,S){e.msg="invalid distances set",n.mode=Gu;break}if(n.mode=wu,t===eu)break e;case wu:n.mode=Du;case Du:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,Uc(e,h),a=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,u=n.hold,l=n.bits,n.mode===Iu&&(n.back=-1);break}for(n.back=0;v=(M=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&M,!((_=M>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(v&&0==(240&v)){for(y=_,I=v,T=m;v=(M=n.lencode[T+((u&(1<<y+I)-1)>>y)])>>>16&255,m=65535&M,!(y+(_=M>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=_,l-=_,n.back+=_,n.length=m,0===v){n.mode=Nu;break}if(32&v){n.back=-1,n.mode=Iu;break}if(64&v){e.msg="invalid literal/length code",n.mode=Gu;break}n.extra=15&v,n.mode=Au;case Au:if(n.extra){for(b=n.extra;l<b;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Ru;case Ru:for(;v=(M=n.distcode[u&(1<<n.distbits)-1])>>>16&255,m=65535&M,!((_=M>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(0==(240&v)){for(y=_,I=v,T=m;v=(M=n.distcode[T+((u&(1<<y+I)-1)>>y)])>>>16&255,m=65535&M,!(y+(_=M>>>24)<=l);){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=_,l-=_,n.back+=_,64&v){e.msg="invalid distance code",n.mode=Gu;break}n.offset=m,n.extra=15&v,n.mode=Lu;case Lu:if(n.extra){for(b=n.extra;l<b;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Gu;break}n.mode=Ou;case Ou:if(0===c)break e;if(p=h-c,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Gu;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),g=n.window}else g=r,f=a-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{r[a++]=g[f++]}while(--p);0===n.length&&(n.mode=Du);break;case Nu:if(0===c)break e;r[a++]=n.length,c--,n.mode=Du;break;case xu:if(n.wrap){for(;l<32;){if(0===s)break e;s--,u|=i[o++]<<l,l+=8}if(h-=c,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?Os(n.check,r,h,a-h):Rs(n.check,r,h,a-h)),h=c,(n.flags?u:qu(u))!==n.check){e.msg="incorrect data check",n.mode=Gu;break}u=0,l=0}n.mode=Pu;case Pu:if(n.wrap&&n.flags){for(;l<32;){if(0===s)break e;s--,u+=i[o++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Gu;break}u=0,l=0}n.mode=Uu;case Uu:S=nu;break e;case Gu:S=ou;break e;case Vu:return au;case Fu:default:return ru}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,(n.wsize||h!==e.avail_out&&n.mode<Gu&&(n.mode<xu||t!==Qc))&&function(e,t,n,i){var r,o=e.state;null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Ma(o.wsize)),i>=o.wsize?(ba(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),ba(o.window,t,n-i,r,o.wnext),(i-=r)?(ba(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r)))}(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?Os(n.check,r,h,e.next_out-h):Rs(n.check,r,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Iu?128:0)+(n.mode===wu||n.mode===Su?256:0),(0===d&&0===h||t===Qc)&&S===tu&&(S=su),S}var Qu,$u=1,el=7;function tl(e){if(e<$u||e>el)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function nl(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}tl.prototype.init=function(e,t,n,i,r){var o;switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=i,3!==this.mode&&4!==this.mode||(this.windowBits+=16),this.mode===el&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new Ea,this.mode){case $u:case 3:case 5:o=function(e,t,n,i,r,o){if(!e)return js;var a=1;if(t===zs&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>Qs||n!==Xs||i<8||i>15||t<0||t>9||o<0||o>Js)return Ic(e,js);8===i&&(i=9);var s=new Lc;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+rc-1)/rc),s.window=new Ma(2*s.w_size),s.head=new ka(s.hash_size),s.prev=new ka(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Ma(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,Oc(e)}(this.strm,this.level,8,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case el:o=Ku(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===o?(this.write_in_progress=!1,this.init_done=!0):this._error(o)},tl.prototype.params=function(){throw new Error("deflateParams Not supported")},tl.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},tl.prototype.write=function(e,t,n,i,r,o,a){this._writeCheck(),this.write_in_progress=!0;var s=this;return Yr((function(){s.write_in_progress=!1;var c=s._write(e,t,n,i,r,o,a);s.callback(c[0],c[1]),s.pending_close&&s.close()})),this},tl.prototype.writeSync=function(e,t,n,i,r,o,a){return this._writeCheck(),this._write(e,t,n,i,r,o,a)},tl.prototype._write=function(e,t,n,i,r,o,a){if(this.write_in_progress=!0,0!==e&&1!==e&&2!==e&&3!==e&&4!==e&&5!==e)throw new Error("Invalid flush value");null==t&&(t=new Ji(0),i=0,n=0),r._set?r.set=r._set:r.set=nl;var s,c=this.strm;switch(c.avail_in=i,c.input=t,c.next_in=n,c.avail_out=a,c.output=r,c.next_out=o,this.mode){case $u:case 3:case 5:s=Nc(c,e);break;case el:case 2:case 4:case 6:s=Xu(c,e);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==s&&0!==s&&this._error(s),this.write_in_progress=!1,[c.avail_in,c.avail_out]},tl.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,this.mode===$u||3===this.mode||5===this.mode?function(e){var t;e&&e.state&&((t=e.state.status)!==cc&&t!==uc&&t!==lc&&t!==dc&&t!==hc&&t!==pc&&t!==fc?Ic(e,js):(e.state=null,t===pc&&Ic(e,qs)))}(this.strm):function(e){if(!e||!e.state)return ru;var t=e.state;t.window&&(t.window=null),e.state=null}(this.strm),this.mode=0)},tl.prototype.reset=function(){switch(this.mode){case $u:case 5:Qu=Oc(this.strm);break;case 2:case 6:Qu=zu(this.strm)}0!==Qu&&this._error(Qu)},tl.prototype._error=function(e){this.onerror(Sa[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var il=Object.freeze({NONE:0,DEFLATE:$u,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:el,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:tl}),rl={};Object.keys(il).forEach((function(e){rl[e]=il[e]})),rl.Z_MIN_WINDOWBITS=8,rl.Z_MAX_WINDOWBITS=15,rl.Z_DEFAULT_WINDOWBITS=15,rl.Z_MIN_CHUNK=64,rl.Z_MAX_CHUNK=1/0,rl.Z_DEFAULT_CHUNK=16384,rl.Z_MIN_MEMLEVEL=1,rl.Z_MAX_MEMLEVEL=9,rl.Z_DEFAULT_MEMLEVEL=8,rl.Z_MIN_LEVEL=-1,rl.Z_MAX_LEVEL=9,rl.Z_DEFAULT_LEVEL=rl.Z_DEFAULT_COMPRESSION;var ol={Z_OK:rl.Z_OK,Z_STREAM_END:rl.Z_STREAM_END,Z_NEED_DICT:rl.Z_NEED_DICT,Z_ERRNO:rl.Z_ERRNO,Z_STREAM_ERROR:rl.Z_STREAM_ERROR,Z_DATA_ERROR:rl.Z_DATA_ERROR,Z_MEM_ERROR:rl.Z_MEM_ERROR,Z_BUF_ERROR:rl.Z_BUF_ERROR,Z_VERSION_ERROR:rl.Z_VERSION_ERROR};function al(e,t,n){var i=[],r=0;function o(){for(var t;null!==(t=e.read());)i.push(t),r+=t.length;e.once("readable",o)}function a(){var t=Ji.concat(i,r);i=[],n(null,t),e.close()}e.on("error",(function(t){e.removeListener("end",a),e.removeListener("readable",o),n(t)})),e.on("end",a),e.end(t),o()}function sl(e,t){if("string"==typeof t&&(t=new Ji(t)),!Lr(t))throw new TypeError("Not a string or buffer");var n=rl.Z_FINISH;return e._processChunk(t,n)}function cl(e){if(!(this instanceof cl))return new cl(e);gl.call(this,e,rl.DEFLATE)}function ul(e){if(!(this instanceof ul))return new ul(e);gl.call(this,e,rl.INFLATE)}function ll(e){if(!(this instanceof ll))return new ll(e);gl.call(this,e,rl.GZIP)}function dl(e){if(!(this instanceof dl))return new dl(e);gl.call(this,e,rl.GUNZIP)}function hl(e){if(!(this instanceof hl))return new hl(e);gl.call(this,e,rl.DEFLATERAW)}function pl(e){if(!(this instanceof pl))return new pl(e);gl.call(this,e,rl.INFLATERAW)}function fl(e){if(!(this instanceof fl))return new fl(e);gl.call(this,e,rl.UNZIP)}function gl(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||rl.Z_DEFAULT_CHUNK,ya.call(this,e),e.flush&&e.flush!==rl.Z_NO_FLUSH&&e.flush!==rl.Z_PARTIAL_FLUSH&&e.flush!==rl.Z_SYNC_FLUSH&&e.flush!==rl.Z_FULL_FLUSH&&e.flush!==rl.Z_FINISH&&e.flush!==rl.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||rl.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<rl.Z_MIN_CHUNK||e.chunkSize>rl.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<rl.Z_MIN_WINDOWBITS||e.windowBits>rl.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<rl.Z_MIN_LEVEL||e.level>rl.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<rl.Z_MIN_MEMLEVEL||e.memLevel>rl.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=rl.Z_FILTERED&&e.strategy!=rl.Z_HUFFMAN_ONLY&&e.strategy!=rl.Z_RLE&&e.strategy!=rl.Z_FIXED&&e.strategy!=rl.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!Lr(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new rl.Zlib(t);var n=this;this._hadError=!1,this._binding.onerror=function(e,t){n._binding=null,n._hadError=!0;var i=new Error(e);i.errno=t,i.code=rl.codes[t],n.emit("error",i)};var i=rl.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(i=e.level);var r=rl.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(r=e.strategy),this._binding.init(e.windowBits||rl.Z_DEFAULT_WINDOWBITS,i,e.memLevel||rl.Z_DEFAULT_MEMLEVEL,r,e.dictionary),this._buffer=new Ji(this._chunkSize),this._offset=0,this._closed=!1,this._level=i,this._strategy=r,this.once("end",this.close)}Object.keys(ol).forEach((function(e){ol[ol[e]]=e})),uo(gl,ya),gl.prototype.params=function(e,t,n){if(e<rl.Z_MIN_LEVEL||e>rl.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=rl.Z_FILTERED&&t!=rl.Z_HUFFMAN_ONLY&&t!=rl.Z_RLE&&t!=rl.Z_FIXED&&t!=rl.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var i=this;this.flush(rl.Z_SYNC_FLUSH,(function(){i._binding.params(e,t),i._hadError||(i._level=e,i._strategy=t,n&&n())}))}else Yr(n)},gl.prototype.reset=function(){return this._binding.reset()},gl.prototype._flush=function(e){this._transform(new Ji(0),"",e)},gl.prototype.flush=function(e,t){var n=this._writableState;if(("function"==typeof e||void 0===e&&!t)&&(t=e,e=rl.Z_FULL_FLUSH),n.ended)t&&Yr(t);else if(n.ending)t&&this.once("end",t);else if(n.needDrain){var i=this;this.once("drain",(function(){i.flush(t)}))}else this._flushFlag=e,this.write(new Ji(0),"",t)},gl.prototype.close=function(e){if(e&&Yr(e),!this._closed){this._closed=!0,this._binding.close();var t=this;Yr((function(){t.emit("close")}))}},gl.prototype._transform=function(e,t,n){var i,r=this._writableState,o=(r.ending||r.ended)&&(!e||r.length===e.length);if(null===!e&&!Lr(e))return n(new Error("invalid input"));o?i=rl.Z_FINISH:(i=this._flushFlag,e.length>=r.length&&(this._flushFlag=this._opts.flush||rl.Z_NO_FLUSH)),this._processChunk(e,i,n)},gl.prototype._processChunk=function(e,t,n){var i=e&&e.length,r=this._chunkSize-this._offset,o=0,a=this,s="function"==typeof n;if(!s){var c,u=[],l=0;this.on("error",(function(e){c=e}));do{var d=this._binding.writeSync(t,e,o,i,this._buffer,this._offset,r)}while(!this._hadError&&f(d[0],d[1]));if(this._hadError)throw c;var h=Ji.concat(u,l);return this.close(),h}var p=this._binding.write(t,e,o,i,this._buffer,this._offset,r);function f(c,d){if(!a._hadError){var h=r-d;if(function(e,t){if(!e)throw new Error(t)}(h>=0,"have should not go down"),h>0){var p=a._buffer.slice(a._offset,a._offset+h);a._offset+=h,s?a.push(p):(u.push(p),l+=p.length)}if((0===d||a._offset>=a._chunkSize)&&(r=a._chunkSize,a._offset=0,a._buffer=new Ji(a._chunkSize)),0===d){if(o+=i-c,i=c,!s)return!0;var g=a._binding.write(t,e,o,i,a._buffer,a._offset,a._chunkSize);return g.callback=f,void(g.buffer=e)}if(!s)return!1;n()}}p.buffer=e,p.callback=f},uo(cl,gl),uo(ul,gl),uo(ll,gl),uo(dl,gl),uo(hl,gl),uo(pl,gl),uo(fl,gl);var _l={codes:ol,createDeflate:function(e){return new cl(e)},createInflate:function(e){return new ul(e)},createDeflateRaw:function(e){return new hl(e)},createInflateRaw:function(e){return new pl(e)},createGzip:function(e){return new ll(e)},createGunzip:function(e){return new dl(e)},createUnzip:function(e){return new fl(e)},deflate:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new cl(t),e,n)},deflateSync:function(e,t){return sl(new cl(t),e)},gzip:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new ll(t),e,n)},gzipSync:function(e,t){return sl(new ll(t),e)},deflateRaw:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new hl(t),e,n)},deflateRawSync:function(e,t){return sl(new hl(t),e)},unzip:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new fl(t),e,n)},unzipSync:function(e,t){return sl(new fl(t),e)},inflate:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new ul(t),e,n)},inflateSync:function(e,t){return sl(new ul(t),e)},gunzip:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new dl(t),e,n)},gunzipSync:function(e,t){return sl(new dl(t),e)},inflateRaw:function(e,t,n){return"function"==typeof t&&(n=t,t={}),al(new pl(t),e,n)},inflateRawSync:function(e,t){return sl(new pl(t),e)},Deflate:cl,Inflate:ul,Gzip:ll,Gunzip:dl,DeflateRaw:hl,InflateRaw:pl,Unzip:fl,Zlib:gl},vl=class{constructor(e,t,n){this.SDKAPPID=e,this.EXPIRETIME=n,this.PRIVATEKEY=t}genTestUserSig(e){return this._isNumber(this.SDKAPPID)?this._isString(this.PRIVATEKEY)?this._isString(e)?this._isNumber(this.EXPIRETIME)?(console.log("sdkAppID="+this.SDKAPPID+" key="+this.PRIVATEKEY+" userID="+e+" expire="+this.EXPIRETIME),this.genSigWithUserbuf(e,this.EXPIRETIME,null)):(console.error("expireTime must be a number"),""):(console.error("userID must be a string"),""):(console.error("privateKey must be a string"),""):(console.error("sdkAppID must be a number"),"")}newBuffer(e,t){return Ji.from?Ji.from(e,t):new Ji(e,t)}unescape(e){return e.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}escape(e){return e.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}encode(e){return this.escape(this.newBuffer(e).toString("base64"))}decode(e){return this.newBuffer(this.unescape(e),"base64")}base64encode(e){return this.newBuffer(e).toString("base64")}base64decode(e){return this.newBuffer(e,"base64").toString()}_hmacsha256(e,t,n,i){let r="TLS.identifier:"+e+"\n";r+="TLS.sdkappid:"+this.SDKAPPID+"\n",r+="TLS.time:"+t+"\n",r+="TLS.expire:"+n+"\n",null!=i&&(r+="TLS.userbuf:"+i+"\n");let o=Pr.HmacSHA256(r,this.PRIVATEKEY);return Pr.enc.Base64.stringify(o)}_utc(){return Math.round(Date.now()/1e3)}_isNumber(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)}_isString(e){return"string"==typeof e}genSigWithUserbuf(e,t,n){let i=this._utc(),r={"TLS.ver":"2.0","TLS.identifier":e,"TLS.sdkappid":this.SDKAPPID,"TLS.time":i,"TLS.expire":t},o="";if(null!=n){let a=this.base64encode(n);r["TLS.userbuf"]=a,o=this._hmacsha256(e,i,t,a)}else o=this._hmacsha256(e,i,t,null);r["TLS.sig"]=o;let a=JSON.stringify(r),s=_l.deflateSync(this.newBuffer(a)).toString("base64"),c=this.escape(s);return console.log("ret="+c),c}validate(e){let t=this.decode(e),n=_l.inflateSync(t);console.log("validate ret="+n)}};const ml=604800;function yl(e){const{SDKAppID:t,secretKey:n,userID:i}=e,r=new vl(t,n,ml),o=r.genTestUserSig(i);return{SDKAppID:t,userSig:o}}var Il={name:"chat",components:{TUICallKit:ai},watch:{},data(){return{SDKAppID:1400815285,userID:"",userSig:""}},created(){this.userID=this.$unit.getLocalStorage("userId");let e=this.SDKAppID,t="09340b5022c2d8236dd0ccf6b2d94c521ce5f3c4ea819e5804ee09c44714d250",n=this.userID,i=yl({SDKAppID:e,secretKey:t,userID:n});this.userSig=i.userSig},mounted(){this.init()},beforeDestroy(){},methods:{async init(){try{await Li.init({SDKAppID:this.SDKAppID,userID:this.userID,userSig:this.userSig})}catch(e){alert(`初始化失败，原因：${e}`)}},async call(e){if(this.userID!=e){e=e.toString();try{await Li.call({userID:e,type:o.TUICallType.VIDEO_CALL})}catch(t){alert(`拨打失败，原因：${t},接受Id：${e}`)}}else alert("不能打电话给自己")}}},Tl=Il,Cl=n(1001),Sl=(0,Cl.Z)(Tl,i,r,!1,null,"d895bc1a",null),El=Sl.exports},7066:function(e,t,n){"use strict";var i=n(9670);e.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},2087:function(e,t,n){var i=n(7854),r=n(9781),o=n(7045),a=n(7066),s=n(7293),c=i.RegExp,u=c.prototype,l=r&&s((function(){var e=!0;try{c(".","d")}catch(l){e=!1}var t={},n="",i=e?"dgimsy":"gimsy",r=function(e,i){Object.defineProperty(t,e,{get:function(){return n+=i,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(o.hasIndices="d"),o)r(a,o[a]);var s=Object.getOwnPropertyDescriptor(u,"flags").get.call(t);return s!==i||n!==i}));l&&o(u,"flags",{configurable:!0,get:a})},1816:function(e,t,n){n(7658),n(1439),n(7585),n(5315),function(t,i){e.exports=i(n(2741))}(0,(function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=t(e);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(){a=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(w){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r=t&&t.prototype instanceof h?t:h,o=Object.create(r.prototype),a=new E(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return M()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=l(e,t,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(w){return{type:"throw",arg:w}}}e.wrap=u;var d={};function h(){}function p(){}function f(){}var g={};c(g,r,(function(){return this}));var _=Object.getPrototypeOf,v=_&&_(_(b([])));v&&v!==t&&n.call(v,r)&&(g=v);var m=f.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function i(r,o,a,s){var c=l(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var r;this._invoke=function(e,n){function o(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function b(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:M}}function M(){return{value:void 0,done:!0}}return p.prototype=f,c(m,"constructor",f),c(f,"constructor",p),p.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(I.prototype),c(I.prototype,o,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new I(u(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(m),c(m,s,"Generator"),c(m,r,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=b,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:b(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function s(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(i,r)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){s(o,i,r,a,c,"next",e)}function c(e){s(o,i,r,a,c,"throw",e)}a(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{},f=function(e){try{return!!e()}catch(t){return!0}},g=!f((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),_=g,v=Function.prototype,m=v.call,y=_&&v.bind.bind(m,m),I=function(e){return _?y(e):function(){return m.apply(e,arguments)}},T=I,C=T({}.toString),S=T("".slice),E=function(e){return S(C(e),8,-1)},b=E,M=I,k=function(e){if("Function"===b(e))return M(e)},w=f,D=E,A=Object,R=k("".split),L=w((function(){return!A("z").propertyIsEnumerable(0)}))?function(e){return"String"==D(e)?R(e,""):A(e)}:A,O=function(e){return null==e},N=O,x=TypeError,P=function(e){if(N(e))throw x("Can't call method on "+e);return e},U=L,G=P,V=function(e){return U(G(e))},F=function(e){return e&&e.Math==Math&&e},B=F("object"==typeof globalThis&&globalThis)||F("object"==typeof window&&window)||F("object"==typeof self&&self)||F("object"==typeof p&&p)||function(){return this}()||Function("return this")(),j={exports:{}},q=B,H=Object.defineProperty,z=function(e,t){try{H(q,e,{value:t,configurable:!0,writable:!0})}catch(i){q[e]=t}return t},K=z,W="__core-js_shared__",Y=B[W]||K(W,{}),J=Y;(j.exports=function(e,t){return J[e]||(J[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"});var Z,X,Q=P,$=Object,ee=function(e){return $(Q(e))},te=ee,ne=k({}.hasOwnProperty),ie=Object.hasOwn||function(e,t){return ne(te(e),t)},re=k,oe=0,ae=Math.random(),se=re(1..toString),ce=function(e){return"Symbol("+(void 0===e?"":e)+")_"+se(++oe+ae,36)},ue="object"==typeof document&&document.all,le={all:ue,IS_HTMLDDA:void 0===ue&&void 0!==ue},de=le.all,he=le.IS_HTMLDDA?function(e){return"function"==typeof e||e===de}:function(e){return"function"==typeof e},pe=B,fe=he,ge=function(e){return fe(e)?e:void 0},_e=function(e,t){return arguments.length<2?ge(pe[e]):pe[e]&&pe[e][t]},ve=_e("navigator","userAgent")||"",me=B,ye=ve,Ie=me.process,Te=me.Deno,Ce=Ie&&Ie.versions||Te&&Te.version,Se=Ce&&Ce.v8;Se&&(X=(Z=Se.split("."))[0]>0&&Z[0]<4?1:+(Z[0]+Z[1])),!X&&ye&&(!(Z=ye.match(/Edge\/(\d+)/))||Z[1]>=74)&&(Z=ye.match(/Chrome\/(\d+)/))&&(X=+Z[1]);var Ee=X,be=Ee,Me=f,ke=!!Object.getOwnPropertySymbols&&!Me((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&be&&be<41})),we=ke&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,De=B,Ae=j.exports,Re=ie,Le=ce,Oe=ke,Ne=we,xe=Ae("wks"),Pe=De.Symbol,Ue=Pe&&Pe.for,Ge=Ne?Pe:Pe&&Pe.withoutSetter||Le,Ve=function(e){if(!Re(xe,e)||!Oe&&"string"!=typeof xe[e]){var t="Symbol."+e;Oe&&Re(Pe,e)?xe[e]=Pe[e]:xe[e]=Ne&&Ue?Ue(t):Ge(t)}return xe[e]},Fe=he,Be=le.all,je=le.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Fe(e)||e===Be}:function(e){return"object"==typeof e?null!==e:Fe(e)},qe=je,He=String,ze=TypeError,Ke=function(e){if(qe(e))return e;throw ze(He(e)+" is not an object")},We={},Ye=!f((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Je=Ye&&f((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ze={},Xe=je,Qe=B.document,$e=Xe(Qe)&&Xe(Qe.createElement),et=function(e){return $e?Qe.createElement(e):{}},tt=et,nt=!Ye&&!f((function(){return 7!=Object.defineProperty(tt("div"),"a",{get:function(){return 7}}).a})),it=g,rt=Function.prototype.call,ot=it?rt.bind(rt):function(){return rt.apply(rt,arguments)},at=k({}.isPrototypeOf),st=_e,ct=he,ut=at,lt=Object,dt=we?function(e){return"symbol"==typeof e}:function(e){var t=st("Symbol");return ct(t)&&ut(t.prototype,lt(e))},ht=String,pt=function(e){try{return ht(e)}catch(t){return"Object"}},ft=he,gt=pt,_t=TypeError,vt=function(e){if(ft(e))return e;throw _t(gt(e)+" is not a function")},mt=vt,yt=O,It=function(e,t){var n=e[t];return yt(n)?void 0:mt(n)},Tt=ot,Ct=he,St=je,Et=TypeError,bt=ot,Mt=je,kt=dt,wt=It,Dt=function(e,t){var n,i;if("string"===t&&Ct(n=e.toString)&&!St(i=Tt(n,e)))return i;if(Ct(n=e.valueOf)&&!St(i=Tt(n,e)))return i;if("string"!==t&&Ct(n=e.toString)&&!St(i=Tt(n,e)))return i;throw Et("Can't convert object to primitive value")},At=TypeError,Rt=Ve("toPrimitive"),Lt=function(e,t){if(!Mt(e)||kt(e))return e;var n,i=wt(e,Rt);if(i){if(void 0===t&&(t="default"),n=bt(i,e,t),!Mt(n)||kt(n))return n;throw At("Can't convert object to primitive value")}return void 0===t&&(t="number"),Dt(e,t)},Ot=Lt,Nt=dt,xt=function(e){var t=Ot(e,"string");return Nt(t)?t:t+""},Pt=Ye,Ut=nt,Gt=Je,Vt=Ke,Ft=xt,Bt=TypeError,jt=Object.defineProperty,qt=Object.getOwnPropertyDescriptor,Ht="enumerable",zt="configurable",Kt="writable";Ze.f=Pt?Gt?function(e,t,n){if(Vt(e),t=Ft(t),Vt(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Kt in n&&!n.writable){var i=qt(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:zt in n?n.configurable:i.configurable,enumerable:Ht in n?n.enumerable:i.enumerable,writable:!1})}return jt(e,t,n)}:jt:function(e,t,n){if(Vt(e),t=Ft(t),Vt(n),Ut)try{return jt(e,t,n)}catch(r){}if("get"in n||"set"in n)throw Bt("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Wt=Math.ceil,Yt=Math.floor,Jt=Math.trunc||function(e){var t=+e;return(t>0?Yt:Wt)(t)},Zt=function(e){var t=+e;return t!=t||0===t?0:Jt(t)},Xt=Zt,Qt=Math.max,$t=Math.min,en=function(e,t){var n=Xt(e);return n<0?Qt(n+t,0):$t(n,t)},tn=Zt,nn=Math.min,rn=function(e){return e>0?nn(tn(e),9007199254740991):0},on=rn,an=function(e){return on(e.length)},sn=V,cn=en,un=an,ln=function(e){return function(t,n,i){var r,o=sn(t),a=un(o),s=cn(i,a);if(e&&n!=n){for(;a>s;)if((r=o[s++])!=r)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},dn={includes:ln(!0),indexOf:ln(!1)},hn={},pn=ie,fn=V,gn=dn.indexOf,_n=hn,vn=k([].push),mn=function(e,t){var n,i=fn(e),r=0,o=[];for(n in i)!pn(_n,n)&&pn(i,n)&&vn(o,n);for(;t.length>r;)pn(i,n=t[r++])&&(~gn(o,n)||vn(o,n));return o},yn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],In=mn,Tn=yn,Cn=Object.keys||function(e){return In(e,Tn)},Sn=Ye,En=Je,bn=Ze,Mn=Ke,kn=V,wn=Cn;We.f=Sn&&!En?Object.defineProperties:function(e,t){Mn(e);for(var n,i=kn(t),r=wn(t),o=r.length,a=0;o>a;)bn.f(e,n=r[a++],i[n]);return e};var Dn,An=_e("document","documentElement"),Rn=j.exports,Ln=ce,On=Rn("keys"),Nn=function(e){return On[e]||(On[e]=Ln(e))},xn=Ke,Pn=We,Un=yn,Gn=hn,Vn=An,Fn=et,Bn=Nn("IE_PROTO"),jn=function(){},qn=function(e){return"<script>"+e+"<\/script>"},Hn=function(e){e.write(qn("")),e.close();var t=e.parentWindow.Object;return e=null,t},zn=function(){try{Dn=new ActiveXObject("htmlfile")}catch(r){}var e,t;zn="undefined"!=typeof document?document.domain&&Dn?Hn(Dn):((t=Fn("iframe")).style.display="none",Vn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(qn("document.F=Object")),e.close(),e.F):Hn(Dn);for(var n=Un.length;n--;)delete zn.prototype[Un[n]];return zn()};Gn[Bn]=!0;var Kn=Object.create||function(e,t){var n;return null!==e?(jn.prototype=xn(e),n=new jn,jn.prototype=null,n[Bn]=e):n=zn(),void 0===t?n:Pn.f(n,t)},Wn=Ve,Yn=Kn,Jn=Ze.f,Zn=Wn("unscopables"),Xn=Array.prototype;null==Xn[Zn]&&Jn(Xn,Zn,{configurable:!0,value:Yn(null)});var Qn,$n,ei,ti={},ni=he,ii=B.WeakMap,ri=ni(ii)&&/native code/.test(String(ii)),oi=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ai=Ze,si=oi,ci=Ye?function(e,t,n){return ai.f(e,t,si(1,n))}:function(e,t,n){return e[t]=n,e},ui=ri,li=B,di=je,hi=ci,pi=ie,fi=Y,gi=Nn,_i=hn,vi="Object already initialized",mi=li.TypeError,yi=li.WeakMap;if(ui||fi.state){var Ii=fi.state||(fi.state=new yi);Ii.get=Ii.get,Ii.has=Ii.has,Ii.set=Ii.set,Qn=function(e,t){if(Ii.has(e))throw mi(vi);return t.facade=e,Ii.set(e,t),t},$n=function(e){return Ii.get(e)||{}},ei=function(e){return Ii.has(e)}}else{var Ti=gi("state");_i[Ti]=!0,Qn=function(e,t){if(pi(e,Ti))throw mi(vi);return t.facade=e,hi(e,Ti,t),t},$n=function(e){return pi(e,Ti)?e[Ti]:{}},ei=function(e){return pi(e,Ti)}}var Ci={set:Qn,get:$n,has:ei,enforce:function(e){return ei(e)?$n(e):Qn(e,{})},getterFor:function(e){return function(t){var n;if(!di(t)||(n=$n(t)).type!==e)throw mi("Incompatible receiver, "+e+" required");return n}}},Si={},Ei={},bi={}.propertyIsEnumerable,Mi=Object.getOwnPropertyDescriptor,ki=Mi&&!bi.call({1:2},1);Ei.f=ki?function(e){var t=Mi(this,e);return!!t&&t.enumerable}:bi;var wi=Ye,Di=ot,Ai=Ei,Ri=oi,Li=V,Oi=xt,Ni=ie,xi=nt,Pi=Object.getOwnPropertyDescriptor;Si.f=wi?Pi:function(e,t){if(e=Li(e),t=Oi(t),xi)try{return Pi(e,t)}catch(i){}if(Ni(e,t))return Ri(!Di(Ai.f,e,t),e[t])};var Ui={exports:{}},Gi=Ye,Vi=ie,Fi=Function.prototype,Bi=Gi&&Object.getOwnPropertyDescriptor,ji=Vi(Fi,"name"),qi={EXISTS:ji,PROPER:ji&&"something"===function(){}.name,CONFIGURABLE:ji&&(!Gi||Gi&&Bi(Fi,"name").configurable)},Hi=he,zi=Y,Ki=k(Function.toString);Hi(zi.inspectSource)||(zi.inspectSource=function(e){return Ki(e)});var Wi=zi.inspectSource,Yi=f,Ji=he,Zi=ie,Xi=Ye,Qi=qi.CONFIGURABLE,$i=Wi,er=Ci.enforce,tr=Ci.get,nr=Object.defineProperty,ir=Xi&&!Yi((function(){return 8!==nr((function(){}),"length",{value:8}).length})),rr=String(String).split("String"),or=Ui.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Zi(e,"name")||Qi&&e.name!==t)&&(Xi?nr(e,"name",{value:t,configurable:!0}):e.name=t),ir&&n&&Zi(n,"arity")&&e.length!==n.arity&&nr(e,"length",{value:n.arity});try{n&&Zi(n,"constructor")&&n.constructor?Xi&&nr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(o){}var i=er(e);return Zi(i,"source")||(i.source=rr.join("string"==typeof t?t:"")),e};Function.prototype.toString=or((function(){return Ji(this)&&tr(this).source||$i(this)}),"toString");var ar=he,sr=Ze,cr=Ui.exports,ur=z,lr=function(e,t,n,i){i||(i={});var r=i.enumerable,o=void 0!==i.name?i.name:t;if(ar(n)&&cr(n,o,i),i.global)r?e[t]=n:ur(t,n);else{try{i.unsafe?e[t]&&(r=!0):delete e[t]}catch(s){}r?e[t]=n:sr.f(e,t,{value:n,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e},dr={},hr=mn,pr=yn.concat("length","prototype");dr.f=Object.getOwnPropertyNames||function(e){return hr(e,pr)};var fr={};fr.f=Object.getOwnPropertySymbols;var gr,_r,vr,mr=_e,yr=dr,Ir=fr,Tr=Ke,Cr=k([].concat),Sr=mr("Reflect","ownKeys")||function(e){var t=yr.f(Tr(e)),n=Ir.f;return n?Cr(t,n(e)):t},Er=ie,br=Sr,Mr=Si,kr=Ze,wr=f,Dr=he,Ar=/#|\.prototype\./,Rr=function(e,t){var n=Or[Lr(e)];return n==xr||n!=Nr&&(Dr(t)?wr(t):!!t)},Lr=Rr.normalize=function(e){return String(e).replace(Ar,".").toLowerCase()},Or=Rr.data={},Nr=Rr.NATIVE="N",xr=Rr.POLYFILL="P",Pr=Rr,Ur=B,Gr=Si.f,Vr=ci,Fr=lr,Br=z,jr=function(e,t,n){for(var i=br(t),r=kr.f,o=Mr.f,a=0;a<i.length;a++){var s=i[a];Er(e,s)||n&&Er(n,s)||r(e,s,o(t,s))}},qr=Pr,Hr=function(e,t){var n,i,r,o,a,s=e.target,c=e.global,u=e.stat;if(n=c?Ur:u?Ur[s]||Br(s,{}):(Ur[s]||{}).prototype)for(i in t){if(o=t[i],r=e.dontCallGetSet?(a=Gr(n,i))&&a.value:n[i],!qr(c?i:s+(u?".":"#")+i,e.forced)&&void 0!==r){if(typeof o==typeof r)continue;jr(o,r)}(e.sham||r&&r.sham)&&Vr(o,"sham",!0),Fr(n,i,o,e)}},zr=!f((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Kr=ie,Wr=he,Yr=ee,Jr=zr,Zr=Nn("IE_PROTO"),Xr=Object,Qr=Xr.prototype,$r=Jr?Xr.getPrototypeOf:function(e){var t=Yr(e);if(Kr(t,Zr))return t[Zr];var n=t.constructor;return Wr(n)&&t instanceof n?n.prototype:t instanceof Xr?Qr:null},eo=f,to=he,no=je,io=$r,ro=lr,oo=Ve("iterator"),ao=!1;[].keys&&("next"in(vr=[].keys())?(_r=io(io(vr)))!==Object.prototype&&(gr=_r):ao=!0);var so=!no(gr)||eo((function(){var e={};return gr[oo].call(e)!==e}));so&&(gr={}),to(gr[oo])||ro(gr,oo,(function(){return this}));var co={IteratorPrototype:gr,BUGGY_SAFARI_ITERATORS:ao},uo=Ze.f,lo=ie,ho=Ve("toStringTag"),po=function(e,t,n){e&&!n&&(e=e.prototype),e&&!lo(e,ho)&&uo(e,ho,{configurable:!0,value:t})},fo=co.IteratorPrototype,go=Kn,_o=oi,vo=po,mo=ti,yo=function(){return this},Io=he,To=String,Co=TypeError,So=k,Eo=Ke,bo=function(e){if("object"==typeof e||Io(e))return e;throw Co("Can't set "+To(e)+" as a prototype")},Mo=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=So(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(r){}return function(n,i){return Eo(n),bo(i),t?e(n,i):n.__proto__=i,n}}():void 0),ko=Hr,wo=ot,Do=he,Ao=function(e,t,n,i){var r=t+" Iterator";return e.prototype=go(fo,{next:_o(+!i,n)}),vo(e,r,!1),mo[r]=yo,e},Ro=$r,Lo=Mo,Oo=po,No=ci,xo=lr,Po=ti,Uo=qi.PROPER,Go=qi.CONFIGURABLE,Vo=co.IteratorPrototype,Fo=co.BUGGY_SAFARI_ITERATORS,Bo=Ve("iterator"),jo="keys",qo="values",Ho="entries",zo=function(){return this},Ko=function(e,t,n,i,r,o,a){Ao(n,t,i);var s,c,u,l=function(e){if(e===r&&g)return g;if(!Fo&&e in p)return p[e];switch(e){case jo:case qo:case Ho:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,p=e.prototype,f=p[Bo]||p["@@iterator"]||r&&p[r],g=!Fo&&f||l(r),_="Array"==t&&p.entries||f;if(_&&(s=Ro(_.call(new e)))!==Object.prototype&&s.next&&(Ro(s)!==Vo&&(Lo?Lo(s,Vo):Do(s[Bo])||xo(s,Bo,zo)),Oo(s,d,!0)),Uo&&r==qo&&f&&f.name!==qo&&(Go?No(p,"name",qo):(h=!0,g=function(){return wo(f,this)})),r)if(c={values:l(qo),keys:o?g:l(jo),entries:l(Ho)},a)for(u in c)(Fo||h||!(u in p))&&xo(p,u,c[u]);else ko({target:t,proto:!0,forced:Fo||h},c);return p[Bo]!==g&&xo(p,Bo,g,{name:r}),Po[t]=g,c},Wo=function(e,t){return{value:e,done:t}},Yo=V,Jo=function(e){Xn[Zn][e]=!0},Zo=ti,Xo=Ci,Qo=Ze.f,$o=Ko,ea=Wo,ta=Ye,na="Array Iterator",ia=Xo.set,ra=Xo.getterFor(na),oa=$o(Array,"Array",(function(e,t){ia(this,{type:na,target:Yo(e),index:0,kind:t})}),(function(){var e=ra(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,ea(void 0,!0)):ea("keys"==n?i:"values"==n?t[i]:[i,t[i]],!1)}),"values"),aa=Zo.Arguments=Zo.Array;if(Jo("keys"),Jo("values"),Jo("entries"),ta&&"values"!==aa.name)try{Qo(aa,"name",{value:"values"})}catch(iT){}var sa={exports:{}},ca={},ua=xt,la=Ze,da=oi,ha=function(e,t,n){var i=ua(t);i in e?la.f(e,i,da(0,n)):e[i]=n},pa=en,fa=an,ga=ha,_a=Array,va=Math.max,ma=function(e,t,n){for(var i=fa(e),r=pa(t,i),o=pa(void 0===n?i:n,i),a=_a(va(o-r,0)),s=0;r<o;r++,s++)ga(a,s,e[r]);return a.length=s,a},ya=E,Ia=V,Ta=dr.f,Ca=ma,Sa="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];ca.f=function(e){return Sa&&"Window"==ya(e)?function(e){try{return Ta(e)}catch(iT){return Ca(Sa)}}(e):Ta(Ia(e))};var Ea=f((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),ba=f,Ma=je,ka=E,wa=Ea,Da=Object.isExtensible,Aa=ba((function(){Da(1)}))||wa?function(e){return!!Ma(e)&&(!wa||"ArrayBuffer"!=ka(e))&&(!Da||Da(e))}:Da,Ra=!f((function(){return Object.isExtensible(Object.preventExtensions({}))})),La=Hr,Oa=k,Na=hn,xa=je,Pa=ie,Ua=Ze.f,Ga=dr,Va=ca,Fa=Aa,Ba=Ra,ja=!1,qa=ce("meta"),Ha=0,za=function(e){Ua(e,qa,{value:{objectID:"O"+Ha++,weakData:{}}})},Ka=sa.exports={enable:function(){Ka.enable=function(){},ja=!0;var e=Ga.f,t=Oa([].splice),n={};n[qa]=1,e(n).length&&(Ga.f=function(n){for(var i=e(n),r=0,o=i.length;r<o;r++)if(i[r]===qa){t(i,r,1);break}return i},La({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Va.f}))},fastKey:function(e,t){if(!xa(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Pa(e,qa)){if(!Fa(e))return"F";if(!t)return"E";za(e)}return e[qa].objectID},getWeakData:function(e,t){if(!Pa(e,qa)){if(!Fa(e))return!0;if(!t)return!1;za(e)}return e[qa].weakData},onFreeze:function(e){return Ba&&ja&&Fa(e)&&!Pa(e,qa)&&za(e),e}};Na[qa]=!0;var Wa=vt,Ya=g,Ja=k(k.bind),Za=function(e,t){return Wa(e),void 0===t?e:Ya?Ja(e,t):function(){return e.apply(t,arguments)}},Xa=ti,Qa=Ve("iterator"),$a=Array.prototype,es=function(e){return void 0!==e&&(Xa.Array===e||$a[Qa]===e)},ts={};ts[Ve("toStringTag")]="z";var ns="[object z]"===String(ts),is=ns,rs=he,os=E,as=Ve("toStringTag"),ss=Object,cs="Arguments"==os(function(){return arguments}()),us=is?os:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(iT){}}(t=ss(e),as))?n:cs?os(t):"Object"==(i=os(t))&&rs(t.callee)?"Arguments":i},ls=us,ds=It,hs=O,ps=ti,fs=Ve("iterator"),gs=function(e){if(!hs(e))return ds(e,fs)||ds(e,"@@iterator")||ps[ls(e)]},_s=ot,vs=vt,ms=Ke,ys=pt,Is=gs,Ts=TypeError,Cs=function(e,t){var n=arguments.length<2?Is(e):t;if(vs(n))return ms(_s(n,e));throw Ts(ys(e)+" is not iterable")},Ss=ot,Es=Ke,bs=It,Ms=Za,ks=ot,ws=Ke,Ds=pt,As=es,Rs=an,Ls=at,Os=Cs,Ns=gs,xs=function(e,t,n){var i,r;Es(e);try{if(!(i=bs(e,"return"))){if("throw"===t)throw n;return n}i=Ss(i,e)}catch(iT){r=!0,i=iT}if("throw"===t)throw n;if(r)throw i;return Es(i),n},Ps=TypeError,Us=function(e,t){this.stopped=e,this.result=t},Gs=Us.prototype,Vs=function(e,t,n){var i,r,o,a,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),g=Ms(t,l),_=function(e){return i&&xs(i,"normal",e),new Us(!0,e)},v=function(e){return d?(ws(e),f?g(e[0],e[1],_):g(e[0],e[1])):f?g(e,_):g(e)};if(h)i=e.iterator;else if(p)i=e;else{if(!(r=Ns(e)))throw Ps(Ds(e)+" is not iterable");if(As(r)){for(o=0,a=Rs(e);a>o;o++)if((s=v(e[o]))&&Ls(Gs,s))return s;return new Us(!1)}i=Os(e,r)}for(c=h?e.next:i.next;!(u=ks(c,i)).done;){try{s=v(u.value)}catch(iT){xs(i,"throw",iT)}if("object"==typeof s&&s&&Ls(Gs,s))return s}return new Us(!1)},Fs=at,Bs=TypeError,js=function(e,t){if(Fs(t,e))return e;throw Bs("Incorrect invocation")},qs=Ve("iterator"),Hs=!1;try{var zs=0,Ks={next:function(){return{done:!!zs++}},return:function(){Hs=!0}};Ks[qs]=function(){return this},Array.from(Ks,(function(){throw 2}))}catch(iT){}var Ws=function(e,t){if(!t&&!Hs)return!1;var n=!1;try{var i={};i[qs]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(iT){}return n},Ys=he,Js=je,Zs=Mo,Xs=function(e,t,n){var i,r;return Zs&&Ys(i=t.constructor)&&i!==n&&Js(r=i.prototype)&&r!==n.prototype&&Zs(e,r),e},Qs=Hr,$s=B,ec=k,tc=Pr,nc=lr,ic=sa.exports,rc=Vs,oc=js,ac=he,sc=O,cc=je,uc=f,lc=Ws,dc=po,hc=Xs,pc=lr,fc=function(e,t,n){for(var i in t)pc(e,i,t[i],n);return e},gc=_e,_c=Ze,vc=Ye,mc=Ve("species"),yc=function(e){var t=gc(e),n=_c.f;vc&&t&&!t[mc]&&n(t,mc,{configurable:!0,get:function(){return this}})},Ic=Ze.f,Tc=Kn,Cc=fc,Sc=Za,Ec=js,bc=O,Mc=Vs,kc=Ko,wc=Wo,Dc=yc,Ac=Ye,Rc=sa.exports.fastKey,Lc=Ci.set,Oc=Ci.getterFor,Nc={getConstructor:function(e,t,n,i){var r=e((function(e,r){Ec(e,o),Lc(e,{type:t,index:Tc(null),first:void 0,last:void 0,size:0}),Ac||(e.size=0),bc(r)||Mc(r,e[i],{that:e,AS_ENTRIES:n})})),o=r.prototype,a=Oc(t),s=function(e,t,n){var i,r,o=a(e),s=c(e,t);return s?s.value=n:(o.last=s={index:r=Rc(t,!0),key:t,value:n,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=s),i&&(i.next=s),Ac?o.size++:e.size++,"F"!==r&&(o.index[r]=s)),e},c=function(e,t){var n,i=a(e),r=Rc(t);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key==t)return n};return Cc(o,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Ac?e.size=0:this.size=0},delete:function(e){var t=this,n=a(t),i=c(t,e);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first==i&&(n.first=r),n.last==i&&(n.last=o),Ac?n.size--:t.size--}return!!i},forEach:function(e){for(var t,n=a(this),i=Sc(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),Cc(o,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Ac&&Ic(o,"size",{get:function(){return a(this).size}}),r},setStrong:function(e,t,n){var i=t+" Iterator",r=Oc(t),o=Oc(i);kc(e,t,(function(e,t){Lc(this,{type:i,target:e,state:r(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?wc("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,wc(void 0,!0))}),n?"entries":"values",!n,!0),Dc(t)}},xc=function(e,t,n){var i=-1!==e.indexOf("Map"),r=-1!==e.indexOf("Weak"),o=i?"set":"add",a=$s[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=ec(s[e]);nc(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(r&&!cc(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return r&&!cc(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(r&&!cc(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(tc(e,!ac(a)||!(r||s.forEach&&!uc((function(){(new a).entries().next()})))))c=n.getConstructor(t,e,i,o),ic.enable();else if(tc(e,!0)){var d=new c,h=d[o](r?{}:-0,1)!=d,p=uc((function(){d.has(1)})),f=lc((function(e){new a(e)})),g=!r&&uc((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));f||((c=t((function(e,t){oc(e,s);var n=hc(new a,e,c);return sc(t)||rc(t,n[o],{that:n,AS_ENTRIES:i}),n}))).prototype=s,s.constructor=c),(p||g)&&(l("delete"),l("has"),i&&l("get")),(g||h)&&l(o),r&&s.clear&&delete s.clear}return u[e]=c,Qs({global:!0,constructor:!0,forced:c!=a},u),dc(c,e),r||n.setStrong(c,e,i),c};xc("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Nc);var Pc=us,Uc=ns?{}.toString:function(){return"[object "+Pc(this)+"]"};ns||lr(Object.prototype,"toString",Uc,{unsafe:!0});var Gc=us,Vc=String,Fc=function(e){if("Symbol"===Gc(e))throw TypeError("Cannot convert a Symbol value to a string");return Vc(e)},Bc=k,jc=Zt,qc=Fc,Hc=P,zc=Bc("".charAt),Kc=Bc("".charCodeAt),Wc=Bc("".slice),Yc=function(e){return function(t,n){var i,r,o=qc(Hc(t)),a=jc(n),s=o.length;return a<0||a>=s?e?"":void 0:(i=Kc(o,a))<55296||i>56319||a+1===s||(r=Kc(o,a+1))<56320||r>57343?e?zc(o,a):i:e?Wc(o,a,a+2):r-56320+(i-55296<<10)+65536}},Jc={codeAt:Yc(!1),charAt:Yc(!0)}.charAt,Zc=Fc,Xc=Ci,Qc=Ko,$c=Wo,eu="String Iterator",tu=Xc.set,nu=Xc.getterFor(eu);Qc(String,"String",(function(e){tu(this,{type:eu,string:Zc(e),index:0})}),(function(){var e,t=nu(this),n=t.string,i=t.index;return i>=n.length?$c(void 0,!0):(e=Jc(n,i),t.index+=e.length,$c(e,!1))}));var iu=et("span").classList,ru=iu&&iu.constructor&&iu.constructor.prototype,ou=ru===Object.prototype?void 0:ru,au=B,su={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},cu=ou,uu=oa,lu=ci,du=Ve,hu=du("iterator"),pu=du("toStringTag"),fu=uu.values,gu=function(e,t){if(e){if(e[hu]!==fu)try{lu(e,hu,fu)}catch(iT){e[hu]=fu}if(e[pu]||lu(e,pu,t),su[t])for(var n in uu)if(e[n]!==uu[n])try{lu(e,n,uu[n])}catch(iT){e[n]=uu[n]}}};for(var _u in su)gu(au[_u]&&au[_u].prototype,_u);gu(cu,"DOMTokenList");var vu=E,mu=Array.isArray||function(e){return"Array"==vu(e)},yu=k,Iu=f,Tu=he,Cu=us,Su=Wi,Eu=function(){},bu=[],Mu=_e("Reflect","construct"),ku=/^\s*(?:class|function)\b/,wu=yu(ku.exec),Du=!ku.exec(Eu),Au=function(e){if(!Tu(e))return!1;try{return Mu(Eu,bu,e),!0}catch(iT){return!1}},Ru=function(e){if(!Tu(e))return!1;switch(Cu(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Du||!!wu(ku,Su(e))}catch(iT){return!0}};Ru.sham=!0;var Lu=!Mu||Iu((function(){var e;return Au(Au.call)||!Au(Object)||!Au((function(){e=!0}))||e}))?Ru:Au,Ou=f,Nu=Ee,xu=Ve("species"),Pu=function(e){return Nu>=51||!Ou((function(){var t=[];return(t.constructor={})[xu]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Uu=k([].slice),Gu=Hr,Vu=mu,Fu=Lu,Bu=je,ju=en,qu=an,Hu=V,zu=ha,Ku=Ve,Wu=Uu,Yu=Pu("slice"),Ju=Ku("species"),Zu=Array,Xu=Math.max;Gu({target:"Array",proto:!0,forced:!Yu},{slice:function(e,t){var n,i,r,o=Hu(this),a=qu(o),s=ju(e,a),c=ju(void 0===t?a:t,a);if(Vu(o)&&(n=o.constructor,(Fu(n)&&(n===Zu||Vu(n.prototype))||Bu(n)&&null===(n=n[Ju]))&&(n=void 0),n===Zu||void 0===n))return Wu(o,s,c);for(i=new(void 0===n?Zu:n)(Xu(c-s,0)),r=0;s<c;s++,r++)s in o&&zu(i,r,o[s]);return i.length=r,i}});var Qu=Hr,$u=Date,el=k($u.prototype.getTime);Qu({target:"Date",stat:!0},{now:function(){return el(new $u)}});var tl=k,nl=lr,il=Date.prototype,rl="Invalid Date",ol="toString",al=tl(il.toString),sl=tl(il.getTime);String(new Date(NaN))!=rl&&nl(il,ol,(function(){var e=sl(this);return e==e?al(this):rl}));var cl=TypeError,ul=mu,ll=Lu,dl=je,hl=Ve("species"),pl=Array,fl=function(e){var t;return ul(e)&&(t=e.constructor,(ll(t)&&(t===pl||ul(t.prototype))||dl(t)&&null===(t=t[hl]))&&(t=void 0)),void 0===t?pl:t},gl=function(e,t){return new(fl(e))(0===t?0:t)},_l=Hr,vl=f,ml=mu,yl=je,Il=ee,Tl=an,Cl=function(e){if(e>9007199254740991)throw cl("Maximum allowed index exceeded");return e},Sl=ha,El=gl,bl=Pu,Ml=Ee,kl=Ve("isConcatSpreadable"),wl=Ml>=51||!vl((function(){var e=[];return e[kl]=!1,e.concat()[0]!==e})),Dl=bl("concat"),Al=function(e){if(!yl(e))return!1;var t=e[kl];return void 0!==t?!!t:ml(e)};_l({target:"Array",proto:!0,arity:1,forced:!wl||!Dl},{concat:function(e){var t,n,i,r,o,a=Il(this),s=El(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(Al(o=-1===t?a:arguments[t]))for(r=Tl(o),Cl(c+r),n=0;n<r;n++,c++)n in o&&Sl(s,c,o[n]);else Cl(c+1),Sl(s,c++,o);return s.length=c,s}});var Rl,Ll,Ol,Nl,xl="process"==E(B.process),Pl=Lu,Ul=pt,Gl=TypeError,Vl=function(e){if(Pl(e))return e;throw Gl(Ul(e)+" is not a constructor")},Fl=Ke,Bl=Vl,jl=O,ql=Ve("species"),Hl=function(e,t){var n,i=Fl(e).constructor;return void 0===i||jl(n=Fl(i)[ql])?t:Bl(n)},zl=g,Kl=Function.prototype,Wl=Kl.apply,Yl=Kl.call,Jl="object"==typeof Reflect&&Reflect.apply||(zl?Yl.bind(Wl):function(){return Yl.apply(Wl,arguments)}),Zl=TypeError,Xl=/(?:ipad|iphone|ipod).*applewebkit/i.test(ve),Ql=B,$l=Jl,ed=Za,td=he,nd=ie,id=f,rd=An,od=Uu,ad=et,sd=function(e,t){if(e<t)throw Zl("Not enough arguments");return e},cd=Xl,ud=xl,ld=Ql.setImmediate,dd=Ql.clearImmediate,hd=Ql.process,pd=Ql.Dispatch,fd=Ql.Function,gd=Ql.MessageChannel,_d=Ql.String,vd=0,md={},yd="onreadystatechange";try{Rl=Ql.location}catch(iT){}var Id=function(e){if(nd(md,e)){var t=md[e];delete md[e],t()}},Td=function(e){return function(){Id(e)}},Cd=function(e){Id(e.data)},Sd=function(e){Ql.postMessage(_d(e),Rl.protocol+"//"+Rl.host)};ld&&dd||(ld=function(e){sd(arguments.length,1);var t=td(e)?e:fd(e),n=od(arguments,1);return md[++vd]=function(){$l(t,void 0,n)},Ll(vd),vd},dd=function(e){delete md[e]},ud?Ll=function(e){hd.nextTick(Td(e))}:pd&&pd.now?Ll=function(e){pd.now(Td(e))}:gd&&!cd?(Nl=(Ol=new gd).port2,Ol.port1.onmessage=Cd,Ll=ed(Nl.postMessage,Nl)):Ql.addEventListener&&td(Ql.postMessage)&&!Ql.importScripts&&Rl&&"file:"!==Rl.protocol&&!id(Sd)?(Ll=Sd,Ql.addEventListener("message",Cd,!1)):Ll=yd in ad("script")?function(e){rd.appendChild(ad("script")).onreadystatechange=function(){rd.removeChild(this),Id(e)}}:function(e){setTimeout(Td(e),0)});var Ed,bd,Md,kd,wd,Dd,Ad,Rd,Ld={set:ld,clear:dd},Od=B,Nd=/ipad|iphone|ipod/i.test(ve)&&void 0!==Od.Pebble,xd=/web0s(?!.*chrome)/i.test(ve),Pd=B,Ud=Za,Gd=Si.f,Vd=Ld.set,Fd=Xl,Bd=Nd,jd=xd,qd=xl,Hd=Pd.MutationObserver||Pd.WebKitMutationObserver,zd=Pd.document,Kd=Pd.process,Wd=Pd.Promise,Yd=Gd(Pd,"queueMicrotask"),Jd=Yd&&Yd.value;Jd||(Ed=function(){var e,t;for(qd&&(e=Kd.domain)&&e.exit();bd;){t=bd.fn,bd=bd.next;try{t()}catch(iT){throw bd?kd():Md=void 0,iT}}Md=void 0,e&&e.enter()},Fd||qd||jd||!Hd||!zd?!Bd&&Wd&&Wd.resolve?((Ad=Wd.resolve(void 0)).constructor=Wd,Rd=Ud(Ad.then,Ad),kd=function(){Rd(Ed)}):qd?kd=function(){Kd.nextTick(Ed)}:(Vd=Ud(Vd,Pd),kd=function(){Vd(Ed)}):(wd=!0,Dd=zd.createTextNode(""),new Hd(Ed).observe(Dd,{characterData:!0}),kd=function(){Dd.data=wd=!wd}));var Zd=Jd||function(e){var t={fn:e,next:void 0};Md&&(Md.next=t),bd||(bd=t,kd()),Md=t},Xd=B,Qd=function(e){try{return{error:!1,value:e()}}catch(iT){return{error:!0,value:iT}}},$d=function(){this.head=null,this.tail=null};$d.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var eh=$d,th=B.Promise,nh="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,ih=!nh&&!xl&&"object"==typeof window&&"object"==typeof document,rh=B,oh=th,ah=he,sh=Pr,ch=Wi,uh=Ve,lh=ih,dh=nh,hh=Ee;oh&&oh.prototype;var ph=uh("species"),fh=!1,gh=ah(rh.PromiseRejectionEvent),_h=sh("Promise",(function(){var e=ch(oh),t=e!==String(oh);if(!t&&66===hh)return!0;if(!hh||hh<51||!/native code/.test(e)){var n=new oh((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};if((n.constructor={})[ph]=i,!(fh=n.then((function(){}))instanceof i))return!0}return!t&&(lh||dh)&&!gh})),vh={CONSTRUCTOR:_h,REJECTION_EVENT:gh,SUBCLASSING:fh},mh={},yh=vt,Ih=TypeError,Th=function(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw Ih("Bad Promise constructor");t=e,n=i})),this.resolve=yh(t),this.reject=yh(n)};mh.f=function(e){return new Th(e)};var Ch,Sh,Eh,bh=Hr,Mh=xl,kh=B,wh=ot,Dh=lr,Ah=Mo,Rh=po,Lh=yc,Oh=vt,Nh=he,xh=je,Ph=js,Uh=Hl,Gh=Ld.set,Vh=Zd,Fh=function(e,t){var n=Xd.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},Bh=Qd,jh=eh,qh=Ci,Hh=th,zh=mh,Kh="Promise",Wh=vh.CONSTRUCTOR,Yh=vh.REJECTION_EVENT,Jh=vh.SUBCLASSING,Zh=qh.getterFor(Kh),Xh=qh.set,Qh=Hh&&Hh.prototype,$h=Hh,ep=Qh,tp=kh.TypeError,np=kh.document,ip=kh.process,rp=zh.f,op=rp,ap=!!(np&&np.createEvent&&kh.dispatchEvent),sp="unhandledrejection",cp=function(e){var t;return!(!xh(e)||!Nh(t=e.then))&&t},up=function(e,t){var n,i,r,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&fp(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),r=!0)),n===e.promise?u(tp("Promise-chain cycle")):(i=cp(n))?wh(i,n,c,u):c(n)):u(o)}catch(iT){l&&!r&&l.exit(),u(iT)}},lp=function(e,t){e.notified||(e.notified=!0,Vh((function(){for(var n,i=e.reactions;n=i.get();)up(n,e);e.notified=!1,t&&!e.rejection&&hp(e)})))},dp=function(e,t,n){var i,r;ap?((i=np.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),kh.dispatchEvent(i)):i={promise:t,reason:n},!Yh&&(r=kh["on"+e])?r(i):e===sp&&Fh("Unhandled promise rejection",n)},hp=function(e){wh(Gh,kh,(function(){var t,n=e.facade,i=e.value;if(pp(e)&&(t=Bh((function(){Mh?ip.emit("unhandledRejection",i,n):dp(sp,n,i)})),e.rejection=Mh||pp(e)?2:1,t.error))throw t.value}))},pp=function(e){return 1!==e.rejection&&!e.parent},fp=function(e){wh(Gh,kh,(function(){var t=e.facade;Mh?ip.emit("rejectionHandled",t):dp("rejectionhandled",t,e.value)}))},gp=function(e,t,n){return function(i){e(t,i,n)}},_p=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,lp(e,!0))},vp=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw tp("Promise can't be resolved itself");var i=cp(t);i?Vh((function(){var n={done:!1};try{wh(i,t,gp(vp,n,e),gp(_p,n,e))}catch(iT){_p(n,iT,e)}})):(e.value=t,e.state=1,lp(e,!1))}catch(iT){_p({done:!1},iT,e)}}};if(Wh&&(ep=($h=function(e){Ph(this,ep),Oh(e),wh(Ch,this);var t=Zh(this);try{e(gp(vp,t),gp(_p,t))}catch(iT){_p(t,iT)}}).prototype,(Ch=function(e){Xh(this,{type:Kh,done:!1,notified:!1,parent:!1,reactions:new jh,rejection:!1,state:0,value:void 0})}).prototype=Dh(ep,"then",(function(e,t){var n=Zh(this),i=rp(Uh(this,$h));return n.parent=!0,i.ok=!Nh(e)||e,i.fail=Nh(t)&&t,i.domain=Mh?ip.domain:void 0,0==n.state?n.reactions.add(i):Vh((function(){up(i,n)})),i.promise})),Sh=function(){var e=new Ch,t=Zh(e);this.promise=e,this.resolve=gp(vp,t),this.reject=gp(_p,t)},zh.f=rp=function(e){return e===$h||void 0===e?new Sh(e):op(e)},Nh(Hh)&&Qh!==Object.prototype)){Eh=Qh.then,Jh||Dh(Qh,"then",(function(e,t){var n=this;return new $h((function(e,t){wh(Eh,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete Qh.constructor}catch(iT){}Ah&&Ah(Qh,ep)}bh({global:!0,constructor:!0,wrap:!0,forced:Wh},{Promise:$h}),Rh($h,Kh,!1),Lh(Kh);var mp=th,yp=vh.CONSTRUCTOR||!Ws((function(e){mp.all(e).then(void 0,(function(){}))})),Ip=ot,Tp=vt,Cp=mh,Sp=Qd,Ep=Vs;Hr({target:"Promise",stat:!0,forced:yp},{all:function(e){var t=this,n=Cp.f(t),i=n.resolve,r=n.reject,o=Sp((function(){var n=Tp(t.resolve),o=[],a=0,s=1;Ep(e,(function(e){var c=a++,u=!1;s++,Ip(n,t,e).then((function(e){u||(u=!0,o[c]=e,--s||i(o))}),r)})),--s||i(o)}));return o.error&&r(o.value),n.promise}});var bp=Hr,Mp=vh.CONSTRUCTOR,kp=th,wp=_e,Dp=he,Ap=lr,Rp=kp&&kp.prototype;if(bp({target:"Promise",proto:!0,forced:Mp,real:!0},{catch:function(e){return this.then(void 0,e)}}),Dp(kp)){var Lp=wp("Promise").prototype.catch;Rp.catch!==Lp&&Ap(Rp,"catch",Lp,{unsafe:!0})}var Op=ot,Np=vt,xp=mh,Pp=Qd,Up=Vs;Hr({target:"Promise",stat:!0,forced:yp},{race:function(e){var t=this,n=xp.f(t),i=n.reject,r=Pp((function(){var r=Np(t.resolve);Up(e,(function(e){Op(r,t,e).then(n.resolve,i)}))}));return r.error&&i(r.value),n.promise}});var Gp=ot,Vp=mh;Hr({target:"Promise",stat:!0,forced:vh.CONSTRUCTOR},{reject:function(e){var t=Vp.f(this);return Gp(t.reject,void 0,e),t.promise}});var Fp=Ke,Bp=je,jp=mh,qp=Hr,Hp=vh.CONSTRUCTOR,zp=function(e,t){if(Fp(e),Bp(t)&&t.constructor===e)return t;var n=jp.f(e);return(0,n.resolve)(t),n.promise};_e("Promise"),qp({target:"Promise",stat:!0,forced:Hp},{resolve:function(e){return zp(this,e)}}),window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var Kp,Wp=function(){if(Kp)return Kp;Kp=new window.AudioContext({sampleRate:48e3});var e=function e(){"suspended"===Kp.state?(Kp.resume(),document.removeEventListener("click",e)):"interrupted"===Kp.state?Kp.resume():document.removeEventListener("click",e)};return document.addEventListener("click",e),Kp.onstatechange=function(){e()},Kp},Yp="input",Jp="output";function Zp(e){return Xp.apply(this,arguments)}function Xp(){return(Xp=c(a().mark((function e(t){var n,i,r,o,s,c,u,l,d,h,p,f,g,_;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sdkAppId,i=t.userId,r=t.userSig,o=t.timestamp,s="https://schedule.rtc.qq.com/api/v1/audioAiAuth?sdkAppId=".concat(n,"&userId=").concat(i,"&userSig=").concat(r,"&timestamp=").concat(o),e.next=4,fetch(s);case 4:return c=e.sent,e.next=7,c.json();case 7:if(u=e.sent,l=u.data,d=l.errCode,h=l.errMsg,p=l.sign,"1"!==(f=l.status)){e.next=15;break}return e.abrupt("return",{auth:!0,sign:p,status:f,message:h});case 15:g="Init RTCAIDenoiser failed.",_="",e.t0=d,e.next=1===e.t0?20:2===e.t0?22:3===e.t0?24:4===e.t0?26:5===e.t0?28:6===e.t0?30:32;break;case 20:return _="Please check your params.",e.abrupt("break",32);case 22:return _="You need to buy packages. Refer to: https://cloud.tencent.com/document/product/647/44247",e.abrupt("break",32);case 24:return _="Server is invalid. Please contact our engineer. ",e.abrupt("break",32);case 26:return _="Your packages is not active. Refer to: https://cloud.tencent.com/document/product/647/44247",e.abrupt("break",32);case 28:return _="Your packages is expired. Refer to: https://cloud.tencent.com/document/product/647/44247",e.abrupt("break",32);case 30:return _="Your version is not supported.",e.abrupt("break",32);case 32:return e.abrupt("return",{auth:!1,status:f,message:h?"".concat(g," Reason: ").concat(h,". ").concat(_):"".concat(g,", ").concat(_)});case 33:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qp={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(Qp);var $p=Qp.exports,ef="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,tf=Zt,nf=rn,rf=RangeError,of=function(e){if(void 0===e)return 0;var t=tf(e),n=nf(t);if(t!==n)throw rf("Wrong length or index");return n},af=Array,sf=Math.abs,cf=Math.pow,uf=Math.floor,lf=Math.log,df=Math.LN2,hf=ee,pf=en,ff=an,gf=function(e){for(var t=hf(this),n=ff(t),i=arguments.length,r=pf(i>1?arguments[1]:void 0,n),o=i>2?arguments[2]:void 0,a=void 0===o?n:pf(o,n);a>r;)t[r++]=e;return t},_f=B,vf=k,mf=Ye,yf=ef,If=qi,Tf=ci,Cf=fc,Sf=f,Ef=js,bf=Zt,Mf=rn,kf=of,wf={pack:function(e,t,n){var i,r,o,a=af(n),s=8*n-t-1,c=(1<<s)-1,u=c>>1,l=23===t?cf(2,-24)-cf(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=sf(e))!=e||1/0===e?(r=e!=e?1:0,i=c):(i=uf(lf(e)/df),e*(o=cf(2,-i))<1&&(i--,o*=2),(e+=i+u>=1?l/o:l*cf(2,1-u))*o>=2&&(i++,o/=2),i+u>=c?(r=0,i=c):i+u>=1?(r=(e*o-1)*cf(2,t),i+=u):(r=e*cf(2,u-1)*cf(2,t),i=0));t>=8;)a[h++]=255&r,r/=256,t-=8;for(i=i<<t|r,s+=t;s>0;)a[h++]=255&i,i/=256,s-=8;return a[--h]|=128*d,a},unpack:function(e,t){var n,i=e.length,r=8*i-t-1,o=(1<<r)-1,a=o>>1,s=r-7,c=i-1,u=e[c--],l=127&u;for(u>>=7;s>0;)l=256*l+e[c--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[c--],s-=8;if(0===l)l=1-a;else{if(l===o)return n?NaN:u?-1/0:1/0;n+=cf(2,t),l-=a}return(u?-1:1)*n*cf(2,l-t)}},Df=$r,Af=Mo,Rf=dr.f,Lf=Ze.f,Of=gf,Nf=ma,xf=po,Pf=If.PROPER,Uf=If.CONFIGURABLE,Gf=Ci.get,Vf=Ci.set,Ff="ArrayBuffer",Bf="DataView",jf="Wrong index",qf=_f.ArrayBuffer,Hf=qf,zf=Hf&&Hf.prototype,Kf=_f.DataView,Wf=Kf&&Kf.prototype,Yf=Object.prototype,Jf=_f.Array,Zf=_f.RangeError,Xf=vf(Of),Qf=vf([].reverse),$f=wf.pack,eg=wf.unpack,tg=function(e){return[255&e]},ng=function(e){return[255&e,e>>8&255]},ig=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},rg=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},og=function(e){return $f(e,23,4)},ag=function(e){return $f(e,52,8)},sg=function(e,t){Lf(e.prototype,t,{get:function(){return Gf(this)[t]}})},cg=function(e,t,n,i){var r=kf(n),o=Gf(e);if(r+t>o.byteLength)throw Zf(jf);var a=Gf(o.buffer).bytes,s=r+o.byteOffset,c=Nf(a,s,s+t);return i?c:Qf(c)},ug=function(e,t,n,i,r,o){var a=kf(n),s=Gf(e);if(a+t>s.byteLength)throw Zf(jf);for(var c=Gf(s.buffer).bytes,u=a+s.byteOffset,l=i(+r),d=0;d<t;d++)c[u+d]=l[o?d:t-d-1]};if(yf){var lg=Pf&&qf.name!==Ff;if(Sf((function(){qf(1)}))&&Sf((function(){new qf(-1)}))&&!Sf((function(){return new qf,new qf(1.5),new qf(NaN),1!=qf.length||lg&&!Uf})))lg&&Uf&&Tf(qf,"name",Ff);else{(Hf=function(e){return Ef(this,zf),new qf(kf(e))}).prototype=zf;for(var dg,hg=Rf(qf),pg=0;hg.length>pg;)(dg=hg[pg++])in Hf||Tf(Hf,dg,qf[dg]);zf.constructor=Hf}Af&&Df(Wf)!==Yf&&Af(Wf,Yf);var fg=new Kf(new Hf(2)),gg=vf(Wf.setInt8);fg.setInt8(0,2147483648),fg.setInt8(1,2147483649),!fg.getInt8(0)&&fg.getInt8(1)||Cf(Wf,{setInt8:function(e,t){gg(this,e,t<<24>>24)},setUint8:function(e,t){gg(this,e,t<<24>>24)}},{unsafe:!0})}else zf=(Hf=function(e){Ef(this,zf);var t=kf(e);Vf(this,{bytes:Xf(Jf(t),0),byteLength:t}),mf||(this.byteLength=t)}).prototype,Wf=(Kf=function(e,t,n){Ef(this,Wf),Ef(e,zf);var i=Gf(e).byteLength,r=bf(t);if(r<0||r>i)throw Zf("Wrong offset");if(r+(n=void 0===n?i-r:Mf(n))>i)throw Zf("Wrong length");Vf(this,{buffer:e,byteLength:n,byteOffset:r}),mf||(this.buffer=e,this.byteLength=n,this.byteOffset=r)}).prototype,mf&&(sg(Hf,"byteLength"),sg(Kf,"buffer"),sg(Kf,"byteLength"),sg(Kf,"byteOffset")),Cf(Wf,{getInt8:function(e){return cg(this,1,e)[0]<<24>>24},getUint8:function(e){return cg(this,1,e)[0]},getInt16:function(e){var t=cg(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=cg(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return rg(cg(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return rg(cg(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return eg(cg(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return eg(cg(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){ug(this,1,e,tg,t)},setUint8:function(e,t){ug(this,1,e,tg,t)},setInt16:function(e,t){ug(this,2,e,ng,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){ug(this,2,e,ng,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){ug(this,4,e,ig,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){ug(this,4,e,ig,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){ug(this,4,e,og,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){ug(this,8,e,ag,t,arguments.length>2?arguments[2]:void 0)}});xf(Hf,Ff),xf(Kf,Bf);var _g={ArrayBuffer:Hf,DataView:Kf},vg=Hr,mg=k,yg=f,Ig=Ke,Tg=en,Cg=rn,Sg=Hl,Eg=_g.ArrayBuffer,bg=_g.DataView,Mg=bg.prototype,kg=mg(Eg.prototype.slice),wg=mg(Mg.getUint8),Dg=mg(Mg.setUint8);vg({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:yg((function(){return!new Eg(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(kg&&void 0===t)return kg(Ig(this),e);for(var n=Ig(this).byteLength,i=Tg(e,n),r=Tg(void 0===t?n:t,n),o=new(Sg(this,Eg))(Cg(r-i)),a=new bg(this),s=new bg(o),c=0;i<r;)Dg(s,c++,wg(a,i++));return o}});var Ag,Rg,Lg,Og={exports:{}},Ng=ef,xg=Ye,Pg=B,Ug=he,Gg=je,Vg=ie,Fg=us,Bg=pt,jg=ci,qg=lr,Hg=Ze.f,zg=at,Kg=$r,Wg=Mo,Yg=Ve,Jg=ce,Zg=Ci.enforce,Xg=Ci.get,Qg=Pg.Int8Array,$g=Qg&&Qg.prototype,e_=Pg.Uint8ClampedArray,t_=e_&&e_.prototype,n_=Qg&&Kg(Qg),i_=$g&&Kg($g),r_=Object.prototype,o_=Pg.TypeError,a_=Yg("toStringTag"),s_=Jg("TYPED_ARRAY_TAG"),c_="TypedArrayConstructor",u_=Ng&&!!Wg&&"Opera"!==Fg(Pg.opera),l_=!1,d_={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},h_={BigInt64Array:8,BigUint64Array:8},p_=function(e){var t=Kg(e);if(Gg(t)){var n=Xg(t);return n&&Vg(n,c_)?n.TypedArrayConstructor:p_(t)}},f_=function(e){if(!Gg(e))return!1;var t=Fg(e);return Vg(d_,t)||Vg(h_,t)};for(Ag in d_)(Lg=(Rg=Pg[Ag])&&Rg.prototype)?Zg(Lg).TypedArrayConstructor=Rg:u_=!1;for(Ag in h_)(Lg=(Rg=Pg[Ag])&&Rg.prototype)&&(Zg(Lg).TypedArrayConstructor=Rg);if((!u_||!Ug(n_)||n_===Function.prototype)&&(n_=function(){throw o_("Incorrect invocation")},u_))for(Ag in d_)Pg[Ag]&&Wg(Pg[Ag],n_);if((!u_||!i_||i_===r_)&&(i_=n_.prototype,u_))for(Ag in d_)Pg[Ag]&&Wg(Pg[Ag].prototype,i_);if(u_&&Kg(t_)!==i_&&Wg(t_,i_),xg&&!Vg(i_,a_))for(Ag in l_=!0,Hg(i_,a_,{get:function(){return Gg(this)?this[s_]:void 0}}),d_)Pg[Ag]&&jg(Pg[Ag],s_,Ag);var g_={NATIVE_ARRAY_BUFFER_VIEWS:u_,TYPED_ARRAY_TAG:l_&&s_,aTypedArray:function(e){if(f_(e))return e;throw o_("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Ug(e)&&(!Wg||zg(n_,e)))return e;throw o_(Bg(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,i){if(xg){if(n)for(var r in d_){var o=Pg[r];if(o&&Vg(o.prototype,e))try{delete o.prototype[e]}catch(iT){try{o.prototype[e]=t}catch(s){}}}i_[e]&&!n||qg(i_,e,n?t:u_&&$g[e]||t,i)}},exportTypedArrayStaticMethod:function(e,t,n){var i,r;if(xg){if(Wg){if(n)for(i in d_)if((r=Pg[i])&&Vg(r,e))try{delete r[e]}catch(iT){}if(n_[e]&&!n)return;try{return qg(n_,e,n?t:u_&&n_[e]||t)}catch(iT){}}for(i in d_)!(r=Pg[i])||r[e]&&!n||qg(r,e,t)}},getTypedArrayConstructor:p_,isView:function(e){if(!Gg(e))return!1;var t=Fg(e);return"DataView"===t||Vg(d_,t)||Vg(h_,t)},isTypedArray:f_,TypedArray:n_,TypedArrayPrototype:i_},__=B,v_=f,m_=Ws,y_=g_.NATIVE_ARRAY_BUFFER_VIEWS,I_=__.ArrayBuffer,T_=__.Int8Array,C_=!y_||!v_((function(){T_(1)}))||!v_((function(){new T_(-1)}))||!m_((function(e){new T_,new T_(null),new T_(1.5),new T_(e)}),!0)||v_((function(){return 1!==new T_(new I_(2),1,void 0).length})),S_=je,E_=Math.floor,b_=Number.isInteger||function(e){return!S_(e)&&isFinite(e)&&E_(e)===e},M_=Zt,k_=RangeError,w_=function(e){var t=M_(e);if(t<0)throw k_("The argument can't be less than 0");return t},D_=RangeError,A_=function(e,t){var n=w_(e);if(n%t)throw D_("Wrong offset");return n},R_=us,L_=k("".slice),O_=Lt,N_=TypeError,x_=function(e){var t=O_(e,"number");if("number"==typeof t)throw N_("Can't convert number to bigint");return BigInt(t)},P_=Za,U_=ot,G_=Vl,V_=ee,F_=an,B_=Cs,j_=gs,q_=es,H_=function(e){return"Big"===L_(R_(e),0,3)},z_=g_.aTypedArrayConstructor,K_=x_,W_=Za,Y_=L,J_=ee,Z_=an,X_=gl,Q_=k([].push),$_=function(e){var t=1==e,n=2==e,i=3==e,r=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){for(var h,p,f=J_(c),g=Y_(f),_=W_(u,l),v=Z_(g),m=0,y=d||X_,I=t?y(c,v):n||a?y(c,0):void 0;v>m;m++)if((s||m in g)&&(p=_(h=g[m],m,f),e))if(t)I[m]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return m;case 2:Q_(I,h)}else switch(e){case 4:return!1;case 7:Q_(I,h)}return o?-1:i||r?r:I}},ev={forEach:$_(0),map:$_(1),filter:$_(2),some:$_(3),every:$_(4),find:$_(5),findIndex:$_(6),filterReject:$_(7)},tv=Hr,nv=B,iv=ot,rv=Ye,ov=C_,av=g_,sv=_g,cv=js,uv=oi,lv=ci,dv=b_,hv=rn,pv=of,fv=A_,gv=xt,_v=ie,vv=us,mv=je,yv=dt,Iv=Kn,Tv=at,Cv=Mo,Sv=dr.f,Ev=function(e){var t,n,i,r,o,a,s,c,u=G_(this),l=V_(e),d=arguments.length,h=d>1?arguments[1]:void 0,p=void 0!==h,f=j_(l);if(f&&!q_(f))for(c=(s=B_(l,f)).next,l=[];!(a=U_(c,s)).done;)l.push(a.value);for(p&&d>2&&(h=P_(h,arguments[2])),n=F_(l),i=new(z_(u))(n),r=H_(i),t=0;n>t;t++)o=p?h(l[t],t):l[t],i[t]=r?K_(o):+o;return i},bv=ev.forEach,Mv=yc,kv=Ze,wv=Si,Dv=Xs,Av=Ci.get,Rv=Ci.set,Lv=Ci.enforce,Ov=kv.f,Nv=wv.f,xv=Math.round,Pv=nv.RangeError,Uv=sv.ArrayBuffer,Gv=Uv.prototype,Vv=sv.DataView,Fv=av.NATIVE_ARRAY_BUFFER_VIEWS,Bv=av.TYPED_ARRAY_TAG,jv=av.TypedArray,qv=av.TypedArrayPrototype,Hv=av.aTypedArrayConstructor,zv=av.isTypedArray,Kv="BYTES_PER_ELEMENT",Wv="Wrong length",Yv=function(e,t){Hv(e);for(var n=0,i=t.length,r=new e(i);i>n;)r[n]=t[n++];return r},Jv=function(e,t){Ov(e,t,{get:function(){return Av(this)[t]}})},Zv=function(e){var t;return Tv(Gv,e)||"ArrayBuffer"==(t=vv(e))||"SharedArrayBuffer"==t},Xv=function(e,t){return zv(e)&&!yv(t)&&t in e&&dv(+t)&&t>=0},Qv=function(e,t){return t=gv(t),Xv(e,t)?uv(2,e[t]):Nv(e,t)},$v=function(e,t,n){return t=gv(t),!(Xv(e,t)&&mv(n)&&_v(n,"value"))||_v(n,"get")||_v(n,"set")||n.configurable||_v(n,"writable")&&!n.writable||_v(n,"enumerable")&&!n.enumerable?Ov(e,t,n):(e[t]=n.value,e)};rv?(Fv||(wv.f=Qv,kv.f=$v,Jv(qv,"buffer"),Jv(qv,"byteOffset"),Jv(qv,"byteLength"),Jv(qv,"length")),tv({target:"Object",stat:!0,forced:!Fv},{getOwnPropertyDescriptor:Qv,defineProperty:$v}),Og.exports=function(e,t,n){var i=e.match(/\d+$/)[0]/8,r=e+(n?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=nv[r],c=s,u=c&&c.prototype,l={},d=function(e,t){Ov(e,t,{get:function(){return function(e,t){var n=Av(e);return n.view[o](t*i+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){var o=Av(e);n&&(r=(r=xv(r))<0?0:r>255?255:255&r),o.view[a](t*i+o.byteOffset,r,!0)}(this,t,e)},enumerable:!0})};Fv?ov&&(c=t((function(e,t,n,r){return cv(e,u),Dv(mv(t)?Zv(t)?void 0!==r?new s(t,fv(n,i),r):void 0!==n?new s(t,fv(n,i)):new s(t):zv(t)?Yv(c,t):iv(Ev,c,t):new s(pv(t)),e,c)})),Cv&&Cv(c,jv),bv(Sv(s),(function(e){e in c||lv(c,e,s[e])})),c.prototype=u):(c=t((function(e,t,n,r){cv(e,u);var o,a,s,l=0,h=0;if(mv(t)){if(!Zv(t))return zv(t)?Yv(c,t):iv(Ev,c,t);o=t,h=fv(n,i);var p=t.byteLength;if(void 0===r){if(p%i)throw Pv(Wv);if((a=p-h)<0)throw Pv(Wv)}else if((a=hv(r)*i)+h>p)throw Pv(Wv);s=a/i}else s=pv(t),o=new Uv(a=s*i);for(Rv(e,{buffer:o,byteOffset:h,byteLength:a,length:s,view:new Vv(o)});l<s;)d(e,l++)})),Cv&&Cv(c,jv),u=c.prototype=Iv(qv)),u.constructor!==c&&lv(u,"constructor",c),Lv(u).TypedArrayConstructor=c,Bv&&lv(u,Bv,r);var h=c!=s;l[r]=c,tv({global:!0,constructor:!0,forced:h,sham:!Fv},l),Kv in c||lv(c,Kv,i),Kv in u||lv(u,Kv,i),Mv(r)}):Og.exports=function(){},(0,Og.exports)("Float32",(function(e){return function(t,n,i){return e(this,t,n,i)}}));var em=pt,tm=TypeError,nm=ee,im=en,rm=an,om=function(e,t){if(!delete e[t])throw tm("Cannot delete property "+em(t)+" of "+em(e))},am=Math.min,sm=[].copyWithin||function(e,t){var n=nm(this),i=rm(n),r=im(e,i),o=im(t,i),a=arguments.length>2?arguments[2]:void 0,s=am((void 0===a?i:im(a,i))-o,i-r),c=1;for(o<r&&r<o+s&&(c=-1,o+=s-1,r+=s-1);s-- >0;)o in n?n[r]=n[o]:om(n,r),r+=c,o+=c;return n},cm=g_,um=k(sm),lm=cm.aTypedArray;(0,cm.exportTypedArrayMethod)("copyWithin",(function(e,t){return um(lm(this),e,t,arguments.length>2?arguments[2]:void 0)}));var dm=ev.every,hm=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("every",(function(e){return dm(hm(this),e,arguments.length>1?arguments[1]:void 0)}));var pm=gf,fm=x_,gm=us,_m=ot,vm=f,mm=g_.aTypedArray,ym=g_.exportTypedArrayMethod,Im=k("".slice);ym("fill",(function(e){var t=arguments.length;mm(this);var n="Big"===Im(gm(this),0,3)?fm(e):+e;return _m(pm,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),vm((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var Tm=an,Cm=Hl,Sm=g_.aTypedArrayConstructor,Em=g_.getTypedArrayConstructor,bm=function(e){return Sm(Cm(e,Em(e)))},Mm=function(e,t){for(var n=0,i=Tm(t),r=new e(i);i>n;)r[n]=t[n++];return r},km=bm,wm=ev.filter,Dm=function(e,t){return Mm(km(e),t)},Am=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("filter",(function(e){var t=wm(Am(this),e,arguments.length>1?arguments[1]:void 0);return Dm(this,t)}));var Rm=ev.find,Lm=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("find",(function(e){return Rm(Lm(this),e,arguments.length>1?arguments[1]:void 0)}));var Om=ev.findIndex,Nm=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("findIndex",(function(e){return Om(Nm(this),e,arguments.length>1?arguments[1]:void 0)}));var xm=ev.forEach,Pm=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("forEach",(function(e){xm(Pm(this),e,arguments.length>1?arguments[1]:void 0)}));var Um=dn.includes,Gm=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("includes",(function(e){return Um(Gm(this),e,arguments.length>1?arguments[1]:void 0)}));var Vm=dn.indexOf,Fm=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("indexOf",(function(e){return Vm(Fm(this),e,arguments.length>1?arguments[1]:void 0)}));var Bm=B,jm=f,qm=k,Hm=g_,zm=oa,Km=Ve("iterator"),Wm=Bm.Uint8Array,Ym=qm(zm.values),Jm=qm(zm.keys),Zm=qm(zm.entries),Xm=Hm.aTypedArray,Qm=Hm.exportTypedArrayMethod,$m=Wm&&Wm.prototype,ey=!jm((function(){$m[Km].call([1])})),ty=!!$m&&$m.values&&$m[Km]===$m.values&&"values"===$m.values.name,ny=function(){return Ym(Xm(this))};Qm("entries",(function(){return Zm(Xm(this))}),ey),Qm("keys",(function(){return Jm(Xm(this))}),ey),Qm("values",ny,ey||!ty,{name:"values"}),Qm(Km,ny,ey||!ty,{name:"values"});var iy=g_.aTypedArray,ry=g_.exportTypedArrayMethod,oy=k([].join);ry("join",(function(e){return oy(iy(this),e)}));var ay=f,sy=Jl,cy=V,uy=Zt,ly=an,dy=function(e,t){var n=[][e];return!!n&&ay((function(){n.call(null,t||function(){return 1},1)}))},hy=Math.min,py=[].lastIndexOf,fy=!!py&&1/[1].lastIndexOf(1,-0)<0,gy=dy("lastIndexOf"),_y=fy||!gy?function(e){if(fy)return sy(py,this,arguments)||0;var t=cy(this),n=ly(t),i=n-1;for(arguments.length>1&&(i=hy(i,uy(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in t&&t[i]===e)return i||0;return-1}:py,vy=Jl,my=_y,yy=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return vy(my,yy(this),t>1?[e,arguments[1]]:[e])}));var Iy=ev.map,Ty=bm,Cy=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("map",(function(e){return Iy(Cy(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Ty(e))(t)}))}));var Sy=vt,Ey=ee,by=L,My=an,ky=TypeError,wy=function(e){return function(t,n,i,r){Sy(n);var o=Ey(t),a=by(o),s=My(o),c=e?s-1:0,u=e?-1:1;if(i<2)for(;;){if(c in a){r=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw ky("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(r=n(r,a[c],c,o));return r}},Dy={left:wy(!1),right:wy(!0)},Ay=Dy.left,Ry=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return Ay(Ry(this),e,t,t>1?arguments[1]:void 0)}));var Ly=Dy.right,Oy=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return Ly(Oy(this),e,t,t>1?arguments[1]:void 0)}));var Ny=g_.aTypedArray,xy=g_.exportTypedArrayMethod,Py=Math.floor;xy("reverse",(function(){for(var e,t=this,n=Ny(t).length,i=Py(n/2),r=0;r<i;)e=t[r],t[r++]=t[--n],t[n]=e;return t}));var Uy=B,Gy=ot,Vy=g_,Fy=an,By=A_,jy=ee,qy=f,Hy=Uy.RangeError,zy=Uy.Int8Array,Ky=zy&&zy.prototype,Wy=Ky&&Ky.set,Yy=Vy.aTypedArray,Jy=Vy.exportTypedArrayMethod,Zy=!qy((function(){var e=new Uint8ClampedArray(2);return Gy(Wy,e,{length:1,0:3},1),3!==e[1]})),Xy=Zy&&Vy.NATIVE_ARRAY_BUFFER_VIEWS&&qy((function(){var e=new zy(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));Jy("set",(function(e){Yy(this);var t=By(arguments.length>1?arguments[1]:void 0,1),n=jy(e);if(Zy)return Gy(Wy,this,n,t);var i=this.length,r=Fy(n),o=0;if(r+t>i)throw Hy("Wrong length");for(;o<r;)this[t+o]=n[o++]}),!Zy||Xy);var Qy=bm,$y=Uu,eI=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("slice",(function(e,t){for(var n=$y(eI(this),e,t),i=Qy(this),r=0,o=n.length,a=new i(o);o>r;)a[r]=n[r++];return a}),f((function(){new Int8Array(1).slice()})));var tI=ev.some,nI=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("some",(function(e){return tI(nI(this),e,arguments.length>1?arguments[1]:void 0)}));var iI=ma,rI=Math.floor,oI=function(e,t){var n=e.length,i=rI(n/2);return n<8?aI(e,t):sI(e,oI(iI(e,0,i),t),oI(iI(e,i),t),t)},aI=function(e,t){for(var n,i,r=e.length,o=1;o<r;){for(i=o,n=e[o];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==o++&&(e[i]=n)}return e},sI=function(e,t,n,i){for(var r=t.length,o=n.length,a=0,s=0;a<r||s<o;)e[a+s]=a<r&&s<o?i(t[a],n[s])<=0?t[a++]:n[s++]:a<r?t[a++]:n[s++];return e},cI=oI,uI=ve.match(/firefox\/(\d+)/i),lI=!!uI&&+uI[1],dI=/MSIE|Trident/.test(ve),hI=ve.match(/AppleWebKit\/(\d+)\./),pI=!!hI&&+hI[1],fI=k,gI=f,_I=vt,vI=cI,mI=lI,yI=dI,II=Ee,TI=pI,CI=g_.aTypedArray,SI=g_.exportTypedArrayMethod,EI=B.Uint16Array,bI=EI&&fI(EI.prototype.sort),MI=!(!bI||gI((function(){bI(new EI(2),null)}))&&gI((function(){bI(new EI(2),{})}))),kI=!!bI&&!gI((function(){if(II)return II<74;if(mI)return mI<67;if(yI)return!0;if(TI)return TI<602;var e,t,n=new EI(516),i=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,i[e]=e-2*t+3;for(bI(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==i[e])return!0}));SI("sort",(function(e){return void 0!==e&&_I(e),kI?bI(this,e):vI(CI(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!kI||MI);var wI=rn,DI=en,AI=bm,RI=g_.aTypedArray;(0,g_.exportTypedArrayMethod)("subarray",(function(e,t){var n=RI(this),i=n.length,r=DI(e,i);return new(AI(n))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,wI((void 0===t?i:DI(t,i))-r))}));var LI=Jl,OI=g_,NI=f,xI=Uu,PI=B.Int8Array,UI=OI.aTypedArray,GI=OI.exportTypedArrayMethod,VI=[].toLocaleString,FI=!!PI&&NI((function(){VI.call(new PI(1))}));GI("toLocaleString",(function(){return LI(VI,FI?xI(UI(this)):UI(this),xI(arguments))}),NI((function(){return[1,2].toLocaleString()!=new PI([1,2]).toLocaleString()}))||!NI((function(){PI.prototype.toLocaleString.call([1,2])})));var BI=g_.exportTypedArrayMethod,jI=f,qI=k,HI=B.Uint8Array,zI=HI&&HI.prototype||{},KI=[].toString,WI=qI([].join);jI((function(){KI.call({})}))&&(KI=function(){return WI(this)});var YI=zI.toString!=KI;BI("toString",KI,YI),Hr({global:!0,constructor:!0,forced:!ef},{DataView:_g.DataView});var JI=yc,ZI="ArrayBuffer",XI=_g.ArrayBuffer;function QI(e,t){t=t||{};var n=e.numberOfChannels,i=e.sampleRate,r=t.float32?3:1,o=3===r?32:16;return function(e,t,n,i,r){var o=r/8,a=i*o,s=new ArrayBuffer(44+e.length*o),c=new DataView(s);return $I(c,0,"RIFF"),c.setUint32(4,36+e.length*o,!0),$I(c,8,"WAVE"),$I(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,t,!0),c.setUint16(22,i,!0),c.setUint32(24,n,!0),c.setUint32(28,n*a,!0),c.setUint16(32,a,!0),c.setUint16(34,r,!0),$I(c,36,"data"),c.setUint32(40,e.length*o,!0),1===t?function(e,t,n){for(var i=0;i<n.length;i++,t+=2){var r=Math.max(-1,Math.min(1,n[i]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(c,44,e):function(e,t,n){for(var i=0;i<n.length;i++,t+=4)e.setFloat32(t,n[i],!0)}(c,44,e),s}(2===n?function(e,t){for(var n=e.length+t.length,i=new Float32Array(n),r=0,o=0;r<n;)i[r++]=e[o],i[r++]=t[o],o++;return i}(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),r,i,n,o)}function $I(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))}Hr({global:!0,constructor:!0,forced:B.ArrayBuffer!==XI},{ArrayBuffer:XI}),JI(ZI);var eT=function(){function e(t){u(this,e),this.audioContext_=t,this.inputPCM_=new Float32Array,this.outputPCM_=new Float32Array}return d(e,[{key:"onDump",value:function(e,t){if(t===Yp){var n=this.inputPCM_.length,i=new Float32Array(n+e[0].length);i.set(this.inputPCM_),i.set(e[0],n),this.inputPCM_=i}if(t===Jp){var r=this.outputPCM_.length,o=new Float32Array(r+e[0].length);o.set(this.outputPCM_),o.set(e[0],r),this.outputPCM_=o}}},{key:"getBlob",value:function(e){var t=e===Yp?this.inputPCM_:this.outputPCM_,n=this.audioContext_.createBuffer(2,t.length,48e3);n.copyToChannel(t,0,0),n.copyToChannel(t,1,0);var i=QI(n);return n=null,new window.Blob([new DataView(i)],{type:"audio/wav"})}},{key:"reset",value:function(){this.inputPCM_=new Float32Array,this.outputPCM_=new Float32Array}},{key:"destroy",value:function(){this.inputPCM_=null,this.outputPCM_=null}}]),e}(),tT=function(){function e(t){var n=this,i=t.sdkAppId,r=t.userId,o=t.audioContext,a=t.sign,s=t.status,c=t.worklet,l=t.timestamp,d=t.logger;u(this,e),this.audioContext_=o,this.destination_=this.audioContext_.createMediaStreamDestination(),this.gainNode_=this.audioContext_.createGain(),this.gainNode_.gain.value=1.1,this.log_=d,this.workletNode_=c,this.workletNode_.connect(this.gainNode_).connect(this.destination_),this.workletNode_.port.postMessage({type:"init",data:{sdkAppId:String(i),userId:r,timestamp:l,sign:a,status:s}}),this.workletNode_.port.onmessage=function(e){var t=e.data,i=t.type,r=t.data;if("ondump"===i&&n.isDumping_){var o=r.inputPCM,a=r.outputPCM;n.dump_.onDump(o,Yp),n.dump_.onDump(a,Jp)}"dumped"===i&&n.dumped()},this.trackConstraint_={},this.localStream_=null,this.audioTrack_=null,this.source_=null,this.denoiserTrack_=null,this.enableDenoise_=!0,this.emitter_=new $p,this.dump_=new eT(this.audioContext_)}var t,n,r,o;return d(e,[{key:"dumped",value:function(){this.isDumping_=!1;var e=this.dump_.getBlob(Yp),t=this.dump_.getBlob(Jp);this.emitter_.emit("ondumpend",{blob:e,name:Yp}),this.emitter_.emit("ondumpend",{blob:t,name:Jp}),this.dump_.reset()}},{key:"process",value:(o=c(a().mark((function e(t){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localStream_=t,this.log_.info("RTCAIDenoiser: denoiser process stream ID: ".concat(t.getId(),".")),this.audioTrack_=null==t?void 0:t.getAudioTrack(),this.audioTrack_){e.next=5;break}throw new Error("RTCAIDenoiser: cannot process localStream without audioTrack.");case 5:return(n=new MediaStream).addTrack(this.audioTrack_),this.source_=this.audioContext_.createMediaStreamSource(n),e.next=10,this.source_.connect(this.workletNode_);case 10:return this.trackConstraint_=this.audioTrack_.getConstraints(),this.trackConstraint_.noiseSuppression=!1,e.next=14,this.audioTrack_.applyConstraints(this.trackConstraint_);case 14:return i=this.destination_.stream,this.denoiserTrack_=i.getAudioTracks()[0],e.next=18,this.localStream_.replaceTrack(this.denoiserTrack_);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"updateTrack",value:(r=c(a().mark((function e(t){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new MediaStream,e.next=3,n.addTrack(t);case 3:i=this.audioContext_.createMediaStreamSource(n),this.source_.disconnect(),i.connect(this.workletNode_),this.audioTrack_.stop(),this.audioTrack_=t,this.source_=i,this.log_.info("RTCAIDenoiser: ".concat(this.localStream_.getUserId()," updateTrack success."));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"disable",value:(n=c(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.enableDenoise_=!1,null===(t=this.workletNode_)||void 0===t||t.port.postMessage({type:"disable"}),this.trackConstraint_.noiseSuppression=!0,e.next=5,this.audioTrack_.applyConstraints(this.trackConstraint_);case 5:return this.log_.info("RTCAIDenoiser: disable ai denoiser."),e.abrupt("return",this.enableDenoise_);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"enable",value:(t=c(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.enableDenoise_=!0,null===(t=this.workletNode_)||void 0===t||t.port.postMessage({type:"enable"}),this.trackConstraint_.noiseSuppression=!1,e.next=5,this.audioTrack_.applyConstraints(this.trackConstraint_);case 5:return this.log_.info("RTCAIDenoiser: enable ai denoiser."),e.abrupt("return",this.enableDenoise_);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startDump",value:function(){return this.isDumping_?(this.log_.info("RTCAIDenoiser: data is currently being dumped."),!1):(this.workletNode_.port.postMessage({type:"startDump"}),this.dump_?this.dump_.reset():this.dump_=new eT(this.audioContext_),this.isDumping_=!0,this.log_.info("RTCAIDenoiser: start dump data."),!0)}},{key:"stopDump",value:function(){this.workletNode_.port.postMessage({type:"stopDump"}),this.isDumping_=!1,this.log_.info("RTCAIDenoiser: stop dump data.")}},{key:"getAudioTrack",value:function(){return this.audioTrack_}},{key:"getDenoiserTrack",value:function(){return this.denoiserTrack_}},{key:"enabled",get:function(){return this.enableDenoise_}},{key:"destroy",value:function(){var e,t,n,i,r,o,a;this.log_.info("RTCAIDenoiser: ".concat(this.localStream_.getUserId()," destroy processor.")),null===(e=this.localStream_)||void 0===e||e.stop(),null===(t=this.audioTrack_)||void 0===t||t.stop(),null===(n=this.workletNode_)||void 0===n||n.port.postMessage({type:"destroy"}),this.workletNode_.port.onmessage=null,null===(i=this.source_)||void 0===i||i.disconnect(),null===(r=this.destination_)||void 0===r||r.disconnect(),null===(o=this.workletNode_)||void 0===o||o.disconnect(),null===(a=this.dump_)||void 0===a||a.destroy(),this.emitter_.removeAllListeners()}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,n)}},{key:"resetDenoiser",value:function(e){if(i.default){var t=i.default.DenoiserMap;null!=t&&t.has(e.getUserId())&&t.delete(e.getUserId())}}}]),e}();i.default&&(i.default.addDenoiserProcessor=function(e){var t=e.processor,n=e.userId;if(i.default.DenoiserMap)i.default.DenoiserMap.set(n,t);else{var r=new Map;r.set(n,t),i.default.DenoiserMap=r}});var nT=function(){function e(t){var n=t.assetsPath;u(this,e),this.audioContext_=Wp(),this.assetsPath_=n,this.isLoaded_=!1}var t,n,r;return d(e,[{key:"createProcessor",value:(r=c(a().mark((function e(t){var n,r,s,c,u,l,d,h,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.default?i.default.Logger.loggerManager.createLogger({id:t.userId,userId:t.userId,sdkAppId:t.sdkAppId}):{info:console.log},r=String(Date.now()).slice(0,-3),e.next=4,Zp(o(o({},t),{},{timestamp:r}));case 4:if(s=e.sent,c=s.auth,u=s.sign,l=s.status,d=s.message,c){e.next=12;break}throw n.info("RTCAIDenoiser: ".concat(t.userId," auth result: ").concat(c,". Message: ").concat(d)),new Error(d);case 12:return e.next=14,this.load();case 14:return e.next=16,this.initWorklet();case 16:return h=e.sent,p=new tT(o(o({},t),{},{audioContext:this.audioContext_,timestamp:r,sign:u,status:l,worklet:h,logger:n})),n.info("RTCAIDenoiser: ".concat(t.userId," create denoiser processor success.")),i.default&&i.default.addDenoiserProcessor({processor:p,userId:t.userId}),e.abrupt("return",p);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(n=c(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoaded_){e.next=10;break}return e.prev=1,e.next=4,this.audioContext_.audioWorklet.addModule("".concat(this.assetsPath_,"/denoiser-wasm.js"));case 4:this.isLoaded_=!0,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("Init assets from ".concat(this.assetsPath_," failed! Reason: ").concat(e.t0));case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return n.apply(this,arguments)})},{key:"initWorklet",value:(t=c(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",new AudioWorkletNode(this.audioContext_,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1}));case 4:return e.prev=4,e.t0=e.catch(0),e.next=8,this.load();case 8:return e.abrupt("return",new AudioWorkletNode(this.audioContext_,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1}));case 9:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.audioContext_)||void 0===e||e.close()}},{key:"isSupported",value:function(){return"AudioWorklet"in window&&"WebAssembly"in window}}]),e}();return nT}))},944:function(e,t,n){"use strict";n(7658),n(2062),n(1439),n(7585),n(5315),function(t,n){e.exports=n()}(0,(function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,n){return(h=d()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&l(r,n.prototype),r}).apply(null,arguments)}function p(e){var t="function"==typeof Map?new Map:void 0;return(p=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return h(e,arguments,u(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),l(i,e)})(e)}function f(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function v(e){var t=d();return function(){var n,i=u(e);if(t){var r=u(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _(this,n)}}function m(e,t){return I(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(u){s=!0,r=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||C(e,t)||E()}function y(e){return function(e){if(Array.isArray(e))return S(e)}(e)||T(e)||C(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e){if(Array.isArray(e))return e}function T(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function C(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=C(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var M={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},k={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},w=function(){function e(){r(this,e),this.cache=[],this.options=null}return a(e,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),e}(),D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,e),this.high=t,this.low=n}return a(e,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),e}(),A={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com"}}},R={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},L="1.7.3",O=537048168,N="CHINA",x="OVERSEA",P="SINGAPORE",U="KOREA",G="GERMANY",V="IND",F="JPN",B="USA",j={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;this.CURRENT=A.PRODUCTION[e]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GROUP:"group_open_http_svc",GROUP_AVCHATROOM:"group_open_avchatroom_http_svc",GROUP_COMMUNITY:"million_group_open_http_svc",GROUP_ATTR:"group_open_attr_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MESSAGE:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate"},CMD:{LOGIN:"wslogin",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT:"wslogout",HELLO:"wshello",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",ADD_FRIEND:"friend_add",UPDATE_FRIEND:"friend_update",GET_FRIEND_LIST:"friend_get",GET_FRIEND_PROFILE:"friend_get_specified",DELETE_FRIEND:"friend_delete",CHECK_FRIEND:"friend_check",GET_FRIEND_GROUP_LIST:"group_get",RESPOND_FRIEND_APPLICATION:"friend_response",GET_FRIEND_APPLICATION_LIST:"pendency_get",DELETE_FRIEND_APPLICATION:"pendency_delete",REPORT_FRIEND_APPLICATION:"pendency_report",GET_GROUP_APPLICATION:"get_pendency",CREATE_FRIEND_GROUP:"group_add",DELETE_FRIEND_GROUP:"group_delete",UPDATE_FRIEND_GROUP:"group_update",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SET_GROUP_ATTRIBUTES:"set_group_attr",MODIFY_GROUP_ATTRIBUTES:"modify_group_attr",DELETE_GROUP_ATTRIBUTES:"delete_group_attr",CLEAR_GROUP_ATTRIBUTES:"clear_group_attr",GET_GROUP_ATTRIBUTES:"get_group_attr",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",DELETE_C2C_MESSAGE:"delete_c2c_msg_ramble",MODIFY_C2C_MESSAGE:"modify_c2c_msg",MODIFY_C2C_MESSAGE_EXTENSIONS:"set_key_values",GET_C2C_MESSAGE_EXTENSIONS:"get_key_values",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",DELETE_GROUP_MESSAGE:"delete_group_ramble_msg_by_seq",MODIFY_GROUP_MESSAGE:"modify_group_msg",MODIFY_GROUP_MESSAGE_EXTENSIONS:"group_set_key_values",GET_GROUP_MESSAGE_EXTENSIONS:"group_get_key_values",GET_GROUP_INFO:"get_group_self_member_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",GET_AVCHATROOM_MEMBER_LIST:"get_members",MARK_AVCHATROOM_MEMBER_INFO:"modify_user_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",BAN_AVCHATROOM_MEMBER:"ban_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",HANDLE_INVITE_JOIN_GROUP:"handle_invite_join_permission_group",HANDLE_GROUP_INVITATION:"handle_invite_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",DELETE_GROUP_AT_TIPS:"deletemsg",GET_GROUP_NOTIFY:"get_group_notify",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"batch_delete",CLEAR_HISTORY_MESSAGE:"clear_msg",PIN_CONVERSATION:"top",SET_CONVERSATION_CUSTOM_DATA:"mark_contact",MARK_CONVERSATION:"mark_contact",CREATE_CONVERSATION_GROUP:"create_contact_group",DELETE_CONVERSATION_GROUP:"del_contact_group",UPDATE_CONVERSATION_GROUP:"update_contact_group",GET_CONVERSATION_GROUP_LIST:"get_contact_group",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_GROUP_ROAM_MESSAGES:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",VIDEO_COVER:"video_cover",TIM_WEB_REPORT_V2:"tim_web_report_v2",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num",ALIVE:"alive",MESSAGE_PUSH:"msg_push",MULTI_MESSAGE_PUSH:"multi_msg_push_ws",MESSAGE_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",DOWNLOAD_MERGER_MESSAGE:"get_relay_json_msg",UPLOAD_MERGER_MESSAGE:"save_relay_json_msg",FETCH_CLOUD_CONTROL_CONFIG:"fetch_config",PUSHED_CLOUD_CONTROL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",KICK_OTHER:"KickOther",OVERLOAD_NOTIFY:"notify2",SET_ALL_MESSAGE_READ:"read_all_unread_msg",CREATE_TOPIC:"create_topic",DELETE_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe",GET_RPOFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",UPDATE_GROUP_COUNTER:"update_group_counter",GET_GROUP_COUNTER:"get_group_counter"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",im_cos_msg:"v4",webim:"v4",im_open_push:"v4",im_open_status:"v4"}},q={SEARCH_MSG:new D(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new D(0,Math.pow(2,1)).toString(),AVCHATROOM_HISTORY_MSG:new D(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new D(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new D(0,Math.pow(2,4)).toString(),AVCHATROOM_MBR_LIST:new D(0,Math.pow(2,6)).toString(),USER_STATUS:new D(0,Math.pow(2,7)).toString(),CONV_MARK:new D(0,Math.pow(2,9)).toString(),CONV_GROUP:new D(0,Math.pow(2,10)).toString(),AVCHATROOM_BAN_MBR:new D(0,Math.pow(2,11)).toString(),MSG_EXT:new D(0,Math.pow(2,13)).toString(),GRP_COUNTER:new D(0,Math.pow(2,15)).toString()},H="c2c_text_message",z="c2c_custom_message",K="group_text_message",W="group_custom_message",Y="user_profile",J="group_profile",Z="group_member_profile";j.HOST.setCurrent(N);var X="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Q="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),$="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),ee="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),te="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),ne="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,ie="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,re="undefined"!=typeof uni,oe=X||Q||$||ee||te||ie||ne,ae=("undefined"!=typeof uni||"undefined"!=typeof window)&&!oe,se=Q?qq:$?tt:ee?swan:te?my:X?wx:ie?uni:ne?jd:{},ce=ae&&window&&window.navigator&&window.navigator.userAgent||"",ue=/(micromessenger|webbrowser)/i.test(ce),le=/AppleWebKit\/([\d.]+)/i.exec(ce);le&&parseFloat(le.pop());var de,he,pe=(de="WEB",ue?de="WEB":Q?de="QQ_MP":$?de="TT_MP":ee?de="BAIDU_MP":te?de="ALI_MP":X?de="WX_MP":ie&&(de="UNI_NATIVE_APP"),R[de]),fe=/iPad/i.test(ce),ge=/iPhone/i.test(ce)&&!fe,_e=/iPod/i.test(ce),ve=ge||fe||_e,me=(he=ce.match(/OS (\d+)_/i))&&he[1]?he[1]:null,ye=/Android/i.test(ce),Ie=function(){var e=ce.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}();!function(){var e=ce.match(/Chrome\/(\d+)/);e&&e[1]&&parseFloat(e[1])}();var Te=/MSIE/.test(ce)||ce.indexOf("Trident")>-1&&ce.indexOf("rv:11.0")>-1,Ce=function(){var e=/MSIE\s(\d+)\.\d/.exec(ce),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(ce)&&/rv:11.0/.test(ce)&&(t=11),t}();!function(){var e=ce.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}();var Se,Ee,be=/Windows/i.test(ce),Me=/MAC OS X/i.test(ce),ke=ae&&"undefined"!=typeof Worker&&!Te,we=ye||ve,De=ae&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy;Se="undefined"!=typeof console?console:"undefined"!=typeof n.g&&n.g.console?n.g.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Ae=function(){},Re=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Le=Re.length;Le--;)Ee=Re[Le],console[Ee]||(Se[Ee]=Ae);var Oe=Se,Ne=0,xe=function(){return(new Date).getTime()+Ne},Pe=function(){Ne=0},Ue=function(){return Math.floor(xe()/1e3)},Ge=0;function Ve(){return Ht()?"%c TIM %c":"TIM"}function Fe(){var e,t=((e=new Date).setTime(xe()),e);return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(t.getMilliseconds())}var Be={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,i=e.length;n<i;n++)st(e[n])?ut(e[n])?t+=pt(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){Ht()?Oe[e](Ve(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Fe(),t):Oe[e]("".concat(Ve()," ").concat(Fe()," ").concat(t))},d:function(){if(Ge<=-1){var e=this.arguments2String(arguments);this._exec("debug",e)}},l:function(){if(Ge<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},log:function(){if(Ge<=0){var e=this.arguments2String(arguments);this._exec("log",e)}},i:function(){if(Ge<=1){var e=this.arguments2String(arguments);this._exec("info",e)}},w:function(){if(Ge<=2){var e=this.arguments2String(arguments);this._exec("warn",e)}},e:function(){if(Ge<=3){var e=this.arguments2String(arguments);this._exec("error",e)}},setLevel:function(e){e<4&&this._exec("log","set level from "+Ge+" to "+e),Ge=e},getLevel:function(){return Ge}},je={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},qe={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},He={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},ze={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},Ke={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},We="JoinedSuccess",Ye="WaitAdminApproval",Je="@TGS#_",Ze="@TOPIC#_",Xe=["url"],Qe=function(e){return"map"===lt(e)},$e=function(e){return"file"===lt(e)},et=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===i(e)&&e.constructor===Number)},nt=function(e){return"string"==typeof e},it=function(e){return null!==e&&"object"===i(e)},rt=function(e){if("object"!==i(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},ot=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===lt(e)},at=function(e){return void 0===e},st=function(e){return ot(e)||it(e)},ct=function(e){return"function"==typeof e},ut=function(e){return e instanceof Error},lt=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},dt=function(e){if("string"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)};Date.now||(Date.now=function(){return(new Date).getTime()});var ht=function e(t,n,i,r){if(!st(t)||!st(n))return 0;for(var o,a=0,s=Object.keys(n),c=0,u=s.length;c<u;c++)if(o=s[c],!(at(n[o])||i&&i.includes(o)))if(st(t[o])&&st(n[o]))a+=e(t[o],n[o],i,r);else{if(r&&r.includes(n[o]))continue;t[o]!==n[o]&&(t[o]=n[o],a+=1)}return a},pt=function(e){return JSON.stringify(e,["message","code"])},ft=function(e){if(0===e.length)return 0;for(var t=0,n=0,i="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===i?3:2;return n},gt=function(e){var t=e||99999999;return Math.round(Math.random()*t)},_t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",vt=_t.length,mt=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},yt={},It=function(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")},Tt=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var n=Array.isArray(t)?[]:Object.create(null),r="";for(var o in t)null!==t[o]?void 0!==t[o]?(r=i(t[o]),["string","number","function","boolean"].indexOf(r)>=0?n[o]=t[o]:n[o]=e(t[o])):n[o]=void 0:n[o]=null;return n};function Ct(e,t){if(!ot(e)||!ot(t))return!1;var n=!1;return t.forEach((function(t){var i=t.key,r=t.value,o=e.find((function(e){return e.key===i}));o?o.value!==r&&(o.value=r,n=!0):(e.push({key:i,value:r}),n=!0)})),n}var St=function(e){return e===k.GRP_AVCHATROOM},Et=function(e){var t=e.type,n=e.groupID;return t===k.GRP_COMMUNITY||"".concat(n).startsWith(Je)&&!"".concat(n).includes(Ze)},bt=function(e){return"".concat(e).startsWith(Je)&&"".concat(e).includes(Ze)},Mt=function(e){return nt(e)&&e.slice(0,3)===k.CONV_C2C},kt=function(e){return nt(e)&&e.slice(0,5)===k.CONV_GROUP},wt=function(e){return nt(e)&&e===k.CONV_SYSTEM};function Dt(e,t){var n={};return Object.keys(e).forEach((function(i){n[i]=t(e[i],i)})),n}function At(e){return oe?new Promise((function(t,n){se.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):Te&&9===Ce?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var i=new Image;i.onload=function(){t({width:this.width,height:this.height}),i=null},i.onerror=function(){t({width:0,height:0}),i=null},i.src=e}))}function Rt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function Lt(){var e="unknown";if(Me&&(e="mac"),be&&(e="windows"),ve&&(e="ios"),ye&&(e="android"),oe)try{var t=se.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(i){}return e}function Ot(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var i=0;i<n;i++){var r=parseInt(e[i]),o=parseInt(t[i]);if(r>o)return 1;if(r<o)return-1}return 0}function Nt(e){var t=e.originUrl,n=void 0===t?void 0:t,i=e.originWidth,r=e.originHeight,o=e.min,a=void 0===o?198:o,s=parseInt(i),c=parseInt(r),u={url:void 0,width:0,height:0};if((s<=c?s:c)<=a)u.url=n,u.width=s,u.height=c;else{c<=s?(u.width=Math.ceil(s*a/c),u.height=a):(u.width=a,u.height=Math.ceil(c*a/s));var l=n&&n.indexOf("?")>-1?"".concat(n,"&"):"".concat(n,"?");u.url="".concat(l,198===a?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")}return at(n)?(u.url,f(u,Xe)):u}function xt(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function Pt(e){var t=e.servcmd;return t.slice(t.indexOf(".")+1)}function Ut(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Gt(e,t){return e.includes(t)}function Vt(e,t){return e.includes(t)}function Ft(e){return e.split(Ze)[0]}var Bt=function(e,t,n){if(at(t))return"";switch(e){case k.MSG_TEXT:return t.text;case k.MSG_IMAGE:return n?"[Image]":"[图片]";case k.MSG_LOCATION:return n?"[Location]":"[位置]";case k.MSG_AUDIO:return n?"[Voice]":"[语音]";case k.MSG_VIDEO:return n?"[Video]":"[视频]";case k.MSG_FILE:return n?"[File]":"[文件]";case k.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case k.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case k.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case k.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case k.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function jt(e){return e===k.MSG_TEXT||e===k.MSG_CUSTOM||e===k.MSG_LOCATION||e===k.MSG_FACE}function qt(e){var t=[];if(!nt(e))return t;var n=e.length;if(0===n)return t;for(var i=n-1;i>=0;i--)"1"===e[i]&&t.push(Math.pow(2,n-i-1));return t}function Ht(){return!Te&&!oe}function zt(e){return"the length of userIDList cannot exceed ".concat(e)}function Kt(e,t){if(e){var n=e;return t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}}var Wt=Object.prototype.hasOwnProperty;function Yt(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(rt(e)){for(var t in e)if(Wt.call(e,t))return!1;return!0}return!(!Qe(e)&&(n=e,"set"!==lt(n))&&!$e(e))&&0===e.size;var n}function Jt(e,t,n){if(void 0===t)return!0;var i=!0;if(rt(t))Object.keys(t).forEach((function(r){var o=1===e.length?e[0][r]:void 0;i=!!Zt(o,t[r],n,r)&&i}));else if(ot(t))for(var r=0;r<t.length;r++)i=!!Zt(e[r],t[r],n,t[r].name)&&i;if(i)return i;throw new Error("Params validate failed.")}function Zt(e,t,n,i){if(void 0===t)return!0;var r=!0;if(t.required&&Yt(e)&&(Be.e("[".concat(n,'] Missing required params: "').concat(i,'".')),r=!1),!Yt(e)){var o=lt(e),a=t.type.toLowerCase();o!==a&&("asyncfunction"===o&&"function"===a||(Be.e("[".concat(n,'] Invalid params: type check failed for "').concat(i,'".Expected ').concat(t.type,".")),r=!1))}return t.validator&&!t.validator(e)&&(Be.e("[".concat(n,"] Invalid params: custom validator check failed for params.")),r=!1),r}var Xt,Qt={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},$t={NOT_START:"notStart",PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},en=function(e){if(!e)return!1;if(Mt(e)||kt(e)||wt(e))return!0;var t=kn("InvalidConversationID",e);return t&&Be.w(t),!1},tn=function(e){""!==e.desc&&""!==kn("API_REFER")&&Be.w("[".concat(e.api,"] | ").concat(e.param," | ").concat(e.desc,", ").concat(kn("API_REFER")).concat(e.api))},nn=function(){return kn("StringRequiredLog")},rn=function(e){return kn("NonEmptyStringRequiredLog",e)},on=function(){return kn("NumberRequiredLog")},an=function(){return kn("UndefinedNotAllowedLog")},sn=function(){return kn("FileRequiredLog")},cn=function(){return kn("FunctionRequiredLog")},un=function(){return kn("ArrayRequiredLog")},ln=function(){return kn("NonEmptyArrayLog")},dn=function(){return kn("CallbackMissingLog")},hn=function(){return kn("PositiveIntegerRequiredLog")},pn=function(e,t){return kn("StringNotLongerThanLog",e,t)},fn=function(e,t){return kn("NumberLessThanLog",e,t)},gn=function(e){return kn("KeyValueStringRequiredLog",e)},_n=function(){return kn("PlainObjectRequiredLog")},vn=function(){return kn("NonEmptyContentRequiredLog")},mn=function(){return kn("FileNotSelectedLog")},yn=function(){return kn("MessageInstanceRequiredLog")},In=function(){return kn("NonAnonymousFunctionLog")},Tn=function(){return kn("MessageExtensionNotAvailableLog")},Cn={type:"String",required:!0},Sn={type:"Array",required:!0},En={type:"Object",required:!0},bn={type:"Boolean",required:!0},Mn={type:"number",required:!0},kn=null,wn={hookGetAPITips:function(e){kn=e},login:{userID:Cn,userSig:Cn},addToBlacklist:{userIDList:Sn},removeFromBlacklist:{userIDList:Sn},on:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(tn({api:"on",param:"eventName",desc:rn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(tn({api:"on",param:"handler",desc:cn()}),!1):(""===e.name&&tn({api:"on",param:"handler",desc:In()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(tn({api:"once",param:"eventName",desc:rn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(tn({api:"once",param:"handler",desc:cn()}),!1):(""===e.name&&tn({api:"once",param:"handler",desc:In()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(tn({api:"off",param:"eventName",desc:rn("eventName")}),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(tn({api:"off",param:"handler",desc:cn()}),!1):(""===e.name&&tn({api:"off",param:"handler",desc:In()}),!0)}}],sendMessage:[t({name:"message"},En)],setMessageExtensions:[t(t({name:"message"},En),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(tn({api:"setMessageExtensions",param:"message",desc:Tn()}),!1)}}),t({name:"extensions"},Sn)],getMessageExtensions:[t(t({name:"message"},En),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(tn({api:"getMessageExtensions",param:"message",desc:Tn()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},En),{},{validator:function(e){return e.status===Qt.SUCCESS&&!0===e.isSupportExtension||(tn({api:"deleteMessageExtensions",param:"message",desc:Tn()}),!1)}})],getMessageList:{conversationID:t(t({},Cn),{},{validator:function(e){return en(e)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e){return!(!at(e)&&!/^[1-9][0-9]*$/.test(e))||(tn({api:"getMessageList",param:"count",desc:hn()}),!1)}}},getMessageListHopping:{conversationID:t(t({},Cn),{},{validator:function(e){return en(e)}}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e){return!(!at(e)&&0!==e&&1!==e)||(tn({api:"getMessageListHopping",param:"direction",desc:kn("0Or1RequiredLog")}),!1)}},count:{type:"Number",validator:function(e){return!(!at(e)&&!/^[1-9][0-9]*$/.test(e))||(tn({api:"getMessageListHopping",param:"count",desc:hn}),!1)}}},setMessageRead:{conversationID:t(t({},Cn),{},{validator:function(e){return en(e)}})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e){return!e||-1!==[k.READ_ALL_C2C_MSG,k.READ_ALL_GROUP_MSG,k.READ_ALL_MSG].indexOf(e)||(tn({api:"setAllMessageRead",param:"scope",desc:"TIM.TYPES.READ_ALL_C2C_MSG or TIM.TYPES.READ_ALL_GROUP_MSG or TIM.TYPES.READ_ALL_MSG required"}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},Cn),{},{validator:function(e){return en(e)}})],clearHistoryMessage:[t(t({name:"conversationID"},Cn),{},{validator:function(e){return en(e)}})],pinConversation:{conversationID:t(t({},Cn),{},{validator:function(e){return en(e)}}),isPinned:t({},bn)},setConversationCustomData:{conversationIDList:t({},Sn),customData:{type:"String",validator:function(e){return nt(e)?!(e.length>256)||(tn({api:"setConversationCustomData",param:"customData",desc:pn("customData",256)}),!1):(tn({api:"setConversationCustomData",param:"customData",desc:nn()}),!1)}}},markConversation:{conversationIDList:t({},Sn),markType:{type:"number",validator:function(e){return et(e)?e<=0?(tn({api:"markConversation",param:"markType",desc:(t="markType",n=0,kn("NumberGreaterThanLog",t,n))}),!1):!(e>=Math.pow(2,64))||(tn({api:"markConversation",param:"markType",desc:fn("markType","Math.pow(2,64)")}),!1):(tn({api:"markConversation",param:"markType",desc:on()}),!1);var t,n}},enableMark:t({},bn)},createConversationGroup:{conversationIDList:t({},Sn),groupName:t(t({},Cn),{},{validator:function(e){return!!e&&(!(e.length>32)||(tn({api:"createConversationGroup",param:"groupName",desc:pn("groupName",32)}),!1))}})},deleteConversationGroup:[t({name:"groupName"},Cn)],renameConversationGroup:{oldName:t({},Cn),newName:t(t({},Cn),{},{validator:function(e){return!!e&&(!(e.length>32)||(tn({api:"renameConversationGroup",param:"newName",desc:pn("newName",32)}),!1))}})},addConversationsToGroup:{conversationIDList:t({},Sn),groupName:t({},Cn)},deleteConversationsFromGroup:{conversationIDList:t({},Sn),groupName:t({},Cn)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Cn,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:Sn},createGroup:{name:Cn},joinGroup:{groupID:Cn,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},Cn)],handleApplication:{message:En,handleAction:Cn,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Cn,newOwnerID:Cn},updateGroupProfile:{groupID:Cn,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},Cn)],searchGroupByID:[t({name:"groupID"},Cn)],initGroupAttributes:{groupID:Cn,groupAttributes:t(t({},En),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!nt(e[n]))return tn({api:"initGroupAttributes",param:"groupAttributes",desc:gn("value")}),t=!1})),t}})},setGroupAttributes:{groupID:Cn,groupAttributes:t(t({},En),{},{validator:function(e){var t=!0;return Object.keys(e).forEach((function(n){if(!nt(e[n]))return tn({api:"setGroupAttributes",param:"groupAttributes",desc:gn("value")}),t=!1})),t}})},deleteGroupAttributes:{groupID:Cn,keyList:{type:"Array",validator:function(e){if(at(e)||!ot(e))return tn({api:"deleteGroupAttributes",param:"keyList",desc:un()}),!1;if(!Yt(e)){var t=!0;return e.forEach((function(e){if(!nt(e))return tn({api:"deleteGroupAttributes",param:"keyList",desc:kn("StringArrayRequiredLog")}),t=!1})),t}return!0}}},getGroupAttributes:{groupID:Cn,keyList:{type:"Array",validator:function(e){if(at(e)||!ot(e))return tn({api:"getGroupAttributes",param:"keyList",desc:un()}),!1;if(!Yt(e)){var t=!0;return e.forEach((function(e){if(!nt(e))return tn({api:"getGroupAttributes",param:"keyList",desc:gn("key")}),t=!1})),t}return!0}}},setGroupCounters:{groupID:Cn,counters:En},increaseGroupCounter:{groupID:Cn,key:Cn,value:Mn},decreaseGroupCounter:{groupID:Cn,key:Cn,value:Mn},getGroupCounters:{groupID:Cn},getGroupMemberList:{groupID:Cn,count:{type:"Number"}},getGroupMemberProfile:{groupID:Cn,userIDList:Sn,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:Cn,userIDList:Sn},setGroupMemberRole:{groupID:Cn,userID:Cn,role:Cn},setGroupMemberMuteTime:{groupID:Cn,userID:Cn,muteTime:{type:"Number",validator:function(e){return e>=0}}},setGroupMemberNameCard:{groupID:Cn,userID:{type:"String"},nameCard:{type:"String",validator:function(e){return nt(e)?(e.length,!0):(tn({api:"setGroupMemberNameCard",param:"nameCard",desc:nn()}),!1)}}},setGroupMemberCustomField:{groupID:Cn,userID:{type:"String"},memberCustomField:Sn},deleteGroupMember:{groupID:Cn},markGroupMemberList:{groupID:Cn,markType:{type:"number",validator:function(e){return et(e)?!(e<1e3)||(tn({api:"markGroupMemberList",param:"markType",desc:(t="markType",n=1e3,kn("NumberGreaterOrEqualLog",t,n))}),!1):(tn({api:"markGroupMemberList",param:"markType",desc:on()}),!1);var t,n}},userIDList:t({},Sn),enableMark:t({},bn)},createTextMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return rt(e)?nt(e.text)?0!==e.text.length||(tn({api:"createTextMessage",param:"payload.text",desc:vn()}),!1):(tn({api:"createTextMessage",param:"payload.text",desc:nn()}),!1):(tn({api:"createTextMessage",param:"payload",desc:_n()}),!1)}})},createTextAtMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return rt(e)?nt(e.text)?0===e.text.length?(tn({api:"createTextAtMessage",param:"payload.text",desc:vn()}),!1):!(e.atUserList&&!ot(e.atUserList))||(tn({api:"createTextAtMessage",param:"payload.atUserList",desc:un()}),!1):(tn({api:"createTextAtMessage",param:"payload.text",desc:nn()}),!1):(tn({api:"createTextAtMessage",param:"payload",desc:_n()}),!1)}})},createCustomMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return rt(e)?e.data&&!nt(e.data)?(tn({api:"createCustomMessage",param:"payload.data",desc:nn()}),!1):e.description&&!nt(e.description)?(tn({api:"createCustomMessage",param:"payload.description",desc:nn()}),!1):!(e.extension&&!nt(e.extension))||(tn({api:"createCustomMessage",param:"payload.extension",desc:nn()}),!1):(tn({api:"createCustomMessage",param:"payload",desc:_n()}),!1)}})},createImageMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(!rt(e))return tn({api:"createImageMessage",param:"payload",desc:_n()}),!1;if(at(e.file))return tn({api:"createImageMessage",param:"payload.file",desc:an()}),!1;if(ae){if(!(e.file instanceof HTMLInputElement||$e(e.file)))return rt(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(tn({api:"createImageMessage",param:"payload.file",desc:mn()}),!1):(tn({api:"createImageMessage",param:"payload.file",desc:sn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return tn({api:"createImageMessage",param:"payload.file",desc:mn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&tn({api:"createImageMessage",param:"onProgress",desc:dn()}),!0}}})},createAudioMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return!!rt(e)||(tn({api:"createAudioMessage",param:"payload",desc:_n()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&tn({api:"createAudioMessage",param:"onProgress",desc:dn()}),!0}}},createVideoMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(!rt(e))return tn({api:"createVideoMessage",param:"payload",desc:_n()}),!1;if(at(e.file))return tn({api:"createVideoMessage",param:"payload.file",desc:an()}),!1;if(ae){if(!(e.file instanceof HTMLInputElement||$e(e.file)))return rt(e.file)&&"undefined"!=typeof uni?!!$e(e.file.tempFile)||(tn({api:"createVideoMessage",param:"payload.file",desc:mn()}),!1):(tn({api:"createVideoMessage",param:"payload.file",desc:sn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return tn({api:"createVideoMessage",param:"payload.file",desc:mn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&tn({api:"createVideoMessage",param:"onProgress",desc:dn()}),!0}}},createFaceMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return rt(e)?et(e.index)?!!nt(e.data)||(tn({api:"createFaceMessage",param:"payload.data",desc:nn()}),!1):(tn({api:"createFaceMessage",param:"payload.index",desc:on()}),!1):(tn({api:"createFaceMessage",param:"payload",desc:_n()}),!1)}})},createFileMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(!rt(e))return tn({api:"createFileMessage",param:"payload",desc:_n()}),!1;if(at(e.file))return tn({api:"createFileMessage",param:"payload.file",desc:an()}),!1;if(ae){if(!(e.file instanceof HTMLInputElement||$e(e.file)))return rt(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(tn({api:"createFileMessage",param:"payload.file",desc:mn()}),!1):(tn({api:"createFileMessage",param:"payload.file",desc:sn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return tn({api:"createFileMessage",param:"payload.file",desc:mn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return at(e)&&tn({api:"createFileMessage",param:"onProgress",desc:dn()}),!0}}},createLocationMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){return rt(e)?nt(e.description)?et(e.longitude)?!!et(e.latitude)||(tn({api:"createLocationMessage",param:"payload.latitude",desc:on()}),!1):(tn({api:"createLocationMessage",param:"payload.longitude",desc:on()}),!1):(tn({api:"createLocationMessage",param:"payload.description",desc:nn()}),!1):(tn({api:"createLocationMessage",param:"payload",desc:_n()}),!1)}})},createMergerMessage:{to:Cn,conversationType:Cn,payload:t(t({},En),{},{validator:function(e){if(Yt(e.messageList))return tn({api:"createMergerMessage",param:"payload.messageList",desc:ln()}),!1;if(Yt(e.compatibleText))return tn({api:"createMergerMessage",param:"payload.compatibleText",desc:rn("compatibleText")}),!1;var t=!1;return e.messageList.forEach((function(e){e.status===Qt.FAIL&&(t=!0)})),!t||(tn({api:"createMergerMessage",param:"payload.messageList",desc:kn("MergeFailedMessageLog")}),!1)}})},revokeMessage:[t(t({name:"message"},En),{},{validator:function(e){return Yt(e)?(tn({api:"revokeMessage",param:"message",desc:yn()}),!1):e.conversationType===k.CONV_SYSTEM?(tn({api:"revokeMessage",param:"message",desc:kn("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(tn({api:"revokeMessage",param:"message",desc:kn("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},Sn),{},{validator:function(e){return!Yt(e)||(tn({api:"deleteMessage",param:"messageList",desc:ln()}),!1)}})],translateText:{sourceTextList:Sn,sourceLanguage:Cn,targetLanguage:Cn},modifyMessage:[t(t({name:"message"},En),{},{validator:function(e){return Yt(e)?(tn({api:"modifyMessage",param:"message",desc:yn()}),!1):e.conversationType===k.CONV_SYSTEM?(tn({api:"modifyMessage",param:"message",desc:kn("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(tn({api:"modifyMessage",param:"message",desc:kn("OnlineMessageNotSupportLog")}),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(e){return ot(e)?(0===e.length&&tn({api:"getUserProfile",param:"userIDList",desc:ln()}),!0):(tn({api:"getUserProfile",param:"userIDList",desc:un()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e){return!!at(e)||!!ot(e)||(tn({api:"updateMyProfile",param:"profileCustomField",desc:un()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e){return!!nt(e)||(tn({api:"setSelfStatus",param:"customStatus",desc:nn()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e){return ot(e)?0!==e.length||(tn({api:"getUserStatus",param:"userIDList",desc:ln()}),!1):(tn({api:"getUserStatus",param:"userIDList",desc:un()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return ot(e)?0!==e.length||(tn({api:"subscribeUserStatus",param:"userIDList",desc:ln()}),!1):(tn({api:"subscribeUserStatus",param:"userIDList",desc:un()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e){return!e||!!ot(e)||(tn({api:"subscribeUserStatus",param:"userIDList",desc:un()}),!1)}}},addFriend:{to:Cn,source:{type:"String",required:!0,validator:function(e){return!!e&&(e.startsWith("AddSource_Type_")?!(e.replace("AddSource_Type_","").length>8)||(tn({api:"addFriend",param:"source",desc:pn("keyword",8)}),!1):(tn({api:"addFriend",param:"source",desc:kn("SourcePrefixLog")}),!1))}},remark:{type:"String",required:!1,validator:function(e){return!(nt(e)&&e.length>96)||(tn({api:"addFriend",param:"remark",desc:pn("remark",96)}),!1)}}},deleteFriend:{userIDList:Sn},checkFriend:{userIDList:Sn},getFriendProfile:{userIDList:Sn},updateFriend:{userID:Cn,remark:{type:"String",required:!1,validator:function(e){return!(nt(e)&&e.length>96)||(tn({api:"updateFriend",param:"remark",desc:pn("remark",96)}),!1)}},friendCustomField:{type:"Array",required:!1,validator:function(e){if(e){if(!ot(e))return tn({api:"updateFriend",param:"friendCustomField",desc:un()}),!1;var t=!0;return e.forEach((function(e){return nt(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?nt(e.value)?e.key.replace("Tag_SNS_Custom_","").length>8?(tn({api:"updateFriend",param:"friendCustomField",desc:pn("keyword",8)}),t=!1):void 0:(tn({api:"updateFriend",param:"friendCustomField",desc:gn("value")}),t=!1):(tn({api:"updateFriend",param:"friendCustomField",desc:kn("FriendCustomFieldPrefixLog")}),t=!1)})),t}return!0}}},acceptFriendApplication:{userID:Cn},refuseFriendApplication:{userID:Cn},deleteFriendApplication:{userID:Cn},createFriendGroup:{name:Cn},deleteFriendGroup:{name:Cn},addToFriendGroup:{name:Cn,userIDList:Sn},removeFromFriendGroup:{name:Cn,userIDList:Sn},renameFriendGroup:{oldName:Cn,newName:Cn},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e){return ot(e)?0!==e.length||(tn({api:"sendMessageReadReceipt",param:"messageList",desc:ln()}),!1):(tn({api:"sendMessageReadReceipt",param:"messageList",desc:un()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e){return ot(e)?0!==e.length||(tn({api:"getMessageReadReceiptList",param:"messageList",desc:ln()}),!1):(tn({api:"getMessageReadReceiptList",param:"messageList",desc:un()}),!1)}}],createTopicInCommunity:{groupID:Cn,topicName:Cn},deleteTopicFromCommunity:{groupID:Cn,topicIDList:{type:"Array",validator:function(e){return!e||!!ot(e)||(tn({api:"deleteTopicFromCommunity",param:"topicIDList",desc:un()}),!1)}}},updateTopicProfile:{groupID:Cn,topicID:Cn},getTopicList:{groupID:Cn,topicIDList:{type:"Array",validator:function(e){return!e||!!ot(e)||(tn({api:"getTopicList",param:"topicIDList",desc:un()}),!1)}}}},Dn={login:1,logout:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,setMessageRemindType:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,callExperimentalAPI:1},An=1,Rn=2,Ln=3,On=4,Nn=6,xn=7,Pn=8,Un=9,Gn=10,Vn=11,Fn=12,Bn=13,jn=14,qn=15,Hn=16,zn=17,Kn=18,Wn=19,Yn=20,Jn=21,Zn=22,Xn=23,Qn=24,$n=25,ei=26,ti=27,ni=28,ii=29,ri=30,oi=31,ai=32,si=function(){function e(t){r(this,e),this._m=t,this._n=""}return a(e,[{key:"isLoggedIn",value:function(){return this._m.getModule(Fn).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.getModule(Fn).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.getModule(Fn).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.getModule(Fn).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.getModule(Fn).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.getModule(Fn).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.getModule(Fn).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.getModule(Fn).isIntl()}},{key:"isDevMode",value:function(){return this._m.getModule(Fn).isDevMode()}},{key:"getModule",value:function(e){return this._m.getModule(e)}},{key:"getPlatform",value:function(){return pe}},{key:"getNetworkType",value:function(){return this._m.getModule(qn).getNetworkType()}},{key:"probeNetwork",value:function(e){return this._m.getModule(qn).probe(e)}},{key:"getCloudConfig",value:function(e){return this._m.getModule(Xn).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.getModule(Fn).getTinyID()+"-"+e.random}},{key:"filterModifiedMessage",value:function(e){if(!Yt(e)){var t=e.filter((function(e){return!0===e.isModified}));t.length>0&&this.emitOuterEvent(M.MESSAGE_MODIFIED,t)}}},{key:"filterUnmodifiedMessage",value:function(e){return Yt(e)?[]:e.filter((function(e){return!1===e.isModified}))}},{key:"request",value:function(e){return this._m.getModule(Yn).request(e)}},{key:"canIUse",value:function(e){return this._m.getModule(ti).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&Be.w(i)}}]),e}(),ci="wslogin",ui="wslogout",li="wshello",di="KickOther",hi="getmsg",pi="authkey",fi="sendmsg",gi="send_group_msg",_i="portrait_get_all",vi="portrait_set",mi="black_list_get",yi="black_list_add",Ii="black_list_delete",Ti="msgwithdraw",Ci="msgreaded",Si="set_c2c_peer_mute_notifications",Ei="get_c2c_peer_mute_notifications",bi="getroammsg",Mi="get_peer_read_time",ki="delete_c2c_msg_ramble",wi="modify_c2c_msg",Di="set_key_values",Ai="get_key_values",Ri="page_get",Li="get",Oi="batch_delete",Ni="clear_msg",xi="top",Pi="deletemsg",Ui="set_conv_custom_data",Gi="mark_contact",Vi="create_contact_group",Fi="del_contact_group",Bi="update_contact_group",ji="add_conv_to_group",qi="del_conv_from_group",Hi="get_contact_group",zi="get_joined_group_list",Ki="get_group_self_member_info",Wi="create_group",Yi="destroy_group",Ji="modify_group_base_info",Zi="apply_join_group",Xi="apply_join_group_noauth",Qi="quit_group",$i="get_group_public_info",er="change_group_owner",tr="handle_apply_join_group",nr="handle_invite_join_permission_group",ir="handle_invite_join_group",rr="group_msg_recall",or="msg_read_report",ar="read_all_unread_msg",sr="group_msg_get",cr="get_group_msg_receipt",ur="group_msg_receipt",lr="c2c_msg_read_receipt",dr="get_group_msg_receipt_detail",hr="get_pendency",pr="deletemsg",fr="get_msg",gr="get_msg_noauth",_r="get_online_member_num",vr="delete_group_ramble_msg_by_seq",mr="modify_group_msg",yr="set_group_attr",Ir="modify_group_attr",Tr="delete_group_attr",Cr="clear_group_attr",Sr="get_group_attr",Er="group_set_key_values",br="group_get_key_values",Mr="get_group_notify",kr="update_group_counter",wr="get_group_counter",Dr="get_group_member_info",Ar="get_members",Rr="get_specified_group_member_info",Lr="add_group_member",Or="delete_group_member",Nr="ban_group_member",xr="modify_group_member_info",Pr="modify_user_info",Ur="cos",Gr="pre_sig",Vr="video_cover",Fr="tim_web_report_v2",Br="alive",jr="msg_push",qr="multi_msg_push_ws",Hr="ws_msg_push_ack",zr="stat_forceoffline",Kr="save_relay_json_msg",Wr="get_relay_json_msg",Yr="fetch_config",Jr="push_configv2",Zr="fetch_imsdk_purchase_bitsv2",Xr="push_imsdk_purchase_bitsv2",Qr="notify2",$r="create_topic",eo="destroy_topic",to="modify_topic",no="get_topic",io="ws_set_custom_status",ro="ws_get_user_status",oo="ws_status_subscribe",ao="ws_status_unsubscribe",so="ws_stat_background",co="ws_stat_foreground",uo="ws_stat_settoken",lo="get_local_words",ho="ws_batch_trans_text",po={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MESSAGE_SEND_FAIL:2100,MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_DELETE_FAIL:2111,MESSAGE_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MESSAGE_LIST_EMPTY:2114,MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GROUP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,MESSAGE_MERGER_TYPE_INVALID:2450,MESSAGE_MERGER_KEY_INVALID:2451,MESSAGE_MERGER_DOWNLOAD_FAIL:2452,MESSAGE_FORWARD_TYPE_INVALID:2453,MESSAGE_MODIFY_CONFLICT:2480,MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,INVALID_CONVERSATION_ID:2503,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GROUP_ID:2602,CANNOT_FIND_GROUP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GROUP:2623,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GROUP_EXISTED:2710,FRIEND_GROUP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022},fo="networkRTT",go="messageE2EDelay",_o="sendMessageC2C",vo="sendMessageGroup",mo="sendMessageGroupAV",yo="sendMessageRichMedia",Io="cosUpload",To="messageReceivedGroup",Co="messageReceivedGroupAVPush",So="messageReceivedGroupAVPull",Eo=(s(Xt={},fo,2),s(Xt,go,3),s(Xt,_o,4),s(Xt,vo,5),s(Xt,mo,6),s(Xt,yo,7),s(Xt,To,8),s(Xt,Co,9),s(Xt,So,10),s(Xt,Io,11),Xt),bo={info:4,warning:5,error:6},Mo={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},ko={login:4},wo=function(){function e(t){r(this,e),this._n="SSOLogData",this.eventType=ko[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=xe()}return a(e,[{key:"updateTimeStamp",value:function(){this.timestamp=xe()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._sentFlag){var n=xe();0===this.costTime&&(this.costTime=n-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(n)),t?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){e._sentFlag=!0,e._eventStatModule&&e._eventStatModule.pushIn(e)}),0)}}},{key:"setError",value:function(e,t,n){if(!(e instanceof Error))return Be.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;if(this.setNetworkType(n),t)e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message);else{var i=po.NO_NETWORK;this.setCode(i)}return this.setLevel("error"),this}},{key:"setCode",value:function(e){return at(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),et(e)?this.code=e:Be.w("".concat(this._n,".setCode value not a number, please check!"),e,i(e))),this}},{key:"setMessage",value:function(e){return at(e)||this._sentFlag||(et(e)&&(this.message=e.toString()),nt(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return at(e)||this._sentFlag||(this.level=bo[e]),this}},{key:"setMoreMessage",value:function(e){return Yt(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){if(at(e))Be.w("".concat(this._n,".setNetworkType value is undefined, please check!"));else{var t=Mo[e.toLowerCase()];at(t)||(this.networkType=t)}return this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){this.uiPlatform=e}}],[{key:"bindEventStatModule",value:function(t){e.prototype._eventStatModule=t}}]),e}(),Do=function(){function e(t){r(this,e),this.type=k.MSG_TEXT,this.content={text:t.text||""}}return a(e,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),e}(),Ao=function(){function e(t,n){r(this,e),this._imageMemoryURL="",this._fileDownloadProxy=n,oe?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=k.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||je.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._autoFixUrl()}return a(e,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=gt(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.url||"",this.url=Kt(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t=0,n=null,i=null;t<=2;)i=at(e)||at(e[t])?{type:0,size:0,width:0,height:0,url:""}:e[t],(n=new this._ImageInfoModel(i)).setSizeType(t+1),n.setType(t),this.addImageInfo(n),t++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,i=0;i<n;i++)t=this.content.imageInfoArray[i],e[i].size&&(t.size=e[i].size),e[i].url&&t.setImageUrl(e[i].url),e[i].width&&(t.width=e[i].width),e[i].height&&(t.height=e[i].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",i=["http","https"],r=null,o=0;o<e;o++)this.content.imageInfoArray[o].url&&""!==(r=this.content.imageInfoArray[o]).imageUrl&&(n=r.imageUrl.slice(0,r.imageUrl.indexOf("://")+1),t=r.imageUrl.slice(r.imageUrl.indexOf("://")+1),i.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[o].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=je[e.toUpperCase()]||je.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=e[0],n=t.width,i=void 0===n?0:n,r=t.height,o=void 0===r?0:r;0!==i&&0!==o&&(xt(e),Object.assign(e[2],Nt({originWidth:i,originHeight:o,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]),e}(),Ro=function(){function e(t){r(this,e),this.type=k.MSG_FACE,this.content=t||null}return a(e,[{key:"sendable",value:function(){return null!==this.content}}]),e}(),Lo=function(){function e(t,n){r(this,e),this.type=k.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:Kt(t.url,n),remoteAudioUrl:t.url||"",uuid:t.uuid}}return a(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),e}(),Oo={from:!0,groupID:!0,groupName:!0,to:!0},No=function(){function e(t){r(this,e),this.type=k.MSG_GRP_TIP,this.content={},this._initContent(t)}return a(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberExtraInfo":case"onlineMemberInfo":break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];Oo[i]&&(this.content.groupProfile[i]=e[i])}}},{key:"_updateMemberList",value:function(e){Yt(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];this.content.newGroupProfile[i]="muteAllMembers"!==i?e[i]:1===e[i]}}}]),e}(),xo={from:!0,groupID:!0,groupName:!0,to:!0},Po=function(){function e(t){r(this,e),this.type=k.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return a(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];xo[i]&&("groupName"===i?this.content.groupProfile.name=e[i]:this.content.groupProfile[i]=e[i])}}}]),e}(),Uo=function(){function e(t,n){r(this,e),this.type=k.MSG_FILE,this._percent=0;var i=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:Kt(t.url,n)||"",uuid:t.uuid,fileName:i.name||"",fileSize:i.size||0}}return a(e,[{key:"_getFileInfo",value:function(e){if(!at(e.fileName)&&!at(e.fileSize))return{size:e.fileSize,name:e.fileName};var t=e.file.files[0];if(ie){if(t.path&&-1!==t.path.indexOf(".")){var n=t.path.slice(t.path.lastIndexOf(".")+1).toLowerCase();t.type=n,t.name||(t.name="".concat(gt(999999),".").concat(n))}t.name||(t.type="",t.name=t.path.slice(t.path.lastIndexOf("/")+1).toLowerCase()),t.suffix&&(t.type=t.suffix),t.url||(t.url=t.path)}return{size:t.size,name:t.name}}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),e}(),Go=function(){function e(t){r(this,e),this.type=k.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return a(e,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),Vo=function(){function e(t,n){r(this,e),this.type=k.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:Kt(t.videoUrl,n),videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:Kt(t.thumbUrl,n),snapshotUrl:Kt(t.thumbUrl,n)}}return a(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth,i=e.snapshotHeight;Yt(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),Yt(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),Yt(i)||(this.content.thumbHeight=this.content.snapshotHeight=Number(i))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),e}(),Fo=function(){function e(t){r(this,e),this.type=k.MSG_LOCATION;var n=t.description,i=t.longitude,o=t.latitude;this.content={description:n,longitude:i,latitude:o}}return a(e,[{key:"sendable",value:function(){return!0}}]),e}(),Bo=function(){function e(t,n){if(r(this,e),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID)this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType.startsWith(k.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(k.CONV_GROUP)&&(this.receiverGroupID=t.to),this.messageReceiver=t.to;else{this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[];var i=t.elements[0].type,o=t.elements[0].content;this._patchRichMediaPayload(i,o),this._updateRichMediaDownloadUrl(i,o,n),i===k.MSG_MERGER?this.messageBody.push({type:i,payload:new jo(o).content}):this.messageBody.push({type:i,payload:o}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random)}}return a(e,[{key:"_patchRichMediaPayload",value:function(e,t){e===k.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===k.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===k.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===k.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===k.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=Kt(e.url,n)})):e===k.MSG_VIDEO?(t.videoUrl=Kt(t.videoUrl,n),t.snapshotUrl=Kt(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===k.MSG_AUDIO?t.url=Kt(t.url,n):e===k.MSG_FILE&&(t.fileUrl=Kt(t.fileUrl,n)))}}]),e}(),jo=function(){function e(t,n){if(r(this,e),this.type=k.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey){var i=t.downloadKey,o=t.pbDownloadKey,a=t.title,s=t.abstractList,c=t.compatibleText,u=t.version;this.content.downloadKey=i,this.content.pbDownloadKey=o,this.content.title=a,this.content.abstractList=s,this.content.compatibleText=c,this.content.version=u||0}else if(Yt(t.messageList))1===t.layersOverLimit&&(this.content.layersOverLimit=!0);else{var l=t.messageList,d=t.title,h=t.abstractList,p=t.compatibleText,f=t.version,g=[];l.forEach((function(e){if(!Yt(e)){var t=new Bo(e,n);g.push(t)}})),this.content.messageList=g,this.content.title=d,this.content.abstractList=h,this.content.compatibleText=p,this.content.version=f||0}}return a(e,[{key:"sendable",value:function(){return!Yt(this.content.messageList)||!Yt(this.content.downloadKey)}}]),e}(),qo={1:k.MSG_PRIORITY_HIGH,2:k.MSG_PRIORITY_NORMAL,3:k.MSG_PRIORITY_LOW,4:k.MSG_PRIORITY_LOWEST},Ho=function(){function e(t){r(this,e),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||k.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||0===t.random?t.random:gt(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=!1,this.nameCard="",this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Qt.SUCCESS,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!t.messageControlInfo||1!==t.messageControlInfo.excludedFromLastMessage),this.clientTime=t.clientTime||Ue()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=!0===t.needReadReceipt||1===t.needReadReceipt,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this._receiverList=t.receiverList||void 0,this.isSupportExtension=!0===t.isSupportExtension||1===t.isSupportExtension,this.revoker=t.revokerInfo&&t.revokerInfo.revoker||null,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t),this.initC2CReadReceiptInfo(t.readReceiptSentByPeer)}return a(e,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){if(null!==e){nt(e.nick)&&(this.nick=e.nick),nt(e.avatar)&&(this.avatar=e.avatar);var t=e.messageFromAccountExtraInformation;rt(t)&&nt(t.nameCard)&&(this.nameCard=t.nameCard)}}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==k.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(k.MSG_AT_ALL))})),ot(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(k.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Qt.SUCCESS:Qt.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&"function"==typeof this._elements[0].sendable&&this._elements[0].sendable()}},{key:"_initTo",value:function(e){this.conversationType===k.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return!1;if(void 0===yt[e]){var t=new Date,n="3".concat(t.getHours()).slice(-2),i="0".concat(t.getMinutes()).slice(-2),r="0".concat(t.getSeconds()).slice(-2);yt[e]=parseInt([n,i,r,"0001"].join("")),n=null,i=null,r=null,Be.l("autoIncrementIndex start index:".concat(yt[e]))}return yt[e]++}(e)),0===this.sequence&&this.conversationType===k.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===k.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n="",i=this.conversationType;i!==k.CONV_SYSTEM?(n=i===k.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=n?"".concat(i).concat(n):null):this.conversationID=k.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Do||e instanceof Ao||e instanceof Ro||e instanceof Lo||e instanceof Uo||e instanceof Vo||e instanceof No||e instanceof Po||e instanceof Go||e instanceof Fo||e instanceof jo}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var i=function(e){if(e.type&&e.content)switch(e.type){case k.MSG_TEXT:n.setTextElement(e.content);break;case k.MSG_IMAGE:n.setImageElement(e.content,t);break;case k.MSG_AUDIO:n.setAudioElement(e.content,t);break;case k.MSG_FILE:n.setFileElement(e.content,t);break;case k.MSG_VIDEO:n.setVideoElement(e.content,t);break;case k.MSG_CUSTOM:n.setCustomElement(e.content);break;case k.MSG_LOCATION:n.setLocationElement(e.content);break;case k.MSG_GRP_TIP:n.setGroupTipElement(e.content);break;case k.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(e.content);break;case k.MSG_FACE:n.setFaceElement(e.content);break;case k.MSG_MERGER:n.setMergerElement(e.content,t)}};if(ot(e))for(var r=0;r<e.length;r++)i(e[r]);else i(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){var t="string"==typeof e?e:e.text,n=new Do({text:t});this._elements.push(n)}},{key:"setImageElement",value:function(e,t){var n=new Ao(e,t);this._elements.push(n)}},{key:"setAudioElement",value:function(e,t){var n=new Lo(e,t);this._elements.push(n)}},{key:"setFileElement",value:function(e,t){var n=new Uo(e,t);this._elements.push(n)}},{key:"setVideoElement",value:function(e,t){var n=new Vo(e,t);this._elements.push(n)}},{key:"setLocationElement",value:function(e){var t=new Fo(e);this._elements.push(t)}},{key:"setCustomElement",value:function(e){var t=new Go(e);this._elements.push(t)}},{key:"setGroupTipElement",value:function(e){var t={},n=e.operationType;if(Yt(e.memberInfoList)?e.operatorInfo&&(t=e.operatorInfo):n!==k.GRP_TIP_MBR_JOIN&&n!==k.GRP_TIP_MBR_KICKED_OUT&&n!==k.GRP_TIP_MBR_SET_ADMIN&&n!==k.GRP_TIP_MBR_CANCELED_ADMIN||(t=e.memberInfoList[0]),!Yt(e.memberExtraInfo)){var i=e.memberExtraInfo.reason;e.msgMemberInfo.forEach((function(e){e.reason=i}))}var r=t,o=r.nick,a=r.avatar;nt(o)&&(this.nick=o),nt(a)&&(this.avatar=a);var s=new No(e);this._elements.push(s)}},{key:"setGroupSystemNoticeElement",value:function(e){var t=new Po(e);this._elements.push(t)}},{key:"setFaceElement",value:function(e){var t=new Ro(e);this._elements.push(t)}},{key:"setMergerElement",value:function(e,t){var n=new jo(e,t);this._elements.push(n)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"getRelayFlag",value:function(){return this._relayFlag}},{key:"_computePriority",value:function(e){if(at(e))return k.MSG_PRIORITY_NORMAL;if(nt(e)&&-1!==Object.values(qo).indexOf(e))return e;if(et(e)){var t=""+e;if(-1!==Object.keys(qo).indexOf(t))return qo[t]}return k.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick,n=e.avatar;nt(t)&&(this.nick=t),nt(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){nt(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===k.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===e)}}]),e}(),zo=function(e){return{code:0,data:e||{}}},Ko=function(e){c(n,e);var t=v(n);function n(e){var i;r(this,n),i=t.call(this);var o=e.code,a=e.message,s=e.data;return i.code=o,i.message=a||i._getErrorMessage(i.code),i.data=s||{},i}return a(n)}(p(Error)),Wo=null,Yo=function(e){Wo=e},Jo=function(e){return Promise.resolve(zo(e))},Zo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Ko)return t&&null!==Wo&&Wo.emit(M.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new Ko({code:po.UNCAUGHT_ERROR});return t&&null!==Wo&&Wo.emit(M.ERROR,n),Promise.reject(n)}if(!at(e)&&!at(e.code)){var i=new Ko(e);return t&&null!==Wo&&Wo.emit(M.ERROR,i),Promise.reject(i)}},Xo=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="C2CModule",t._messageFromUnreadDBMap=new Map,t._signalingFromUnreadDBList=[],t}return a(i,[{key:"onNewC2CMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,i=e.C2CRemainingUnreadList,r=e.C2CPairUnreadList;Be.d("".concat(this._n,".onNewC2CMessage count:").concat(t.length," isInstantMessage:").concat(n));var o=this._newC2CMessageStoredAndSummary({dataList:t,C2CRemainingUnreadList:i,C2CPairUnreadList:r,isInstantMessage:n}),a=o.conversationOptionsList,s=o.messageList,c=o.isUnreadC2CMessage;this.filterModifiedMessage(s),a.length>0&&this.getModule(Vn).onNewMessage({conversationOptionsList:a,isInstantMessage:n,isUnreadC2CMessage:c});var u=this.filterUnmodifiedMessage(s);n&&u.length>0&&this.emitOuterEvent(M.MESSAGE_RECEIVED,u),s.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,i=e.C2CPairUnreadList,r=e.isInstantMessage,o=null,a=[],s=[],c={},u=this.getModule(Hn),l=this.getModule(ei),d=!1,h=this.getModule(Vn),p=this.getFileDownloadProxy(),f=0,g=t.length;f<g;f++)if(this._isSignaling(t[f]))this._signalingFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var _=t[f];_.currentUser=this.getMyUserID(),_.conversationType=k.CONV_C2C,_.isSystemMessage=!!_.isSystemMessage,(at(_.nick)||at(_.avatar))&&(d=!0,Be.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),o=new Ho(_),_.elements=u.parseElements(_.elements,_.from),o.setElement(_.elements,p),o.setNickAndAvatar({nick:_.nick,avatar:_.avatar});var v=o.conversationID;if(r){if(1===this._messageFromUnreadDBMap.get(o.ID))continue;var m=!1;if(o.from!==this.getMyUserID()){var y=h.getLatestMessageSentByPeer(v);if(y){var I=y.nick,T=y.avatar;d?o.setNickAndAvatar({nick:I,avatar:T}):I===o.nick&&T===o.avatar||(m=!0)}}else{var C=h.getLatestMessageSentByMe(v);if(C){var S=C.nick,E=C.avatar;S===o.nick&&E===o.avatar||h.modifyMessageSentByMe({conversationID:v,latestNick:o.nick,latestAvatar:o.avatar})}}var b=1===t[f].isModified;if(h.isMessageSentByCurrentInstance(o)?o.isModified=b:b=!1,0===_.msgLifeTime)o._onlineOnlyFlag=!0,h.isMessageSentByCurrentInstance(o)||s.push(o);else{if(!h.pushIntoMessageList(s,o,b))continue;m&&(h.modifyMessageSentByPeer({conversationID:v,latestNick:o.nick,latestAvatar:o.avatar}),h.updateUserProfileSpecifiedKey({conversationID:v,nick:o.nick,avatar:o.avatar}))}r&&o.clientTime>0&&l.addMessageDelay(o.clientTime)}else this._messageFromUnreadDBMap.set(o.ID,1);if(0!==_.msgLifeTime){if(!1===o._onlineOnlyFlag){var M=h.getLastMessageTime(v);if(et(M)&&o.time<M)continue;if(at(c[v])){var w=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||(w=1)),c[v]=a.push({conversationID:v,unreadCount:w,type:o.conversationType,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var D=c[v];a[D].type=o.conversationType,a[D].subType=o.conversationSubType,a[D].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||a[D].unreadCount++)}}}else o._onlineOnlyFlag=!0}this._handleSignalingFromUnreadDB();var A=!1;if(ot(i))for(var R=function(e,t){if(i[e].unreadCount>0){A=!0;var n=a.find((function(t){return t.conversationID==="C2C".concat(i[e].from)}));n?n.unreadCount=i[e].unreadCount:a.push({conversationID:"C2C".concat(i[e].from),unreadCount:i[e].unreadCount,type:k.CONV_C2C})}},L=0,O=i.length;L<O;L++)R(L);if(ot(n))for(var N=function(e,t){a.find((function(t){return t.conversationID==="C2C".concat(n[e].from)}))||a.push({conversationID:"C2C".concat(n[e].from),type:k.CONV_C2C,lastMsgTime:n[e].lastMsgTime})},x=0,P=n.length;x<P;x++)N(x);return{conversationOptionsList:a,messageList:s,isUnreadC2CMessage:A}}},{key:"_isSignaling",value:function(e){var t=e.eventArray;return!(!ot(t)||10!==t[0].event)}},{key:"_handleSignalingFromUnreadDB",value:function(){var e=this._signalingFromUnreadDBList.length;if(Be.l("".concat(this._n,"._handleSignalingFromUnreadDB signalingCount:").concat(e)),0!==e){var t=[];this._signalingFromUnreadDBList.forEach((function(e){e.hasOwnProperty("c2cMessageRevokedNotify")&&t.push(e)})),this.onC2CMessageRevoked({dataList:t}),this._signalingFromUnreadDBList.length=0,t.length=0}}},{key:"onC2CMessageRevoked",value:function(e){var t=this,n=this.getModule(Vn),i=[],r=null,o=!0;e.dataList.forEach((function(e){if(e.c2cMessageRevokedNotify){var a=e.c2cMessageRevokedNotify.revokedInfos;at(a)||a.forEach((function(e){var a=t.getMyUserID()===e.from?"".concat(k.CONV_C2C).concat(e.to):"".concat(k.CONV_C2C).concat(e.from);r=n.revoke(a,e.sequence,e.random);var s=e.revokerInfo&&e.revokerInfo.revoker;if(r)r.revoker||(r.revoker=s,i.push(r));else{var c={conversationID:a,sequence:e.sequence,time:e.time,revoker:s};n.isLastMessageRevoked(c)&&(i.push(c),o=!1)}}))}})),0!==i.length&&(n.onMessageRevoked(i),!0===o&&(Be.l("".concat(this._n,".onC2CMessageRevoked count:").concat(i.length)),this.emitOuterEvent(M.MESSAGE_REVOKED,i)))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){if(!Yt(e.c2cMessageReadReceipt)){var n=e.c2cMessageReadReceipt.to;e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){var i=e.peerReadTime;Be.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(n," peerReadTime:").concat(i));var r="".concat(k.CONV_C2C).concat(n),o=t.getModule(Vn);o.recordPeerReadTime(r,i),o.updateMessageIsPeerReadProperty(r,i)}))}}))}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){if(!Yt(e.c2cMessageReadNotice)){var n=t.getModule(Vn);e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var i=e.from,r=e.peerReadTime;Be.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(i," lastReadTime:").concat(r));var o="".concat(k.CONV_C2C).concat(i);n.updateIsReadAfterReadReport({conversationID:o,lastMessageTime:r}),n.updateUnreadCount(o)}))}}))}},{key:"onC2CMessageModified",value:function(e){Be.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var n=this.getModule(Vn);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:k.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Be.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e));var t=e.dataList,n=t.userID,i=t.readReceiptList;this.getModule(Vn).updateReadReceiptInfo({userID:n,readReceiptList:i})}},{key:"sendMessage",value:function(e,t){var n=this._createC2CMessagePack(e,t);return this.request(n)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null;t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0}));var i="";nt(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var r=[];if(rt(t)&&rt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=this.isOnlineMessage(e,t)?0:void 0;return{protocolName:fi,tjgID:this.generateTjgID(e),requestData:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:i,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:u,nick:e.nick,avatar:e.avatar,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==u?r:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_isVoipPush",value:function(e){var t=void 0;return at(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.request({protocolName:Ti,requestData:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;return Be.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.request({protocolName:ki,requestData:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,i=e.version,r=void 0===i?0:i,o=e.sequence,a=e.random,s=e.time,c=e.payload,u=e.type,l=e.cloudCustomData,d=void 0;return jt(u)&&(d=[]).push({type:u,content:c}),this.request({protocolName:wi,requestData:{from:t,to:n,version:r,sequence:o,random:a,time:s,elements:d,cloudCustomData:l}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageTime,r="".concat(this._n,".setMessageRead");Be.l("".concat(r," conversationID:").concat(n," lastMessageTime:").concat(i)),et(i)||this.outputWarning("DoNotModifyLastTime");var o=new wo("setC2CMessageRead");return o.setMessage("conversationID:".concat(n," lastMessageTime:").concat(i)),this.request({protocolName:Ci,requestData:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:i,receipt:1}]}}}).then((function(){o.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(r," ok"));var e=t.getModule(Vn);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:i}),e.updateUnreadCount(n),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.l("".concat(r," failed. error:"),e),Zo(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.peerAccount,r=e.conversationID,o=e.count,a=e.lastMessageTime,s=e.messageKey,c="peerAccount:".concat(i," count:").concat(o||15," lastMessageTime:").concat(a||0," messageKey:").concat(s);Be.l("".concat(n," ").concat(c));var u=new wo("getC2CRoamingMessages");return this.request({protocolName:bi,requestData:{peerAccount:i,count:o||15,lastMessageTime:a||0,messageKey:s}}).then((function(e){var i=e.data,o=i.complete,a=i.messageList,s=i.messageKey,l=i.lastMessageTime;at(a)?Be.l("".concat(n," ok. complete:").concat(o," but messageList is undefined!")):Be.l("".concat(n," ok. complete:").concat(o," count:").concat(a.length)),u.setNetworkType(t.getNetworkType()).setMessage("".concat(c," complete:").concat(o," length:").concat(a.length)).end();var d=t.getModule(Vn);1===o&&d.setCompleted(r);var h=d.onRoamingMessage(a,r);d.modifyMessageList(r),d.updateIsRead(r),d.updateRoamingMessageKeyAndTime(r,s,l);var p=d.getPeerReadTime(r);if(Be.l("".concat(n," update isPeerRead property. conversationID:").concat(r," peerReadTime:").concat(p)),p)d.updateMessageIsPeerReadProperty(r,p);else{var f=r.replace(k.CONV_C2C,"");t.getRemotePeerReadTime([f]).then((function(){d.updateMessageIsPeerReadProperty(r,d.getPeerReadTime(r))}))}var g="";if(h.length>0)g=h[0].ID;else{var _=d.getLocalOldestMessage(r);_&&(g=_.ID)}return Be.l("".concat(n," nextReqID:").concat(g," stored message count:").concat(h.length)),{nextReqID:g,storedMessageList:h}})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];u.setMessage(c).setError(e,i,r).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=e.peerAccount,r=e.time,o=void 0===r?0:r,a=e.count,s=e.direction,c="".concat(k.CONV_C2C).concat(i),u="peerAccount:".concat(i," count:").concat(a," time:").concat(o," direction:").concat(s);Be.l("".concat(n," ").concat(u));var l=new wo("getC2CRoamingMessagesHopping");return this.request({protocolName:bi,requestData:{peerAccount:i,count:a+1,lastMessageTime:o,direction:s}}).then((function(e){var i=e.data,r=i.complete,o=i.messageList,a=void 0===o?[]:o,d=i.lastMessageTime;Be.l("".concat(n," ok. complete:").concat(r," count:").concat(a.length)),l.setNetworkType(t.getNetworkType()).setMessage("".concat(u," complete:").concat(r," length:").concat(a.length)).end(),1!==r&&(1===s?a.pop():a.shift());var h=t.getModule(Vn).onRoamingMessage(a,c,!1);t._modifyMessageList(c,h);var p=t._computeResult({complete:r,lastMessageTime:d,resultList:h});return zo(p)})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];l.setMessage(u).setError(e,i,r).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_computeResult",value:function(e){var t=e.complete,n=void 0===t?0:t,i=e.lastMessageTime,r=e.resultList,o={messageList:y(void 0===r?[]:r),isCompleted:!1,nextMessageTime:""};return 1===n?(o.isCompleted=!0,o):(o.nextMessageTime=i,o)}},{key:"_modifyMessageList",value:function(e,t){var n=this.getModule(Vn).getLocalConversation(e);if(n)for(var i=n.userProfile.nick,r=n.userProfile.avatar,o=this.getModule(On).getNickAndAvatarByUserID(this.getMyUserID()),a=o.nick,s=o.avatar,c=t.length-1;c>=0;c--){var u=t[c];"in"===u.flow&&(u.nick!==i&&u.setNickAndAvatar({nick:i}),u.avatar!==r&&u.setNickAndAvatar({avatar:r})),"out"===u.flow&&(u.nick!==a&&u.setNickAndAvatar({nick:a}),u.avatar!==s&&u.setNickAndAvatar({avatar:s}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if(Yt(e))return Be.w("".concat(n," userIDList is empty!")),Promise.resolve();var i=new wo("getPeerReadTime");return Be.l("".concat(n," userIDList:").concat(e)),this.request({protocolName:Mi,requestData:{userIDList:e}}).then((function(r){var o=r.data.peerReadTimeList;Be.l("".concat(n," ok. peerReadTimeList:").concat(o));for(var a="",s=t.getModule(Vn),c=0;c<e.length;c++)a+="".concat(e[c],"-").concat(o[c]," "),o[c]>0&&s.recordPeerReadTime("C2C".concat(e[c]),o[c]);i.setNetworkType(t.getNetworkType()).setMessage(a).end()})).catch((function(e){t.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n=e[0].conversationID.replace(k.CONV_C2C,""),i=new wo("sendC2CReadReceipt");i.setMessage("peerAccount:".concat(n));var r=this.getMyUserID(),o=e.filter((function(e){return e.from!==r&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}));if(0===o.length)return Zo({code:po.READ_RECEIPT_MESSAGE_LIST_EMPTY});var a="".concat(this._n,".sendReadReceipt");return Be.l("".concat(a,". peerAccount:").concat(n," messageInfoList length:").concat(o.length)),this.request({protocolName:lr,requestData:{peerAccount:n,messageInfoList:o}}).then((function(e){return i.end(),Be.l("".concat(a," ok")),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.w("".concat(a," failed. error:"),e),Zo(e)}))}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),i=e.filter((function(e){return e.from===n&&!0===e.needReadReceipt}));return Be.l("".concat(t," userID:").concat(n," messageList length:").concat(i.length)),Jo({messageList:i})}},{key:"getMessageExtensions",value:function(e,t){return Be.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:Ai,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Be.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Di,requestData:{from:e.from,to:e.to,messageKey:this._getMessageKey(e),extensionList:t,operateType:n}})}},{key:"_getMessageKey",value:function(e){var t=e.clientSequence,n=e.random,i=e.time;return"".concat(t,"_").concat(n,"_").concat(i)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._signalingFromUnreadDBList.length=0}}]),i}(si),Qo=function(){function e(){r(this,e),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map}return a(e,[{key:"getLocalOldestMessageByConversationID",value:function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{key:"pushIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,i=!0;this.list.has(n)||this.list.set(n,new Map);var r=this._getUniqueIDOfMessage(e),o=this.list.get(n).has(r);if(o){var a=this.list.get(n).get(r);if(!t||!0===a.isModified)return!1}return this.list.get(n).set(r,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),i}},{key:"unshift",value:function(e,t){var n;if(ot(e)?e.length>0&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n&&n.startsWith(k.CONV_C2C)){var i=Array.from(this.list.get(n).values()),r=i.length;if(0===r)return;for(var o=r-1;o>=0;o--)if("out"===i[o].flow){this._setLatestMessageSentByMe(n,i[o]);break}for(var a=r-1;a>=0;a--)if("in"===i[a].flow){this._setLatestMessageSentByPeer(n,i[a]);break}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,i=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(i,e),void t.push(e);var r=this.list.get(n),o=Array.from(r);r.has(i)||(o.unshift([i,e]),this.list.set(n,new Map(o)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,i=[],r=e[0].conversationID,o=this.list.get(r),a=this.list.has(r)?Array.from(o):[],s=0;s<n;s++){var c=this._getUniqueIDOfMessage(e[s]);o&&o.has(c)||(i.push([c,e[s]]),t.push(e[s]))}this.list.set(r,new Map(i.concat(a)))}},{key:"remove",value:function(e){var t=e.conversationID,n=this._getUniqueIDOfMessage(e);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(Be.d("revoke message",e,t,n),this.list.has(e)){var i,r=b(this.list.get(e));try{for(r.s();!(i=r.n()).done;){var o=m(i.value,2)[1];if(o.sequence===t&&(at(n)||o.random===n))return o.isRevoked||(o.isRevoked=!0),o}}catch(s){r.e(s)}finally{r.f()}}return null}},{key:"removeByConversationID",value:function(e){this.list.has(e)&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t,n=null,i=b(this.list);try{for(i.s();!(t=i.n()).done;)for(var r=y(m(t.value,2)[1].values()),o=r.length,a=0;a<o;a++)if(r[a].ID===e){n=r[a];break}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var i,r=b(this.list.get(e));try{for(r.s();!(i=r.n()).done;){var o=m(i.value,2)[1];o.time<=t&&!o.isPeerRead&&"out"===o.flow&&(o.isPeerRead=!0,n.push(o))}}catch(s){r.e(s)}finally{r.f()}Be.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(n.length))}return n}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;if(this.list.has(t)){var n=this._getUniqueIDOfMessage(e),i=this.list.get(t).get(n);i&&(i.isModified=!0)}}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?y(this.list.get(e).values()):[]}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,i=this.getLocalMessageList(e),r=i.length,o=0;o<r;o++)i[o].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,i=this.getLocalMessageList(e),r=i.length,o=0;o<r;o++)if(i[o].ID===t){n=i[o];break}return n}},{key:"getLocalLastMessage",value:function(e){var t=this.getLocalMessageList(e);return t[t.length-1]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(k.CONV_C2C)&&"in"===t.flow&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){e.startsWith(k.CONV_C2C)&&"out"===t.flow&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,r=this.list.get(t);if(!Yt(r)){var o=Array.from(r.values()),a=o.length;if(0!==a){for(var s=null,c=0,u=!1,l=a-1;l>=0;l--)"in"===o[l].flow&&((s=o[l]).nick!==n&&(s.setNickAndAvatar({nick:n}),u=!0),s.avatar!==i&&(s.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));Be.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(c))}}}},{key:"modifyMessageSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,i=e.latestAvatar,r=this.list.get(t);if(!Yt(r)){var o=Array.from(r.values()),a=o.length;if(0!==a){for(var s=null,c=0,u=!1,l=a-1;l>=0;l--)"out"===o[l].flow&&((s=o[l]).nick!==n&&(s.setNickAndAvatar({nick:n}),u=!0),s.avatar!==i&&(s.setNickAndAvatar({avatar:i}),u=!0),u&&(c+=1));Be.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(c))}}}},{key:"getTopicConversationIDList",value:function(e){return y(this.list.keys()).filter((function(t){return t.startsWith("".concat(k.CONV_GROUP).concat(e))}))}},{key:"traversal",value:function(){if(0!==this.list.size&&-1===Be.getLevel()){console.group("conversationID-messageCount");var e,t=b(this.list);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2),i=n[0],r=n[1];console.log("".concat(i,"-").concat(r.size))}}catch(a){t.e(a)}finally{t.f()}console.groupEnd()}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e))return{isUpdated:!1,message:null};var n=this._getUniqueIDOfMessage(t),i=this.list.get(e).has(n);if(Be.d("".concat(this._n,".onMessageModified conversationID:").concat(e," uniqueID:").concat(n," has:").concat(i)),i){var r=this.list.get(e).get(n),o=t.messageVersion,a=t.elements,s=t.cloudCustomData;return r.version<o?(r.version=o,r._elements=JSON.parse(JSON.stringify(a)),r.payload=JSON.parse(JSON.stringify(a[0].content)),r.type=a[0].type,r.cloudCustomData=s,r.isModified=!0,{isUpdated:!0,message:r}):{isUpdated:!1,message:r}}return{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(e){var t=e.from,n=e.to,i=e.random,r=e.sequence,o=e.time;return"".concat(t,"-").concat(n,"-").concat(i,"-").concat(r,"-").concat(o)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear()}}]),e}(),$o="_a2KeyAndTinyIDUpdated",ea="_cloudConfigUpdated",ta="_profileUpdated";function na(e){this.mixin(e)}na.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&t.length>0&&t.forEach((function(e){e.call(this)}),e)}),1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var ia=["jpg","jpeg","gif","png","bmp","image","webp"],ra=["mp4","quicktime","mov"],oa=1,aa=2,sa=3,ca=255,ua=function(){function e(t){var n=this;r(this,e),Yt(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||k.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||k.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Yt(t.profileCustomField)||t.profileCustomField.forEach((function(e){n.profileCustomField.push({key:e.key,value:e.value})})))}return a(e,[{key:"validate",value:function(e){var t=!0,n="";if(Yt(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,r=null,o=0;o<i;o++){if(r=e.profileCustomField[o],!nt(r.key)||-1===r.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!nt(r.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if("profileCustomField"===a)continue;if(Yt(e[a])&&!nt(e[a])&&!et(e[a])){n="key:"+a+", invalid value:"+e[a],t=!1;continue}switch(a){case"nick":nt(e[a])||(n="nick must be a string",t=!1),ft(e[a])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(ft(e[a])," bytes"),t=!1);break;case"gender":mt(He,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":et(e.birthday)||(n="birthday must be a number",t=!1);break;case"location":nt(e.location)||(n="location must be a string",t=!1);break;case"selfSignature":nt(e.selfSignature)||(n="selfSignature must be a string",t=!1);break;case"allowType":mt(Ke,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":et(e.language)||(n="language must be a number",t=!1);break;case"avatar":nt(e.avatar)||(n="avatar must be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings must be 0 or 1",t=!1);break;case"adminForbidType":mt(ze,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":et(e.level)||(n="level must be a number",t=!1);break;case"role":et(e.role)||(n="role must be a number",t=!1);break;default:n="unknown key:"+a+"  "+e[a],t=!1}}return{valid:t,tips:n}}}]),e}(),la=a((function e(t){r(this,e),this.value=t,this.next=null})),da=function(){function e(t){r(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map}return a(e,[{key:"set",value:function(e){var t=new la(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),ha=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],pa=function(){function e(t){r(this,e),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(t)}return a(e,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)ha.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0);var n=JSON.parse(JSON.stringify(e));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),at(n.muteAllMembers)||("On"===n.muteAllMembers?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&Ct(this.groupCustomField,n.groupCustomField),at(n.memberNum)||(this.memberCount=n.memberNum),at(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),at(n.isSupportTopic)||(this.isSupportTopic=et(n.isSupportTopic)?1===n.isSupportTopic:n.isSupportTopic),ht(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),ot(n.members)&&n.members.length>0&&n.members.forEach((function(e){e.userID===t.selfInfo.userID&&ht(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){var n={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList};ht(this.selfInfo,t({},n),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),e}(),fa=function(e,n){return at(e)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:e instanceof Ho?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:Bt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:Bt(e.type,e.payload,n)})},ga=function(){function e(t,n){r(this,e),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=fa(t.lastMessage,n),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType="",this.markList=t.markList||[],this.customData=t.customData||"",this.conversationGroupList=t.conversationGroupList||[],this._initProfile(t)}return a(e,[{key:"toAccount",get:function(){return this.conversationID.startsWith(k.CONV_C2C)?this.conversationID.replace(k.CONV_C2C,""):this.conversationID.startsWith(k.CONV_GROUP)?this.conversationID.replace(k.CONV_GROUP,""):""}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),at(this.userProfile)&&this.type===k.CONV_C2C?this.userProfile=new ua({userID:e.conversationID.replace("C2C","")}):at(this.groupProfile)&&this.type===k.CONV_GROUP&&(this.groupProfile=new pa({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations,i=e.isUnreadC2CMessage;at(t)||(St(this.subType)?this.unreadCount=0:n&&this.type===k.CONV_GROUP||n&&this.type===k.CONV_TOPIC||i&&this.type===k.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=fa(e)}},{key:"updateGroupAtInfoList",value:function(e){if(!this._isNeedMergeGroupAtInfo(e)){var t,n=(I(t=e.groupAtType)||T(t)||C(t)||E()).slice(0);-1!==n.indexOf(k.CONV_AT_ME)&&-1!==n.indexOf(k.CONV_AT_ALL)&&(n=[k.CONV_AT_ALL_AT_ME]);var i={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:n,__random:e.__random,__sequence:e.__sequence};this.groupAtInfoList.push(i)}}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!Et({groupID:t}))return!1;var i=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(t.atTypeArray.indexOf(k.CONV_AT_ME)>-1&&e.groupAtType.indexOf(k.CONV_AT_ALL)>-1&&(t.atTypeArray=[k.CONV_AT_ALL_AT_ME]),t.atTypeArray.indexOf(k.CONV_AT_ALL)>-1&&e.groupAtType.indexOf(k.CONV_AT_ME)>-1&&(t.atTypeArray=[k.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),i=!0)})),i}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence,n=e.time;return this.type===k.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===k.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),_a=function(){function e(t){r(this,e),this._conversationModule=t,this._n="MessageRemindHandler",this._updateSequence=0}return a(e,[{key:"getC2CMessageRemindType",value:function(){var e=this,t="".concat(this._n,".getC2CMessageRemindType");return this._conversationModule.request({protocolName:Ei,updateSequence:this._updateSequence}).then((function(n){Be.l("".concat(t," ok"));var i=n.data,r=i.updateSequence,o=i.muteFlagList;e._updateSequence=r,e._patchC2CMessageRemindType(o)})).catch((function(e){Be.e("".concat(t," failed. error:"),e)}))}},{key:"_patchC2CMessageRemindType",value:function(e){var t=this,n=0,i="";ot(e)&&e.length>0&&e.forEach((function(e){var r=e.userID,o=e.muteFlag;0===o?i=k.MSG_REMIND_ACPT_AND_NOTE:1===o?i=k.MSG_REMIND_DISCARD:2===o&&(i=k.MSG_REMIND_ACPT_NOT_NOTE),!0===t._conversationModule.patchMessageRemindType({ID:r,isC2CConversation:!0,messageRemindType:i})&&(n+=1)})),Be.l("".concat(this._n,"._patchC2CMessageRemindType count:").concat(n))}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):ot(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),i=e.groupID,r=e.messageRemindType,o="groupID:".concat(i," messageRemindType:").concat(r),a=new wo("setMessageRemindType");return a.setMessage(o),this._getModule(Un).modifyGroupMemberInfo({groupID:i,messageRemindType:r,userID:this._conversationModule.getMyUserID()}).then((function(){a.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok. ").concat(o));var i=t.onGroupMessageRemindTypeUpdated(e);return t._conversationModule.emitTotalUnreadMessageCountUpdate(),zo(i)})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.messageRemindType,i=this._getModule(xn).getLocalGroupProfile(t);if(i&&(i.selfInfo.messageRemindType=n),bt(t)){var r=t,o=Ft(r),a=this._getModule(Gn).getLocalTopic(o,r);return a&&(a.updateSelfInfo({messageRemindType:n}),this._conversationModule.emitOuterEvent(M.TOPIC_UPDATED,{groupID:o,topic:a})),{topic:a}}return this._conversationModule.patchMessageRemindType({ID:t,isC2CConversation:!1,messageRemindType:n})&&this._emitConversationUpdate(),{group:i}}},{key:"_setC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),i=e.userIDList,r=e.messageRemindType,o=i.slice(0,30),a=0;r===k.MSG_REMIND_DISCARD?a=1:r===k.MSG_REMIND_ACPT_NOT_NOTE&&(a=2);var s="userIDList:".concat(o," messageRemindType:").concat(r),c=new wo("setMessageRemindType");return c.setMessage(s),this._conversationModule.request({protocolName:Si,requestData:{userIDList:o,muteFlag:a}}).then((function(e){c.setNetworkType(t._conversationModule.getNetworkType()).end();var i=e.data,a=i.updateSequence,s=i.errorList;t._updateSequence=a;var u=[],l=[];ot(s)&&s.forEach((function(e){u.push(e.userID),l.push({userID:e.userID,code:e.errorCode})}));var d=o.filter((function(e){return-1===u.indexOf(e)}));Be.l("".concat(n," ok. successUserIDList:").concat(d," failureUserIDList:").concat(JSON.stringify(l)));var h=0;return d.forEach((function(e){t._conversationModule.patchMessageRemindType({ID:e,isC2CConversation:!0,messageRemindType:r})&&(h+=1)})),h>=1&&t._emitConversationUpdate(),o.length=u.length=0,t._conversationModule.emitTotalUnreadMessageCountUpdate(),Jo({successUserIDList:d.map((function(e){return{userID:e}})),failureUserIDList:l})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_getModule",value:function(e){return this._conversationModule.getModule(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"setUpdateSequence",value:function(e){this._updateSequence=e}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._updateSequence=0}}]),e}(),va=function(){function e(t){r(this,e),this._conversationModule=t,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=$t.NOT_START}return a(e,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),i=e.conversationIDList,r=e.customData;Be.l("".concat(n," options:"),e);var o=new wo("setConvCustomData");o.setMessage(JSON.stringify(e));var a={fromAccount:this._getMyUserID(),itemList:[]},s=[],c=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(c,e),!0;if(!Mt(e)&&!kt(e))return t._onConversationIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:r};Mt(e)?n.contactItem={type:1,toAccount:e.replace(k.CONV_C2C,"")}:kt(e)&&(n.contactItem={type:2,groupID:e.replace(k.CONV_GROUP,"")}),a.itemList.push(n)})),c.length===i.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:Ui,requestData:a}).then((function(e){o.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var i=e.data.resultItem;if(ot(i)){var a,u,l=!1;i.forEach((function(e){a=t._concatConversationID(e.contactItem),0===e.resultCode?(s.push(a),(u=t._getLocalConversation(a))&&u.customData!==r&&(u.customData=r,l=!0)):c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&t._emitConversationUpdate()}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"markConversation",value:function(e){var t=this;if(!this._conversationModule.canIUse(q.CONV_MARK))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("markConversation"),i=e.conversationIDList,r=e.markType,o=e.enableMark;Be.l("".concat(n," options:"),e);var a=new wo("markConversation");a.setMessage(JSON.stringify(e));var s=void 0,c=void 0,u=this._getFlagBit(r);!0===o?c=[u]:s=[u];var l={fromAccount:this._getMyUserID(),itemList:[]},d=[],h=[];return i.forEach((function(e){if(!t._hasLocalConversation(e))return t._onConversationNotFound(h,e),!0;if(!Mt(e)&&!kt(e))return t._onConversationIDInvalid(h,e),!0;var n={operationType:1,contactItem:void 0,clearMark:s,setMark:c};Mt(e)?n.contactItem={type:1,toAccount:e.replace(k.CONV_C2C,"")}:kt(e)&&(n.contactItem={type:2,groupID:e.replace(k.CONV_GROUP,"")}),l.itemList.push(n)})),h.length===i.length?Jo({successConversationIDList:d,failureConversationIDList:h}):this._conversationModule.request({protocolName:Gi,requestData:l}).then((function(e){a.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var i=e.data.resultItem;if(ot(i)){var s,c,u=!1;i.forEach((function(e){if(s=t._concatConversationID(e.contactItem),0===e.resultCode){if(d.push(s),c=t._getLocalConversation(s)){var n=c.markList.indexOf(r);!0===o?-1===n&&(c.markList.push(r),u=!0):-1!==n&&(c.markList.splice(n,1),u=!0)}}else h.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConversationUpdate()}return zo({successConversationIDList:d,failureConversationIDList:h})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return Be.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===$t.REJECTED?this.getRemoteConvGroupList().then((function(){return zo(y(e._convGroupMap.values()))})):Jo(y(this._convGroupMap.values()))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=$t.PENDING,this._conversationModule.request({protocolName:Hi,requestData:{fromAccount:this._getMyUserID(),startIndex:this._startIndex,startTime:Ue()}}).then((function(n){var i,r,o=n.data,a=o.completeFlag,s=o.contactItem,c=o.nextStartIndex,u=void 0===c?0:c,l=o.groupItem;if(e._startIndex=u,Be.l("".concat(t," completeFlag:").concat(a," nextStartIndex:").concat(u)),ot(l)&&l.forEach((function(t){var n=t.convGroupID,i=t.groupName;e._convGroupMap.set(n,i)})),ot(s)&&s.forEach((function(t){var n=t.standardMark,o=t.customData,a=t.convGroupIDList;if(i=e._concatConversationID(t),(r=e._getLocalConversation(i))&&(r.markList=qt(n),r.customData=o||"",ot(a))){var s=[];a.forEach((function(t){e._convGroupMap.has(t)&&s.push(e._convGroupMap.get(t))})),r.conversationGroupList=[].concat(s),s.length=0}})),0===a)return e.getRemoteConvGroupList();1===a&&(e._pagingStatus=$t.RESOLVED,e._emitConversationUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=$t.REJECTED,Be.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(q.CONV_GROUP))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("createConvGroup");Be.l("".concat(n," options:"),e);var i=new wo("createConvGroup");i.setMessage(JSON.stringify(e));var r=e.groupName,o=e.conversationIDList,a={fromAccount:this._getMyUserID(),itemList:[{groupName:r,contactItem:[]}]},s=[],c=[];return o.forEach((function(e){return t._hasLocalConversation(e)?Mt(e)||kt(e)?void(Mt(e)?a.itemList[0].contactItem.push({type:1,toAccount:e.replace(k.CONV_C2C,"")}):kt(e)&&a.itemList[0].contactItem.push({type:2,groupID:e.replace(k.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===o.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:Vi,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var o=e.data.groupResultItem[0],a=o.groupItem,u=o.resultItem;if(rt(a)&&(t._convGroupMap.set(a.convGroupID,a.groupName),t._emitConvGroupListUpdate()),ot(u)){var l,d,h=!1;u.forEach((function(e){l=t._concatConversationID(e.contactItem),0===e.resultCode?(s.push(l),(d=t._getLocalConversation(l))&&-1===d.conversationGroupList.indexOf(r)&&(d.conversationGroupList.push(r),h=!0)):c.push({conversationID:l,code:e.resultCode,message:e.resultInfo})})),!0===h&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(q.CONV_GROUP))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvGroup");Be.l("".concat(n," groupName:").concat(e));var i=new wo("deleteConvGroup");return i.setMessage(e),this._conversationModule.request({protocolName:Fi,requestData:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(r){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var o=r.data.groupItem;if(ot(o)){var a=!1;o.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),a=!0)})),!0===a&&t._emitConvGroupListUpdate()}t._eraseFromConversationGroupList([e])})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(q.CONV_GROUP))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("renameConvGroup");Be.l("".concat(n," options:"),e);var i=new wo("renameConvGroup");i.setMessage(JSON.stringify(e));var r=e.oldName,o=e.newName;return this._conversationModule.request({protocolName:Bi,requestData:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:r,newName:o}}}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var a=e.data.updateGroupResult.convGroupID;t._convGroupMap.set(a,o),t._emitConvGroupListUpdate();var s,c,u=t._conversationModule.getLocalConversationList(),l=!1;u.forEach((function(e){s=e.conversationGroupList,-1!==(c=s.indexOf(r))&&(s.splice(c,1,o),l=!0)})),!0===l&&t._emitConversationUpdate()})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(q.CONV_GROUP))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("addConvsToGroup");Be.l("".concat(n," options:"),e);var i=new wo("addConvsToGroup");i.setMessage(JSON.stringify(e));var r=e.conversationIDList,o=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:o,updateItem:[]}},s=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?Mt(e)||kt(e)?void(Mt(e)?a.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(k.CONV_C2C,"")}}):kt(e)&&a.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(k.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:ji,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(ot(r)){var a,u,l=!1;r.forEach((function(e){a=t._concatConversationID(e.contactItem),0===e.resultCode?(u=t._getLocalConversation(a))&&-1===u.conversationGroupList.indexOf(o)&&(u.conversationGroupList.push(o),s.push(a),l=!0):c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(o))}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this;if(!this._conversationModule.canIUse(q.CONV_GROUP))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("deleteConvsFromGroup");Be.l("".concat(n," options:"),e);var i=new wo("deleteConvsFromGroup");i.setMessage(JSON.stringify(e));var r=e.conversationIDList,o=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:o,updateItem:[]}},s=[],c=[];return r.forEach((function(e){return t._hasLocalConversation(e)?Mt(e)||kt(e)?void(Mt(e)?a.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(k.CONV_C2C,"")}}):kt(e)&&a.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(k.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,e),!0):(t._onConversationNotFound(c,e),!0)})),c.length===r.length?Jo({successConversationIDList:s,failureConversationIDList:c}):this._conversationModule.request({protocolName:qi,requestData:a}).then((function(e){i.setNetworkType(t._conversationModule.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=e.data.updateGroupResult.contactResultItem;if(ot(r)){var a,u,l=!1;r.forEach((function(e){if(a=t._concatConversationID(e.contactItem),0===e.resultCode){if(u=t._getLocalConversation(a)){var n=u.conversationGroupList.indexOf(o);-1!==n&&(u.conversationGroupList.splice(n,1),s.push(a),l=!0)}}else c.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(o))}return zo({successConversationIDList:s,failureConversationIDList:c})})).catch((function(e){return t._conversationModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t=this;if(!Yt(e)){var n,i;Be.d("".concat(this._n,".onConvMarkUpdated markItemList:"),e);var r=!1;e.forEach((function(e){var o=e.recentContactItem,a=e.optType,s=e.standardMark,c=e.customMark;if(n=t._concatConversationID(o),i=t._getLocalConversation(n))if(1===a){var u=qt(s);!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(i.markList,u)&&(i.markList=u,r=!0)}else 2===a&&i.customData!==c&&void 0!==c&&(i.customData=c,r=!0)})),!0===r&&this._emitConversationUpdate()}}},{key:"onConvGroupCreated",value:function(e){var t=this;Be.d("".concat(this._n,".onConvGroupCreated resultList:"),e);var n=!1,i=!1;ot(e)&&(e.forEach((function(e){var r=e.msgGroupItem,o=r.groupID,a=r.groupName;t._convGroupMap.get(o)!==a&&(t._convGroupMap.set(o,a),i=!0);var s,c,u=e.msgRecentContactItem;ot(u)&&u.forEach((function(e){s=t._concatConversationID(e),(c=t._getLocalConversation(s))&&-1===c.conversationGroupList.indexOf(a)&&(c.conversationGroupList.push(a),n=!0)}))})),!0===n&&this._emitConversationUpdate(),!0===i&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t=this;Be.d("".concat(this._n,".onConvGroupDeleted groupItemList:"),e);var n=[];if(ot(e)){var i=!1;e.forEach((function(e){var r=e.groupID,o=e.groupName;t._convGroupMap.has(r)&&(t._convGroupMap.delete(r),i=!0,n.push(o))})),!0===i&&this._emitConvGroupListUpdate()}this._eraseFromConversationGroupList(n)}},{key:"_eraseFromConversationGroupList",value:function(e){Yt(e)||(this._conversationModule.getLocalConversationList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Be.d("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t=e.groupID,n=e.groupName,i=e.oldGroupName;if(this._convGroupMap.get(t)!==n){this._convGroupMap.set(t,n),this._emitConvGroupListUpdate();var r,o,a=this._conversationModule.getLocalConversationList(),s=!1;a.forEach((function(e){r=e.conversationGroupList,-1!==(o=r.indexOf(i))&&(r.splice(o,1,n),s=!0)})),!0===s&&this._emitConversationUpdate()}}},{key:"onConvInGroupUpdated",value:function(e){var t=this;Be.d("".concat(this._n,".onConvInGroupUpdated options:"),e);var n=e.oldGroupName,i=e.recentContactUpdateGroupItem;if(ot(i)){var r,o,a,s=!1;i.forEach((function(e){var i=e.contactOptType,c=e.recentContactItem;r=t._concatConversationID(c),(o=t._getLocalConversation(r))&&(a=o.conversationGroupList.indexOf(n),1===i?-1===a&&(o.conversationGroupList.push(n),s=!0):2===i&&-1!==a&&(o.conversationGroupList.splice(a,1),s=!0))})),!0===s&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(n))}}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t=this;Be.d("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e);var n=e.msgRecentContactItem,i=e.msgRecentContactUpdateContactItem,r=this._concatConversationID(n),o=this._getLocalConversation(r);if(o&&ot(i)){var a,s=!1;i.forEach((function(e){var n=e.groupOptType,i=e.recentContactGroupItem.groupName;a=o.conversationGroupList.indexOf(i),1===n?-1===a&&(o.conversationGroupList.push(i),s=!0):2===n&&-1!==a&&(o.conversationGroupList.splice(a,1),s=!0),!0===s&&t._emitConvInGroupUpdate(i)})),!0===s&&this._emitConversationUpdate()}}},{key:"onConvGroupListSynced",value:function(e){var t=this;ot(e)&&0!==e.length&&(Be.l("".concat(this._n,".onConvGroupListSynced groupItemList:"),e),e.forEach((function(e){t._convGroupMap.set(e.convGroupID,e.groupName)})))}},{key:"getConvGroupListByID",value:function(e){var t=this;if(!Yt(e)){var n=[];return e.forEach((function(e){t._convGroupMap.has(e)&&n.push(t._convGroupMap.get(e))})),n}}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:po.CONVERSATION_NOT_FOUND,message:this._conversationModule.getErrorMessage(po.CONVERSATION_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:po.INVALID_CONVERSATION_ID,message:this._conversationModule.getErrorMessage(po.INVALID_CONVERSATION_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,i=n-1;i>=0;i--)if("1"===t[i])return n-i-1}},{key:"_concatConversationID",value:function(e){var t,n=e.type,i=e.to,r=e.groupID,o=e.userID;return 1===n?at(o)?at(i)||(t="".concat(k.CONV_C2C).concat(i)):t="".concat(k.CONV_C2C).concat(o):2===n&&(t="".concat(k.CONV_GROUP).concat(r)),t}},{key:"_getMyUserID",value:function(){return this._conversationModule.getMyUserID()}},{key:"_insertConversationGroup",value:function(e,t){var n=this._getLocalConversation(e);if(n){var i=n.conversationGroupList;-1===i.indexOf(t)&&i.push(t)}}},{key:"_getLocalConversation",value:function(e){return this._conversationModule.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._conversationModule.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._conversationModule.emitOuterEvent(M.CONVERSATION_GROUP_LIST_UPDATED,y(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._conversationModule.getLocalConversationList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._conversationModule.emitOuterEvent(M.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=$t.NOT_START}}]),e}(),ma=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="ConversationModule",na.mixin(g(t)),t._messageListHandler=new Qo,t._messageRemindHandler=new _a(g(t)),t._convGroupHandler=new va(g(t)),t.singlyLinkedList=new da(100),t._pagingStatus=$t.NOT_START,t._pagingTimeStamp=0,t._pagingStartIndex=0,t._pagingPinnedTimeStamp=0,t._pagingPinnedStartIndex=0,t._pagingConvIDMap=new Map,t._convIDFromUnreadDBMap=new Map,t._conversationMap=new Map,t._tmpGroupList=[],t._tmpGroupAtTipsList=[],t._peerReadTimeMap=new Map,t._completedMap=new Map,t._roamingMessageKeyAndTimeMap=new Map,t._roamingMessageSequenceMap=new Map,t._remoteGroupReadSequenceMap=new Map,t._convTotalUnreadCount=0,t._pagingGetCostList=[],t._initListeners(),t}return a(i,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on($o,this._initLocalConversationList,this),e.on(ta,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_initLocalConversationList",value:function(){var e=this,t=new wo("_initLocalConversationList");Be.l("".concat(this._n,".").concat("_initLocalConversationList"));var n="",i=this._getStorageConversationList(),r=this.isIntl();if(i){for(var o=i.length,a=0;a<o;a++){var s=i[a];if(s){if(s.conversationID==="".concat(k.CONV_C2C,"@TLS#ERROR")||s.conversationID==="".concat(k.CONV_C2C,"@TLS#NOT_FOUND"))continue;if(s.groupProfile){var c=s.groupProfile.type;if(St(c))continue}}this._conversationMap.set(i[a].conversationID,new ga(i[a],r))}this.emitConversationUpdate(!0,!1),n="count:".concat(o)}else n="count:0";t.setNetworkType(this.getNetworkType()).setMessage(n).end(),this.getModule(Nn)||this.triggerReady(),this.ready((function(){e._tmpGroupList.length>0&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConversationList()}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,i=e.isInstantMessage,r=void 0===i||i,o=e.isUnreadC2CMessage,a=void 0!==o&&o,s=e.updateUnreadCount,c=void 0===s||s;this._isReady?0!==n.length&&(this._getC2CPeerReadTime(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:r,isUnreadC2CMessage:a,isFromGetConversations:!1,updateUnreadCount:c}),r||(this._convIDFromUnreadDBMap=new Map([].concat(y(this._convIDFromUnreadDBMap),y(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConversation()),this._setStorageConversationList(),n.filter((function(e){return e.type===k.CONV_TOPIC})).length>0||this.emitConversationUpdate()):this.ready((function(){t._onSendOrReceiveMessage(e)}))}},{key:"updateConversationGroupProfile",value:function(e){var t=this;if(!ot(e)||0!==e.length)if(0!==this._conversationMap.size){var n=!1;e.forEach((function(e){var i="GROUP".concat(e.groupID);if(t._conversationMap.has(i)){n=!0;var r=t._conversationMap.get(i);r.groupProfile=JSON.parse(JSON.stringify(e)),r.lastMessage.lastSequence<e.nextMessageSeq&&(r.lastMessage.lastSequence=e.nextMessageSeq-1),r.subType||(r.subType=e.type)}})),n&&this.emitConversationUpdate(!0,!1)}else this._tmpGroupList=e}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach((function(e){var n="C2C".concat(e.userID);t._conversationMap.has(n)&&(t._conversationMap.get(n).userProfile=e)})),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=!1,r=[];e.forEach((function(e){(n=t._conversationMap.get(e.conversationID))&&(n.type===k.CONV_TOPIC?r.push(e):(n.reduceUnreadCount()&&(i=!0),n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),i=!0)))})),this.getModule(Gn).onMessageRevoked(r),i&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())}}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,i=e.sequence,r=e.time,o=this._conversationMap.get(n);return o&&(t=o.type===k.CONV_TOPIC?this.getModule(Gn).isLastMessageRevoked({topicID:n.replace(k.CONV_GROUP,""),sequence:i}):o.isLastMessageRevoked({sequence:i,time:r})),Be.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._messageListHandler.getLocalMessage(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)}));for(var i=e[0].conversationID,r=this._messageListHandler.getLocalMessageList(i),o={},a=r.length-1;a>=0;a--)if(!r[a].isDeleted){o=r[a];break}var s=this._conversationMap.get(i);if(s){var c=!1;s.lastMessage.lastSequence===o.sequence&&s.lastMessage.lastTime===o.time||(Yt(o)&&(o=void 0),s.updateLastMessage(o),s.type!==k.CONV_TOPIC&&(c=!0),Be.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(i," with lastMessage:"),s.lastMessage)),i.startsWith(k.CONV_C2C)&&this.updateUnreadCount(i),c&&this.emitConversationUpdate(!0,!1)}}}},{key:"onMessageModified",value:function(e){var t=e.conversationType,n=e.from,i=e.to,r=e.time,o=e.sequence,a=e.elements,s=e.cloudCustomData,c=e.messageVersion,u=this.getMyUserID(),l="".concat(t).concat(i);i===u&&t===k.CONV_C2C&&(l="".concat(t).concat(n));var d=this._messageListHandler.onMessageModified(l,e),h=d.isUpdated,p=d.message;!0===h&&this.emitOuterEvent(M.MESSAGE_MODIFIED,[p]);var f=this._isTopicConversation(l);if(Be.l("".concat(this._n,".onMessageModified isUpdated:").concat(h," isTopicMessage:").concat(f," from:").concat(n," to:").concat(i)),f)this.getModule(Gn).onMessageModified(e);else{var g=this._conversationMap.get(l);if(g){var _=g.lastMessage;Be.d("".concat(this._n.onMessageModified," lastMessage:"),JSON.stringify(_),"options:",JSON.stringify(e)),_&&_.lastTime===r&&_.lastSequence===o&&_.version!==c&&(_.type=a[0].type,_.payload=a[0].content,_.messageForShow=Bt(_.type,_.payload,this.isIntl()),_.cloudCustomData=s,_.version=c,this.emitConversationUpdate(!0,!1))}}return p}},{key:"onNewGroupAtTips",value:function(e){var n=this,i=e.dataList,r=null;i.forEach((function(e){e.groupAtTips?r=e.groupAtTips:e.elements?r=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(r=t(t({},e),{},{sync:!0})),r.__random=e.random,r.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(r)})),Be.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e=this;if(0!==this._tmpGroupAtTipsList.length){var t=!1;this._tmpGroupAtTipsList.forEach((function(n){var i=n.groupID,r=n.from,o=n.topicID,a=void 0===o?void 0:o,s=n.sync,c=void 0!==s&&s;if(r!==e.getMyUserID())if(at(a)){var u=e._conversationMap.get("".concat(k.CONV_GROUP).concat(i));u&&(u.updateGroupAtInfoList(n),t=!0)}else{var l=e._conversationMap.get("".concat(k.CONV_GROUP).concat(a));if(l){l.updateGroupAtInfoList(n);var d=e.getModule(Gn),h=l.groupAtInfoList;d.onConversationProxy({topicID:a,groupAtInfoList:h})}Yt(l)&&c&&(e.updateTopicConversation([{conversationID:"".concat(k.CONV_GROUP).concat(a),type:k.CONV_TOPIC}]),e._conversationMap.get("".concat(k.CONV_GROUP).concat(a)).updateGroupAtInfoList(n))}})),t&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0}}},{key:"_getC2CPeerReadTime",value:function(e){var t=this,n=[];if(e.forEach((function(e){t._conversationMap.has(e.conversationID)||e.type!==k.CONV_C2C||n.push(e.conversationID.replace(k.CONV_C2C,""))})),n.length>0){Be.d("".concat(this._n,"._getC2CPeerReadTime userIDList:").concat(n));var i=this.getModule(Nn);i&&i.getRemotePeerReadTime(n)}}},{key:"_getStorageConversationList",value:function(){return this.getModule(Bn).getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().filter((function(e){return e.type===k.CONV_C2C||e.type===k.CONV_GROUP&&e.lastMessage.type!==k.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.getModule(Bn).setItem("conversationMap",e)}},{key:"emitConversationUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversationList();if(t){var i=this.getModule(xn);i&&i.updateGroupLastMessage(n)}e&&this.emitOuterEvent(M.CONVERSATION_LIST_UPDATED)}},{key:"getLocalConversationList",value:function(){return y(this._conversationMap.values()).filter((function(e){return e.type!==k.CONV_TOPIC}))}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=new wo("syncConversationList");return this._pagingStatus===$t.NOT_START&&this._conversationMap.clear(),this._pagingGetConversationList().then((function(n){var i=function(e){if(ot(e)&&0!==e.length){var t=0;return e.forEach((function(e){t+=e})),(t/e.length).toFixed(0)}}(e._pagingGetCostList);return Be.l("".concat(e._n,".").concat("syncConversationList",". sum ").concat(function(e){if(ot(e)&&0!==e.length){var t=0;return e.forEach((function(e){t+=e})),t.toFixed(0)}}(e._pagingGetCostList)," ms, average ").concat(i," ms")),e._pagingGetCostList.length=0,e._pagingStatus=$t.RESOLVED,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e._patchConversationProperties(),t.setMessage(e._conversationMap.size).setMoreMessage(i).setNetworkType(e.getNetworkType()).end(),n})).catch((function(n){return e._pagingStatus=$t.REJECTED,t.setMessage(e._pagingTimeStamp),e.probeNetwork().then((function(e){var i=m(e,2),r=i[0],o=i[1];t.setError(n,r,o).end()})),Zo(n)}))}},{key:"_diffAndDeleteConversation",value:function(){var e=this;if(this._isSyncCompleted()){var t=[];this._conversationMap.forEach((function(n,i){!e._pagingConvIDMap.has(i)&&e._convIDFromUnreadDBMap.has(i)&&(e._conversationMap.delete(i),t.push(i))})),Be.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(t))}}},{key:"_patchConversationProperties",value:function(){var e=this,t=Date.now(),n=this.checkAndPatchRemark(),i=this._messageRemindHandler.getC2CMessageRemindType(),r=this.getModule(xn).getGroupList();Promise.all([n,i,r]).then((function(){var n=Date.now()-t;Be.l("".concat(e._n,"._patchConversationProperties ok. cost ").concat(n," ms")),e.emitConversationUpdate(!0,!1),e.emitTotalUnreadMessageCountUpdate()}))}},{key:"_pagingGetConversationList",value:function(){var e=this,t="".concat(this._n,"._pagingGetConversationList");Be.l("".concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex));var n=Date.now();return this._pagingStatus=$t.PENDING,this.request({protocolName:Ri,requestData:{fromAccount:this.getMyUserID(),timeStamp:this._pagingTimeStamp,startIndex:this._pagingStartIndex,pinnedTimeStamp:this._pagingPinnedTimeStamp,pinnedStartIndex:this._pagingPinnedStartIndex,orderType:1}}).then((function(i){var r=i.data,o=r.completeFlag,a=r.conversations,s=void 0===a?[]:a,c=r.timeStamp,u=r.startIndex,l=r.pinnedTimeStamp,d=r.pinnedStartIndex,h=r.groupItem,p=Date.now()-n;if(e._pagingGetCostList.push(p),Be.l("".concat(t," ok. completeFlag:").concat(o," count:").concat(s.length," cost ").concat(p," ms")),e._convGroupHandler.onConvGroupListSynced(h),s.length>0){var f=e._getConversationOptions(s);e._pagingConvIDMap=new Map([].concat(y(e._pagingConvIDMap),y(f.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConversationList({conversationOptionsList:f,isFromGetConversations:!0}),e.isLoggedIn()&&e.emitConversationUpdate()}if(!e._isReady){if(!e.isLoggedIn())return Jo();e.triggerReady()}return e._pagingTimeStamp=c,e._pagingStartIndex=u,e._pagingPinnedTimeStamp=l,e._pagingPinnedStartIndex=d,1!==o?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Jo())})).catch((function(n){throw e.isLoggedIn()&&(e._isReady||(Be.w("".concat(t," failed. error:"),n),e.triggerReady())),n}))}},{key:"_updateLocalConversationList",value:function(e){var t,n=e.isFromGetConversations,i=e.isInstantMessage,r=Date.now();t=this._getTmpConversationListMapping(e),this._conversationMap=new Map(this._sortConversationList([].concat(y(t.toBeUpdatedConversationList),y(this._conversationMap)))),n||(this._updateUserOrGroupProfile(t.newConversationList),i&&this.emitTotalUnreadMessageCountUpdate()),Be.d("".concat(this._n,"._updateLocalConversationList cost ").concat(Date.now()-r," ms"))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,i=e.isInstantMessage,r=e.isUnreadC2CMessage,o=void 0!==r&&r,a=e.updateUnreadCount,s=[],c=[],u=this.getModule(xn),l=this.getModule(Pn),d=this.isIntl(),h=0,p=t.length;h<p;h++){var f=new ga(t[h],d),g=f.conversationID;if(g!=="".concat(k.CONV_C2C,"@TLS#ERROR")&&g!=="".concat(k.CONV_C2C,"@TLS#NOT_FOUND"))if(this._conversationMap.has(g)){var _=this._conversationMap.get(g),v=["unreadCount","allowType","adminForbidType","payload","isPinned"];!1===i&&v.push("lastMessage");var m=t[h].lastMessage,y=!at(m);y||t[h].type===k.CONV_TOPIC||this._onLastMessageNotExist(t[h]),at(i)&&y&&null===_.lastMessage.payload&&(_.lastMessage.payload=m.payload),Yt(_.lastMessage.revoker)||(_.lastMessage.revoker=null),ht(_,f,v,[null,void 0,"",0,NaN]),!0===a&&_.updateUnreadCount({nextUnreadCount:f.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:o}),i&&y&&(m.payload&&(_.lastMessage.payload=m.payload),_.type===k.CONV_GROUP&&(_.lastMessage.nameCard=m.nameCard,_.lastMessage.nick=m.nick)),y&&_.lastMessage.cloudCustomData!==m.cloudCustomData&&(_.lastMessage.cloudCustomData=m.cloudCustomData||""),this._conversationMap.delete(g),s.push([g,_])}else{if(f.type===k.CONV_GROUP&&u){var I=f.groupProfile.groupID,T=u.getLocalGroupProfile(I);T&&(f.groupProfile=T,!0===a&&f.updateUnreadCount({nextUnreadCount:0}))}else if(f.type===k.CONV_C2C){var C=g.replace(k.CONV_C2C,"");l&&l.isMyFriend(C)&&(f.remark=l.getFriendRemark(C))}c.push(f),s.push([g,f])}}var S=this.getModule(Gn);return s.forEach((function(e){if(e[1].type===k.CONV_TOPIC){var t=e[1],n=t.conversationID,i=t.unreadCount,r=t.groupAtInfoList;S.onConversationProxy({topicID:n.replace(k.CONV_GROUP,""),unreadCount:i,groupAtInfoList:Yt(r)?void 0:r})}})),{toBeUpdatedConversationList:s,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new wo("lastMessageNotExist").setMessage("".concat(JSON.stringify(e))).setNetworkType(this.getNetworkType()).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],i=[],r=[];return e.forEach((function(e){!0===e[1].isPinned?Yt(e[1].lastMessage.lastTime)?n.push(e):t.push(e):Yt(e[1].lastMessage.lastTime)?r.push(e):i.push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(i.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(r)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(y(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t=this;if(0!==e.length){var n=[],i=[],r=this.getModule(On),o=this.getModule(xn);e.forEach((function(e){if(e.type===k.CONV_C2C)n.push(e.toAccount);else if(e.type===k.CONV_GROUP){var t=e.toAccount;o.hasLocalGroup(t)?e.groupProfile=o.getLocalGroupProfile(t):i.push(t)}})),Be.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(n," groupIDList:").concat(i)),n.length>0&&r.getUserProfile({userIDList:n}).then((function(e){var n=e.data;ot(n)?n.forEach((function(e){t._doUpdateUserProfile("C2C".concat(e.userID),e)})):t._doUpdateUserProfile("C2C".concat(n.userID),n)})),i.length>0&&o.getGroupProfileAdvance({groupIDList:i,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e.data.successGroupList.forEach((function(e){var n="GROUP".concat(e.groupID);if(t._conversationMap.has(n)){var i=t._conversationMap.get(n);ht(i.groupProfile,e,[],[null,void 0,"",0,NaN]),!i.subType&&e.type&&(i.subType=e.type)}}))}))}}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t)}},{key:"_getConversationOptions",value:function(e){var n=this,i=[],r=e.filter((function(e){var t=e.type,n=e.userID;return 1===t&&"@TLS#NOT_FOUND"!==n&&"@TLS#ERROR"!==n||2===t})),o=this.getMyUserID(),a=r.map((function(e){if(at(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type){var r={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar};return i.push(r),{conversationID:"C2C".concat(e.userID),type:"C2C",lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProperty(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===o&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},userProfile:new ua(r),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,messageRemindType:"",customData:e.customMark||"",markList:qt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}return{conversationID:"GROUP".concat(e.groupID),type:"GROUP",lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount,messageForShow:e.messageShow},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new pa({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage}),unreadCount:e.unreadCount,peerReadTime:0,isPinned:1===e.isPinned,messageRemindType:"",version:0,customData:e.customMark||"",markList:qt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId)}}));return i.length>0&&this.getModule(On).onConversationsProfileUpdated(i),a}},{key:"_patchTypeAndPayload",value:function(e){var n=e.lastMsg,i=n.event,r=void 0===i?void 0:i,o=n.elements,a=void 0===o?[]:o,s=n.groupTips,c=void 0===s?{}:s;if(!at(r)&&!Yt(c)){var u=new Ho(c);u.setElement({type:k.MSG_GRP_TIP,content:t(t({},c.elements),{},{groupProfile:c.groupProfile})});var l=JSON.parse(JSON.stringify(u.payload));return u=null,{type:k.MSG_GRP_TIP,payload:l}}return{type:a[0]?a[0].type:null,payload:a[0]?this._amendLayersOverLimitProperty(a[0].content):null}}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof Ho&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){if(ot(e)){var t=e.map((function(e){var t=e.type,n=e.userID,i=e.groupID;return 1===t?"".concat(k.CONV_C2C).concat(n):2===t?"".concat(k.CONV_GROUP).concat(i):void 0}));Be.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(t)),this.deleteLocalConversationList(t)}}},{key:"onConversationPinned",value:function(e){var t=this;if(ot(e)){var n=!1;e.forEach((function(e){var i,r=e.type,o=e.userID,a=e.groupID;1===r?i=t.getLocalConversation("".concat(k.CONV_C2C).concat(o)):2===r&&(i=t.getLocalConversation("".concat(k.CONV_GROUP).concat(a))),i&&(Be.l("".concat(t._n,".onConversationPinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned||(i.isPinned=!0,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"onConversationUnpinned",value:function(e){var t=this;if(ot(e)){var n=!1;e.forEach((function(e){var i,r=e.type,o=e.userID,a=e.groupID;1===r?i=t.getLocalConversation("".concat(k.CONV_C2C).concat(o)):2===r&&(i=t.getLocalConversation("".concat(k.CONV_GROUP).concat(a))),i&&(Be.l("".concat(t._n,".onConversationUnpinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned&&(i.isPinned=!1,n=!0))})),n&&this._sortConversationListAndEmitEvent()}}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,i=e.nextReqMessageID,r=e.count,o="".concat(this._n,".getMessageList"),a=this.getLocalConversation(n),s="";if(a&&a.groupProfile&&(s=a.groupProfile.type),St(s))return Be.l("".concat(o," not available in avchatroom. conversationID:").concat(n)),Jo({messageList:[],nextReqMessageID:"",isCompleted:!0});(at(r)||r>15)&&(r=15),!i&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var c=this._computeRemainingCount({conversationID:n,nextReqMessageID:i}),u=this._completedMap.has(n);if(Be.l("".concat(o," conversationID:").concat(n," nextReqMessageID:").concat(i)+" remainingCount:".concat(c," count:").concat(r," isCompleted:").concat(u)),this._needGetHistory({conversationID:n,remainingCount:c,count:r}))return this.getHistoryMessages({conversationID:n,nextReqMessageID:i,count:20}).then((function(e){var i=e.nextReqID,r=e.storedMessageList,a=t._completedMap.has(n),s=r;c>0&&(s=t._messageListHandler.getLocalMessageList(n).slice(0,r.length+c));var u={nextReqMessageID:a?"":i,messageList:s,isCompleted:a};return Be.l("".concat(o," ret.nextReqMessageID:").concat(u.nextReqMessageID," ret.isCompleted:").concat(u.isCompleted," ret.length:").concat(s.length)),zo(u)}));this.modifyMessageList(n);var l=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:i,count:r});return Jo(l)}},{key:"_getMessageListFromMemory",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=e.count,r="".concat(this._n,"._getMessageListFromMemory"),o=this._messageListHandler.getLocalMessageList(t),a=o.length,s=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(s=o.findIndex((function(e){return e.ID===n})))>i?(c.messageList=o.slice(s-i,s),c.nextReqMessageID=o[s-i].ID):(c.messageList=o.slice(0,s),c.isCompleted=!0):a>i?(s=a-i,c.messageList=o.slice(s,a),c.nextReqMessageID=o[s].ID):(c.messageList=o.slice(0,a),c.isCompleted=!0),Be.l("".concat(r," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(e){var t=e.conversationID,n=e.sequence,i=e.time,r=e.count,o=e.direction,a=void 0===o?0:o;if((at(r)||r>15)&&(r=15),t.startsWith(k.CONV_C2C)){var s=this.getModule(Nn),c=t.replace(k.CONV_C2C,"");return s.getRoamingMessagesHopping({peerAccount:c,time:i,count:r,direction:a})}if(t.startsWith(k.CONV_GROUP)){var u=this.getModule(xn),l=t.replace(k.CONV_GROUP,"");return u.getRoamingMessagesHopping({groupID:l,sequence:n,count:r,direction:a})}}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,i=this._messageListHandler.getLocalMessageList(t),r=i.length;if(!n)return r;var o=0;return Mt(t)?o=i.findIndex((function(e){return e.ID===n})):kt(t)&&(o=-1!==n.indexOf("-")?i.findIndex((function(e){return e.ID===n})):i.findIndex((function(e){return e.sequence===n}))),-1===o&&(o=0),o}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,i=e.count,r=this.getLocalConversation(t),o="";return r&&r.groupProfile&&(o=r.groupProfile.type),!wt(t)&&!St(o)&&!(kt(t)&&this._isPagingGetGroupListCompleted()&&this._getLocalGroupCount()<=4e3&&!this._hasLocalGroup(t)&&!this._isTopicConversation(t))&&n<=i&&!this._completedMap.has(t)}},{key:"_isTopicConversation",value:function(e){var t=e.replace(k.CONV_GROUP,"");return bt(t)}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(t===k.CONV_SYSTEM)return Jo();var i=15;n>20&&(i=20);var r=null;if(Mt(t)){var o=this._roamingMessageKeyAndTimeMap.has(t);return(r=this.getModule(Nn))?r.getRoamingMessage({conversationID:t,peerAccount:t.replace(k.CONV_C2C,""),count:i,lastMessageTime:o?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:o?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):Zo({code:po.CANNOT_FIND_MODULE})}if(kt(t)){if(!(r=this.getModule(xn)))return Zo({code:po.CANNOT_FIND_MODULE});var a=null;this._conversationMap.has(t)&&(a=this._conversationMap.get(t).lastMessage);var s=0;a&&(s=a.lastSequence);var c=this._roamingMessageSequenceMap.get(t);return r.getRoamingMessage({conversationID:t,groupID:t.replace(k.CONV_GROUP,""),count:i,sequence:c||s})}return Jo()}},{key:"patchConversationLastMessage",value:function(e){var t=this.getLocalConversation(e);if(t){var n=t.lastMessage,i=n.messageForShow,r=n.payload;if(Yt(i)||Yt(r)){var o=this._messageListHandler.getLocalMessageList(e);if(0===o.length)return;var a=o[o.length-1];Be.l("".concat(this._n,".patchConversationLastMessage conversationID:").concat(e," payload:"),a.payload),t.updateLastMessage(a)}}}},{key:"onRoamingMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n.startsWith(k.CONV_C2C)?k.CONV_C2C:k.CONV_GROUP,o=null,a=[],s=[],c=0,u=e.length,l=null,d=r===k.CONV_GROUP,h=this.getModule(Hn),p=this.getFileDownloadProxy(),f=function(){c=d?e.length-1:0,u=d?0:e.length},g=function(){d?--c:++c},_=function(){return d?c>=u:c<u};for(f();_();g())if(d&&1===e[c].sequence&&i&&this.setCompleted(n),1!==e[c].isPlaceMessage)if((o=new Ho(e[c])).to=e[c].to,r!==k.CONV_GROUP||at(e[c].topicID)||(o.to=e[c].topicID),o.isSystemMessage=!!e[c].isSystemMessage,o.conversationType=r,4===e[c].event?l={type:k.MSG_GRP_TIP,content:t(t({},e[c].elements),{},{groupProfile:e[c].groupProfile})}:(e[c].elements=h.parseElements(e[c].elements,e[c].from),l=e[c].elements),d||o.setNickAndAvatar({nick:e[c].nick,avatar:e[c].avatar}),Yt(l)){var v=new wo("emptyMessageBody");v.setMessage("from:".concat(o.from," to:").concat(o.to," sequence:").concat(o.sequence," event:").concat(e[c].event)),v.setNetworkType(this.getNetworkType()).setLevel("warning").end()}else o.setElement(l,p),o.reInitialize(this.getMyUserID()),a.push(o);return f=g=_=null,i?(this._messageListHandler.unshift(a,s),a=null,s):(s=null,a)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;if(e.startsWith(k.CONV_GROUP)&&this._isTopicConversation(e)){var n=Ft(e.replace(k.CONV_GROUP,""));this.getModule(xn).hasLocalGroup(n)||(t=!0)}return t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;Et({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach((function(e){t._messageListHandler.removeByConversationID(e),t._completedMap.delete(e),t._roamingMessageSequenceMap.delete(e)}))}},{key:"deleteGroupRomaingMessageInfo",value:function(e){var t="".concat(k.CONV_GROUP).concat(e);this._messageListHandler.removeByConversationID(t),this._completedMap.delete(t),this._roamingMessageSequenceMap.delete(t)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(Be.l("".concat(this._n,".setMessageRead conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return Jo();if(n.type!==k.CONV_GROUP&&n.type!==k.CONV_TOPIC||Yt(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return Jo();if(n.type===k.CONV_GROUP&&!this._hasLocalGroup(t))return 0!==n.unreadCount&&(n.unreadCount=0,this.emitConversationUpdate(!0,!1)),Jo();var i=this._messageListHandler.getLocalLastMessage(t),r=n.lastMessage.lastTime;i&&r<i.time&&(r=i.time);var o=n.lastMessage.lastSequence;if(i&&o<i.sequence&&(o=i.sequence),n.type===k.CONV_TOPIC&&at(i)){var a=this.getModule(Gn),s=t.replace(k.CONV_GROUP,""),c=Ft(s),u=a.getLocalTopic(c,s);u&&(o=u.nextMessageSeq-1)}var l=null;switch(n.type){case k.CONV_C2C:return(l=this.getModule(Nn))?l.setMessageRead({conversationID:t,lastMessageTime:r}):Zo({code:po.CANNOT_FIND_MODULE});case k.CONV_GROUP:case k.CONV_TOPIC:return(l=this.getModule(xn))?l.setMessageRead({conversationID:t,lastMessageSeq:o}):Zo({code:po.CANNOT_FIND_MODULE});case k.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),Jo();default:return Jo()}}},{key:"setAllMessageRead",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",i="".concat(this._n,".").concat(n);t.scope||(t.scope=k.READ_ALL_MSG),Be.l("".concat(i," options:"),t);var r=this._createSetAllMessageReadPack(t);if(0===r.readAllC2CMessage&&0===r.groupMessageReadInfoList.length)return Jo();var o=new wo(n);return this.request({protocolName:ar,requestData:r}).then((function(n){var i=n.data,r=e._handleAllMessageRead(i);return o.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(r))).setNetworkType(e.getNetworkType()).end(),Jo()})).catch((function(t){return e.probeNetwork().then((function(e){var n=m(e,2),i=n[0],r=n[1];o.setError(t,i,r).end()})),Be.w("".concat(i," failed. error:"),t),Zo({code:t&&t.code?t.code:po.MESSAGE_UNREAD_ALL_FAIL,message:t&&t.message?t.message:void 0})}))}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastSequence;return t&&n<t.sequence&&(n=t.sequence),n}},{key:"_getConversationLastMessageTime",value:function(e){var t=this._messageListHandler.getLocalLastMessage(e.conversationID),n=e.lastMessage.lastTime;return t&&n<t.time&&(n=t.time),n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},i=e.scope,r=b(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var o=m(t.value,2)[1];if(o.unreadCount>0)if(o.type===k.CONV_C2C&&0===n.readAllC2CMessage){if(i===k.READ_ALL_MSG)n.readAllC2CMessage=1;else if(i===k.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else if(o.type===k.CONV_GROUP&&(i===k.READ_ALL_GROUP_MSG||i===k.READ_ALL_MSG)){var a=this._getConversationLastMessageSequence(o);n.groupMessageReadInfoList.push({groupID:o.groupProfile.groupID,messageSequence:a})}}}catch(c){r.e(c)}finally{r.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(e){var t=e.groupMessageReadInfoList,n=e.readAllC2CMessage,i=this._parseGroupReadInfo(t);return this._updateAllConversationUnreadCount({readAllC2CMessage:n})>=1&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate()),i}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,i=e.length;n<i;n++){var r=e[n],o=r.groupID,a=r.sequence,s=r.retCode,c=r.lastMessageSeq;at(s)?this._remoteGroupReadSequenceMap.set(o,c):(this._remoteGroupReadSequenceMap.set(o,a),0!==s&&t.push("".concat(o,"-").concat(a,"-").concat(s)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,i=0,r=b(this._conversationMap);try{for(r.s();!(t=r.n()).done;){var o=m(t.value,2),a=o[0],s=o[1];if(s.unreadCount>=1){if(1===n&&s.type===k.CONV_C2C){var c=this._getConversationLastMessageTime(s);this.updateIsReadAfterReadReport({conversationID:a,lastMessageTime:c})}else if(s.type===k.CONV_GROUP){var u=a.replace(k.CONV_GROUP,"");if(this._remoteGroupReadSequenceMap.has(u)){var l=this._remoteGroupReadSequenceMap.get(u),d=this._getConversationLastMessageSequence(s);this.updateIsReadAfterReadReport({conversationID:a,remoteReadSequence:l}),d>=l&&this._remoteGroupReadSequenceMap.delete(u)}}this.updateUnreadCount(a,!1)&&(i+=1)}}}catch(p){r.e(p)}finally{r.f()}return i}},{key:"isRemoteRead",value:function(e){var t=e.conversationID,n=e.sequence,i=t.replace(k.CONV_GROUP,""),r=!1;if(this._remoteGroupReadSequenceMap.has(i)){var o=this._remoteGroupReadSequenceMap.get(i);n<=o&&(r=!0,Be.l("".concat(this._n,".isRemoteRead conversationID:").concat(t," messageSequence:").concat(n," remoteReadSequence:").concat(o))),n>=o+10&&this._remoteGroupReadSequenceMap.delete(i)}return r}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,i=e.lastMessageTime,r=this._messageListHandler.getLocalMessageList(t);if(0!==r.length)for(var o,a=r.length-1;a>=0;a--)if(o=r[a],!(i&&o.time>i||n&&o.sequence>n)){if("in"===o.flow&&o.isRead)break;o.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!1,i=this.getLocalConversation(e),r=this._messageListHandler.getLocalMessageList(e);if(i){var o=i.unreadCount,a=r.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length;if(o!==a&&(i.unreadCount=a,n=!0,Be.l("".concat(this._n,".updateUnreadCount from ").concat(o," to ").concat(a,", conversationID:").concat(e)),!0===t&&(this.emitConversationUpdate(!0,!1),this.emitTotalUnreadMessageCountUpdate())),n&&i.type===k.CONV_TOPIC){var s=i.unreadCount,c=this.getModule(Gn),u=e.replace(k.CONV_GROUP,"");c.onConversationProxy({topicID:u,unreadCount:s})}return n}}},{key:"clearGroupAtInfoList",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalConversation(e);if(n&&n.groupAtInfoList.length>0){if(n.clearGroupAtInfoList(),Be.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),n.type===k.CONV_TOPIC){var i=n.groupAtInfoList,r=this.getModule(Gn),o=e.replace(k.CONV_GROUP,"");r.onConversationProxy({topicID:o,groupAtInfoList:i})}!0===t&&this.emitConversationUpdate(!0,!1)}}},{key:"updateReadReceiptInfo",value:function(e){var t=this,n=e.userID,i=void 0===n?void 0:n,r=e.groupID,o=void 0===r?void 0:r,a=e.readReceiptList;if(!Yt(a)){var s=[];if(at(i)){if(!at(o)){var c="".concat(k.CONV_GROUP).concat(o);a.forEach((function(e){var n=e.tinyID,i=e.clientTime,r=e.random,a=e.readCount,u=e.unreadCount,l="".concat(n,"-").concat(i,"-").concat(r),d=t._messageListHandler.getLocalMessage(c,l),h={groupID:o,messageID:l,readCount:0,unreadCount:0};d&&(et(a)&&(d.readReceiptInfo.readCount=a,h.readCount=a),et(u)&&(d.readReceiptInfo.unreadCount=u,h.unreadCount=u),s.push(h))}))}}else{var u="".concat(k.CONV_C2C).concat(i);a.forEach((function(e){var n=e.tinyID,r=e.clientTime,o=e.random,a="".concat(n,"-").concat(r,"-").concat(o),c=t._messageListHandler.getLocalMessage(u,a);if(c){c.readReceiptInfo.isPeerRead=!0;var l={userID:i,messageID:a,isPeerRead:!0};s.push(l)}}))}s.length>0&&this.emitOuterEvent(M.MESSAGE_READ_RECEIPT_RECEIVED,s)}}},{key:"recomputeGroupUnreadCount",value:function(e){var t=e.conversationID,n=e.count,i=this.getLocalConversation(t);if(i){var r=i.unreadCount,o=r-n;o<0&&(o=0),i.unreadCount=o,Be.l("".concat(this._n,".recomputeGroupUnreadCount from ").concat(r," to ").concat(o,", conversationID:").concat(t))}}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!wt(t.type)){for(var i=[],r=0,o=n.length;r<o;r++)"in"!==n[r].flow?"out"!==n[r].flow||n[r].isRead||n[r].setIsRead(!0):i.push(n[r]);var a=0;if(t.type===k.CONV_C2C){var s=i.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length;a=i.length-t.unreadCount-s}else a=i.length-t.unreadCount;for(var c=0;c<a&&!i[c].isRead;c++)i[c].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");Be.l("".concat(n));var i=this._conversationMap.get(e);if(!i)return Promise.resolve();var r=i.groupAtInfoList;if(0===r.length)return Promise.resolve();var o=void 0;e.startsWith(k.CONV_GROUP)&&(o=e.replace(k.CONV_GROUP,""));var a=y(r);if((Et({groupID:o})||bt(o))&&0===(a=r.filter((function(e){return!e.atTypeArray.includes(k.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var s=this.getMyUserID();return this.request({protocolName:Pi,requestData:{messageListToDelete:a.map((function(e){return{from:e.from,to:s,messageSeq:e.__sequence,messageRandom:e.__random,groupID:at(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Be.l("".concat(n," ok. count:").concat(r.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"appendToMessageList",value:function(e){this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n)&&(e.push(t),!0)}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<t&&this._peerReadTimeMap.set(e,t):this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){if(e.startsWith(k.CONV_C2C)&&t>0){var n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t);if(n.length>0&&this.emitOuterEvent(M.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)){var i=this._conversationMap.get(e).lastMessage;Yt(i)||i.fromAccount===this.getMyUserID()&&i.lastTime<=t&&!i.isPeerRead&&(i.isPeerRead=!0,this.emitConversationUpdate(!0,!1))}}}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){Be.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t=this,n="getConversationList",i="".concat(this._n,".").concat(n),r="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);if(Be.l("".concat(i,". ").concat(r)),this._pagingStatus===$t.REJECTED){var o=new wo(n);return o.setMessage(r),this.syncConversationList().then((function(){o.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return zo({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}if(0===this._conversationMap.size){var a=new wo(n);return a.setMessage(r),this.syncConversationList().then((function(){a.setNetworkType(t.getNetworkType()).end();var n=t._getConversationList(e);return zo({conversationList:n,isSyncCompleted:t._isSyncCompleted()})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}var s=this._getConversationList(e);return Be.l("".concat(i,". returned conversation count:").concat(s.length)),Jo({conversationList:s,isSyncCompleted:this._isSyncCompleted()})}},{key:"_getConversationList",value:function(e){if(at(e))return this.getLocalConversationList();if(ot(e))return 0===e.length?[]:this.getLocalConversationList().filter((function(t){return e.includes(t.conversationID)}));if(rt(e)){var t=e.type,n=e.markType,i=e.groupName;return this.getLocalConversationList().filter((function(e){return(t!==k.CONV_C2C&&t!==k.CONV_GROUP||e.type===t)&&(!nt(i)||e.conversationGroupList.includes(i))&&(!et(n)||e.markList.includes(n))}))}return[]}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=b(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2),i=n[0],r=n[1];r.type===k.CONV_C2C&&(Be.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(i," peerReadTime:").concat(r.peerReadTime)),this.recordPeerReadTime(i,r.peerReadTime))}}catch(a){t.e(a)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){return this.getModule(xn).isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){return this.getModule(xn).getLocalGroupList().length}},{key:"_hasLocalGroup",value:function(e){return this.getModule(xn).hasLocalGroup(e.replace(k.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new ga({conversationID:e,type:e.slice(0,3)===k.CONV_C2C?k.CONV_C2C:k.CONV_GROUP},this.isIntl()))._isInfoCompleted||t.type===k.CONV_SYSTEM)return Jo({conversation:t});if(kt(e)&&!this._hasLocalGroup(e))return Jo({conversation:t});var i="".concat(this._n,".").concat("getConversationProfile"),r=new wo("getConversationProfile");return Be.l("".concat(i,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then((function(o){r.setNetworkType(n.getNetworkType()).setMessage("conversationID:".concat(e," unreadCount:").concat(o.data.conversation.unreadCount)).end();var a=n.getModule(Pn);if(a&&t.type===k.CONV_C2C){var s=e.replace(k.CONV_C2C,"");if(a.isMyFriend(s)){var c=a.getFriendRemark(s);t.remark!==c&&(t.remark=c,Be.l("".concat(i,". conversationID:").concat(e," patch remark:").concat(t.remark)))}}return Be.l("".concat(i," ok. conversationID:").concat(e)),o})).catch((function(t){return n.probeNetwork().then((function(n){var i=m(n,2),o=i[0],a=i[1];r.setError(t,o,a).setMessage("conversationID:".concat(e)).end()})),Be.e("".concat(i," failed. error:"),t),Zo(t)}))}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===k.CONV_C2C?this.getModule(On).getUserProfile({userIDList:[e.toAccount]}).then((function(n){var i=n.data;return 0===i.length?Zo(new Ko({code:po.USER_OR_GROUP_NOT_FOUND})):(e.userProfile=i[0],e._isInfoCompleted=!0,t._unshiftConversation(e),Jo({conversation:e}))})):this.getModule(xn).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),Jo({conversation:e})}))}},{key:"_unshiftConversation",value:function(e){e instanceof ga&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(y(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;if(n===t.getMyUserID())t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar});else{var i=t._conversationMap.get("".concat(k.CONV_C2C).concat(n));i&&(i.userProfile=e)}}))}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===$t.RESOLVED}},{key:"_errorLog",value:function(e,t,n,i){var r=new Error("Params validate failed."),o="".concat(this.getErrorMessage("API_REFER")).concat(e);throw Be.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,i),", ").concat(o)),Be.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),r}},{key:"_isValidConversationID",value:function(e){return Mt(e)||kt(e)||wt(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return nt(e)||it(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),nt(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),Be.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(ot(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConversationID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),e.conversationIDList.length>100&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(e){var t=this,n=e.conversationIDList,i=void 0===n?[]:n,r=e.clearHistoryMessage,o=void 0===r||r,a=e.flag,s=void 0===a?0:a,c="".concat(this._n,".").concat("deleteConversationList");Be.l("".concat(c," conversationIDList.length:").concat(i.length," clearHistoryMessage:").concat(o));var u=new wo("deleteConversationList");return u.setMessage("conversationIDList:".concat(i)),Promise.all([this.rmLocalOnlyConversationList(i),this.rmLocalAndRemoteConversationList(i,o)]).then((function(e){u.setNetworkType(t.getNetworkType()).end();var n=[].concat(y(e[0]),y(e[1]));return 0===n.length?Zo(new Ko({code:po.CONVERSATION_NOT_FOUND})):(Be.l("".concat(c," ok")),Jo(1===s?{conversationID:n[0]}:{conversationIDList:n}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Be.e("".concat(c," failed. error:"),e),Zo(e)}))}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter((function(e){if(!t._conversationMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==k.CONV_GROUP||t._hasLocalGroup(e)?n===k.CONV_SYSTEM&&(t.getModule(xn).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(e)}),t.deleteLocalConversation(e),!0):(t.deleteLocalConversation(e),!0)}))}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,i={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){if(n._conversationMap.has(e)){var t=n.getLocalConversation(e).type;t===k.CONV_C2C?i.conversationList.push({toAccount:e.replace(t,""),type:1}):t===k.CONV_GROUP&&n._hasLocalGroup(e)&&i.conversationList.push({toGroupID:e.replace(t,""),type:2})}})),0===i.conversationList.length?[]:this.request({protocolName:Oi,requestData:i}).then((function(e){var t=[];return e.data.resultList.length>0&&e.data.resultList.map((function(e){if(0===e.code){var n=1===e.type?"".concat(k.CONV_C2C).concat(e.to):"".concat(k.CONV_GROUP).concat(e.groupID);t.push(n)}})),n.deleteLocalConversationList(t),t}))}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return Zo({code:po.CONVERSATION_NOT_FOUND});var i=this._conversationMap.get(e).type;if(i===k.CONV_C2C)n.type=1,n.toAccount=e.replace(k.CONV_C2C,"");else{if(i!==k.CONV_GROUP)return i===k.CONV_SYSTEM?(this.getModule(xn).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),Jo({conversationID:e})):Zo({code:po.CONVERSATION_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(k.CONV_GROUP,"")}var r="".concat(this._n,".").concat("clearHistoryMessage"),o=new wo("clearHistoryMessage");return o.setMessage("conversationID:".concat(e)),Be.l("".concat(r,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.request({protocolName:Ni,requestData:n})})).then((function(){o.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(r," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConversationListAndEmitEvent()),Jo({conversationID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(r," failed. error:"),e),Zo(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,i=e.isPinned;if(!this._conversationMap.has(n))return Zo({code:po.CONVERSATION_NOT_FOUND});var r=this.getLocalConversation(n);if(r.isPinned===i)return Jo({conversationID:n});var o="".concat(this._n,".").concat("pinConversation"),a=new wo("pinConversation");a.setMessage("conversationID:".concat(n," isPinned:").concat(i)),Be.l("".concat(o,". conversationID:").concat(n," isPinned:").concat(i));var s=null;return Mt(n)?s={type:1,toAccount:n.replace(k.CONV_C2C,"")}:kt(n)&&(s={type:2,groupID:n.replace(k.CONV_GROUP,"")}),this.request({protocolName:xi,requestData:{fromAccount:this.getMyUserID(),operationType:!0===i?1:2,itemList:[s]}}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(o," ok")),r.isPinned!==i&&(r.isPinned=i,t._sortConversationListAndEmitEvent()),zo({conversationID:n})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(o," failed. error:"),e),Zo(e)}))}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,i=e.messageRemindType,r=!1,o=this.getLocalConversation(n?"".concat(k.CONV_C2C).concat(t):"".concat(k.CONV_GROUP).concat(t));return o&&o.messageRemindType!==i&&(o.messageRemindType=i,r=!0),Be.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(r)),r}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");Be.d(n,e),e.dataList.forEach((function(e){if(!Yt(e.muteNotificationsSync)){var i,r=e.muteNotificationsSync,o=r.to,a=r.updateSequence,s=r.muteFlag;t._messageRemindHandler.setUpdateSequence(a),0===s?i=k.MSG_REMIND_ACPT_AND_NOTE:1===s?i=k.MSG_REMIND_DISCARD:2===s&&(i=k.MSG_REMIND_ACPT_NOT_NOTE);var c=0;t.patchMessageRemindType({ID:o,isC2CConversation:!0,messageRemindType:i})&&(c+=1),Be.l("".concat(n," updateCount:").concat(c)),c>=1&&t.emitConversationUpdate(!0,!1)}}))}},{key:"onGroupMessageRemindTypeSynced",value:function(e){Be.d("".concat(this._n,".onGroupMessageRemindTypeSynced options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._conversationMap.has(e);if(Be.d("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)){var i=!this._isTopicConversation(e);this.emitConversationUpdate(i,!1)}}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=0,i=!1;e.forEach((function(e){t._conversationMap.has(e)&&(n+=t._conversationMap.get(e).unreadCount||0,t.deleteLocalConversation(e,!1),i=!0)})),Be.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(i)),i&&(this.emitConversationUpdate(!0,!1),n>0&&this.emitTotalUnreadMessageCountUpdate())}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){if(e.startsWith(k.CONV_C2C)&&this._conversationMap.has(e)){var t=this._conversationMap.get(e),n=Date.now();this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:t.userProfile.nick,latestAvatar:t.userProfile.avatar});var i=this.getModule(On).getNickAndAvatarByUserID(this.getMyUserID());this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:i.nick,latestAvatar:i.avatar}),Be.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost ").concat(Date.now()-n," ms"))}}},{key:"updateUserProfileSpecifiedKey",value:function(e){Be.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick,i=e.avatar;if(this._conversationMap.has(t)){var r=this._conversationMap.get(t).userProfile;nt(n)&&r.nick!==n&&(r.nick=n),nt(i)&&r.avatar!==i&&(r.avatar=i),this.emitConversationUpdate(!0,!1)}}},{key:"_onMyProfileModified",value:function(e){var n=this,i=this.getLocalConversationList(),r=Date.now();i.forEach((function(i){n.modifyMessageSentByMe(t({conversationID:i.conversationID},e))})),Be.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost ").concat(Date.now()-r," ms"))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random))&&(e.push(t),!0)}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e=Promise.resolve();if(0===this._conversationMap.size)return e;var t=this.getModule(Pn);if(!t)return e;var n=y(this._conversationMap.values()).filter((function(e){return e.type===k.CONV_C2C}));if(0===n.length)return e;var i=0;return n.forEach((function(e){var n=e.conversationID.replace(k.CONV_C2C,"");if(t.isMyFriend(n)){var r=t.getFriendRemark(n);e.remark!==r&&(e.remark=r,i+=1)}})),Be.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(n.length,", patched count:").concat(i)),e}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===k.CONV_C2C?n=this._m.getModule(Nn):t.conversationType===k.CONV_GROUP&&(n=this._m.getModule(xn)),n?n.sendReadReceipt(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===k.CONV_C2C?n=this._m.getModule(Nn):t.conversationType===k.CONV_GROUP&&(n=this._m.getModule(xn)),n?n.getReadReceiptList(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){var t=this.getLocalConversation(e);return t?t.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach((function(e){e.type!==k.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==k.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(Be.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(M.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._pagingStatus=$t.NOT_START,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this.resetReady()}}]),i}(si),ya=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map}return a(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupTipsMap.size>0&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var i=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);Be.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(i)),r?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"onNewGroupTips",value:function(e){Be.d("".concat(this._n,".onReceiveGroupTips count:").concat(e.dataList.length));var t=this.newGroupTipsStoredAndSummary(e),n=t.eventDataList,i=t.result,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(Vn).onNewMessage({conversationOptionsList:n,isInstantMessage:!0})),i.length>0&&(this._groupModule.emitOuterEvent(M.MESSAGE_RECEIVED,i),this.handleMessageList(i))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var n=this,i=e.event,r=e.dataList,o=null,a=[],s=[],c={},u=[],l=function(e,l){var d=Tt(r[e]);if(6===i){if(n._groupModule.isGroupAttributesUpdatedNotice(d))return"continue";if(n._groupModule.isGroupCountersNotice(d))return"continue"}var h=d.groupProfile,p=h.groupID,f=h.communityType,g=void 0===f?0:f,_=h.topicID,v=void 0===_?void 0:_,m=h.invisible,y=void 0,I=n._groupModule.isMessageFromTopic(g,v);if(I){y=k.CONV_TOPIC,d.to=v;var T=n._groupModule.getModule(Gn);T.hasLocalTopic(p,v)||n._getTopicPendingMap.has(v)||(n._getTopicPendingMap.set(v,1),T.getTopicList({groupID:p,topicIDList:[v]}).finally((function(){n._getTopicPendingMap.delete(v)})))}var C=n._groupModule.hasLocalGroup(p);if(!C&&n._groupModule.isUnjoinedAVChatRoom(p))return"continue";if(!C&&!I)return n._cacheGroupTipsAndProbe({groupID:p,event:i,item:d}),"continue";if(n._groupModule.isMessageFromOrToAVChatroom(p))return d.event=i,u.push(d),"continue";if(d.currentUser=n._groupModule.getMyUserID(),d.conversationType=k.CONV_GROUP,(o=new Ho(d)).setElement({type:k.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),o.isSystemMessage=!1,1===m)return n._qualityStat(o),"continue";var S=n._groupModule.getModule(Vn),E=o,b=E.conversationID,M=E.sequence;if(6===i)o._onlineOnlyFlag=!0,s.push(o);else if(!S.pushIntoNoticeResult(s,o))return"continue";if(n._groupModule.isMessageFromCommunityOfTopic(g,v))return"continue";if(6===i&&S.getLocalConversation(b))return"continue";6!==i&&n._qualityStat(o);var w=S.isRemoteRead({conversationID:b,sequence:M});if(at(c[b])){var D=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||w||(D=1)),c[b]=a.push({conversationID:b,unreadCount:D,type:at(y)?o.conversationType:y,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var A=c[b];a[A].type=o.conversationType,a[A].subType=o.conversationSubType,a[A].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||w||a[A].unreadCount++)}},d=0,h=r.length;d<h;d++)l(d);return{eventDataList:a,result:s,AVChatRoomMessageList:u}}},{key:"_qualityStat",value:function(e){this._groupModule.getModule(ei).addMessageSequence({key:To,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Be.w("".concat(t._n,".handleMessageList unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&et(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r))}},{key:"_onMemberQuit",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&et(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(Un).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=e.payload,n=t.memberNum,i=t.groupProfile.groupID,r=this._groupModule.getLocalGroupProfile(i);r&&et(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConversationGroupProfile(r)),this._groupModule.getModule(Un).deleteLocalGroupMembers(i,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._groupModule.getModule(Vn).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(Un);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(k.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.userIDList,i=this._groupModule.getModule(Un);n.forEach((function(e){var n=i.getLocalGroupMemberInfo(t,e);n&&n.updateRole(k.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=e.payload,i=n.newGroupProfile,r=n.groupProfile.groupID,o=this._groupModule.getLocalGroupProfile(r);Object.keys(i).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(o,i);break;case"groupName":o.name=i[e];break;default:o[e]=i[e]}}));var a=!o.isSupportTopic;this._groupModule.emitGroupListUpdate(!0,a)}},{key:"_ownerChanged",value:function(e,t){var n=e.groupID,i=this._groupModule.getLocalGroupProfile(n),r=this._groupModule.getMyUserID();if(r===t.ownerID){i.updateGroup({selfInfo:{role:k.GRP_MBR_ROLE_OWNER}});var o=this._groupModule.getModule(Un),a=o.getLocalGroupMemberInfo(n,r),s=this._groupModule.getLocalGroupProfile(n).ownerID,c=o.getLocalGroupMemberInfo(n,s);a&&a.updateRole(k.GRP_MBR_ROLE_OWNER),c&&c.updateRole(k.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,r=n.memberList,o=i.groupID;bt(t)&&this._updateTopicMuteTime(e);var a=this._groupModule.getModule(Un);r.forEach((function(e){var t=a.getLocalGroupMemberInfo(o,e.userID);t&&et(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=e.payload,i=n.groupProfile,r=n.memberList,o=void 0===r?[]:r,a=this._groupModule.getModule(Gn),s=i.groupID,c=a.getLocalTopic(s,t);if(c){for(var u=!1,l=0;l<o.length;l++){var d=o[l];if(d.userID===this._groupModule.getMyUserID()&&d.muteTime>=0){c.updateSelfInfo({muteTime:d.muteTime}),u=!0;break}}u&&this._groupModule.emitOuterEvent(M.TOPIC_UPDATED,{groupID:s,topic:c})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=e.payload,i=n.groupProfile.groupID,r=n.newTopicInfo;this._groupModule.getModule(Gn).onTopicProfileUpdated(t({groupID:i,topicID:e.to},r))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach((function(e){t.onNewGroupTips(e)})),this._deleteCachedGroupTips(e),Be.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,r=e.item;this._cacheGroupTips(n,{event:i,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===k.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupTips(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Be.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear()}}]),e}(),Ia=function(){function e(t){r(this,e),this._groupModule=t,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map,this._isPagingGetCompleted=!1,t.getInnerEmitterInstance().once($o,this._initGroupList,this)}return a(e,[{key:"onCheckTimer",value:function(e){e%1==0&&this._cachedGroupMessageMap.size>0&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var i=e._checkCountMap.get(n),r=e._groupModule.hasLocalGroup(n);Be.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(r," checkCount:").concat(i)),r?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._groupModule.deleteUnjoinedAVChatRoom(n)):i>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):(i++,e._checkCountMap.set(n,i))}))}},{key:"_initGroupList",value:function(){var e=this;Be.l("".concat(this._n,"._initGroupList"));var t=new wo("getGroupListInStorage"),n=this._groupModule.getStorageGroupList();if(ot(n)&&n.length>0){n.forEach((function(t){e._groupModule.initGroupMap(t)})),this._groupModule.emitGroupListUpdate(!0,!1);var i=this._groupModule.getLocalGroupList().length;t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:".concat(i)).end()}else t.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:0").end();Be.l("".concat(this._n,"._initGroupList ok"))}},{key:"handleUpdateGroupLastMessage",value:function(e){var n="".concat(this._n,".handleUpdateGroupLastMessage");if(Be.l("".concat(n," conversation count:").concat(e.length,", local group count:").concat(this._groupModule.getLocalGroupList().length)),0!==this._groupModule.getGroupMap().size){for(var i,r,o,a=!1,s=0,c=e.length;s<c;s++)(i=e[s]).type===k.CONV_GROUP&&(r=i.conversationID.split(/^GROUP/)[1],(o=this._groupModule.getLocalGroupProfile(r))&&(o.lastMessage=t({},i.lastMessage),a=!0));a&&(this._groupModule.sortLocalGroupList(),this._groupModule.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){Be.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var t=this._newGroupMessageStoredAndSummary(e),n=t.conversationOptionsList,i=t.messageList,r=t.AVChatRoomMessageList;r.length>0&&this._groupModule.onAVChatRoomMessage(r),this._groupModule.filterModifiedMessage(i),n.length>0&&(this._groupModule.updateNextMessageSeq(n),this._groupModule.getModule(Vn).onNewMessage({conversationOptionsList:n,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0}));var o=this._groupModule.filterUnmodifiedMessage(i);o.length>0&&this._groupModule.emitOuterEvent(M.MESSAGE_RECEIVED,o),i.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=this,n=e.dataList,i=e.event,r=e.isInstantMessage,o=null,a=[],s=[],c=[],u={},l=this._groupModule.getModule(Hn),d=this._groupModule.getFileDownloadProxy(),h=n.length;h>1&&n.sort((function(e,t){return e.sequence-t.sequence}));for(var p=function(e){var h=Tt(n[e]),p=h.groupProfile,f=p.groupID,g=p.communityType,_=void 0===g?0:g,v=p.topicID,m=void 0===v?void 0:v,y=p.invisible,I=void 0,T=t._groupModule.isMessageFromTopic(_,m);if(T){I=k.CONV_TOPIC,h.to=m;var C=t._groupModule.getModule(Gn);C.hasLocalTopic(f,m)||t._getTopicPendingMap.has(m)||(t._getTopicPendingMap.set(m,1),C.getTopicList({groupID:f,topicIDList:[m]}).finally((function(){t._getTopicPendingMap.delete(m)})))}var S=t._groupModule.hasLocalGroup(f);if(!S&&t._groupModule.isUnjoinedAVChatRoom(f))return"continue";if(!S&&!T)return t._cacheGroupMessageAndProbe({groupID:f,event:i,item:h}),"continue";if(t._groupModule.isMessageFromOrToAVChatroom(f))return h.event=i,c.push(h),"continue";if(h.currentUser=t._groupModule.getMyUserID(),h.conversationType=k.CONV_GROUP,h.isSystemMessage=!!h.isSystemMessage,o=new Ho(h),h.elements=l.parseElements(h.elements,h.from),o.setElement(h.elements,d),1===y)return t._qualityStat(r,o),"continue";var E=1===n[e].isModified,b=t._groupModule.getModule(Vn);if(b.isMessageSentByCurrentInstance(o)?o.isModified=E:E=!1,1===h.onlineOnlyFlag)o._onlineOnlyFlag=!0,b.isMessageSentByCurrentInstance(o)||s.push(o);else{if(t._groupModule.isMessageFromCommunityOfTopic(_,m))return s.push(o),"continue";if(!b.pushIntoMessageList(s,o,E))return"continue";t._qualityStat(r,o);var M=o,w=M.conversationID,D=M.sequence,A=b.isRemoteRead({conversationID:w,sequence:D});if(at(u[w])){var R=0;"in"===o.flow&&(o._isExcludedFromUnreadCount||A||(R=1)),u[w]=a.push({conversationID:w,unreadCount:R,type:at(I)?o.conversationType:I,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1}else{var L=u[w];a[L].type=at(I)?o.conversationType:I,a[L].subType=o.conversationSubType,a[L].lastMessage=o._isExcludedFromLastMessage?"":o,"in"===o.flow&&(o._isExcludedFromUnreadCount||A||a[L].unreadCount++)}}},f=0;f<h;f++)p(f);return{conversationOptionsList:a,messageList:s,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e,t){var n=this._groupModule.getModule(ei);n.addMessageSequence({key:To,message:t}),e&&t.clientTime>0&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this._groupModule.getModule(Vn),n=[],i=null,r=!0;e.dataList.forEach((function(e){var o=e.elements.revokedInfos;at(o)||o.forEach((function(e){var o=Yt(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID);i=t.revoke(o,e.sequence,e.random);var a=e.revokerInfo&&e.revokerInfo.revoker;if(i)i.revoker=a,n.push(i);else{var s={conversationID:o,to:e.topicID||"",sequence:e.sequence,time:e.time,revoker:a};t.isLastMessageRevoked(s)&&(n.push(s),r=!1)}}))})),0!==n.length&&(t.onMessageRevoked(n),!0===r&&(Be.l("".concat(this._n,".onGroupMessageRevoked count:").concat(n.length)),this._groupModule.emitOuterEvent(M.MESSAGE_REVOKED,n)))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(y(this._groupModule.getGroupMap())),n=0,i=e.length;n<i;n++)t.delete(e[n].groupID);this._groupModule.hasJoinedAVChatRoom()&&this._groupModule.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._groupModule.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var r=y(t.keys()),o=0,a=r.length;o<a;o++)this._groupModule.deleteGroup(r[o])}},{key:"getGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupList"),i=new wo("getGroupList");Be.l("".concat(n));var r={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",inviteOption:"InviteJoinOption",muteAllMembers:"ShutUpAllMember"},o=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"],a=[];e&&e.groupProfileFilter&&e.groupProfileFilter.forEach((function(e){r[e]&&o.push(r[e])}));var s=(e||{}).isGroupWithTopicOnly,c=void 0!==s&&s;return this._pagingGetGroupList({limit:50,offset:0,groupBaseInfoFilter:o,groupList:a,isGroupWithTopicOnly:c}).then((function(){Be.l("".concat(n," ok. count:").concat(a.length," isGroupWithTopicOnly:").concat(c)),c||t._groupListTreeShaking(a),t._groupModule.updateGroupMap(a);var e=t._groupModule.getLocalGroupList().length;i.setNetworkType(t._groupModule.getNetworkType()).setMessage("remote count:".concat(a.length,", after tree shaking, local count:").concat(e,", isGroupWithTopicOnly:").concat(c)).end(),t.tempConversationList&&(t.handleUpdateGroupLastMessage(t.tempConversationList),t.tempConversationList=null),t._groupModule.patchGroupMessageRemindType(),t._groupModule.recomputeUnreadCount(),t._groupModule.emitGroupListUpdate(!0,!c);var r=t._groupModule.getLocalGroupList();if(c){var o=r.filter((function(e){return!0===e.isSupportTopic}));return zo({groupList:o})}return t._isPagingGetCompleted=!0,zo({groupList:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"isPagingGetCompleted",value:function(){return this._isPagingGetCompleted}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),i=e.isCommunityRelay,r=void 0!==i&&i,o=e.isGroupWithTopicOnly,a=void 0!==o&&o,s=e.limit,c=e.offset,u=e.groupBaseInfoFilter,l=e.groupList;if(a)return this._pagingGetGroupListWithTopic({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l});var d=new wo("_pagingGetGroupList");return this._groupModule.request({protocolName:zi,requestData:{type:r?k.GRP_COMMUNITY:void 0,memberAccount:this._groupModule.getMyUserID(),limit:s,offset:c,responseFilter:{groupBaseInfoFilter:u,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var i=e.data,o=i.groups,a=void 0===o?[]:o,h=i.totalCount;l.push.apply(l,y(a)),t._handleGroupAtInfoWithoutTopic(r,a);var p=c+s,f=!(h>p),g="offset:".concat(c," totalCount:").concat(h," isCompleted:").concat(f," ")+"currentCount:".concat(l.length," isCommunityRelay:").concat(r);return d.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(g)).end(),r||f?!r&&f?(Be.l("".concat(n," start to get community list")),c=0,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):r&&!f?(c=p,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l,isCommunityRelay:!0})):(Be.l("".concat(n," ok. totalCount:").concat(l.length)),zo({groupList:l})):(c=p,t._pagingGetGroupList({limit:s,offset:c,groupBaseInfoFilter:u,groupList:l}))})).catch((function(e){return 11e3!==e.code&&t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];d.setMessage("isCommunityRelay:".concat(r)).setError(e,i,o).end()})),r?(11e3===e.code&&(d=null,Be.l("".concat(n," ok. community unavailable"))),Jo({groupList:l})):Zo(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),i=e.limit,r=e.offset,o=e.groupBaseInfoFilter,a=e.groupList,s=new wo("pagingGetGroupListWithTopic");return this._groupModule.request({protocolName:zi,requestData:{type:k.GRP_COMMUNITY,memberAccount:this._groupModule.getMyUserID(),limit:i,offset:r,responseFilter:{groupBaseInfoFilter:o,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then((function(e){var c=e.data,u=c.groups,l=void 0===u?[]:u,d=c.totalCount;a.push.apply(a,y(l));var h=r+i,p=!(d>h),f="offset:".concat(r," totalCount:").concat(d," isCompleted:").concat(p," ")+"currentCount:".concat(a.length);return s.setNetworkType(t._groupModule.getNetworkType()).setMessage("".concat(f)).end(),p?(Be.l("".concat(n," ok. totalCount:").concat(a.length)),zo({groupList:a})):(r=h,t._pagingGetGroupListWithTopic({limit:i,offset:r,groupBaseInfoFilter:o,groupList:a}))})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Zo(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach((function(e){t.onNewGroupMessage(e)})),this._deleteCachedGroupMessage(e),Be.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(e){var t=this,n=e.groupID,i=e.event,r=e.item;this._cacheGroupMessage(n,{event:i,dataList:[r]}),this._groupModule.getGroupSimplifiedInfo(n).then((function(e){e.type===k.GRP_AVCHATROOM?t._groupModule.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._groupModule.setUnjoinedAVChatRoom(n):(t._groupModule.updateGroupMap([e]),t._notifyCachedGroupMessage(n))})),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),Be.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var i=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,r=e.groupAtInfoList,o=[];at(r)||(r.forEach((function(e){o.push(t(t({},e),{},{groupID:n}))})),i._groupModule.getModule(Vn).onNewGroupAtTips({dataList:o}))}))}},{key:"reset",value:function(){this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear(),this._isPagingGetCompleted=!1,this._groupModule.getInnerEmitterInstance().once($o,this._initGroupList,this)}}]),e}(),Ta=1,Ca=2,Sa=3,Ea=4,ba=5,Ma=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ea,this._onCloudConfigUpdated,this)}return a(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_attr_cache_time");at(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=e.elements.newGroupProfile,i=!at(n)&&!Yt(n.groupAttributeOption);return i&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),i}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,i=e.groupAttributeOption,r=i.mainSequence,o=i.isWithChangedAttributeInfo,a=i.groupAttributeList,s=void 0===a?[]:a,c=i.operationType;if(Be.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(o," operationType:").concat(c)),!at(c)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var u=this._getLocalGroupAttributes(n).localMainSequence;if(1===o&&r-u==1)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:r,groupAttributeList:s,operationType:c}),void this._emitGroupAttributesUpdated(n);if(this._hasLocalGroupAttributes(n)){var l=this._getLocalGroupAttributes(n).avChatRoomKey;this._getGroupAttributes({groupID:n,avChatRoomKey:l}).then((function(){t._emitGroupAttributesUpdated(n)}))}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey,i=void 0===n?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:i}),Be.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(i))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.groupAttributes,r=this._getLocalGroupAttributes(n),o=r.remoteMainSequence,a=r.avChatRoomKey,s=new wo("initGroupAttributes");return s.setMessage("groupID:".concat(n," avChatRoomKey:").concat(a," mainSequence:").concat(o)),this._groupModule.request({protocolName:yr,requestData:{groupID:n,avChatRoomKey:a,mainSequence:o,groupAttributeList:this._transformGroupAttributes(i)}}).then((function(e){var r=e.data,o=r.mainSequence,a=y(r.groupAttributeList);return a.forEach((function(e){e.value=i[e.key]})),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:a,operationType:Ta}),s.setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n)),zo({groupAttributes:i})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Zo(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),i=e.groupID,r=e.groupAttributes,o=this._getLocalGroupAttributes(i),a=o.remoteMainSequence,s=o.avChatRoomKey,c=o.attributes,u=this._transformGroupAttributes(r);u.forEach((function(e){var t=e.key;e.sequence=0,c.has(t)&&(e.sequence=c.get(t).sequence)}));var l=new wo("setGroupAttributes");return l.setMessage("groupID:".concat(i," groupAttributes:").concat(JSON.stringify(r))),Be.l("".concat(n,". groupID:").concat(i," mainSequence:").concat(a)),this._groupModule.request({protocolName:Ir,requestData:{groupID:i,avChatRoomKey:s,mainSequence:a,groupAttributeList:u}}).then((function(e){var o=e.data,a=o.mainSequence,s=y(o.groupAttributeList);return s.forEach((function(e){e.value=r[e.key]})),t._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:a,groupAttributeList:s,operationType:Ca}),l.setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(n," ok.")),zo({groupAttributes:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),Zo(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,i=e.keyList,r=void 0===i?[]:i,o=this._getLocalGroupAttributes(n),a=o.remoteMainSequence,s=o.avChatRoomKey,c=o.attributes,u=y(c.keys()),l=Cr,d=Sa,h={groupID:n,avChatRoomKey:s,mainSequence:a},p=[];r.length>0&&(u=[],l=Tr,d=Ea,r.forEach((function(e){var t=0;c.has(e)&&(t=c.get(e).sequence,u.push(e)),p.push({key:e,sequence:t})})),h.groupAttributeList=p);var f=new wo("deleteGroupAttributes");return f.setMessage("groupID:".concat(n," mainSequence:").concat(a," keyList:").concat(r," protocolName:").concat(l)),this._groupModule.request({protocolName:l,requestData:h}).then((function(e){var i=e.data.mainSequence;return t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:p,operationType:d}),f.setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),zo({keyList:u})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];f.setError(e,i,r).end()})),Zo(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),i=e.groupID,r=this._getLocalGroupAttributes(i),o=r.avChatRoomKey,a=r.lastUpdateTime,s=r.localMainSequence,c=r.remoteMainSequence,u=new wo("getGroupAttributes");if(u.setMessage("groupID:".concat(i," localMainSequence:").concat(s," remoteMainSequence:").concat(c," keyList:").concat(e.keyList)),Date.now()-a>=this.CACHE_EXPIRE_TIME||s<c)return this._getGroupAttributes({groupID:i,avChatRoomKey:o}).then((function(r){u.setMoreMessage("get attributes from remote. count:".concat(r.length)).setNetworkType(t._groupModule.getNetworkType()).end(),Be.l("".concat(n," from remote. groupID:").concat(i));var o=t._getCachedAttributes(e);return zo({groupAttributes:o})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Zo(e)}));u.setMoreMessage("get attributes from cache").setNetworkType(this._groupModule.getNetworkType()).end(),Be.l("".concat(n," from cache. groupID:").concat(i));var l=this._getCachedAttributes(e);return Jo({groupAttributes:l})}},{key:"_getGroupAttributes",value:function(e){var n=this,i=0;return at(e.avChatRoomKey)||(i=1),this._groupModule.request({protocolName:Sr,requestData:t(t({},e),{},{groupType:i})}).then((function(t){var i=t.data,r=i.mainSequence,o=i.groupAttributeList,a=y(o);return at(r)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:r,groupAttributeList:a,operationType:ba}),Be.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID)),o})).catch((function(e){return Zo(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,i=e.groupAttributeList,r=e.operationType;if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t),a=o.localMainSequence;if(r===ba||n-a==1)o.remoteMainSequence=n,o.localMainSequence=n,o.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:o,groupAttributeList:i,operationType:r});else{if(a===n)return;o.remoteMainSequence=n}this._groupAttributesMap.set(t,o);var s="operationType:".concat(r," localMainSequence:").concat(a," remoteMainSequence:").concat(n);Be.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(s))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=e.keyList,i=void 0===n?[]:n,r={};if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t).attributes;if(i.length>0)i.forEach((function(e){o.has(e)&&(r[e]=o.get(e).value)}));else{var a,s=b(o.keys());try{for(s.s();!(a=s.n()).done;){var c=a.value;r[c]=o.get(c).value}}catch(l){s.e(l)}finally{s.f()}}}return r}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList,i=e.operationType;i!==Sa?i!==Ea?(i===Ta&&t.attributes.clear(),n.forEach((function(e){var n=e.key,i=e.value,r=e.sequence;t.attributes.set(n,{value:i,sequence:r})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=this._computeAttrChangedInfo(t),i=n.updatedKeyList,r=n.deletedKeyList;this._groupModule.emitOuterEvent(M.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:i,deletedKeyList:r})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],i=[];return Object.keys(e).forEach((function(i){e[i]!==t._groupAttributesCopy[i]&&n.push(i)})),Object.keys(this._groupAttributesCopy).forEach((function(t){at(e[t])&&i.push(t)})),this._groupAttributesCopy={},Be.l("".concat(this._n,"._computeAttrChangedInfo update count:").concat(n.length,", delete count:").concat(i.length)),{updatedKeyList:n,deletedKeyList:i}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),e}(),ka="Set",wa="Increase",Da="Decrease",Aa=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ea,this._onCloudConfigUpdated,this)}return a(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._groupModule.getCloudConfig("grp_counter_expire_time");at(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=e.elements.groupCounterInfo,i=!1;return Yt(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),i=!0),i}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var i=e.type,r=e.groupCounterSeq,o=e.counterList,a=void 0===o?[]:o;0!==i&&2!==i||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:a}),a.forEach((function(e){t._groupModule.emitOuterEvent(M.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===i&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:r,counterList:a})})),Be.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID,n=e.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),Be.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(q.GRP_COUNTER))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".setGroupCounters"),i=e.groupID,r=e.counters,o=this._convertObjectToList(r),a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," count:").concat(o.length),c=new wo("setGroupCounters");return c.setMessage("".concat(s)),Be.l("".concat(n,". ").concat(s)),this._updateGroupCounters({groupID:i,counterList:o,avChatRoomKey:a,mode:ka}).then((function(e){return c.end(),Be.l("".concat(n," ok.")),zo({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"increaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(q.GRP_COUNTER))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".increaseGroupCounters"),i=e.groupID,r=e.key,o=e.value,a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," key:").concat(r," value:").concat(o),c=new wo("increaseGroupCounter");c.setMessage("".concat(s)),Be.l("".concat(n,". ").concat(s));var u=[{key:r,value:o}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:a,mode:wa}).then((function(e){return c.end(),Be.l("".concat(n," ok.")),zo({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t=this;if(!this._groupModule.canIUse(q.GRP_COUNTER))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".decreaseGroupCounter"),i=e.groupID,r=e.key,o=e.value,a=this._getLocalGroupCounters(i).avChatRoomKey,s="groupID:".concat(i," key:").concat(r," value:").concat(o),c=new wo("decreaseGroupCounter");c.setMessage("".concat(s)),Be.l("".concat(n,". ").concat(s));var u=[{key:r,value:o}];return this._updateGroupCounters({groupID:i,counterList:u,avChatRoomKey:a,mode:Da}).then((function(e){return c.end(),Be.l("".concat(n," ok.")),zo({counters:e})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._groupModule.canIUse(q.GRP_COUNTER))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".getGroupCounters"),i=e.groupID,r=e.keyList,o=void 0===r?[]:r,a=this._getLocalGroupCounters(i),s=a.avChatRoomKey,c=a.lastUpdateTime,u=new wo("getGroupCounters");if(u.setMessage("groupID:".concat(i)),Date.now()-c>=this.EXPIRE_TIME)return this._getRemoteGroupCounters({groupID:i,avChatRoomKey:s}).then((function(e){u.setMoreMessage("from remote. count:".concat(e.length)).end(),Be.l("".concat(n," from remote. groupID:").concat(i));var r=t._getLocalCounters(i,o);return zo({counters:r})})).catch((function(e){return t._groupModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Zo(e)}));u.setMoreMessage("from cache").end(),Be.l("".concat(n," from cache. groupID:").concat(i));var l=this._getLocalCounters(i,o);return Jo({counters:l})}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._groupModule.request({protocolName:wr,requestData:t({},e)}).then((function(t){var i=t.data,r=i.counterList,o=void 0===r?[]:r,a=i.groupCounterSeq;return n._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:a}),Be.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o})).catch((function(e){return Zo(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),i=e.groupID,r=e.avChatRoomKey,o=e.mode;return Be.l("".concat(n,". groupID:").concat(i," avChatRoomKey:").concat(r," mode:").concat(o)),this._groupModule.request({protocolName:kr,requestData:t({},e)}).then((function(e){Be.l("".concat(n," ok."));var t=e.data.counterList,i={};return(void 0===t?[]:t).forEach((function(e){var t=e.key,n=e.value;i[t]=n})),i})).catch((function(e){return Zo(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var o=this._getLocalGroupCounters(t),a=o.counters,s=o.avChatRoomKey,c=o.groupCounterSeq;if(r>0&&r<c)return;i.forEach((function(e){var t=e.key,n=e.value;a.set(t,n)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:a,avChatRoomKey:s})}}},{key:"_deleteLocalGroupCounters",value:function(e){var t=e.groupID,n=e.counterList,i=void 0===n?[]:n,r=e.groupCounterSeq;if(this._hasLocalGroupCounters(t)){var o=this._getLocalGroupCounters(t),a=o.counters,s=o.avChatRoomKey;i.forEach((function(e){a.delete(e.key)})),this._groupCountersMap.set(t,{lastUpdateTime:Date.now(),groupCounterSeq:r,counters:a,avChatRoomKey:s})}}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var i=this._getLocalGroupCounters(e).counters;if(t.length>0)t.forEach((function(e){i.has(e)&&(n[e]=i.get(e))}));else{var r,o=b(i.keys());try{for(o.s();!(r=o.n()).done;){var a=r.value;n[a]=i.get(a)}}catch(c){o.e(c)}finally{o.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),e}(),Ra=function(){function e(t){r(this,e);var n=t.manager,i=t.groupID,o=t.onInit,a=t.onSuccess,s=t.onFail;this._n="Polling",this._manager=n,this._groupModule=n._groupModule,this._onInit=o,this._onSuccess=a,this._onFail=s,this._groupID=i,this._timeoutID=-1,this._isRunning=!1,this._protocolName=fr}return a(e,[{key:"start",value:function(){var e=this._groupModule.isLoggedIn();e||(this._protocolName=gr),Be.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._groupModule.request({protocolName:this._protocolName,requestData:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Be.l("".concat(this._n,".stop")),this._timeoutID>0&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),e}(),La={3:!0,4:!0,5:!0,6:!0,17:!0},Oa=function(){function e(t){r(this,e),this._groupModule=t,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new da(200),this.messageIDLinkedList=new da(100),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}return a(e,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?y(this._joinedGroupMap.keys()):null}},{key:"_updateRequestData",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===y(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n=t.data,i=n.key,r=n.nextSeq,o=n.rspMsgList,a=n.errorCode,s=n.nextBroadcastSeq,c=n.broadcastMessageList;if(0!==a){var u=this._pollingRequestInfoMap.get(e),l=new wo("longPollingAVError"),d=u?"".concat(u.key,"-").concat(u.startSeq):"requestInfo is undefined";l.setMessage("".concat(e,"-").concat(d,"-").concat(t.errorInfo)).setCode(t.errorCode).setNetworkType(this._groupModule.getNetworkType()).end(!0)}else{if(!this.checkJoinedAVChatRoomByID(e))return;nt(i)&&et(r)&&this._pollingRequestInfoMap.set(e,{key:i,startSeq:r}),et(s)&&s>this._startBroadcastSeq&&(this._startBroadcastSeq=s),ot(o)&&o.length>0?(o.forEach((function(e){e.to=e.groupID})),this.onMessage(o)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c)}}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e){if(ot(e)&&0!==e.length){0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL);var t=null,n=[],i=this._getModule(Vn),r=this._getModule(ei),o=e.length;o>1&&e.sort((function(e,t){return e.sequence-t.sequence}));for(var a=this._getModule(Fn),s=0;s<o;s++){var c=this.restoreMessageFromSimplified(e[s]);if(La[c.event]){if(6===c.event){if(this._groupModule.isGroupAttributesUpdatedNotice(c))continue;if(this._groupModule.isGroupCountersNotice(c))continue}this.receivedMessageCount+=1,t=this.packMessage(c,c.event);var u=1===c.isModified,l=1===c.isHistoryMessage;if((a.isUnlimitedAVChatRoom()||!this.sequencesLinkedList.has(t.sequence))&&!this.messageIDLinkedList.has(t.ID)){var d=t.conversationID;if(this.receivedMessageCount%50==0?this._getModule(Zn).detectFirstRound(d,this.sequencesLinkedList.data()):this.receivedMessageCount%80==0&&this._getModule(Zn).detectSecondRound(d,this.sequencesLinkedList.data()),null!==this.sequencesLinkedList.tail()){var h=this.sequencesLinkedList.tail().value,p=t.sequence-h;p>1&&p<=20?this._getModule(Zn).onMessageMaybeLost(d,h+1,p-1):p<-1&&p>=-20&&this._getModule(Zn).onMessageMaybeLost(d,t.sequence+1,Math.abs(p)-1)}this.sequencesLinkedList.set(t.sequence),this.messageIDLinkedList.set(t.ID);var f=!1;if(this._isMessageSentByCurrentInstance(t)?u&&(f=!0,t.isModified=u,i.updateMessageIsModifiedProperty(t)):f=!0,f){if(t.conversationType===k.CONV_SYSTEM&&5===t.payload.operationType&&this._onGroupDismissed(t.payload.groupProfile.groupID),!l&&t.conversationType!==k.CONV_SYSTEM){var g=t.conversationID.replace(k.CONV_GROUP,"");this._pollingInstanceMap.has(g)?this._groupModule.isLoggedIn()&&r.addMessageSequence({key:So,message:t}):(t.type!==k.MSG_GRP_TIP&&t.clientTime>0&&r.addMessageDelay(t.clientTime),r.addMessageSequence({key:Co,message:t}))}n.push(t)}}}else Be.w("".concat(this._n,".onMessage unknown event:").concat(c.event))}if(0!==n.length){this._groupModule.filterModifiedMessage(n);var _=this.packConversationOption(n);_.length>0&&this._getModule(Vn).onNewMessage({conversationOptionsList:_,isInstantMessage:!0}),Be.d("".concat(this._n,".onMessage count:").concat(n.length)),this._checkMessageStacked(n);var v=this._groupModule.filterUnmodifiedMessage(n);v.length>0&&this._groupModule.emitOuterEvent(M.MESSAGE_RECEIVED,v),n.length=0}}}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.groupJoinType||(e.groupJoinType=1);var t=e.operatorInfo,n=void 0===t?{}:t,i=e.operatorID,r=e.userIDList,o=void 0===r?[]:r,a=n.userID,s=void 0===a?i:a,c=n.avatar,u=void 0===c?"":c,l=n.nick,d=void 0===l?"":l;e.operatorInfo={userID:s,avatar:u,nick:d};var h=o.map((function(e){return{userID:e}}));return e.memberInfoList=e.memberInfoList||h,e}},{key:"restoreMessageFromSimplified",value:function(e){var n=e.event;if(this.isBroadcastOrNormal(n)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){if(e.type===k.MSG_CUSTOM){var n=e.content,i=void 0===n?{}:n;e.content=t({data:"",description:"",extension:""},i)}return e}))),(this.isGroupTip(n)||this.isGroupSystemNotice(n))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(n)){e.elements=this.restoreGroupTipElements(e.elements);var i=e.elements,r=void 0===i?{}:i,o=r.operationType,a=r.operatorInfo;if(1===o){var c=[{userID:(void 0===a?{}:a).userID}];r.memberInfoList=r.memberInfoList||c}}if(this.isGroupSystemNotice(n)){var u=e.elements,l=u.memberInfoList,d=u.operatorInfo;l||(l=void 0===d?{}:d),e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},l),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements);var h=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,i){return t(t({},n),{},s({},i,e.elements[i]))}),{});e.elements=h}return e}},{key:"_onGroupDismissed",value:function(e){Be.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._groupModule.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked",n=e.length;n>=100&&(this._groupModule.outputWarning(t),this._reportMessageStackedCount<5&&(new wo(t).setNetworkType(this._groupModule.getNetworkType()).setMessage("count:".concat(n," groupID:").concat(y(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._getModule(Vn).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._groupModule.getMyUserID(),e.conversationType=5===t?k.CONV_SYSTEM:k.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new Ho(e),i=this.packElements(e,t);return n.setElement(i,this._groupModule.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:k.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:k.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:this._getModule(Hn).parseElements(e.elements,e.from)}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var i=e[n],r=i.conversationID;if(t.has(r)){var o=t.get(r);o.lastMessage=i,"in"===i.flow&&o.unreadCount++}else t.set(r,{conversationID:i.conversationID,unreadCount:"out"===i.flow?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return y(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t=e.groupProfile.groupID,n=e.elements.onlineMemberInfo,i=void 0===n?void 0:n;if(!Yt(i)){var r=i.onlineMemberNum,o=void 0===r?0:r,a=i.expireTime,s=void 0===a?this.DEFAULT_EXPIRE_TIME:a,c=this._onlineMemberCountMap.get(t)||{},u=Date.now();Yt(c)?Object.assign(c,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:u,memberCount:o,expireTime:s}):(c.latestUpdateTime=u,c.memberCount=o),Be.d("".concat(this._n,"._updateMemberCountByGroupTips info:"),c),this._onlineMemberCountMap.set(t,c)}}},{key:"_onBroadcastMessage",value:function(e){if(!Yt(e)){for(var t=[],n=e.length,i=null,r=0;r<n;r++){var o=this.restoreMessageFromSimplified(e[r]);La[o.event]?((i=this.packMessage(o,o.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(i.ID)||(t.push(i),this._broadcastMessageIDMap.set(i.ID,1))):Be.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(o.event))}t.length>0&&this._groupModule.emitOuterEvent(M.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){if(this._pollingInstanceMap.has(e)){var t=this._pollingInstanceMap.get(e);t.isRunning()||t.start()}else{var n=new Ra({manager:this,groupID:e,onInit:this._updateRequestData.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)});n.start(),this._pollingInstanceMap.set(e,n),Be.l("".concat(this._n,".start groupID:").concat(e))}}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck().then((function(){var n=e.longPollingKey,i=e.group,r=i.groupID;return t._joinedGroupMap.set(r,i),t._groupModule.updateGroupMap([i]),t._groupModule.deleteUnjoinedAVChatRoom(r),t._groupModule.emitGroupListUpdate(!0,!1),at(n)?Jo({status:We,group:i}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,i=e.group,r=e.startSeq,o=void 0===r?0:r,a=i.groupID;return t._pollingRequestInfoMap.set(a,{key:n,startSeq:o}),t.start(a),t._groupModule.isLoggedIn()?Jo({status:We,group:i}):Jo({status:We})}))}},{key:"_preCheck",value:function(){if(this._getModule(Fn).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();var e=m(this._joinedGroupMap.entries().next().value,2),t=e[0],n=e[1];if(this._groupModule.isLoggedIn()){if(n.selfInfo.role!==k.GRP_MBR_ROLE_OWNER&&n.ownerID!==this._groupModule.getMyUserID())return this._groupModule.quitGroup(t);this._groupModule.deleteLocalGroupAndConversation(t)}else this._groupModule.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,i="".concat(this._n,".").concat("joinWithoutAuth"),r=new wo("joinWithoutAuth");return this._groupModule.request({protocolName:Xi,requestData:e}).then((function(e){var o=e.data.longPollingKey;if(t._groupModule.probeNetwork().then((function(e){var t=m(e,2);t[0];var i=t[1];r.setNetworkType(i).setMessage("groupID:".concat(n," longPollingKey:").concat(o)).end(!0)})),at(o))return Zo({code:po.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});Be.l("".concat(i," ok. groupID:").concat(n)),t._getModule(Vn).setCompleted("".concat(k.CONV_GROUP).concat(n));var a=new pa({groupID:n});return t.startRunLoop({group:a,longPollingKey:o}),zo({status:We})})).catch((function(e){return Be.e("".concat(i," failed. groupID:").concat(n," error:"),e),t._groupModule.probeNetwork().then((function(t){var i=m(t,2),o=i[0],a=i[1];r.setError(e,o,a).setMessage("groupID:".concat(n)).end(!0)})),Zo(e)})).finally((function(){t._groupModule.getModule(jn).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return Yt(t)||n-t.lastSyncTime>1e3*t.expireTime&&n-t.latestUpdateTime>1e4&&n-t.lastReqTime>3e3?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return zo({memberCount:e.memberCount})})).catch((function(e){return Zo(e)}))):Jo({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount");return this._groupModule.request({protocolName:_r,requestData:{groupID:e}}).then((function(i){var r=t._onlineMemberCountMap.get(e)||{},o=i.data,a=o.onlineMemberNum,s=void 0===a?0:a,c=o.expireTime,u=void 0===c?t.DEFAULT_EXPIRE_TIME:c;Be.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(s," expireTime:").concat(u));var l=Date.now();return Yt(r)&&(r.lastReqTime=l),t._onlineMemberCountMap.set(e,Object.assign(r,{lastSyncTime:l,latestUpdateTime:l,memberCount:s,expireTime:u})),{memberCount:s}})).catch((function(i){return Be.w("".concat(n," failed. error:"),i),new wo("_getGroupOnlineMemberCount").setCode(i.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(i))).setNetworkType(t._groupModule.getNetworkType()).end(),Promise.reject(i)}))}},{key:"_getModule",value:function(e){return this._groupModule.getModule(e)}},{key:"setPollingInterval",value:function(e){at(e)||(et(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){at(e)||(et(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){at(e)||(et(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){at(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){var t=e.payload.groupProfile.groupID;Be.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(t)),this._groupModule.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"restartPolling",value:function(){Be.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=b(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(r){t.e(r)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var t=this._pollingInstanceMap.get(e).getPollingTimerID();return Be.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t}},{key:"reset",value:function(e){if(e){Be.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Be.l("".concat(this._n,".reset all"));var n,i=b(this._pollingInstanceMap.values());try{for(i.s();!(n=i.n()).done;)n.value.stop()}catch(o){i.e(o)}finally{i.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),e}(),Na=1,xa=15,Pa=function(){function e(t){r(this,e),this._groupModule=t,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}return a(e,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,i=e.isInstantMessage;Be.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length));var r=this.newSystemNoticeStoredAndSummary({notifiesList:t,isInstantMessage:i}),o=r.eventDataList,a=r.result;o.length>0&&(this._groupModule.getModule(Vn).onNewMessage({conversationOptionsList:o,isInstantMessage:i}),this._onReceivedGroupSystemNotice({result:a,isInstantMessage:i})),i?a.length>0&&this._groupModule.emitOuterEvent(M.MESSAGE_RECEIVED,a):!0===n&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){var n=e.notifiesList,i=e.isInstantMessage,r=null,o=n.length,a=0,s=[],c={conversationID:k.CONV_SYSTEM,unreadCount:0,type:k.CONV_SYSTEM,subType:null,lastMessage:null};for(a=0;a<o;a++){var u=n[a],l=u.groupProfile,d=l.communityType,h=void 0===d?0:d,p=l.topicID,f=void 0===p?void 0:p,g=u.elements,_=g.topicIDList,v=void 0===_?void 0:_,m=g.operationType;if(!(2!==h||Yt(f)&&Yt(v))){if([17,18,20].includes(m)){this._handleTopicSystemNotice(u);continue}Yt(f)||(u.to=f)}u.elements.operationType!==xa&&(u.currentUser=this._groupModule.getMyUserID(),u.conversationType=k.CONV_SYSTEM,u.conversationID=k.CONV_SYSTEM,(r=new Ho(u)).setElement({type:k.MSG_GRP_SYS_NOTICE,content:t(t({},u.elements),{},{groupProfile:t({},u.groupProfile)})}),r.isSystemMessage=!0,(1===r.sequence&&1===r.random||2===r.sequence&&2===r.random)&&(r.sequence=gt(),r.random=gt(),r.generateMessageID(),Be.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(r.ID))),this._groupModule.getModule(Vn).pushIntoNoticeResult(s,r)&&(i?c.unreadCount++:r.setIsRead(!0),c.subType=r.conversationSubType))}return c.lastMessage=s[s.length-1],{eventDataList:s.length>0?[c]:[],result:s}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)}));var n=e._groupModule.getModule(Vn).getLocalMessageList(k.CONV_SYSTEM),i=[];n.forEach((function(t){var n=t.payload,r=n.operatorID,o=n.operationType,a=n.groupProfile;if(o===Na){var s="".concat(r,"_").concat(a.groupID,"_").concat(a.to),c=e.pendencyMap.get(s);c&&et(c.handled)&&0!==c.handled&&i.push(t)}})),e.deleteGroupSystemNotice({messageList:i})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return ot(e.messageList)&&0!==e.messageList.length?(Be.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._groupModule.request({protocolName:pr,requestData:{messageListToDelete:e.messageList.map((function(e){return{from:k.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Be.l("".concat(n," ok"));var i=t._groupModule.getModule(Vn);return e.messageList.forEach((function(e){i.deleteLocalMessage(e)})),zo()})).catch((function(e){return Be.e("".concat(n," error:"),e),Zo(e)}))):Jo()}},{key:"_getPendencyList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,i=void 0===n?void 0:n,r=t.startTime,o=void 0===r?0:r,a=t.limit,s=void 0===a?20:a;return this._groupModule.request({protocolName:hr,requestData:{type:i,startTime:o,limit:s,handleAccount:this._groupModule.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(y(n),y(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:k.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,y(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID})})),Jo({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:break;case 2:t._onApplyGroupRequestAgreed(e);break;case 3:break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 6:break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 11:case 12:case 15:break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._groupModule.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyGroupRequestAgreed",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;if(n){t._groupModule.updateGroupMap([n]);var i=!n.isSupportTopic;t._groupModule.emitGroupListUpdate(!0,i)}}))}},{key:"_onMemberKicked",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onGroupDismissed",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t);var n=this._groupModule._AVChatRoomHandler;n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(n)||this._groupModule.getGroupProfile({groupID:n}).then((function(e){var n=e.data.group;n&&(t._groupModule.updateGroupMap([n]),t._groupModule.emitGroupListUpdate())}))}},{key:"_onQuitGroup",value:function(e){var t=e.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(t)&&this._groupModule.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,r=this._groupModule.getModule(Un).getLocalGroupMemberInfo(i,n);r&&r.updateRole(k.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=e.payload.groupProfile,n=t.to,i=t.groupID,r=this._groupModule.getModule(Un).getLocalGroupMemberInfo(i,n);r&&r.updateRole(k.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID,n=e.payload.messageRemindType;this._groupModule.getModule(Vn).onGroupMessageRemindTypeSynced({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(e){var t=e.groupProfile,n=t.groupID,i=t.topicID,r=e.elements,o=r.operationType,a=r.topicIDList,s=r.messageRemindType,c=this._groupModule.getModule(Gn);17===o?c.onTopicCreated({groupID:n,topicID:i}):18===o?c.onTopicDeleted({groupID:n,topicIDList:a}):20===o&&c.onTopicMessageRemindTypeUpdated({groupID:n,topicID:i,messageRemindType:s})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),e}(),Ua=["relayFlag"],Ga=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="GroupModule",t._commonGroupHandler=null,t._AVChatRoomHandler=null,t._groupSystemNoticeHandler=null,t._commonGroupHandler=new Ia(g(t)),t._groupAttributesHandler=new Ma(g(t)),t._groupCountersHandler=new Aa(g(t)),t._AVChatRoomHandler=new Oa(g(t)),t._groupTipsHandler=new ya(g(t)),t._groupSystemNoticeHandler=new Pa(g(t)),t.groupMap=new Map,t._unjoinedAVChatRoomList=new Map,t._receiptDetailCompleteMap=new Map,t.getInnerEmitterInstance().on(ea,t._onCloudConfigUpdated,g(t)),t}return a(i,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),i=this.getCloudConfig("polling_simplified_msg");this._AVChatRoomHandler&&(Be.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(i))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t=this;if(e.conversationType===k.CONV_GROUP){var n=bt(e.to)?Ft(e.to):e.to;return this.hasLocalGroup(n)?Jo():this.getGroupProfile({groupID:n}).then((function(i){var r=i.data.group.type;if(Be.l("".concat(t._n,".guardForAVChatRoom. groupID:").concat(n," type:").concat(r)),r===k.GRP_AVCHATROOM){var o=po.MESSAGE_SEND_FAIL_NOT_IN_AVCHATROOM;return Zo(new Ko({code:o,message:t.getErrorMessage(o,e.from,n),data:{message:e}}))}return Jo()}))}return Jo()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t=this;if(ot(e)){var n=this.getModule(Gn);e.forEach((function(e){var i=e.conversationID.replace(k.CONV_GROUP,"");bt(i)&&n.updateLastMessage(i,e.lastMessage),t.groupMap.has(i)&&(t.groupMap.get(i).nextMessageSeq=e.lastMessage.sequence+1)}))}}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler&&this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n=e.elements.groupMessageReadNotice;if(!at(n)){var i=t.getModule(Vn);n.forEach((function(e){var n=e.groupID,r=e.topicID,o=void 0===r?void 0:r,a=e.lastMessageSeq;Be.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(n," lastMessageSeq:").concat(a));var s="".concat(k.CONV_GROUP).concat(n),c=!0;Yt(o)||(s="".concat(k.CONV_GROUP).concat(o),c=!1),i.updateIsReadAfterReadReport({conversationID:s,lastMessageSeq:a}),i.updateUnreadCount(s,c),i.clearGroupAtInfoList(s,c)}))}}))}},{key:"onReadReceiptList",value:function(e){var t=this;Be.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach((function(e){var n=e.groupProfile,i=e.elements,r=n.groupID,o=t.getModule(Vn),a=i.readReceiptList;o.updateReadReceiptInfo({groupID:r,readReceiptList:a})}))}},{key:"onGroupMessageModified",value:function(e){Be.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var n=this.getModule(Vn);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:k.CONV_GROUP,to:e.topicID?e.topicID:e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new pa(e))}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,i=this.getModule(Vn);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new pa(e)),i.deleteGroupRomaingMessageInfo(t))}));var r,o=this.getMyUserID(),a=b(this.groupMap);try{for(a.s();!(r=a.n()).done;){var s=m(r.value,2)[1];s.selfInfo.userID=o,"Owner"===s.selfInfo.role&&(s.ownerID=o)}}catch(u){a.e(u)}finally{a.f()}this._setStorageGroupList()}},{key:"getStorageGroupList",value:function(){return this.getModule(Bn).getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroupList().filter((function(e){var t=e.type;return!St(t)})).filter((function(e){return!e.isSupportTopic})).slice(0,20).map((function(e){return{groupID:e.groupID,name:e.name,avatar:e.avatar,type:e.type}}));this.getModule(Bn).setItem("groupMap",e)}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return y(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=y(this.groupMap).filter((function(e){var t=m(e,2);return t[0],!Yt(t[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(y(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();if(e&&this.emitOuterEvent(M.GROUP_LIST_UPDATED),t){var i=JSON.parse(JSON.stringify(n)),r=this.getModule(Vn);r.updateConversationGroupProfile(i)}}},{key:"patchGroupMessageRemindType",value:function(){var e=this.getLocalGroupList(),t=this.getModule(Vn),n=0;e.forEach((function(e){!0===t.patchMessageRemindType({ID:e.groupID,isC2CConversation:!1,messageRemindType:e.selfInfo.messageRemindType})&&(n+=1)})),Be.l("".concat(this._n,".patchGroupMessageRemindType count:").concat(n))}},{key:"recomputeUnreadCount",value:function(){var e=this.getLocalGroupList(),t=this.getModule(Vn);e.forEach((function(e){var n=e.groupID,i=e.selfInfo,r=i.excludedUnreadSequenceList,o=i.readedSequence;if(ot(r)){var a=0;r.forEach((function(t){t>=o&&t<=e.nextMessageSeq-1&&(a+=1)})),a>=1&&t.recomputeGroupUnreadCount({conversationID:"".concat(k.CONV_GROUP).concat(n),count:a})}}))}},{key:"getMyNameCardByGroupID",value:function(e){var t=this.getLocalGroupProfile(e);return t?t.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return!!this._commonGroupHandler&&this._commonGroupHandler.isPagingGetCompleted()}},{key:"getGroupList",value:function(e){return this._commonGroupHandler?this._commonGroupHandler.getGroupList(e):Jo()}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),i=new wo("getGroupProfile"),r=e.groupID,o=e.groupCustomFieldFilter;Be.l("".concat(n," groupID:").concat(r));var a={groupIDList:[r],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:o,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}};return this.getGroupProfileAdvance(a).then((function(e){var o,a=e.data,s=a.successGroupList,c=a.failureGroupList;return Be.l("".concat(n," ok")),c.length>0?Zo(c[0]):(St(s[0].type)&&!t.hasLocalGroup(r)?o=new pa(s[0]):(t.updateGroupMap(s),o=t.getLocalGroupProfile(r)),o.isSupportTopic||t.getModule(Vn).updateConversationGroupProfile([o]),i.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," type:").concat(o.type," muteAllMembers:").concat(o.muteAllMembers," ownerID:").concat(o.ownerID)).end(),zo({group:o}))})).catch((function(r){return t.probeNetwork().then((function(t){var n=m(t,2),o=n[0],a=n[1];i.setError(r,o,a).setMessage("groupID:".concat(e.groupID)).end()})),Be.e("".concat(n," failed. error:"),r),Zo(r)}))}},{key:"getGroupProfileAdvance",value:function(e){var n="".concat(this._n,".getGroupProfileAdvance"),i=e.groupIDList;ot(i)&&i.length>50&&(this.outputWarning("GetGroupProfileLimit"),i.length=50);var r=[],o=[];i.forEach((function(e){Et({groupID:e})?o.push(e):r.push(e)}));var a=[];if(r.length>0){var s=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:r}));a.push(s)}if(o.length>0){var c=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:o,relayFlag:r.length>0}));a.push(c)}return Promise.all(a).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,y(e.successGroupList)),n.push.apply(n,y(e.failureGroupList))})),zo({successGroupList:t,failureGroupList:n})})).catch((function(e){return Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,i=void 0!==n&&n,r=f(e,Ua);return this.request({protocolName:Ki,requestData:r}).then((function(e){Be.l("".concat(t._n,"._getGroupProfileAdvance ok."));var n=e.data.groups;return{successGroupList:n.filter((function(e){return at(e.errorCode)||0===e.errorCode})),failureGroupList:n.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new Ko({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return i&&Et({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:Zo(t)}))}},{key:"createGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("createGroup"),r=e.type,o=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return Zo({code:po.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Zo({code:po.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Zo({code:po.PROFANITY_FOUND});if(!["Public","Private","ChatRoom","AVChatRoom","Community"].includes(r))return Zo({code:po.ILLEGAL_GROUP_TYPE});if(!Et({type:r})){if(!Yt(o)&&Et({groupID:o}))return Zo({code:po.ILLEGAL_GROUP_ID});e.isSupportTopic=void 0}if(St(r)&&!at(e.memberList)&&e.memberList.length>0&&(e.memberList=void 0),this._canIUseJoinOption(r)||at(e.joinOption)||(e.joinOption=void 0),Et({type:r})){if(!Yt(o)&&!Et({groupID:o}))return Zo({code:po.ILLEGAL_GROUP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var a=new wo("createGroup");Be.l("".concat(i," options:"),e);var s=null,c=[];return this.request({protocolName:Wi,requestData:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(r){var o=r.data,u=o.groupID,l=o.overLimitUserIDList,d=void 0===l?[]:l;if(s=u,c=d,a.setNetworkType(n.getNetworkType()).setMessage("groupType:".concat(e.type," groupID:").concat(u," overLimitUserIDList=").concat(d)).end(),Be.l("".concat(i," ok groupID:").concat(u," overLimitUserIDList:"),d),e.type===k.GRP_AVCHATROOM)return n.getGroupProfile({groupID:u});if(e.type===k.GRP_COMMUNITY&&1===e.isSupportTopic)return n.getGroupProfile({groupID:u});Yt(e.memberList)||Yt(d)||(e.memberList=e.memberList.filter((function(e){return-1===d.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:u})]);var h=n.getModule(Rn),p=h.createCustomMessage({to:u,conversationType:k.CONV_GROUP,payload:{data:"group_create",extension:n.isIntl()?"".concat(n.getMyUserID()," created a group"):"".concat(n.getMyUserID(),"创建群组")}});return h.sendMessageInstance(p),n.emitGroupListUpdate(),n.getGroupProfile({groupID:u})})).then((function(e){var t=e.data.group,n=t.selfInfo,i=n.nameCard,r=n.joinTime;return t.updateSelfInfo({nameCard:i,joinTime:r,messageRemindType:k.MSG_REMIND_ACPT_AND_NOTE,role:k.GRP_MBR_ROLE_OWNER}),zo({group:t,overLimitUserIDList:c})})).catch((function(r){if(a.setMessage("groupType:".concat(e.type)),n.probeNetwork().then((function(e){var t=m(e,2),n=t[0],i=t[1];a.setError(r,n,i).end()})),10010===r.code||10007===r.code){n.updateGroupMap([t(t({},e),{},{groupID:s})]);var o=n.getLocalGroupProfile(s);return Be.l("".concat(i," success, but failed to get group profile.")),zo({group:o,overLimitUserIDList:c})}return Be.e("".concat(i," failed. error:"),r),Zo(r)}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===k.GRP_WORK)return Zo(new Ko({code:po.CANNOT_DISMISS_WORK}));var i=new wo("dismissGroup");return i.setMessage("groupID:".concat(e)),Be.l("".concat(n," groupID:").concat(e)),this.request({protocolName:Yi,requestData:{groupID:e}}).then((function(){return i.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),zo({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"updateGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)){var i=this.getLocalGroupProfile(e.groupID).type;this._canIUseJoinOption(i)||at(e.joinOption)||(Be.w("".concat(n," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)}if(at(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return Zo({code:po.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Zo({code:po.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Zo({code:po.PROFANITY_FOUND});var r=new wo("updateGroupProfile");return r.setMessage(JSON.stringify(e)),Be.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:Ji,requestData:e}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.hasLocalGroup(e.groupID)&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList()),zo({group:t.groupMap.get(e.groupID)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.l("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ii);if(!n)return!0;var i=n.filterText(t[e],J),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,i=e.type,r="".concat(this._n,".joinGroup");if(i===k.GRP_WORK)return Zo({code:po.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return Jo({status:k.JOIN_STATUS_ALREADY_IN_GROUP});var o=new wo("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," joinedStatus:").concat(k.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Jo({status:k.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(i){return o.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," unjoined")).end(),Be.w("".concat(r," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return Be.l("".concat(r," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,i="".concat(this._n,".").concat("applyJoinGroup"),r=e.groupID;if(!Yt(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return Zo({code:po.PROFANITY_FOUND});var o=new wo("applyJoinGroup"),a=t({},e),s=this.canIUse(q.AVCHATROOM_HISTORY_MSG);return s&&(a.historyMessageFlag=1),this.getModule(Vn).deleteTopicRoamingMessageInfo(r),this.request({protocolName:Zi,requestData:a}).then((function(e){var t=e.data,a=t.joinedStatus,c=t.longPollingKey,u=t.startSeq,l=t.avChatRoomFlag,d=t.avChatRoomKey,h=t.messageList,p="groupID:".concat(r," joinedStatus:").concat(a," longPollingKey:").concat(c," startSeq:").concat(u)+" avChatRoomFlag:".concat(l," canGetAVChatRoomHistoryMessage:").concat(s,",")+" history message count:".concat(Yt(h)?0:h.length);switch(o.setNetworkType(n.getNetworkType()).setMessage("".concat(p)).end(),Be.l("".concat(i," ok. ").concat(p)),a){case Ye:return zo({status:Ye});case We:return n.getGroupProfile({groupID:r}).then((function(e){var t=e.data.group;return n._handleJoinResult({group:t,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:h})})).catch((function(){var e=new pa({groupID:r});return n._handleJoinResult({group:e,avChatRoomFlag:l,longPollingKey:c,startSeq:u,avChatRoomKey:d,messageList:h})}));default:var f=new Ko({code:po.JOIN_GROUP_FAIL});return Be.e("".concat(i," failed. error:"),f),Zo(f)}})).catch((function(e){return o.setMessage("groupID:".concat(r)),n.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"_handleJoinResult",value:function(e){var t,n=this,i=e.group,r=e.avChatRoomFlag,o=e.longPollingKey,a=e.startSeq,s=e.avChatRoomKey,c=e.messageList,u=i.groupID;return 1===r?(this.getModule(Vn).setCompleted("".concat(k.CONV_GROUP).concat(u)),this._groupAttributesHandler.initGroupAttributesCache({groupID:u,avChatRoomKey:s}),this._groupCountersHandler.initGroupCountersCache({groupID:u,avChatRoomKey:s}),(t=at(o)?this._AVChatRoomHandler.handleJoinResult({group:i}):this._AVChatRoomHandler.startRunLoop({group:i,longPollingKey:o,startSeq:a})).then((function(){n._onAVChatRoomHistoryMessage(c)})),t):(this.emitGroupListUpdate(!0,!1),zo({status:We,group:i}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup");Be.l("".concat(n," groupID:").concat(e));var i=this.checkJoinedAVChatRoomByID(e);if(!i&&!this.hasLocalGroup(e))return Zo({code:po.MEMBER_NOT_IN_GROUP});if(i&&!this.isLoggedIn())return Be.l("".concat(n," anonymously ok. groupID:").concat(e)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Jo({groupID:e});var r=new wo("quitGroup");return r.setMessage("groupID:".concat(e)),this.request({protocolName:Qi,requestData:{groupID:e}}).then((function(){return r.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),zo({groupID:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"searchGroupByID",value:function(e){var t=this,n="".concat(this._n,".").concat("searchGroupByID"),i={groupIDList:[e]},r=new wo("searchGroupByID");return r.setMessage("groupID:".concat(e)),Be.l("".concat(n," groupID:").concat(e)),this.request({protocolName:$i,requestData:i}).then((function(e){var i=e.data.groupProfile;if(0!==i[0].errorCode)throw new Ko({code:i[0].errorCode,message:i[0].errorInfo});return r.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),zo({group:new pa(i[0])})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===k.GRP_AVCHATROOM)return Zo({code:po.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return Zo({code:po.CANNOT_CHANGE_OWNER_TO_SELF});var i=new wo("changeGroupOwner");return i.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Be.l("".concat(n," groupID:").concat(e.groupID)),this.request({protocolName:er,requestData:e}).then((function(){i.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=e.groupID,o=e.newOwnerID;t.groupMap.get(r).ownerID=o;var a=t.getModule(Un).getLocalGroupMemberList(r);if(a instanceof Map){var s=a.get(t.getMyUserID());at(s)||(s.updateRole("Member"),t.groupMap.get(r).selfInfo.role="Member");var c=a.get(o);at(c)||c.updateRole("Owner")}return t.emitGroupListUpdate(!0,!1),zo({group:t.groupMap.get(r)})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,i,r,o,a=this,s="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application;l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,i=l.payload.authentication,r=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,i=d.authentication,r=d.messageKey);var h=tr;d&&2===d.applicationType&&(h=nr,o=d.userID);var p=new wo("handleGroupApplication");return p.setMessage("groupID:".concat(n)),Be.l("".concat(s," groupID:").concat(n)),this.request({protocolName:h,requestData:{handleAction:c,handleMessage:u,applicant:t,invitee:o,groupID:n,authentication:i,messageKey:r}}).then((function(){return p.setNetworkType(a.getNetworkType()).end(),Be.l("".concat(s," ok")),l&&a._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),zo({group:a.getLocalGroupProfile(n)})})).catch((function(e){return a.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];p.setError(e,i,r).end()})),Be.e("".concat(s," failed. error"),e),Zo(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,i="".concat(this._n,".").concat("handleGroupInvitation"),r=e.message.payload,o=r.groupProfile.groupID,a=r.authentication,s=r.messageKey,c=r.operatorID,u=e.handleAction,l=new wo("handleGroupInvitation");return l.setMessage("groupID:".concat(o," inviter:").concat(c," handleAction:").concat(u)),Be.l("".concat(i," groupID:").concat(o," inviter:").concat(c," handleAction:").concat(u)),this.request({protocolName:ir,requestData:t(t({},e),{},{inviter:c,groupID:o,authentication:a,messageKey:s})}).then((function(){return l.setNetworkType(n.getNetworkType()).end(),Be.l("".concat(i," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),zo({group:n.getLocalGroupProfile(o)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),Be.e("".concat(i," failed. error"),e),Zo(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){return this._AVChatRoomHandler?this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this._AVChatRoomHandler.getGroupOnlineMemberCount(e):Jo({memberCount:0}):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e);if(Be.l("".concat(this._n,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(t)),t&&this.getModule(Vn).deleteLocalConversation("".concat(k.CONV_GROUP).concat(e)),Et({groupID:e})){var n=this.getLocalGroupProfile(e);n&&!0===n.isSupportTopic&&this.getModule(Gn).deleteTopicListInCommunity(e)}this._deleteLocalGroup(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this.getModule(Un).deleteGroupMemberList(e),this._setStorageGroupList()}},{key:"sendMessage",value:function(e,t){if(ot(e._receiverList)&&e._receiverList.length>0&&!this.canIUse(q.MSG_TO_SPECIFIED_GRP_MBR))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n=this.createGroupMessagePack(e,t);return this.request(n)}},{key:"createGroupMessagePack",value:function(e,t){var n=null;t&&t.offlinePushInfo&&(n=t.offlinePushInfo);var i="";nt(e.cloudCustomData)&&e.cloudCustomData.length>0&&(i=e.cloudCustomData);var r=[];if(rt(t)&&rt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u=void 0;ot(e._receiverList)&&e._receiverList.length>0&&(u=e._receiverList,e._receiverList.length>50&&(u=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit")));var l=this.isOnlineMessage(e,t)?1:0,d=e.getGroupAtInfoList(),h={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:i,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==k.MSG_TEXT||Yt(d)?void 0:d,onlineOnlyFlag:l,clientTime:e.clientTime,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:0===l?r:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:u,isSupportExtension:!0===e.isSupportExtension?1:0};return bt(e.to)&&(h.groupID=Ft(e.to),h.topicID=e.to),{protocolName:gi,tjgID:this.generateTjgID(e),requestData:h}}},{key:"_isVoipPush",value:function(e){var t=void 0;return at(e.disableVoipPush)||(t=!1===e.disableVoipPush?1:0),t}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return bt(e.to)&&(t.groupID=Ft(e.to),t.topicID=e.to),this.request({protocolName:rr,requestData:t})}},{key:"deleteMessage",value:function(e){var t=e.to,n=e.keyList;Be.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length));var i={groupID:t,deleter:this.getMyUserID(),keyList:n};return bt(t)&&(i.groupID=Ft(t),i.topicID=t),this.request({protocolName:vr,requestData:i})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,i=e.payload,r=e.type,o=e.version,a=void 0===o?0:o,s=e.cloudCustomData,c=t,u=void 0;bt(t)&&(c=Ft(t),u=t);var l=void 0;return jt(r)&&(l=[]).push({type:r,content:i}),this.request({protocolName:mr,requestData:{groupID:c,topicID:u,sequence:n,version:a,elements:l,cloudCustomData:s}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessage"),i=e.conversationID,r=e.groupID,o=e.sequence,a=new wo("getGroupRoamingMessages"),s=0,c=void 0;return bt(r)&&(r=Ft(c=r)),this._computeLastSequence({groupID:r,topicID:c,sequence:o}).then((function(e){return s=e,Be.l("".concat(n," groupID:").concat(r," startSequence:").concat(s)),t.request({protocolName:sr,requestData:{groupID:r,count:21,sequence:s,topicID:c}})})).then((function(e){var o=e.data,u=o.messageList,l=o.complete,d=o.invisibleSequenceList,h=void 0===d?[]:d;at(u)?Be.l("".concat(n," ok. complete:").concat(l," but messageList is undefined!")):Be.l("".concat(n," ok. complete:").concat(l," count:").concat(u.length));var p=t._getMinSequence(h,u)-1;a.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(s," complete:").concat(l," nextSequence:").concat(p)).end();var f=t.getModule(Vn),g=[];return Yt(u)||(f.updateRoamingMessageSequence(i,p),g=f.onRoamingMessage(u,i),f.updateIsRead(i),f.patchConversationLastMessage(i)),(2===l||p<=1)&&(f.setCompleted(i),p=""),Be.l("".concat(n," nextReqID:").concat(p,", stored message count:").concat(g.length,", invisible sequence count:").concat(h.length)),{nextReqID:p+"",storedMessageList:g}})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];a.setError(e,i,o).setMessage("groupID:".concat(r," topicID:").concat(c," startSequence:").concat(s)).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(k.CONV_GROUP,"")}},{key:"_getMinSequence",value:function(e,t){var n=0;Yt(t)||(n=t[t.length-1].sequence);var i=0;return Yt(e)||(i=e[e.length-1]),Be.l("".concat(this._n,"._getMinSequence minVisibleSequence:").concat(n," minInvisibleSequence:").concat(i)),i>0&&i<n?i:n}},{key:"getReadReceiptList",value:function(e){var t=this,n="".concat(this._n,".").concat("getReadReceiptList"),i=this._getGroupIDOfMessage(e[0]),r=this.getMyUserID(),o=e.filter((function(e){return e.from===r&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(Be.l("".concat(n," groupID:").concat(i," sequenceList:").concat(JSON.stringify(o))),0===o.length)return Jo({messageList:e});var a=new wo("getReadReceiptList");return a.setMessage("groupID:".concat(i)),this.request({protocolName:cr,requestData:{groupID:i,sequenceList:o}}).then((function(t){a.end(),Be.l("".concat(n," ok"));var i=t.data.readReceiptList;return ot(i)&&i.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),zo({messageList:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"sendReadReceipt",value:function(e){var t=this,n="".concat(this._n,".").concat("sendReadReceipt"),i=this._getGroupIDOfMessage(e[0]),r=new wo("sendReadReceipt");r.setMessage("groupID:".concat(i));var o=this.getMyUserID(),a=e.filter((function(e){return e.from!==o&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));return 0===a.length?Zo({code:po.READ_RECEIPT_MESSAGE_LIST_EMPTY}):(Be.l("".concat(n,". sequenceList:").concat(JSON.stringify(a))),this.request({protocolName:ur,requestData:{groupID:i,sequenceList:a}}).then((function(e){return r.end(),Be.l("".concat(n," ok")),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,i=e.filter,r=e.cursor,o=e.count,a=this._getGroupIDOfMessage(n),s=n.ID,c=n.sequence,u="".concat(this._n,".").concat("getReadReceiptDetail"),l=this._receiptDetailCompleteMap.get(s)||!1,d=0!==i&&1!==i?0:i,h=nt(r)?r:"",p=!et(o)||o<=0||o>=100?100:o,f="groupID:".concat(a," sequence:").concat(c," cursor:").concat(h," filter:").concat(d," completeFlag:").concat(l);Be.l("".concat(u," ").concat(f));var g={cursor:"",isCompleted:!1,messageID:s,unreadUserIDList:[],readUserIDList:[]},_=new wo("getReadReceiptDetail");return _.setMessage(f),this.request({protocolName:dr,requestData:{groupID:a,sequence:c,flag:d,cursor:h,count:p}}).then((function(e){_.end();var n=e.data,i=n.cursor,r=n.isCompleted,o=n.unreadUserIDList,a=n.readUserIDList;return g.cursor=i,1===r&&(g.isCompleted=!0,t._receiptDetailCompleteMap.set(s,!0)),0===d?g.readUserIDList=a.map((function(e){return e.userID})):1===d&&(g.unreadUserIDList=o.map((function(e){return e.userID}))),Be.l("".concat(u," ok")),zo(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];_.setError(e,i,r).end()})),Be.w("".concat(u," failed. error:"),e),Zo(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),i=new wo("getGroupRoamingMessagesHopping"),r=e.groupID,o=e.count,a=e.sequence,s=e.direction,c=a;1===s&&(c=a+o-1);var u=void 0;bt(r)&&(r=Ft(u=r));var l="".concat(u?"topicID:".concat(u):"groupID:".concat(r)," sequence:").concat(a," direction:").concat(s);return Be.l("".concat(n," ").concat(l)),this.request({protocolName:sr,requestData:{groupID:r,topicID:u,count:o,sequence:c}}).then((function(r){var o=r.data,c=o.messageList,u=o.complete,d="complete:".concat(u," count:").concat(c?c.length:0);if(Be.l("".concat(n," ok. ").concat(d)),i.setNetworkType(t.getNetworkType()).setMessage("".concat(l," ").concat(d)).end(),2===u||Yt(c)){var h=t._computeResult();return zo(h)}var p="".concat(k.CONV_GROUP).concat(e.groupID),f=t.getModule(Vn).onRoamingMessage(c,p,!1),g=t._computeResult({direction:s,sequence:a,remoteMessageList:c,processedMessageList:f});return zo(g)})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),s=n[0],c=n[1];i.setError(e,s,c).setMessage("groupID:".concat(r," sequence:").concat(a," count:").concat(o)).end()})),Be.w("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(at(e))return t.isCompleted=!0,t;var n=e.direction,i=e.sequence,r=e.remoteMessageList,o=void 0===r?[]:r,a=e.processedMessageList,s=void 0===a?[]:a,c=o.length;return 1===n?(t.nextMessageSeq=o[0].sequence+1,s.forEach((function(e){e.sequence>=i&&t.messageList.push(e)})),0===t.messageList.length&&o[0].sequence<i&&(t.isCompleted=!0,t.nextMessageSeq=""),t):(t.nextMessageSeq=o[c-1].sequence-1,t.messageList=y(s),0===t.nextMessageSeq&&(t.isCompleted=!0,t.nextMessageSeq=""),t)}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,i=e.lastMessageSeq,r="".concat(this._n,".setMessageRead");Be.l("".concat(r," conversationID:").concat(n," lastMessageSeq:").concat(i)),et(i)||this.outputWarning("DoNotModifyLastSeq");var o=new wo("setGroupMessageRead");o.setMessage("".concat(n,"-").concat(i));var a=n.replace(k.CONV_GROUP,""),s=void 0;return bt(a)&&(a=Ft(s=a)),this.request({protocolName:or,requestData:{groupID:a,topicID:s,messageReadSeq:i}}).then((function(){o.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(r," ok."));var e=t.getModule(Vn);e.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:i});var c=!0;if(!at(s)){c=!1;var u=t.getModule(Gn).getLocalTopic(a,s);u&&u.updateSelfInfo({readedSequence:i})}return e.updateUnreadCount(n,c),zo()})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.l("".concat(r," failed. error:"),e),Zo(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=e.topicID,i=void 0===n?void 0:n,r=e.sequence;return r>0?Promise.resolve(r):at(i)||this.hasLocalGroup(t)?at(i)?this.getGroupLastSequence(t):this.getTopicLastSequence({groupID:t,topicID:i}):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupLastSequence"),i=new wo("getGroupLastSequence"),r=0,o="";if(this.hasLocalGroup(e)){var a=this.getLocalGroupProfile(e),s=a.lastMessage;if(s.lastSequence>0&&!1===s.onlineOnlyFlag)return r=s.lastSequence,o="got lastSequence:".concat(r," from local group profile[lastMessage.lastSequence]. groupID:").concat(e),Be.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r);if(a.nextMessageSeq>1)return r=a.nextMessageSeq-1,o="got lastSequence:".concat(r," from local group profile[nextMessageSeq]. groupID:").concat(e),Be.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r)}var c="GROUP".concat(e),u=this.getModule(Vn).getLocalConversation(c);if(u&&u.lastMessage.lastSequence&&!1===u.lastMessage.onlineOnlyFlag)return r=u.lastMessage.lastSequence,o="got lastSequence:".concat(r," from local conversation profile[lastMessage.lastSequence]. groupID:").concat(e),Be.l("".concat(n," ").concat(o)),i.setNetworkType(this.getNetworkType()).setMessage("".concat(o)).end(),Promise.resolve(r);var l={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(l).then((function(a){var s=a.data.successGroupList;return Yt(s)?Be.l("".concat(n," successGroupList is empty. groupID:").concat(e)):(r=s[0].nextMessageSeq-1,o="got lastSequence:".concat(r," from getGroupProfileAdvance. groupID:").concat(e),Be.l("".concat(n," ").concat(o))),i.setNetworkType(t.getNetworkType()).setMessage("".concat(o)).end(),r})).catch((function(r){return t.probeNetwork().then((function(t){var n=m(t,2),o=n[0],a=n[1];i.setError(r,o,a).setMessage("get lastSequence failed from getGroupProfileAdvance. groupID:".concat(e)).end()})),Be.w("".concat(n," failed. error:"),r),Zo(r)}))}},{key:"getTopicLastSequence",value:function(e){var t=this,n=e.groupID,i=e.topicID,r="".concat(this._n,".").concat("getTopicLastSequence"),o=new wo("getTopicLastSequence"),a=0,s="",c=this.getModule(Gn);return c.hasLocalTopic(n,i)?(a=c.getLocalTopic(n,i).nextMessageSeq-1,s="get lastSequence:".concat(a," from local topic info[nextMessageSeq]. topicID:").concat(i),Be.l("".concat(r," ").concat(s)),o.setNetworkType(this.getNetworkType()).setMessage("".concat(s)).end(),Promise.resolve(a)):c.getTopicList({groupID:n,topicIDList:[i]}).then((function(e){var n=e.data.successTopicList;return Yt(n)?Be.l("".concat(r," successTopicList is empty. topicID:").concat(i)):(a=n[0].nextMessageSeq-1,s="get lastSequence:".concat(a," from getTopicList. topicID:").concat(i),Be.l("".concat(r," ").concat(s))),o.setNetworkType(t.getNetworkType()).setMessage("".concat(s)).end(),a})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),r=n[0],a=n[1];o.setError(e,r,a).setMessage("get lastSequence failed from getTopicList. topicID:".concat(i)).end()})),Be.w("".concat(r," failed. error:"),e),Zo(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.hasJoinedAVChatRoom():0}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.getJoinedAVChatRoom():[]}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==k.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e){if(!Yt(e)){Be.l("".concat(this._n,"._onAVChatRoomHistoryMessage count:").concat(e.length));var n=[];e.forEach((function(e){n.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(n)}}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onMessage(e)}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=this,n=new wo("getGroupSimplifiedInfo"),i={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}};return this.getGroupProfileAdvance(i).then((function(i){var r=i.data.successGroupList;return n.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(e," type:").concat(r[0].type)).end(),r[0]})).catch((function(i){t.probeNetwork().then((function(t){var r=m(t,2),o=r[0],a=r[1];n.setError(i,o,a).setMessage("groupID:".concat(e)).end()}))}))}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!Yt(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&Yt(t)}},{key:"getMessageExtensions",value:function(e,t){return Be.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.request({protocolName:br,requestData:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Be.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.request({protocolName:Er,requestData:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"getGroupNotify",value:function(e){var n=this;if(this.hasLocalGroup(e)){var i=this.getLocalGroupProfile(e),r=i.type,o=i.isSupportTopic;if(!St(r)&&!o){var a="".concat(this._n,".getGroupNotify"),s=this._getGroupLastRevokedTime(e),c=1e3*xe();Be.l("".concat(a," groupID:").concat(e," type:").concat(r," beginTime:").concat(s," endTime:").concat(c)),this.request({protocolName:Mr,requestData:{type:Et({type:r,groupID:e})?k.GRP_COMMUNITY:void 0,groupID:e,beginTime:s,endTime:c}}).then((function(i){var r=i.data,o=r.nextRevokedTime,s=r.notifyList;Be.l("".concat(a," ok. groupID:").concat(e," nextRevokedTime:").concat(o));var c={dataList:[{elements:{revokedInfos:[]}}]};ot(s)&&s.forEach((function(n){c.dataList[0].elements.revokedInfos.push({groupID:e,sequence:n.sequence,random:n.random,revokerInfo:t({},n.revokerInfo)})})),n.onGroupMessageRevoked(c),0!==o?(n._setGroupLastRevokedTime(e,o),n.getGroupNotify(e)):n._setGroupLastRevokedTime(e,1e3*xe())})).catch((function(e){Be.e("".concat(a," failed. error:"),e)}))}}}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler&&this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var t=this.getLocalGroupProfile(e);return t&&St(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return function(e){return e===k.GRP_PUBLIC}(e)||Et({type:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler&&this._AVChatRoomHandler.reset()}}]),i}(si),Va=function(){function e(t){r(this,e),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return a(e,[{key:"_initMember",value:function(e){this.updateMember(e)}},{key:"updateMember",value:function(e){var t=[null,void 0,"",0,NaN];e.memberCustomField&&Ct(this.memberCustomField,e.memberCustomField),ht(this,e,["memberCustomField","marks"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){at(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){at(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&Ct(this.memberCustomField,e)}}]),e}(),Fa=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="GroupMemberModule",t.groupMemberListMap=new Map,t.getInnerEmitterInstance().on(ta,t._onProfileUpdated,g(t)),t}return a(i,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,i=function(e){var i=n[e];t.groupMemberListMap.forEach((function(e){e.has(i.userID)&&e.get(i.userID).updateMember({nick:i.nick,avatar:i.avatar})}))},r=0;r<n.length;r++)i(r)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,r=void 0===i?0:i,o=e.count,a=void 0===o?15:o,s=e.filter,c=void 0===s?void 0:s,u="".concat(this._n,".").concat("getGroupMemberList"),l=this.getModule(xn),d=l.hasLocalGroup(n);if(Be.l("".concat(u," groupID:").concat(n," offset:").concat(r," count:").concat(a," hasLocalGroup:").concat(d)),!d)return Jo({memberList:[],offset:0});if(l.getLocalGroupProfile(n).type===k.GRP_AVCHATROOM){if(this.canIUse(q.AVCHATROOM_MBR_LIST))return this._getAVChatRoomMemberList({groupID:n,offset:r,filter:c});this.outputWarning("LiveOnlineMember")}var h=new wo("getGroupMemberList"),p=0,f={groupID:n,limit:a>100?100:a};Et({groupID:n})?f.next="".concat(r):(f.offset=r,p=r+a);var g=[];return this.request({protocolName:Dr,requestData:f}).then((function(e){var i=e.data,r=i.members,o=i.memberNum,a=i.next,s=void 0===a?void 0:a;if(at(s)||(p=Yt(s)?0:s),!ot(r)||0===r.length)return p=0,Promise.resolve([]);var c=t.getModule(xn);return c.hasLocalGroup(n)&&(c.getLocalGroupProfile(n).memberNum=o),g=t._updateLocalGroupMemberMap(n,r),t.getModule(On).getUserProfile({userIDList:r.map((function(e){return e.userID})),tagList:[qe.NICK,qe.AVATAR]})})).then((function(e){var i=e.data;if(!ot(i)||0===i.length)return Jo({memberList:[],offset:p});var o=i.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));return t._updateLocalGroupMemberMap(n,o),g.length<a&&(p=0),h.setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(n," offset:").concat(r," count:").concat(a)).end(),Be.l("".concat(u," ok.")),zo({memberList:g,offset:p})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];h.setError(e,i,r).end()})),Be.e("".concat(u," failed. error:"),e),Zo(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var t=this,n=e.groupID,i=e.offset,r=e.filter,o="".concat(this._n,".").concat("_getAVChatRoomMemberList"),a=new wo("_getAVChatRoomMemberList");return a.setMessage("groupID:".concat(n," offset:").concat(i," filter:").concat(r)),this.request({protocolName:Ar,requestData:{groupID:n,offset:i,filter:r}}).then((function(e){var i=e.data,r=i.memberList,s=void 0===r?[]:r,c=i.offset,u=void 0===c?0:c;a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(o," ok. member count:").concat(s.length,", next request timestamp:").concat(u));var l=t._updateLocalGroupMemberMap(n,s);return zo({memberList:l,offset:u})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(o," failed. error:"),e),Zo(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("getGroupMemberProfile"),r=new wo("getGroupMemberProfile");r.setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)),Be.l("".concat(i," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var o=e.groupID,a=e.userIDList;return this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:a})).then((function(e){var t=e.data.members;return ot(t)&&0!==t.length?(n._updateLocalGroupMemberMap(o,t),n.getModule(On).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[qe.NICK,qe.AVATAR]})):Jo([])})).then((function(e){var t=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}}));n._updateLocalGroupMemberMap(o,t);var i=a.filter((function(e){return n.hasLocalGroupMember(o,e)})).map((function(e){return n.getLocalGroupMemberInfo(o,e)}));return r.setNetworkType(n.getNetworkType()).end(),zo({memberList:i})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),i=e.groupID,r=this.getModule(xn).getLocalGroupProfile(i),o=r.type,a=new wo("addGroupMember");if(a.setMessage("groupID:".concat(i," groupType:").concat(o)),St(o)){var s=new Ko({code:po.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return a.setError(s,!0,this.getNetworkType()).end(),Zo(s)}return e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Be.l("".concat(n," groupID:").concat(i)),this.request({protocolName:Lr,requestData:e}).then((function(i){var o=i.data.members;Be.l("".concat(n," ok"));var s=o.filter((function(e){return 1===e.result})).map((function(e){return e.userID})),c=o.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),u=o.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),l=o.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),d="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(s,", ")+"failureUserIDList:".concat(c,", ")+"existedUserIDList:".concat(u,", ")+"overLimitUserIDList:".concat(l);return a.setNetworkType(t.getNetworkType()).setMoreMessage(d).end(),0===s.length?zo({successUserIDList:s,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l}):(r.memberCount+=s.length,t._updateConversationGroupProfile(r),zo({successUserIDList:s,failureUserIDList:c,existedUserIDList:u,overLimitUserIDList:l,group:r}))})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,r=e.userIDList,o=this.getModule(xn).getLocalGroupProfile(i);if(at(o))return Zo({code:po.CANNOT_FIND_GROUP});if(St(o.type))return this.canIUse(q.AVCHATROOM_BAN_MBR)?this._banAVChatRoomMember(e):Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var a=new wo("deleteGroupMember"),s="groupID:".concat(i," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r));return a.setMessage(s),Be.l("".concat(n," groupID:").concat(i," userIDList:"),r),this.request({protocolName:Or,requestData:e}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),o.memberCount-=1,t._updateConversationGroupProfile(o),t.deleteLocalGroupMembers(i,r),zo({group:o,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_updateConversationGroupProfile",value:function(e){this.getModule(Vn).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,r=e.userIDList,o="groupID:".concat(i," ").concat(r.length>5?"userIDList.length:".concat(r.length):"userIDList:".concat(r)),a=new wo("deleteGroupMember");a.setMessage(o),Be.l("".concat(n," groupID:").concat(i," userIDList:"),r);var s=this.getModule(xn).getLocalGroupProfile(i);return at(e.duration)||0===e.duration?Zo({code:po.BAN_DURATION_INVALID}):this.request({protocolName:Nr,requestData:e}).then((function(){return a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),t.deleteLocalGroupMembers(i,r),zo({group:s,userIDList:r})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,i=e.userID,r=e.muteTime,o="".concat(this._n,".").concat("setGroupMemberMuteTime");if(i===this.getMyUserID())return Zo(new Ko({code:po.CANNOT_MUTE_SELF}));Be.l("".concat(o," groupID:").concat(n," userID:").concat(i));var a=new wo("setGroupMemberMuteTime");return a.setMessage("groupID:".concat(n," userID:").concat(i," muteTime:").concat(r)),this.modifyGroupMemberInfo({groupID:n,userID:i,muteTime:r}).then((function(e){a.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(o," ok"));var i=t.getModule(xn);return zo({group:i.getLocalGroupProfile(n),member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(o," failed. error:"),e),Zo(e)}))}},{key:"setGroupMemberRole",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberRole"),i=e.groupID,r=e.userID,o=e.role,a=this.getModule(xn).getLocalGroupProfile(i);if(a.selfInfo.role!==k.GRP_MBR_ROLE_OWNER)return Zo({code:po.NOT_OWNER});if([k.GRP_WORK,k.GRP_AVCHATROOM].includes(a.type))return Zo({code:po.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});var s=[k.GRP_MBR_ROLE_ADMIN,k.GRP_MBR_ROLE_MEMBER];if(Et({groupID:i})&&s.push(k.GRP_MBR_ROLE_CUSTOM),s.indexOf(o)<0)return Zo({code:po.INVALID_MEMBER_ROLE});if(r===this.getMyUserID())return Zo({code:po.CANNOT_SET_SELF_MEMBER_ROLE});var c=new wo("setGroupMemberRole");return c.setMessage("groupID:".concat(i," userID:").concat(r," role:").concat(o)),Be.l("".concat(n," groupID:").concat(i," userID:").concat(r)),this.modifyGroupMemberInfo({groupID:i,userID:r,role:o}).then((function(e){return c.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok")),zo({group:a,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ii);if(!n)return!0;var i=n.filterText(t[e],Z),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberNameCard");if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return Zo({code:po.PROFANITY_FOUND});var i=e.groupID,r=e.userID,o=void 0===r?this.getMyUserID():r,a=e.nameCard;Be.l("".concat(n," groupID:").concat(i," userID:").concat(o));var s=new wo("setGroupMemberNameCard");return s.setMessage("groupID:".concat(i," userID:").concat(o," nameCard:").concat(a)),this.modifyGroupMemberInfo({groupID:i,userID:o,nameCard:a}).then((function(e){Be.l("".concat(n," ok")),s.setNetworkType(t.getNetworkType()).end();var r=t.getModule(xn).getLocalGroupProfile(i);return o===t.getMyUserID()&&r&&r.setSelfNameCard(a),zo({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupMemberCustomField"),i=e.groupID,r=e.userID,o=void 0===r?this.getMyUserID():r,a=e.memberCustomField;Be.l("".concat(n," groupID:").concat(i," userID:").concat(o));var s=new wo("setGroupMemberCustomField");return s.setMessage("groupID:".concat(i," userID:").concat(o," memberCustomField:").concat(JSON.stringify(a))),this.modifyGroupMemberInfo({groupID:i,userID:o,memberCustomField:a}).then((function(e){s.setNetworkType(t.getNetworkType()).end(),Be.l("".concat(n," ok"));var r=t.getModule(xn).getLocalGroupProfile(i);return zo({group:r,member:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];s.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,i=e.groupID,r=e.userID,o=void 0;return bt(i)&&(i=Ft(o=i)),this.request({protocolName:xr,requestData:t(t({},e),{},{groupID:i,topicID:o})}).then((function(){if(n.hasLocalGroupMember(i,r)){var t=n.getLocalGroupMemberInfo(i,r);return at(e.muteTime)||t.updateMuteUntil(e.muteTime),at(e.role)||t.updateRole(e.role),at(e.nameCard)||t.updateNameCard(e.nameCard),at(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t}return n.getGroupMemberProfile({groupID:i,userIDList:[r]}).then((function(e){return m(e.data.memberList,1)[0]}))}))}},{key:"markGroupMemberList",value:function(e){var t=this,n="".concat(this._n,".").concat("markGroupMemberList"),i=e.groupID,r=e.markType,o=e.enableMark,a=e.userIDList,s=void 0===a?[]:a,c="groupID:".concat(i," markType:").concat(r," enableMark:").concat(o," userIDList count: ").concat(s.length);Be.l("".concat(n," ").concat(c));var u=2,l=[];!0===o&&(u=1);var d=y(s);s.length>500&&(d=s.slice(0,500),Be.w("".concat(n," ").concat(zt(500)))),d.forEach((function(e){l.push({userID:e,markType:[r]})})),d=null;var h=new wo("markGroupMemberList");return h.setMessage("".concat(c)),this.request({protocolName:Pr,requestData:{groupID:i,operationType:u,memberList:l}}).then((function(e){var i=e.data.memberList,r=void 0===i?[]:i,o=[],a=[];r.length===s.length?o.push.apply(o,y(s)):(r.forEach((function(e){o.push(e.userID)})),s.forEach((function(e){o.includes(e)||a.push(e)})));var c="success count:".concat(o.length," fail count:").concat(a.length);return h.setNetworkType(t.getNetworkType()).setMessage(c).end(),Be.l("".concat(n," ok. ").concat(c)),zo({successUserIDList:o,failureUserIDList:a})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];h.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({protocolName:Rr,requestData:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return ot(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new Va(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),i}(si),Ba=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],ja=function(e,t){return Yt(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:Bt(e.type,e.payload,t),nick:e.nick||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}},qa=function(){function e(t,n){r(this,e),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=ja(t.lastMessage,n),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(t)}return a(e,[{key:"_initTopic",value:function(e){for(var t in e)Ba.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.unreadCount=e}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=ja(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){at(e.selfInfo)||this.updateSelfInfo(e.selfInfo),at(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),ht(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0!==ht(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return this.unreadCount>=1&&(this.unreadCount-=1,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),e}(),Ha=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="TopicModule",t._topicMap=new Map,t._getTopicTimeMap=new Map,t.TOPIC_CACHE_TIME=300,t.TOPIC_LAST_ACTIVE_TIME=3600,t.getInnerEmitterInstance().on(ea,t._onCloudConfigUpdated,g(t)),t}return a(i,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");at(e)||(this.TOPIC_CACHE_TIME=Number(e)),at(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(M.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,i=e.topicIDList;(void 0===i?[]:i).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOuterEvent(M.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=e.messageRemindType,r=this.getLocalTopic(t,n);if(r){var o=r.updateSelfInfo({messageRemindType:i});o&&this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:t,topic:r}),Be.d("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(n)+" messageRemindType:".concat(i," isTopicUpdated:").concat(o))}}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,i=this.getLocalTopic(t,n);i&&(i.updateTopic(e),this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:t,topic:i}))}},{key:"onConversationProxy",value:function(e){var t=e.topicID,n=e.unreadCount,i=e.groupAtInfoList,r=Ft(t),o=this.getLocalTopic(r,t),a=!1;o&&(at(n)||o.unreadCount===n||(o.updateUnreadCount(n),a=!0),at(i)||(o.updateGroupAtInfoList(i),a=!0)),a&&this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:r,topic:o})}},{key:"onMessageSent",value:function(e){var t=e.groupID,n=e.topicID,i=e.lastMessage,r=this.getLocalTopic(t,n);r&&(r.nextMessageSeq+=1,r.updateLastMessage(i),this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:t,topic:r}))}},{key:"onMessageModified",value:function(e){var t=e.to,n=e.time,i=e.sequence,r=e.elements,o=e.cloudCustomData,a=e.messageVersion,s=Ft(t),c=this.getLocalTopic(s,t);if(c){var u=c.lastMessage;Be.d("".concat(this._n,".onMessageModified topicID:").concat(t," lastMessage:"),JSON.stringify(u),"options:",JSON.stringify(e)),u&&(null===u.payload||u.lastTime===n&&u.lastSequence===i&&u.version!==a)&&(u.type=r[0].type,u.payload=r[0].content,u.messageForShow=Bt(u.type,u.payload,this.isIntl()),u.cloudCustomData=o,u.version=a,u.lastSequence=i,u.lastTime=n,this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:s,topic:c}))}}},{key:"onMessageRevoked",value:function(e){var t=this;if(0!==e.length){var n=null,i=null,r=!1;e.forEach((function(e){var o=e.to;i=Ft(o),(n=t.getLocalTopic(i,o))&&(n.reduceUnreadCount()&&(r=!0),n.isLastMessageRevoked(e)&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),r=!0))})),r&&this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:i,topic:n})}}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=e.sequence,i=Ft(t),r=this.getLocalTopic(i,t),o=!1;return r&&(o=r.isLastMessageRevoked({sequence:n})),o}},{key:"getJoinedCommunityList",value:function(){return this.getModule(xn).getGroupList({isGroupWithTopicOnly:!0}).then((function(e){var t=e.data.groupList;return zo({groupList:void 0===t?[]:t})})).catch((function(e){return Zo(e)}))}},{key:"createTopicInCommunity",value:function(e){var n=this,i="".concat(this._n,".").concat("createTopicInCommunity"),r=e.topicID;if(!at(r)&&!bt(r))return Zo({code:po.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return Zo({code:po.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Zo({code:po.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Zo({code:po.PROFANITY_FOUND});var o=new wo("createTopicInCommunity");return this.request({protocolName:$r,requestData:t({},e)}).then((function(r){var a=r.data.topicID;return o.setMessage("topicID:".concat(a)).setNetworkType(n.getNetworkType()).end(),Be.l("".concat(i," ok")),n._updateTopicMap([t(t({},e),{},{topicID:a})]),zo({topicID:a})})).catch((function(e){return n.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];o.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),i=e.groupID,r=e.topicIDList,o=void 0===r?[]:r,a=new wo("deleteTopicFromCommunity");return a.setMessage("groupID:".concat(i," topicIDList:").concat(o)),this.request({protocolName:eo,requestData:{groupID:i,topicIDList:o}}).then((function(e){var n=e.data.resultList,r=[],o=[];(void 0===n?[]:n).forEach((function(e){var t=e.topicID,n=e.errorCode,i=e.errorInfo;0===n?r.push({topicID:t}):o.push({topicID:t,code:n,message:i})}));var s="success count:".concat(r.length,", fail count:").concat(o.length);return a.setMoreMessage("".concat(s)).setNetworkType(t.getNetworkType()).end(),Be.l("".concat(s)),r.forEach((function(e){t._deleteLocalTopic(i,e.topicID)})),zo({successTopicList:r,failureTopicList:o})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"updateTopicProfile",value:function(e){var n=this,i="".concat(this._n,".").concat("updateTopicProfile");if(Be.l("".concat(i," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return Zo({code:po.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return Zo({code:po.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return Zo({code:po.PROFANITY_FOUND});var r=new wo("updateTopicProfile");return r.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),at(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.request({protocolName:to,requestData:t({},e)}).then((function(){return r.setNetworkType(n.getNetworkType()).end(),Be.l("".concat(i," ok")),n._updateTopicMap([e]),zo({topic:n.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return n.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];r.setError(e,i,o).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"getTopicList",value:function(e){var n=this,i="".concat(this._n,".").concat("getTopicList"),r=e.groupID,o=e.topicIDList,a=void 0===o?[]:o,s=0===a.length,c=new wo("getTopicList");if(c.setMessage("groupID:".concat(r)),this._getTopicTimeMap.has(r)){var u=this._getTopicTimeMap.get(r),l=u.isGetAll,d=u.time;if((l||!l&&!s)&&Date.now()-d<1e3*this.TOPIC_CACHE_TIME){var h=this._getLocalTopicList(r,a);if(s||h.length===a.length)return c.setNetworkType(this.getNetworkType()).setMoreMessage("from cache, topic count:".concat(h.length)).end(),Be.l("".concat(i," groupID:").concat(r," from cache, topic count:").concat(h.length)),Jo({successTopicList:h,failureTopicList:[]})}}return this.request({protocolName:no,requestData:{groupID:r,topicIDList:a}}).then((function(e){var o=e.data.topicInfoList,a=[],u=[],l=[];(void 0===o?[]:o).forEach((function(e){var n=e.topic,i=e.selfInfo,r=e.errorCode,o=e.errorInfo,s=n.topicID;0===r?(a.push(t(t({},n),{},{selfInfo:i})),u.push(s)):l.push({topicID:s,code:r,message:o})})),n._updateTopicMap(a),n._handleTopicAtInfo(a);var d="success count:".concat(u.length,", fail count:").concat(l.length);c.setNetworkType(n.getNetworkType()).setMoreMessage("".concat(d)).end(),Be.l("".concat(i," groupID:").concat(r," from remote, ").concat(d));var h=[];return Yt(u)||(n._getTopicTimeMap.set(r,{time:Date.now(),isGetAll:s}),h=n._getLocalTopicList(r,u)),zo({successTopicList:h,failureTopicList:l})})).catch((function(e){return n.probeNetwork(e).then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)&&(n=this._topicMap.get(e).get(t)),n}},{key:"_getLocalTopicList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._topicMap.get(e),i=[];return n&&(i=y(n.values())),0===t.length?i:i.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&(this._topicMap.get(e).delete(t),Be.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var i=e.groupID,r=e.topicID,o=null;t._topicMap.has(i)||t._topicMap.set(i,new Map),t._topicMap.get(i).has(r)?(o=t._topicMap.get(i).get(r)).updateTopic(e):(t._getTopicLastMessage(e),o=new qa(e,t.isIntl()),t._topicMap.get(i).set(r,o));var a=t._computeUnreadCount(o);o.updateUnreadCount(a),n.push({conversationID:"".concat(k.CONV_GROUP).concat(r),type:k.CONV_TOPIC,unreadCount:a})})),n.length>0&&this.getModule(Vn).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;at(e)?y(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=y(this._topicMap.keys()),n=[];t.forEach((function(t){var i=[];e._getLocalTopicList(t).forEach((function(t){var n=t.lastMessage.lastTime,r=void 0===n?0:n;Date.now()-1e3*r<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(t.topicID)})),i.length>0&&n.push({groupID:t,topicIDList:i})})),Be.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t=this;if(0!==e.length){var n=e.shift(),i=n.topicIDList.length>5?"topicIDList.length:".concat(n.topicIDList.length):"topicIDList:".concat(n.topicIDList),r=new wo("relayGetTopicList");r.setMessage(i),Be.l("".concat(this._n,"._relayGetTopicList. ").concat(i)),this.getTopicList(n).then((function(){r.setNetworkType(t.getNetworkType()).end(),t._relayGetTopicList(e)})).catch((function(n){t.probeNetwork().then((function(e){var t=m(e,2),i=t[0],o=t[1];r.setError(n,i,o).end()})),t._relayGetTopicList(e)}))}}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var i=e.groupID,r=e.topicID,o=e.groupAtInfoList,a=[];at(o)||(o.forEach((function(e){a.push(t(t({},e),{},{groupID:i,topicID:r}))})),n.getModule(Vn).onNewGroupAtTips({dataList:a}))}))}},{key:"_getTopicLastMessage",value:function(e){if(!at(e.lastMsg)){var t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:Yt(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker};e.lastMessage=t}}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),i=this.getModule(Vn);n.forEach((function(n){var r=n.topicID;t._deleteLocalTopic(e,r),t._getTopicTimeMap.delete(e),i.deleteLocalConversation("".concat(k.CONV_GROUP).concat(r))}))}},{key:"_computeUnreadCount",value:function(e){var t=e.selfInfo,n=t.excludedUnreadSequenceList,i=t.readedSequence,r=e.nextMessageSeq-e.selfInfo.readedSequence-1;if(ot(n)){var o=0;n.forEach((function(t){t>=i&&t<=e.nextMessageSeq-1&&(o+=1)})),o>=1&&(r-=o)}return r<0?0:r}},{key:"_filterProfanity",value:function(e,t){var n=this.getModule(ii);if(!n)return!0;var i=n.filterText(t[e],J),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"updateLastMessage",value:function(e,t){var n=Ft(e),i=this.getLocalTopic(n,e);if(i){var r=t.sequence+1;i.updateNextMessageSeq(r),i.updateLastMessage(t),this.emitOuterEvent(M.TOPIC_UPDATED,{groupID:n,topic:i})}}},{key:"getMessageExtensions",value:function(e,t){Be.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=Ft(e.to);return this.request({protocolName:br,requestData:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Be.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n));var i=Ft(e.to);return this.request({protocolName:Er,requestData:{groupID:i,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),i}(si),za=function(){function e(t){r(this,e),this._userModule=t,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}return a(e,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),i=e.userIDList;e.fromAccount=this._userModule.getMyAccount(),i.length>100&&(Be.w("".concat(n," ").concat(zt(100))),i.length=100);for(var r,o=[],a=[],s=0,c=i.length;s<c;s++)r=i[s],this._userModule.isMyFriend(r)&&this._contains(r)?a.push(this._getProfileFromMap(r)):o.push(r);if(0===o.length)return Jo(a);e.toAccount=o;var u=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l;var d=new wo("getUserProfile");return d.setMessage(i.length>5?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),this._userModule.request({protocolName:_i,requestData:e}).then((function(e){d.setNetworkType(t._userModule.getNetworkType()).end(),Be.i("".concat(n," ok"));var i=t._handleResponse(e).concat(a);return zo(u?i[0]:i)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];d.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"getMyProfile",value:function(){var e=this._userModule.getMyAccount(),t="".concat(this._n,".getMyProfile");if(Be.l("".concat(t," myAccount:").concat(e)),this._fill(),this._contains(e)){var n=this._getProfileFromMap(e);return Be.d("".concat(t," from cache, myProfile:").concat(JSON.stringify(n))),Jo(n)}return this.getUserProfile({fromAccount:e,userIDList:[e],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!ot(t))return[];for(var n=[],i=Date.now(),r=0,o=t.length;r<o;r++){var a=t[r],s=a.to,c=a.profileItem;if("@TLS#NOT_FOUND"!==s&&""!==s){var u=this._update(s,this._getLatestProfileFromResponse(s,c)).latestProfile;n.push(u)}}return Be.l("".concat(this._n,"._handleResponse cost ").concat(Date.now()-i," ms")),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!Yt(t))for(var i=0,r=t.length;i<r;i++)if(t[i].tag.indexOf("Tag_Profile_Custom")>-1)n.profileCustomField.push({key:t[i].tag,value:t[i].value});else switch(t[i].tag){case qe.NICK:n.nick=t[i].value;break;case qe.GENDER:n.gender=t[i].value;break;case qe.BIRTHDAY:n.birthday=t[i].value;break;case qe.LOCATION:n.location=t[i].value;break;case qe.SELFSIGNATURE:n.selfSignature=t[i].value;break;case qe.ALLOWTYPE:n.allowType=t[i].value;break;case qe.LANGUAGE:n.language=t[i].value;break;case qe.AVATAR:n.avatar=t[i].value;break;case qe.MESSAGESETTINGS:n.messageSettings=t[i].value;break;case qe.ADMINFORBIDTYPE:n.adminForbidType=t[i].value;break;case qe.LEVEL:n.level=t[i].value;break;case qe.ROLE:n.role=t[i].value;break;default:Be.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[i].tag,t[i].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userModule.filterProfanity("nick",e))return Zo({code:po.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userModule.filterProfanity("selfSignature",e))return Zo({code:po.PROFANITY_FOUND});var i=new wo("updateMyProfile");i.setMessage(JSON.stringify(e));var r=(new ua).validate(e);if(!r.valid)return i.setCode(po.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(r.tips)).setNetworkType(this._userModule.getNetworkType()).end(),Be.e("".concat(n," info:").concat(r.tips)),Zo({code:po.UPDATE_PROFILE_INVALID_PARAM});var o=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&("profileCustomField"===a?e.profileCustomField.forEach((function(e){o.push({tag:e.key,value:e.value})})):o.push({tag:qe[a.toUpperCase()],value:e[a]}));if(0===o.length){var s=new Ko({code:po.UPDATE_PROFILE_NO_KEY});return i.setError(s,!0,this._userModule.getNetworkType()).end(),Be.e("".concat(n," failed. error:"),s),Zo(s)}var c=this._userModule.getMyAccount();return this._userModule.request({protocolName:vi,requestData:{fromAccount:c,profileItem:o}}).then((function(r){i.setNetworkType(t._userModule.getNetworkType()).end(),Be.i("".concat(n," ok"));var o=t._update(c,e),a=o.isProfileUpdated,s=o.latestProfile;return!0===a&&t._userModule.emitOuterEvent(M.PROFILE_UPDATED,[s]),Jo(s)})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!Yt(t)){var n,i=t.length;Be.d("".concat(this._n,".onProfileModified count:").concat(i," dataList:"),e.dataList);for(var r=[],o=0;o<i;o++){n=t[o].userID;var a=this._update(n,this._getLatestProfileFromResponse(n,t[o].profileList)),s=a.isProfileUpdated,c=a.latestProfile;!0===s&&r.push(c)}r.length>0&&(this._userModule.emitInnerEvent(ta,r),this._userModule.emitOuterEvent(M.PROFILE_UPDATED,r))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,i=e.length;n<i;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Be.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,i=!1,r=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===Ct(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=r,i=!0),ht(n,t,["profileCustomField"])>0&&(n.lastUpdatedTime=r,i=!0)):(n=new ua(t),(this._userModule.isMyFriend(e)||e===this._userModule.getMyAccount())&&(n.lastUpdatedTime=r,i=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userModule.getMyAccount()),Be.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(i)),{isProfileUpdated:i,latestProfile:n}}},{key:"_flush",value:function(e){var t=y(this.accountProfileMap.values()),n=this._userModule.getStorageModule();Be.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userModule.getStorageModule().getItem(this.TAG);return Yt(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,i,r=[],o=0,a=e.length;o<a;o++)n=(t=e[o]).userID,this._userModule.isMyFriend(n)&&(this._contains(n)?(i=this._getProfileFromMap(n),ht(i,t)>0&&r.push(n)):r.push(t.userID));0!==r.length&&(Be.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(r)),this.getUserProfile({userIDList:r}))}},{key:"getNickAndAvatarByUserID",value:function(e){if(this._contains(e)){var t=this._getProfileFromMap(e);return{nick:t.nick,avatar:t.avatar}}return{nick:"",avatar:""}}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),e}(),Ka=a((function e(t){r(this,e),Yt||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)})),Wa=function(){function e(t){r(this,e),this._userModule=t,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}return a(e,[{key:"getLocalBlacklist",value:function(){return y(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userModule.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},i=new wo("getBlacklist");return this._userModule.request({protocolName:mi,requestData:n}).then((function(n){var r=n.data,o=r.blackListItem,a=r.currentSequence,s=Yt(o)?0:o.length;i.setNetworkType(e._userModule.getNetworkType()).setMessage("count:".concat(s)).end(),Be.i("".concat(t," ok")),e.currentSequence=a,e._handleResponse(o,!0),e._userModule.emitOuterEvent(M.BLACKLIST_UPDATED,y(e._blacklistMap.keys()))})).catch((function(n){return e._userModule.probeNetwork().then((function(e){var t=m(e,2),r=t[0],o=t[1];i.setError(n,r,o).end()})),Be.e("".concat(t," failed. error:"),n),Zo(n)}))}},{key:"addBlacklist",value:function(e){var t=this,n=new wo("addToBlacklist"),i="".concat(this._n,".addBlacklist"),r=this._userModule.getMyAccount();if(1===e.userIDList.length&&e.userIDList[0]===r){var o=po.CANNOT_ADD_SELF_TO_BLACKLIST,a=this._userModule.getErrorMessage(o);n.setCode(o).setMessage(a).setNetworkType(this._userModule.getNetworkType()).end();var s=new Ko({code:o});return Be.e("".concat(i," failed. error:"),s),Zo(s)}return e.userIDList.includes(r)&&(e.userIDList=e.userIDList.filter((function(e){return e!==r}))),e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:yi,requestData:e}).then((function(r){return n.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Be.i("".concat(i," ok")),t._handleResponse(r.resultItem,!0),zo(y(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var i=m(t,2),r=i[0],o=i[1];n.setError(e,r,o).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"_handleResponse",value:function(e,t){if(!Yt(e))for(var n,i,r,o=0,a=e.length;o<a;o++)i=e[o].to,r=e[o].resultCode,(at(r)||0===r)&&(t?((n=this._blacklistMap.has(i)?this._blacklistMap.get(i):new Ka).userID=i,!Yt(e[o].addBlackTimeStamp)&&(n.timeStamp=e[o].addBlackTimeStamp),this._blacklistMap.set(i,n)):this._blacklistMap.has(i)&&(n=this._blacklistMap.get(i),this._blacklistMap.delete(i)));Be.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),i=new wo("removeFromBlacklist");return e.fromAccount=this._userModule.getMyAccount(),e.toAccount=e.userIDList,this._userModule.request({protocolName:Ii,requestData:e}).then((function(r){return i.setNetworkType(t._userModule.getNetworkType()).setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Be.i("".concat(n," ok")),t._handleResponse(r.data.resultItem,!1),zo(y(t._blacklistMap.keys()))})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],this._blacklistMap.has(t)&&(this._blacklistMap.delete(t),n.push(t));n.length>0&&(Be.l("".concat(this._n,".onAccountDeleted count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(M.BLACKLIST_UPDATED,y(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Ka({userID:t})),n.push(t));n.length>0&&(Be.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userModule.emitOuterEvent(M.BLACKLIST_UPDATED,y(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),e}(),Ya=function(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var i,r,o=0,a=0;r=t.charAt(a++);~r&&(i=o%4?64*i+r:r,o++%4)?n+=String.fromCharCode(255&i>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);try{return decodeURIComponent(escape(n))}catch(c){return""}},Ja=function(){function e(t){r(this,e),this._userModule=t,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userModule.getInnerEmitterInstance().on(ea,this._onCloudConfigUpdated,this)}return a(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userModule.getCloudConfig("status_query_count"),t=this._userModule.getCloudConfig("status_sub_count"),n=this._userModule.getCloudConfig("status_unsub_count");Be.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),at(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),at(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),at(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){var t=e.dataList,n=this._userModule.getMyUserID(),i=this._userModule.getModule(Fn),r=t.map((function(e){var t=e.to,r=e.statusType,o=e.customStatus,a=Ya(o);return t===n&&i.setCustomStatus(a),{userID:t,statusType:r,customStatus:a}}));this._userModule.emitOuterEvent(M.USER_STATUS_UPDATED,r)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userModule.filterProfanity("customStatus",e))return Zo({code:po.PROFANITY_FOUND});var i=new wo("setSelfStatus"),r=e.customStatus;return this._userModule.request({protocolName:io,requestData:{customStatus:r}}).then((function(e){return i.setNetworkType(t._userModule.getNetworkType()).setMessage("customStatus:".concat(r)).end(),Be.l("".concat(n," ok. customStatus:").concat(r)),t._userModule.getModule(Fn).setCustomStatus(r),zo({userID:t._userModule.getMyUserID(),statusType:1,customStatus:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),r=n[0],o=n[1];i.setError(e,r,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"getUserStatus",value:function(e){var t=this,n="".concat(this._n,".getUserStatus"),i=e.userIDList,r=void 0===i?[]:i,o=this._userModule.getMyUserID(),a=y(r),s=void 0,c=a.indexOf(o);if(c>-1){a.splice(c,1);var u=this._userModule.getModule(Fn).getCustomStatus();s={userID:o,statusType:1,customStatus:u}}if(0===a.length)return Jo({successUserList:[s],failureUserList:[]});if(!this._userModule.canIUse(q.USER_STATUS))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});a.length>this.MAX_QUERY_USER_COUNT&&(Be.w("".concat(n," ").concat(zt(this.MAX_QUERY_USER_COUNT))),a=r.slice(0,this.MAX_QUERY_USER_COUNT));var l=new wo("getUserStatus");return this._userModule.request({protocolName:ro,requestData:{userIDList:a}}).then((function(e){var i=e.data,o=i.successUserList,a=void 0===o?[]:o,c=i.failureUserList,u=void 0===c?[]:c,d=a.map((function(e){var t=e.userID,n=e.statusType,i=e.customStatus;return{userID:t,statusType:n,customStatus:Ya(i)}})),h=u.map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:Yt(n)?t:n,code:i,message:r}}));at(s)||d.unshift(s);var p="userID count:".concat(r.length,", success count:").concat(d.length,", fail count:").concat(h.length);return l.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(p)).end(),Be.l("".concat(n," ok. ").concat(p,".")),zo({successUserList:d,failureUserList:h})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],o=n[1];l.setMessage("userID count:".concat(r.length)).setError(e,i,o).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"subscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(q.USER_STATUS))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".subscribeUserStatus"),i=e.userIDList,r=void 0===i?[]:i,o=y(r);o.length>this.MAX_SUBSCRIBE_USER_COUNT&&(Be.w("".concat(n," ").concat(zt(this.MAX_SUBSCRIBE_USER_COUNT))),o=r.slice(0,this.MAX_SUBSCRIBE_USER_COUNT));var a=new wo("subscribeUserStatus"),s="userID count:".concat(r.length);return Be.l("".concat(n," ").concat(s)),this._userModule.request({protocolName:oo,requestData:{userIDList:o}}).then((function(e){var i=e.data.failureUserList,r=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:Yt(n)?t:n,code:i,message:r}}));return a.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(s," fail count:").concat(r.length)).end(),Be.l("".concat(n," ok. fail count:").concat(r.length,".")),zo({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setMessage("".concat(s)).setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t=this;if(!this._userModule.canIUse(q.USER_STATUS))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".unsubscribeUserStatus"),i=(e||{}).userIDList,r=void 0===i?[]:i,o=y(r);r.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Be.w("".concat(n," ").concat(zt(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=r.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT));var a=new wo("unsubscribeUserStatus"),s="userID count:".concat(r.length);Be.l("".concat(n," ").concat(s));var c={userIDList:o};return 0===o.length&&(c.userIDList=void 0,c.unsubscribeAll=1),this._userModule.request({protocolName:ao,requestData:c}).then((function(e){var i=e.data.failureUserList,r=(void 0===i?[]:i).map((function(e){var t=e.userID,n=e.invalidUserID,i=e.errorCode,r=e.errorInfo;return{userID:Yt(n)?t:n,code:i,message:r}}));return a.setNetworkType(t._userModule.getNetworkType()).setMessage("".concat(s," fail count:").concat(r.length)).end(),Be.l("".concat(n," ok. fail count:").concat(r.length,".")),zo({failureUserList:r})})).catch((function(e){return t._userModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setMessage("".concat(s)).setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),e}(),Za=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="UserModule",i._profileHandler=new za(g(i)),i._blacklistHandler=new Wa(g(i)),i._userStatusHandler=new Ja(g(i)),i.getInnerEmitterInstance().on($o,i.onContextUpdated,g(i)),i}return a(n,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t=e.dataList;if(!Yt(t)){var n=[];t.forEach((function(e){e.blackListDelAccount&&n.push.apply(n,y(e.blackListDelAccount))})),n.length>0&&this._blacklistHandler.onAccountDeleted(n);var i=[];t.forEach((function(e){e.blackListAddAccount&&i.push.apply(i,y(e.blackListAddAccount))})),i.length>0&&this._blacklistHandler.onAccountAdded(i)}}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.getModule(Bn)}},{key:"filterProfanity",value:function(e,t){var n=this.getModule(ii);if(!n)return!0;var i=n.filterText(t[e],Y),r=i.isAllowedToSend,o=i.modifiedText;return!0===r&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.getModule(Pn);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return Jo(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),n}(si),Xa=function(){function e(t,n){r(this,e),this._m=t,this._isLoggedIn=!1,this._SDKAppID=n.SDKAppID,this._userID=n.userID||"",this._userSig=n.userSig||"",this._version="2.27.3",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=n.unlimitedAVChatRoom,this._scene=n.scene||"",this._oversea=n.oversea,this._instanceID=n.instanceID,this._statusInstanceID=0,this._isDevMode=n.devMode,this._proxyServer=n.proxyServer,this._fileUploadProxy=n.fileUploadProxy,this._fileDownloadProxy=n.fileDownloadProxy}return a(e,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isSingaporeSite",value:function(){return this._SDKAppID>=2e7&&this._SDKAppID<3e7||this._SDKAppID>=172e7&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return this._SDKAppID>=3e7&&this._SDKAppID<4e7||this._SDKAppID>=173e7&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return this._SDKAppID>=4e7&&this._SDKAppID<5e7||this._SDKAppID>=174e7&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return this._SDKAppID>=5e7&&this._SDKAppID<6e7||this._SDKAppID>=175e7&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return this._SDKAppID>=6e7&&this._SDKAppID<7e7||this._SDKAppID>=176e7&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return this._SDKAppID>=7e7&&this._SDKAppID<8e7||this._SDKAppID>=177e7&&this._SDKAppID<178e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||e>=2e7&&e<8e7||e>=172e7&&e<178e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return De?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,i=!1,r=[];oe&&(r=Object.keys(se)),ae&&(r=re?Object.keys(uni):Object.keys(window));for(var o=0,a=r.length;o<a;o++)if(r[o].toLowerCase().includes("uikit")){e=!0;break}if(r=null,oe&&!ct(se.createGamePortal)&&ct(getApp)&&!at(getApp())){var s=getApp().globalData;rt(s)&&!0===s.isTUIKit&&(t=!0)}!0===this._m.getModule(Bn).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0);var c=null;if(X&&!$&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),Q&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),ot(c)&&c.length>0){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){i=!0;break}c=null}return e||t||n||i}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),e}(),Qa=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="SignModule",i._helloInterval=120,i._lastLoginTs=0,i._lastWsHelloTs=0,i._isWebUniapp=0,na.mixin(g(i)),i}return a(n,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"login",value:function(e){var t="";if(this.isLoggedIn()){var n=this.getMyUserID();return(t=this.getErrorMessage("RepeatLogin",n))&&Be.w(t),Jo({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0})}if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",e.userID),Zo({code:po.REPEAT_LOGIN});Be.l("".concat(this._n,".login userID:").concat(e.userID));var i=this._checkLoginInfo(e);if(0!==i.code)return Zo(i);var r=this.getModule(Fn),o=e.userID,a=e.userSig;return r.setUserID(o),r.setUserSig(a),this.getModule(Yn).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.getModule(Fn),n=t.getScene(),i=0,r=new wo("login");r.setMessage("".concat(n)).setMoreMessage("identifier:".concat(this.getMyUserID())),re?"tuikit"===n?r.setUIPlatform(4):r.setUIPlatform(3):oe?"tuikit"===n?r.setUIPlatform(12):r.setUIPlatform(11):ae&&(De?"flutter_web_uikit"===n?r.setUIPlatform(21):r.setUIPlatform(20):this._isReactUIKit()?we?r.setUIPlatform(25):r.setUIPlatform(24):we?"tuikit"===n?r.setUIPlatform(17):r.setUIPlatform(16):"tuikit"===n?r.setUIPlatform(14):r.setUIPlatform(13));var o=this.getModule(ni);if(o.canIUseOfflinePush()){this._isWebUniapp=o.getUniAppPlatform();var a=this._getStatusInstanceID();t.setStatusInstanceID(a),this.getModule(Yn).updateProtocolConfig(),i=o.getDeviceBrand()}var s="".concat(this._n,"._login");return this._lastLoginTs=Date.now(),this.request({protocolName:ci,requestData:{deviceBrand:i,isWebUniapp:this._isWebUniapp}}).then((function(i){e._lastLoginTs=0;var o=Date.now(),a=null,c=i.data,u=c.a2Key,l=c.tinyID,d=c.helloInterval,h=c.instanceID,p=c.timeStamp,f=c.customStatus,g=void 0===f?"":f;Be.l("".concat(s," ok. scene:").concat(n," helloInterval:").concat(d," instanceID:").concat(h," timeStamp:").concat(p));var _=1e3*p,v=o-r.getStartTs(),m=_+parseInt(v/2)-o,y=r.getStartTs()+m;if(r.start(y),function(e,t){Ne=t;var n=new Date;n.setTime(e),Be.i("baseTime from server:".concat(n," offset:").concat(Ne))}(_,m),!l)throw a=new Ko({code:po.NO_TINYID}),r.setError(a,!0,e.getNetworkType()).end(),a;if(!u)throw a=new Ko({code:po.NO_A2KEY}),r.setError(a,!0,e.getNetworkType()).end(),a;var I=Ya(g);r.setNetworkType(e.getNetworkType()).setMoreMessage("helloInterval:".concat(d," instanceID:").concat(h," offset:").concat(m," customStatus:").concat(I)).end(),t.setA2Key(u),t.setTinyID(l),t.setStatusInstanceID(h),t.setCustomStatus(I),e.getModule(Yn).updateProtocolConfig(),e.emitInnerEvent($o),e._helloInterval=d,e.triggerReady();var T=e.getModule(ni);return T.canIUseOfflinePush()&&(uni.setStorageSync("timUniAppInstanceID",h),T.init()),e._fetchCloudControlConfig(),e.getModule(ii).init(),i})).catch((function(t){return e.probeNetwork().then((function(e){var n=m(e,2),i=n[0],o=n[1];r.setError(t,i,o).end(!0)})),e._m.setNotReadyReason(po.LOGIN_FAILED),Be.e("".concat(s," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),Zo(t)}))}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.isLoggedIn())return Zo({code:po.USER_NOT_LOGGED_IN});var n=new wo("logout");n.setNetworkType(this.getNetworkType()).setMessage("identifier:".concat(this.getMyUserID())).end(!0);var i="".concat(this._n,".logout");return Be.i("".concat(i," type:").concat(t)),0===t&&this._m.setNotReadyReason(po.LOGGED_OUT),this.request({protocolName:ui,requestData:{type:t}}).then((function(){return e.resetReady(),Jo({})})).catch((function(t){return Be.e("".concat(i," error:"),t),e.resetReady(),Jo({})}))}},{key:"_fetchCloudControlConfig",value:function(){this.getModule(Xn).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.request({protocolName:li,requestData:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Be.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return Yt(this.getModule(Fn).getSDKAppID())?t=po.NO_SDKAPPID:Yt(e.userID)?t=po.NO_IDENTIFIER:Yt(e.userSig)&&(t=po.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return ae&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(k.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Be.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(M.KICKED_OUT,{type:k.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(po.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(k.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Be.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOuterEvent(M.KICKED_OUT,{type:k.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(po.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage(k.KICKED_OUT_USERSIG_EXPIRED).end(!0),Be.w("".concat(this._n,".onUserSigExpired: userSig expired")),0!==this.getModule(Fn).getStatusInstanceID()&&(this.emitOuterEvent(M.KICKED_OUT,{type:k.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(po.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new wo("kickedOut").setNetworkType(this.getNetworkType()).setMessage("type:".concat(k.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Be.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.getModule(Fn).getStatusInstanceID()&&(this.emitOuterEvent(M.KICKED_OUT,{type:k.KICKED_OUT_REST_API}),this._m.setNotReadyReason(po.KICKED_OUT_REST_API),this._m.reset(),this.getModule(Jn).onRestApiKickedOut())}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),n}(si);function $a(){return null}var es=function(){function e(t){r(this,e),this._m=t,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}return a(e,[{key:"_errorTolerantHandle",value:function(){oe||!at(window)&&this._canIUseCookies()||(this.getItem=$a,this.setItem=$a,this.removeItem=$a,this.clear=$a)}},{key:"onCheckTimer",value:function(e){if(e%20==0){if(0===this._storageQueue.size)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var e,t=b(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2),i=n[0],r=n[1];this._setStorageSync(this._getKey(i),r)}}catch(a){t.e(a)}finally{t.f()}this._storageQueue.clear()}catch(s){Be.w("".concat(this._n,"._doFlush error:"),s)}}},{key:"_getPrefix",value:function(){var e=this._m.getModule(Fn);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(r){return Be.w("".concat(this._n,".getItem error:"),r),{}}}},{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(n){var r=i?this._getKey(e):e;this._setStorageSync(r,t)}else this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{oe?se.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Be.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(r){Be.w("".concat(this._n,".removeItem error:"),r)}}},{key:"getSize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b";try{var i={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(i,"leftSize",{enumerable:!0,get:function(){return i.limitSize-i.size}}),oe&&(i.limitSize=1024*se.getStorageInfoSync().limitSize),e)i.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(oe){var r=se.getStorageInfoSync(),o=r.keys;o.forEach((function(e){i.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}))}else if(this._canIUseCookies())for(var a in localStorage)localStorage.hasOwnProperty(a)&&(i.size+=localStorage.getItem(a).length+a.length);return this._convertUnit(i)}catch(c){Be.w("".concat(this._n," error:"),c)}}},{key:"_convertUnit",value:function(e){var t={},n=e.unit;for(var i in t.unit=n,e)"number"==typeof e[i]&&("kb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024):"mb"===n.toLowerCase()?t[i]=Math.round(e[i]/1024/1024):t[i]=e[i]);return t}},{key:"_setStorageSync",value:function(e,t){oe?te?my.setStorageSync({key:e,data:t}):se.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return oe?te?my.getStorageSync({key:e}).data:se.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){oe?te?my.removeStorageSync({key:e}):se.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._doFlush()}}]),e}(),ts=function(){function e(t){r(this,e),this._n="SSOLogBody",this._report=[]}return a(e,[{key:"pushIn",value:function(e){Be.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;ot(e)&&0!==e.length&&(Be.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,y(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),e}(),ns=function(e){var t=e.getModule(Fn);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:xe()}},is=function(e){c(i,e);var n=v(i);function i(e){var t;r(this,i),(t=n.call(this,e))._n="EventStatModule",t.TAG="im-ssolog-event",t._reportBody=new ts,t.MIN_THRESHOLD=20,t.MAX_THRESHOLD=100,t.WAITING_TIME=6e4,t.REPORT_LEVEL=[4,5,6],t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._lastReportTime=Date.now();var o=t.getInnerEmitterInstance();return o.on($o,t._onLoginSuccess,g(t)),o.on(ea,t._onCloudConfigUpdated,g(t)),t}return a(i,[{key:"reportAtOnce",value:function(){Be.d("".concat(this._n,".reportAtOnce")),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.getModule(Bn),n=t.getItem(this.TAG,!1);!Yt(n)&&ct(n.forEach)&&(Be.l("".concat(this._n,"._onLoginSuccess get ssolog in storage, count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),i=this.getCloudConfig("evt_rpt_sdkappid_bl"),r=this.getCloudConfig("evt_rpt_tinyid_wl");at(e)||(this.MIN_THRESHOLD=Number(e)),at(t)||(this.WAITING_TIME=Number(t)),at(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),at(i)||(this.REPORT_SDKAPPID_BLACKLIST=i.split(",").map((function(e){return Number(e)}))),at(r)||(this.REPORT_TINYID_WHITELIST=r.split(","))}},{key:"pushIn",value:function(e){e instanceof wo&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=this.getModule(Fn),i=n.getSDKAppID(),r=n.getTinyID();return Gt(this.REPORT_SDKAPPID_BLACKLIST,i)&&!Vt(this.REPORT_TINYID_WHITELIST,r)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var n=this._reportBody.getLogsInMemory(),i=this._filterLogs(n);if(0!==i.length){var r={header:ns(this),event:i};this.request({protocolName:Fr,requestData:t({},r)}).then((function(){e._lastReportTime=Date.now()})).catch((function(t){Be.w("".concat(e._n,".report failed. networkType:").concat(e.getNetworkType()," error:"),t),e._reportBody.backfill(n),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD&&e._flushAtOnce()}))}else this._lastReportTime=Date.now()}}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Bn),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),i="".concat(this._n,"._flushAtOnce");if(Yt(t))Be.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>this.MAX_THRESHOLD&&(r=r.slice(0,this.MAX_THRESHOLD)),Be.l("".concat(i," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),i}(si),rs="none",os="online",as=[po.OVER_FREQUENCY_LIMIT,po.OPEN_SERVICE_OVERLOAD_ERROR],ss=function(){function e(t){r(this,e),this._m=t,this._networkType="",this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}return a(e,[{key:"start",value:function(){var e=this;oe?(se.getNetworkType({success:function(t){e._networkType=t.networkType||t.subtype||"",t.networkType===rs?Be.w("".concat(e._n,".start no network, please check!")):Be.i("".concat(e._n,".start networkType:").concat(t.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),se.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=os,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:os})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:rs})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=e.networkType,i="".concat(this._n,"._onNetworkStatusChange"),r=!1;t?(Be.i("".concat(i," previous:").concat(this._networkType," current:").concat(n)),this._networkType!==n&&(r=!0,this._m.getModule(Jn).reConnect(!0))):this._networkType!==n&&(r=!0,Be.w("".concat(i," no network, please check!")),this._m.getModule(Jn).offline()),r&&(new wo("networkChange").setMessage("isConnected:".concat(t," previousNetworkType:").concat(this._networkType," networkType:").concat(n)).end(),this._networkType=n)}},{key:"probe",value:function(e){var t=this;if(!at(e)&&as.includes(e.code))return Promise.resolve([!0,this._networkType]);var n="".concat(this._n,".probe");return new Promise((function(e,i){oe?se.getNetworkType({success:function(i){t._networkType=i.networkType,i.networkType===rs?(Be.w("".concat(n," no network, please check!")),e([!1,i.networkType])):(Be.i("".concat(n," networkType:").concat(i.networkType)),e([!0,i.networkType]))}}):t._networkType===rs?e([!1,rs]):e([!0,os])}))}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),oe?null!==this._mpNetworkStatusCallback&&(se.offNetworkStatusChange&&(ie||$?se.offNetworkStatusChange(this._mpNetworkStatusCallback):se.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),e}(),cs=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),us=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="BigDataChannelModule",i.FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},i._bdh_download_server="grouptalk.c2c.qq.com",i._BDHBizID=10001,i._authKey="",i._expireTime=0,i.getInnerEmitterInstance().on($o,i._getAuthKey,g(i)),i}return a(n,[{key:"_getAuthKey",value:function(){var e=this;this.isIntl()||this.request({protocolName:pi}).then((function(t){t.data.authKey&&(e._authKey=t.data.authKey,e._expireTime=parseInt(t.data.expireTime))}))}},{key:"_isFromOlderVersion",value:function(e){return!(!e.content||2===e.content.downloadFlag)}},{key:"parseElements",value:function(e,t){if(!ot(e)||!t)return[];for(var n=[],i=null,r=0;r<e.length;r++)i=e[r],this._needParse(i)?n.push(this._parseElement(i,t)):n.push(e[r]);return n}},{key:"_needParse",value:function(e){return!e.cloudCustomData&&!(!this._isFromOlderVersion(e)||e.type!==k.MSG_AUDIO&&e.type!==k.MSG_FILE&&e.type!==k.MSG_VIDEO)}},{key:"_parseElement",value:function(e,t){switch(e.type){case k.MSG_AUDIO:return this._parseAudioElement(e,t);case k.MSG_FILE:return this._parseFileElement(e,t);case k.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{key:"_parseAudioElement",value:function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{key:"_parseFileElement",value:function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{key:"_genAudioUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(Fn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(t,"&ver=0")}},{key:"_genFileUrl",value:function(e,t,n){if(""===this._authKey)return"";n||(n="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now()));var i=this.getModule(Fn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(i,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(t,"&ver=0&filename=").concat(encodeURIComponent(n))}},{key:"_genVideoUrl",value:function(e,t){if(""===this._authKey)return"";var n=this.getModule(Fn).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(n,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(t,"&ver=0")}},{key:"reset",value:function(){this._authKey="",this.expireTime=0}}]),n}(si),ls=["requestSnapshotUrl"],ds=function(e){c(i,e);var n=v(i);function i(e){var t;r(this,i),(t=n.call(this,e))._n="UploadModule",t.TIMUploadPlugin=null,t.timUploadPlugin=null,t.COSSDK=null,t._cosUploadMethod=null,t.expiredTimeLimit=600,t.appid=0,t.bucketName="",t.ciUrl="",t.directory="",t.downloadUrl="",t.uploadUrl="",t.region="ap-shanghai",t.cos=null,t.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},t.uploadFileType="",t.duration=900,t.tryCount=0,t.UPLOAD_SIZE_LIMIT={AUDIO:20971520,FILE:104857600,IMAGE:20971520,VIDEO:104857600};var o=t.getInnerEmitterInstance();return o.on($o,t._init,g(t)),o.on(ea,t._onCloudConfigUpdated,g(t)),t}return a(i,[{key:"_init",value:function(){var e=this.getModule(Kn);if(this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin)this._initUploaderMethod();else{var t=oe?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=e.getPlugin(t),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",t)):this.outputWarning("PluginUndetected")}}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit");if(Be.l("".concat(e," uploadSizeLimit:").concat(t)),!at(t))try{var n=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={AUDIO:n.a?1048576*parseInt(n.a):this.UPLOAD_SIZE_LIMIT.AUDIO,FILE:n.f?1048576*parseInt(n.f):this.UPLOAD_SIZE_LIMIT.FILE,IMAGE:n.i?1048576*parseInt(n.i):this.UPLOAD_SIZE_LIMIT.IMAGE,VIDEO:n.v?1048576*parseInt(n.v):this.UPLOAD_SIZE_LIMIT.VIDEO}}catch(r){Be.e("".concat(e," JSON parse error. uploadSizeLimit:"),t)}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new wo("_getAuthorizationKey"),i=Math.ceil(Date.now()/1e3);this.request({protocolName:Ur,requestData:{duration:this.expiredTimeLimit}}).then((function(r){var o=r.data;Be.l("".concat(t," ok. data:"),o);var a=o.expiredTime-i;n.setMessage("requestId:".concat(o.requestId," requestTime:").concat(i," expiredTime:").concat(o.expiredTime," diff:").concat(a,"s")).setNetworkType(e.getNetworkType()).end(),!oe&&o.region&&(e.region=o.region),e.appid=o.appid,e.bucketName=o.bucketName,e.ciUrl=o.ciUrl,e.directory=o.directory,e.downloadUrl=o.downloadUrl,e.uploadUrl=o.uploadUrl,e.cosOptions={secretId:o.secretId,secretKey:o.secretKey,sessionToken:o.sessionToken,expiredTime:o.expiredTime},Be.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(i){e.probeNetwork().then((function(e){var t=m(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),Be.w("".concat(t," failed. error:"),i)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),i=Math.ceil(Date.now()/1e3),r=new wo("_getCosPreSigUrl");return this.request({protocolName:Gr,requestData:{fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration}}).then((function(e){t.tryCount=0;var o=e.data||{},a=o.expiredTime-i;return Be.l("".concat(n," ok. data:"),o),r.setMessage("requestId:".concat(o.requestId," expiredTime:").concat(o.expiredTime," diff:").concat(a,"s")).setNetworkType(t.getNetworkType()).end(),o})).catch((function(i){return-1===i.code&&(i.code=po.COS_GET_SIG_FAIL),t.probeNetwork().then((function(e){var t=m(e,2),n=t[0],o=t[1];r.setError(i,n,o).end()})),Be.w("".concat(n," failed. error:"),i),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,Zo({code:po.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=oe?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=oe?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e.getRelayFlag())return Promise.resolve();var t=this.getModule(ei);switch(e.type){case k.MSG_IMAGE:return t.addTotalCount(Io),this._uploadImage(e);case k.MSG_FILE:return t.addTotalCount(Io),this._uploadFile(e);case k.MSG_AUDIO:return t.addTotalCount(Io),this._uploadAudio(e);case k.MSG_VIDEO:return t.addTotalCount(Io),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,i=this.getModule(Rn),r=e.getElements()[0],o=i.getMessageOption(e.clientSequence);return this.doUploadImage({file:o.payload.file,to:o.to,onProgress:function(e){if(r.updatePercent(e),ct(o.onProgress))try{o.onProgress(e)}catch(t){return Zo({code:po.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(i){var o,a,s=i.location,c=i.fileType,u=i.fileSize,l=i.width,d=i.height,h=i.smallImageUrl,p=i.smallImageWidth,f=i.smallImageHeight,g=i.largeImageUrl,_=i.largeImageWidth,v=i.largeImageHeight,m=n.isPrivateNetWork()?s:It(s);return r.updateImageFormat(c),h&&g?(o={url:h,width:p,height:f},a={url:g,width:_,height:v}):(o=Nt({originUrl:m,originWidth:l,originHeight:d,min:198}),a=Nt({originUrl:m,originWidth:l,originHeight:d,min:720})),r.updateImageInfoArray([{size:u,url:m,width:l,height:d},t({},a),t({},o)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.getModule(Rn),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),ct(r.onProgress))try{r.onProgress(e)}catch(t){return Zo({code:po.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=t.isPrivateNetWork()?r:It(r);return i.updateFileUrl(o),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.getModule(Rn),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),ct(r.onProgress))try{r.onProgress(e)}catch(t){return Zo({code:po.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=t.isPrivateNetWork()?r:It(r);return i.updateAudioUrl(o),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.getModule(Rn),i=e.getElements()[0],r=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:r.payload.file,to:r.to,onProgress:function(e){if(i.updatePercent(e),ct(r.onProgress))try{r.onProgress(e)}catch(t){return Zo({code:po.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then((function(n){var r=n.location,o=n.snapshotInfo,a=t.isPrivateNetWork()?r:It(r);return i.updateVideoUrl(a),Yt(o)||i.updateSnapshotInfo(o),e}))}},{key:"_checkSizeError",value:function(e){return Zo({code:po["MESSAGE_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",e.toLowerCase(),"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576," MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file)return Zo({code:po.MESSAGE_IMAGE_SELECT_FILE_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;var i=this._checkImageSize(e.file);if(!0!==i)return i;var r=null;return this._setUploadFileType(oa),this.uploadByCOS(e).then((function(e){return r=e,t.isPrivateNetWork()?At(e.location):At("https://".concat(e.location))})).then((function(e){return r.width=e.width,r.height=e.height,Promise.resolve(r)}))}},{key:"_checkImageType",value:function(e){var t="";return t=oe?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),ia.indexOf(t.toLowerCase())>=0||Zo({code:po.MESSAGE_IMAGE_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){var t=0;return 0===(t=oe?e.size:e.files[0].size)?Zo({code:po.MESSAGE_FILE_IS_EMPTY}):t<this.UPLOAD_SIZE_LIMIT.IMAGE||this._checkSizeError("IMAGE")}},{key:"doUploadFile",value:function(e){return e.file?e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.FILE?this._checkSizeError("FILE"):0===e.file.files[0].size?Zo({code:po.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(ca),this.uploadByCOS(e)):Zo({code:po.MESSAGE_FILE_SELECT_FILE_FIRST})}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.VIDEO?this._checkSizeError("VIDEO"):0===e.file.videoFile.size?Zo({code:po.MESSAGE_FILE_IS_EMPTY}):-1===ra.indexOf(e.file.videoFile.type)?Zo({code:po.MESSAGE_VIDEO_TYPES_LIMIT}):(this._setUploadFileType(aa),oe?this.handleVideoUpload({file:e.file.videoFile,onProgress:e.onProgress}):ae?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,i){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){i(new Ko({code:po.MESSAGE_VIDEO_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.AUDIO?this._checkSizeError("AUDIO"):0===e.file.size?Zo({code:po.MESSAGE_FILE_IS_EMPTY}):(this._setUploadFileType(sa),this.uploadByCOS(e)):Zo({code:po.MESSAGE_AUDIO_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!ct(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),Zo({code:po.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new wo("upload"),i="".concat(this._n,".uploadByCOS"),r=Date.now(),o=this._getFile(e);return new Promise((function(a,s){var c=oe?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||ot(c.files)&&c.files[0].error){var d=new Ko({code:po.MESSAGE_FILE_UPLOAD_FAIL});return n.setError(d,!0,t.getNetworkType()).end(),Be.l("".concat(i," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&(Be.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void s(d)}l.fileName=o.name,l.fileSize=o.size,l.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),l.location=oe?c.Location:c.files[0].data.Location;var h=Date.now()-r,p=u._formatFileSize(o.size),f=u._formatSpeed(1e3*o.size/h),g="size:".concat(p," time:").concat(h,"ms speed:").concat(f);Be.l("".concat(i," success. name:").concat(o.name," ").concat(g)),a(l);var _=t.getModule(ei);return _.addCost(Io,h),_.addFileSize(Io,o.size),void n.setNetworkType(t.getNetworkType()).setMessage(g).end()}var v=new Ko({code:po.MESSAGE_FILE_UPLOAD_FAIL});n.setError(v,!0,u.getNetworkType()).end(),Be.w("".concat(i," failed. error:"),e),403===e.statusCode&&(Be.w("".concat(i," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),s(v)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),i=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(r,o){var a=new wo("upload"),s=e.requestSnapshotUrl,c=void 0===s?void 0:s,u=f(e,ls),l=Date.now();t._cosUploadMethod(u,(function(e,s){if(e||403===s.statusCode)return a.setError(new Ko(e),!0,t.getNetworkType()).end(),Be.l("".concat(n," failed, error:"),e),void o(new Ko({code:po.MESSAGE_FILE_UPLOAD_FAIL}));var d=Object.create(null),h=s.data.location||"";t.isPrivateNetWork()||0!==h.indexOf("https://")&&0!==h.indexOf("http://")||(h=h.split("//")[1]),d.fileName=i.name,d.fileSize=i.size,d.fileType=i.type.slice(i.type.indexOf("/")+1).toLowerCase(),d.location=h;var p=Date.now()-l,f=t._formatFileSize(i.size),g=t._formatSpeed(1e3*i.size/p),_="size:".concat(f,",time:").concat(p,"ms,speed:").concat(g," res:").concat(JSON.stringify(s.data));Be.l("".concat(n," success name:").concat(i.name,",").concat(_)),a.setNetworkType(t.getNetworkType()).setMessage(_).end();var v=t.getModule(ei);v.addCost(Io,p),v.addFileSize(Io,i.size);var m=[];if(u.thumbUrl&&u.largeUrl&&(m=[t._getSmallImageInfoByUrl(u.thumbUrl,d),t._getLargeImageInfoByUrl(u.largeUrl,d)]),c&&m.push(t._getSnapshotInfoByUrl(c,d)),m.length>0)return Promise.all(m).then((function(){r(d)}));r(d)}))}))}))}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.getModule(Fn).getFileUploadProxy(),n=e;return t&&(n=e.replace(/^https:\/\/[^/]+/,t)),n}},{key:"_getFile",value:function(e){var t;return ot(e.file.files)||(t=e.file.files,"filelist"===lt(t))?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Ut(e/1024,1)+"KB/s":Ut(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,i=n.slice(n.lastIndexOf(".")),r=this._genFileName("".concat(gt(999999)).concat(i));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(r),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Be.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name),i=t.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:i,onProgress:function(t){if(Be.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Be.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t=this,n="",i="",r=0,o=this._getFile(e);if(oe)n=this._genFileName(o.name),i=o.url,r=1;else{var a=o.name,s=a.slice(a.lastIndexOf("."));n=this._genFileName("".concat(gt(999999)).concat(s)),i=o,r=0}return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:n,uploadMethod:r,duration:this.duration}).then((function(r){var o=r.uploadUrl,a=r.downloadUrl,s=r.requestSnapshotUrl,c=void 0===s?void 0:s,u=r.thumbUrl,l=r.largeUrl;return{url:t._getRawOrUploadProxyUrl(o),fileType:t.uploadFileType,fileName:n,resources:i,downloadUrl:a,requestSnapshotUrl:c,thumbUrl:u,largeUrl:l,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Be.w("onProgress callback error:",n),Be.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(Rt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,i=new wo("getSnapshotInfo");return this.request({protocolName:Vr,requestData:{platform:this.getPlatform(),coverName:this._genFileName(gt(99999)),requestSnapshotUrl:e}}).then((function(e){var n=(e.data||{}).snapshotUrl;return i.setMessage("snapshotUrl:".concat(n)).end(),Yt(n)?{}:At(n).then((function(e){t.snapshotInfo={snapshotUrl:n,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Be.w("".concat(n._n,"._getSnapshotInfoByUrl failed. error:"),e),i.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return At(e).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return At(e).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),i}(si),hs=["downloadKey","pbDownloadKey","messageList"],ps=function(){function e(t){r(this,e),this._n="MergerMessageHandler",this._messageModule=t}return a(e,[{key:"uploadMergerMessage",value:function(e,t){var n=this,i="".concat(this._n,".").concat("uploadMergerMessage");Be.d("".concat(i," message:"),e,"messageBytes:".concat(t));var r=e.payload.messageList,o=r.length,a=new wo("uploadMergerMessage");return this._messageModule.request({protocolName:Kr,requestData:{messageList:r}}).then((function(e){Be.d("".concat(i," ok. response:"),e.data);var r=e.data,s=r.pbDownloadKey,c=r.downloadKey,u={pbDownloadKey:s,downloadKey:c,messageNumber:o};return a.setNetworkType(n._messageModule.getNetworkType()).setMessage("".concat(o,"-").concat(t,"-").concat(c)).end(),u})).catch((function(e){throw Be.w("".concat(i," failed. error:"),e),n._messageModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,i="".concat(this._n,".").concat("downloadMergerMessage");Be.d("".concat(i," message:"),e);var r=e.payload.downloadKey,o=this._messageModule.getFileDownloadProxy(),a=new wo("downloadMergerMessage");return a.setMessage("downloadKey:".concat(r)),this._messageModule.request({protocolName:Wr,requestData:{downloadKey:r}}).then((function(r){if(Be.d("".concat(i," ok. response:"),r.data),ct(e.clearElement)){var s=e.payload;s.downloadKey,s.pbDownloadKey,s.messageList;var c=f(s,hs);e.clearElement(),e.setElement({type:e.type,content:t({messageList:r.data.messageList},c)},o)}else{var u=[];r.data.messageList.forEach((function(e){if(!Yt(e)){var t=new Bo(e,o);u.push(t)}})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""}return a.setNetworkType(n._messageModule.getNetworkType()).end(),e})).catch((function(e){throw Be.w("".concat(i," failed. key:").concat(r," error:"),e),n._messageModule.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];a.setError(e,i,r).end()})),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===k.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var i=null;t&&(t.offlinePushInfo&&(i=t.offlinePushInfo),!0===t.onlineUserOnly&&(i?i.disablePush=!0:i={disablePush:!0}));var r=[];if(rt(t)&&rt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";nt(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,h=n.messageNumber,p=e.payload,f=p.title,g=p.abstractList,_=p.compatibleText,v=this._messageModule.getModule(Nn),m=v&&v.isOnlineMessage(e,t)?0:void 0;return{protocolName:fi,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:_,messageNumber:h}}],cloudCustomData:u,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:m,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,messageControlInfo:0!==m?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var i=null;t&&t.offlinePushInfo&&(i=t.offlinePushInfo);var r=[];if(rt(t)&&rt(t.messageControlInfo)){var o=t.messageControlInfo,a=o.excludedFromUnreadCount,s=o.excludedFromLastMessage,c=o.excludedFromContentModeration;!0===a&&r.push("NoUnread"),!0===s&&r.push("NoLastMsg"),!0===c&&r.push("NoMsgCheck")}var u="";nt(e.cloudCustomData)&&e.cloudCustomData.length>0&&(u=e.cloudCustomData);var l=n.pbDownloadKey,d=n.downloadKey,h=n.messageNumber,p=e.payload,f=p.title,g=p.abstractList,_=p.compatibleText,v=this._messageModule.getModule(xn),m=v&&v.isOnlineMessage(e,t)?1:0;return{protocolName:gi,tjgID:this._messageModule.generateTjgID(e),requestData:{fromAccount:this._messageModule.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:l,downloadKey:d,title:f,abstractList:g,compatibleText:_,messageNumber:h}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:u,onlineOnlyFlag:m,offlinePushInfo:i?{pushFlag:!0===i.disablePush?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:!0===i.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||v.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0===m?r:void 0,isSupportExtension:!0===e.isSupportExtension?1:0}}}}]),e}(),fs={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MESSAGE_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},gs=[po.MESSAGE_ONPROGRESS_FUNCTION_ERROR,po.MESSAGE_IMAGE_SELECT_FILE_FIRST,po.MESSAGE_IMAGE_TYPES_LIMIT,po.MESSAGE_FILE_IS_EMPTY,po.MESSAGE_IMAGE_SIZE_LIMIT,po.MESSAGE_FILE_SELECT_FILE_FIRST,po.MESSAGE_FILE_SIZE_LIMIT,po.MESSAGE_VIDEO_SIZE_LIMIT,po.MESSAGE_VIDEO_TYPES_LIMIT,po.MESSAGE_AUDIO_UPLOAD_FAIL,po.MESSAGE_AUDIO_SIZE_LIMIT,po.COS_UNDETECTED];function _s(e){var t=!1;return Object.values(fs).includes(e)&&(t=!0),(e>=120001&&e<=13e4||e>=10100&&e<=10200)&&(t=!0),t}var vs=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="MessageModule",t._messageOptionsMap=new Map,t._mergerMessageHandler=new ps(g(t)),t}return a(i,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i="string"==typeof e.payload?e.payload:e.payload.text,r=new Do({text:i}),o=this._getNickAndAvatarByUserID(t);return n.setElement(r),n.setNickAndAvatar(o),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e);if(oe){var i=e.payload.file;if($e(i))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var r=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,o={url:r,name:r.slice(r.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:r.slice(r.lastIndexOf(".")+1).toLowerCase()};e.payload.file=o}else if(ae)if($e(e.payload.file)){var a=e.payload.file;e.payload.file={files:[a]}}else if(rt(e.payload.file)&&"undefined"!=typeof uni){var s=e.payload.file.tempFiles[0];e.payload.file={files:[s]}}var c=new Ao({imageFormat:je.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),u=this._getNickAndAvatarByUserID(t);return n.setElement(c),n.setNickAndAvatar(u),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file;if(oe){var n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=n}var i=this.getMyUserID();e.currentUser=i,e.senderTinyID=this.getMyTinyID();var r=new Ho(e),o=new Lo({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),a=this._getNickAndAvatarByUserID(i);return r.setElement(o),r.setNickAndAvatar(a),r.setNameCard(this._getNameCardByGroupID(r)),this._messageOptionsMap.set(r.clientSequence,e),r}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0;var n={};if(oe){if(te)return void this.outputWarning("VideoUnsupportedInAlipay");if($e(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var i=e.payload.file;ot(i.tempFiles)&&(i=i.tempFiles[0]),n.url=i.tempFilePath,n.name=i.tempFilePath.slice(i.tempFilePath.lastIndexOf("/")+1),n.size=i.size||1,n.second=i.duration||0,n.type=i.tempFilePath.slice(i.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(ae){if($e(e.payload.file)){var r=e.payload.file;e.payload.file.files=[r]}else if(rt(e.payload.file)&&"undefined"!=typeof uni){var o=e.payload.file.tempFile;e.payload.file.files=[o]}var a=e.payload.file;n.url=window.URL.createObjectURL(a.files[0]),n.name=a.files[0].name,n.size=a.files[0].size||1,n.second=a.files[0].duration||0,n.type=a.files[0].type.split("/")[1]}e.payload.file.videoFile=n;var s=new Ho(e),c=new Vo({videoFormat:n.type,videoSecond:Ut(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),u=this._getNickAndAvatarByUserID(t);return s.setElement(c),s.setNickAndAvatar(u),s.setNameCard(this._getNameCardByGroupID(s)),this._messageOptionsMap.set(s.clientSequence,e),s}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i=new Go({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i=new Ro(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=this._getNickAndAvatarByUserID(t),i=new Ho(e),r=new jo(e.payload);return i.setElement(r),i.setNickAndAvatar(n),i.setNameCard(this._getNameCardByGroupID(i)),i.setRelayFlag(!0),i}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,i=e.priority,r=e.payload,o=e.needReadReceipt,a=e.receiverList,s=this.getMyUserID(),c=this._getNickAndAvatarByUserID(s);if(r.type===k.MSG_GRP_TIP)return Zo({code:po.MESSAGE_FORWARD_TYPE_INVALID});var u={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:i,isPlaceMessage:0,status:Qt.UNSEND,currentUser:s,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||r.cloudCustomData||"",needReadReceipt:o,receiverList:a,isSupportExtension:e.isSupportExtension||!1},l=new Ho(u);return l.setElement(r.getElements()[0]),l.setNickAndAvatar(c),l.setNameCard(this._getNameCardByGroupID(r)),l.setRelayFlag(!0),l}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(oe){if(!X&&!Q&&!ie)return;var n=se.getSystemInfoSync().SDKVersion;if(X&&Ot(n,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if(Q&&Ot(n,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}if(ae||ie){if($e(e.payload.file)){var i=e.payload.file;e.payload.file={files:[i]}}else if(rt(e.payload.file)&&"undefined"!=typeof uni){var r=e.payload.file,o=r.tempFiles,a=r.files,s=null;ot(o)?s=o[0]:ot(a)&&(s=a[0]),e.payload.file={files:[s]}}}else if(X||Q){var c=e.payload.file.tempFiles,u=t(t({},c[0]),{},{url:c[0].path});e.payload.file={files:[u]}}var l=this.getMyUserID();e.currentUser=l,e.senderTinyID=this.getMyTinyID();var d=new Ho(e),h=new Uo({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),p=this._getNickAndAvatarByUserID(l);return d.setElement(h),d.setNickAndAvatar(p),d.setNameCard(this._getNameCardByGroupID(d)),this._messageOptionsMap.set(d.clientSequence,e),d}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID();e.currentUser=t,e.senderTinyID=this.getMyTinyID();var n=new Ho(e),i=new Fo(e.payload),r=this._getNickAndAvatarByUserID(t);return n.setElement(i),n.setNickAndAvatar(r),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onCannotFindModule",value:function(){return Zo({code:po.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.getModule(ii).filterMessage(e,t))return this._onSendMessageFailed(e,new Ko({code:po.PROFANITY_FOUND}));var i,r=null;switch(e.conversationType){case k.CONV_C2C:if(!(r=this.getModule(Nn)))return this._onCannotFindModule();break;case k.CONV_GROUP:if(!(r=this.getModule(xn)))return this._onCannotFindModule();if(Et({groupID:e.to})){var o=r.getLocalGroupProfile(e.to);if(o&&o.isSupportTopic)return Zo({code:po.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL})}break;default:return Zo({code:po.MESSAGE_SEND_INVALID_CONVERSATION_TYPE})}var a=this.getModule(zn),s=this.getModule(xn);return a.upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===yo&&n.getModule(ei).addSuccessCount(Io),s.guardForAVChatRoom(e).then((function(){if(!e.isSendable())return Zo({code:po.MESSAGE_FILE_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var o=function(e){var t="utf-8";ae&&document&&(t=document.charset.toLowerCase());var n,i,r=0;if(i=e.length,"utf-8"===t||"utf8"===t)for(var o=0;o<i;o++)(n=e.codePointAt(o))<=127?r+=1:n<=2047?r+=2:n<=65535?r+=3:(r+=4,o++);else if("utf-16"===t||"utf16"===t)for(var a=0;a<i;a++)(n=e.codePointAt(a))<=65535?r+=2:(r+=4,a++);else r=e.replace(/[^\x00-\xff]/g,"aa").length;return r}(JSON.stringify(e));return e.type===k.MSG_MERGER&&o>11264?n._mergerMessageHandler.uploadMergerMessage(e,o).then((function(i){var r=n._mergerMessageHandler.createMergerMessagePack(e,t,i);return n.request(r)})):(n.getModule(Vn).setMessageRandom(e),e.conversationType===k.CONV_C2C||e.conversationType===k.CONV_GROUP?r.sendMessage(e,t):void 0)})).then((function(o){var a=o.data,s=a.time,c=a.sequence,u=a.readReceiptCode;et(u)&&0!==u&&(new wo("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(c," readReceiptCode:").concat(u)).end(),Be.w("".concat(n._n,".sendMessageInstance readReceiptCode:").concat(u," message:").concat(n.getErrorMessage(u)))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence);var l=n.getModule(Vn);e.status=Qt.SUCCESS,e.time=s;var d=!1;if(e.conversationType===k.CONV_GROUP)e.sequence=c;else if(e.conversationType===k.CONV_C2C){var h=l.getLatestMessageSentByMe(e.conversationID);if(h){var p=h.nick,f=h.avatar;p===e.nick&&f===e.avatar||(d=!0)}}if(d&&l.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),r.isOnlineMessage(e,t))e._onlineOnlyFlag=!0;else{l.appendToMessageList(e);var g=e;rt(t)&&rt(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,g=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0));var _=e.conversationType;bt(e.to)&&(_=k.CONV_TOPIC,n.getModule(Gn).onMessageSent({groupID:Ft(e.to),topicID:e.to,lastMessage:g})),l.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:_,subType:e.conversationSubType,lastMessage:g}]})}return e.getRelayFlag()||"TIMImageElem"!==e.type||xt(e.payload.imageInfoArray),zo({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t)}))}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Qt.FAIL,this.getModule(Vn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new wo("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=m(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),Be.e("".concat(this._n,"._onSendMessageFailed error:"),t),Zo(new Ko({code:t&&t.code?t.code:po.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([k.MSG_IMAGE,k.MSG_AUDIO,k.MSG_VIDEO,k.MSG_FILE].includes(e.type))return yo;if(e.conversationType===k.CONV_C2C)return _o;if(e.conversationType===k.CONV_GROUP){var t=this.getModule(xn).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return St(n)?mo:vo}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(ei).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var r=this.getModule(ei);r.addSuccessCount(i),r.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n,i,r=t.code,o=void 0===r?-1:r,a=this.getModule(ei),s=this._getSendMessageSpecifiedKey(e);s===yo&&(n=o,i=!1,gs.includes(n)&&(i=!0),i)?a.addFailedCountOfUserSide(Io):_s(o)&&s&&a.addFailedCountOfUserSide(s)}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=Qt.UNSEND,this.sendMessageInstance(e)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===k.CONV_C2C?n=this.getModule(Nn):e.conversationType===k.CONV_GROUP&&(n=this.getModule(xn)),!n)return this._onCannotFindModule();var i=new wo("revokeMessage");i.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to));var r="".concat(this._n,".").concat("revokeMessage");return n.revokeMessage(e).then((function(n){var o=n.data.recallRetList;if(!Yt(o)&&0!==o[0].retCode){var a=new Ko({code:o[0].retCode,data:{message:e}});return i.setCode(a.code).setMoreMessage(a.message).end(),Zo(a)}return Be.i("".concat(r," ok. ID:").concat(e.ID)),e.isRevoked=!0,i.end(),t.getModule(Vn).onMessageRevoked([e]),zo({message:e})})).catch((function(n){t.probeNetwork().then((function(e){var t=m(e,2),r=t[0],o=t[1];i.setError(n,r,o).end()}));var o=new Ko({code:n&&n.code?n.code:po.MESSAGE_REVOKE_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}});return Be.w("".concat(r," failed. error:"),n),Zo(o)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,i=e[0],r=i.conversationID,o="",a=[],s=[];if(i.conversationType===k.CONV_C2C)n=this.getModule(Nn),o=r.replace(k.CONV_C2C,""),e.forEach((function(e){e&&e.status===Qt.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||a.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),s.push(e))}));else if(i.conversationType===k.CONV_GROUP)n=this.getModule(xn),o=r.replace(k.CONV_GROUP,""),e.forEach((function(e){e&&e.status===Qt.SUCCESS&&e.conversationID===r&&(e._onlineOnlyFlag||a.push("".concat(e.sequence)),s.push(e))}));else if(i.conversationType===k.CONV_SYSTEM)return Zo({code:po.CANNOT_DELETE_GROUP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(0===a.length)return this._onMessageDeleted(s);a.length>30&&(a=a.slice(0,30),s=s.slice(0,30));var c=new wo("deleteMessage");c.setMessage("to:".concat(o," count:").concat(a.length));var u="".concat(this._n,".").concat("deleteMessage");return n.deleteMessage({to:o,keyList:a}).then((function(e){return c.end(),Be.i("".concat(u," ok")),t._onMessageDeleted(s)})).catch((function(e){t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.w("".concat(u," failed. error:"),e);var n=new Ko({code:e&&e.code?e.code:po.MESSAGE_DELETE_FAIL,message:e&&e.message?e.message:void 0});return Zo(n)}))}},{key:"_onMessageDeleted",value:function(e){return this.getModule(Vn).onMessageDeleted(e),Jo({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),i=e.sourceTextList,r=e.sourceLanguage,o=e.targetLanguage,a=new wo("translateText");return a.setMessage("sourceLanguage:".concat(r," targetLanguage:").concat(o)),this.request({protocolName:ho,requestData:{sourceTextList:i,source:r||"auto",target:o,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var i=e.data,r=i.error,o=i.requestID,s=i.translatedTextList;if(0===r.code)return a.end(),Be.i("".concat(n," ok. requestID:").concat(o)),zo({translatedTextList:s});throw t(t({},r),{},{requestID:o})})).catch((function(e){return a.setCode(e.code).setMoreMessage(e.requestID).end(),Be.w("".concat(n," failed. error:"),e),Zo({code:po.TRANSLATE_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,i=e.conversationType,r=e.to;if(this.getModule(xn).isMessageFromOrToAVChatroom(r))return Zo({code:po.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(!1===this.getModule(ii).filterMessage(e))return Zo({code:po.PROFANITY_FOUND,data:{message:e}});i===k.CONV_C2C?n=this.getModule(Nn):i===k.CONV_GROUP&&(n=this.getModule(xn));var o=new wo("modifyMessage");o.setMessage("to:".concat(r));var a="".concat(this._n,".modifyRemoteMessage");return n.modifyRemoteMessage(e).then((function(n){o.end(),Be.i("".concat(a," ok"));var i=t._onModifyRemoteMessageResp(e,n.data);return zo({message:i})})).catch((function(n){if(o.setCode(n.code).setMoreMessage(n.message).end(),Be.w("".concat(a," failed. error:"),n),20027===n.code){var i=t._onModifyRemoteMessageResp(e,n.data);return Zo({code:po.MESSAGE_MODIFY_CONFLICT,data:{message:i}})}return Zo({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Be.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,i=e.from,r=e.to,o=e.random,a=e.sequence,s=e.time,c=t.elements,u=t.messageVersion,l=t.cloudCustomData,d=void 0===l?"":l;return this.getModule(Vn).onMessageModified({conversationType:n,from:i,to:r,time:s,random:o,sequence:a,elements:c,cloudCustomData:d,messageVersion:u})}},{key:"_generateUUID",value:function(e){var t=this.getModule(Fn),n="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(function(){for(var e="",t=32;t>0;--t)e+=_t[Math.floor(Math.random()*vt)];return e}()),i=e.name||e.value||e.url||e.tempFilePath,r=i&&i.slice(i.lastIndexOf(".")+1);return r&&(n="".concat(n,".").concat(r)),n}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.getModule(On).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===k.CONV_GROUP){var t=this.getModule(xn);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),i}(si),ms=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="MessageExtensionModule",i.messageExtensionMap=new Map,i.globalSeqMap=new Map,i.getMessageExtensionsMap=new Map,i}return a(n,[{key:"onMessageExtensionNotify",value:function(e){var t=this,n=e.dataList,i=n.messageInfo,r=n.operateType,o=n.operateResultList,a=n.tinyID,s=n.globalSequence,c=i.clientTime,u=i.random,l="".concat(a,"-").concat(c,"-").concat(u),d=[],h=[];Be.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(l," operateType:").concat(r," globalSequence:").concat(s)),this._updateGlobalSequence(l,s);var p=!1,f=!1;o.forEach((function(e){var n=e.extensions,i=void 0===n?[]:n,o=e.clearSequence;1===r?(p=!0,i.forEach((function(e){d.push({key:e.key,value:e.value})})),t._updateLocalExtension(l,i)):2===r?(f=!0,i.forEach((function(e){h.push(e.key)})),t._updateLocalExtension(l,i)):3===r&&(f=!0,t._hasLocalExtension(l)&&t._getLocalExtension(l).forEach((function(e,t){e.seq<=o&&!Yt(e.value)&&h.push(t)})),t._clearLocalExtension(l,o))})),p&&this.emitOuterEvent(M.MESSAGE_EXTENSIONS_UPDATED,{messageID:l,extensions:d}),f&&this.emitOuterEvent(M.MESSAGE_EXTENSIONS_DELETED,{messageID:l,keyList:h})}},{key:"setMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(q.MSG_EXT))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("setMessageExtensions"),r=e.ID,o=e.conversationID,a=e.sequence,s=e.time,c=y(t);t.length>20&&(c=t.slice(0,20),Be.w("".concat(i,". the length of extensions cannot exceed 20.")));var u="conversationID:".concat(o," messageID:").concat(r," sequence:").concat(a," time:").concat(s," count:").concat(c.length),l=new wo("setMessageExtensions");return l.setMessage(u),Be.l("".concat(i," ").concat(u)),this._modifyMessageExtensions(e,c).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,o="success count:".concat(n," fail count:").concat(r);return l.setMoreMessage(o).end(),Be.l("".concat(i," ok. ").concat(o)),zo({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];l.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this;if(!this.canIUse(q.MSG_EXT))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var n="".concat(this._n,".").concat("getMessageExtensions"),i=e.ID,r=e.conversationID,o=e.sequence,a=e.time,s="conversationID:".concat(r," messageID:").concat(i," sequence:").concat(o," time:").concat(a),c=new wo("getMessageExtensions");c.setMessage(s),Be.l("".concat(n," ").concat(s));var u=void 0;return this.getMessageExtensionsMap.has(i)&&(u=this._getGlobalSequence(i)),this._getMessageExtensions(e,u).then((function(e){return c.end(),Be.l("".concat(n," ok. total count:").concat(e.length)),at(u)&&e.length>0&&t.getMessageExtensionsMap.set(i,1),zo({extensions:e})})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];c.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n=this;if(!this.canIUse(q.MSG_EXT))return Zo({code:po.CANNOT_USE_COMMERCIAL_ABILITY});var i="".concat(this._n,".").concat("deleteMessageExtensions"),r=[],o=3;Yt(t)||(o=2,t.forEach((function(e){r.push({key:e,value:"",seq:0})})));var a=e.ID,s=e.conversationID,c=e.sequence,u=e.time,l="conversationID:".concat(s," messageID:").concat(a," sequence:").concat(c," time:").concat(u," operateType:").concat(o),d=new wo("deleteMessageExtensions");return d.setMessage(l),Be.l("".concat(i," ").concat(l)),this._modifyMessageExtensions(e,r,o).then((function(e){var t=e.resultList,n=e.successCount,r=e.failureCount,a="";return 2===o&&(a="success count:".concat(n," fail count:").concat(r)),d.setMoreMessage("".concat(a)).end(),Be.l("".concat(i," ok. ").concat(a)),zo({extensions:t})})).catch((function(e){return n.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];d.setError(e,i,r).end()})),Be.e("".concat(i," failed. error:"),e),Zo(e)}))}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=bt(e.to)?k.CONV_TOPIC:e.conversationType,o=void 0;3!==i&&(o=this._getRequestExtensions(e,t));var a=null;switch(r){case k.CONV_C2C:a=this.getModule(Nn);break;case k.CONV_GROUP:a=this.getModule(xn);break;case k.CONV_TOPIC:a=this.getModule(Gn);break;default:return Zo({code:po.CANNOT_FIND_MODULE})}return a.modifyMessageExtensions(e,o,i).then((function(t){var i=t.data,r=i.extensions,o=i.seq,a=[],s=0,c=0,u=[];return(r=Yt(r)?[]:r).forEach((function(e){var t=e.errorCode,n=e.extension,i=n.key,r=n.value,o=n.seq;a.push({code:t,key:i,value:r}),0===t?s++:c++,u.push({key:i,value:r,seq:o})})),n._updateGlobalSequence(e.ID,o),u.length>0&&(n._updateLocalExtension(e.ID,u),u=null),{resultList:a,successCount:s,failureCount:c}})).catch((function(e){return Zo(e)}))}},{key:"_getRequestExtensions",value:function(e,t){var n=[];if(this._hasLocalExtension(e.ID)){var i=this._getLocalExtension(e.ID);return t.forEach((function(e){var t=e.key,r=e.value,o=0;i.has(t)&&(o=i.get(t).seq),n.push({key:t,value:r,seq:o})})),n}return t.forEach((function(e){var t=e.key,i=e.value;n.push({key:t,value:i,seq:0})})),n}},{key:"_getMessageExtensions",value:function(e,t){var n=this,i="".concat(this._n,"._getMessageExtensions"),r=e.ID,o=e.to,a=null;switch(bt(o)?k.CONV_TOPIC:e.conversationType){case k.CONV_C2C:a=this.getModule(Nn);break;case k.CONV_GROUP:a=this.getModule(xn);break;case k.CONV_TOPIC:a=this.getModule(Gn);break;default:return Zo({code:po.CANNOT_FIND_MODULE})}return a.getMessageExtensions(e,t).then((function(t){var o=t.data,a=o.extensions,s=o.completeFlag,c=o.globalSequence,u=o.clearSequence;if(a=Yt(a)?[]:a,Be.l("".concat(i," ok. completeFlag:").concat(s," globalSequence:").concat(c," clearSequence:").concat(u," count:").concat(a.length)),n._updateLocalExtension(r,a),n._clearLocalExtension(r,u),n._updateGlobalSequence(r,c),1!==s){var l=a.slice(-1)[0].seq+1;return n._getMessageExtensions(e,l)}return n._getLocalExtensions(r)})).catch((function(e){return Zo(e)}))}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach((function(e){var t=e.key,i=e.value,r=void 0===i?"":i,o=e.seq;n.set(t,{value:r,seq:o})}))}},{key:"_clearLocalExtension",value:function(e,t){if(!(t<=0)&&this._hasLocalExtension(e)){var n=this._getLocalExtension(e);n.forEach((function(e,i){e.seq<=t&&n.delete(i)}))}}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach((function(e,n){var i=e.value;Yt(i)||t.push({key:n,value:i})})),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),n}(si),ys=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="ComboMessageModule",i}return a(n,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(null===n)return Zo({code:po.MESSAGE_SEND_FAIL});this._addSendMessageTotalCount(n);var i=Date.now();return this.getModule(Vn).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var r=e.data,o=r.time,a=r.sequence,s=r.readReceiptCode;et(s)&&0!==s&&(new wo("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(a," readReceiptCode:").concat(s)).end(),Be.w("".concat(t._n,".sendMessage readReceiptCode:").concat(s," message:").concat(t.getErrorMessage(s)))),t._addSendMessageSuccessCount(n,i);var c=t.getModule(Vn);n.status=Qt.SUCCESS,n.time=o,n.conversationType===k.CONV_GROUP&&(n.sequence=a),c.appendToMessageList(n);var u=n;return!0===n._isExcludedFromLastMessage&&(u=""),c.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:u}]}),zo({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.getModule(Yn),i="";return e.conversationType===k.CONV_C2C&&(i="".concat(j.NAME.OPEN_IM,".").concat(j.CMD.SEND_MESSAGE)),e.conversationType===k.CONV_GROUP&&(i="".concat(j.NAME.GROUP,".").concat(j.CMD.SEND_GROUP_MESSAGE)),n.sendComboMessage({servcmd:i,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var i=this.getMyUserID(),r={};if(r.senderTinyID=this.getMyTinyID(),r.currentUser=i,r.from=e.From_Account||i,e.GroupId?(r.conversationID="".concat(k.CONV_GROUP).concat(e.GroupId),r.conversationType=k.CONV_GROUP,r.to=e.GroupId):e.To_Account&&(r.conversationID="".concat(k.CONV_C2C).concat(e.To_Account),r.conversationType=k.CONV_C2C,r.to=e.To_Account),r.time=e.MsgTimeStamp||0,r.random=e.Random||e.MsgRandom||0,r.priority=e.MsgPriority,nt(e.CloudCustomData)&&e.CloudCustomData.length>0&&(r.cloudCustomData=e.CloudCustomData),ot(e.SendMsgControl)&&(r.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(r.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(r.messageControlInfo.excludedFromLastMessage=1)),r.conversationType===k.CONV_GROUP&&ot(e.To_Account)&&e.To_Account.length>0){var o=e.To_Account;e.To_Account.length>50&&(o=e.To_Account.slice(0,50),Be.w("".concat(t," To_Account must be less than or equal to 50."))),r.receiverList=y(o),e.To_Account=y(o)}1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(r.needReadReceipt=!0),1===e.SupportMessageExtension&&(r.isSupportExtension=!0),(n=new Ho(r)).status=Qt.UNSEND,e.MsgClientTime=n.clientTime,n.conversationType===k.CONV_C2C&&(e.MsgSeq=n.sequence);for(var a,s=e.MsgBody.length,c=0;c<s;c++)"TIMTextElem"===(a=e.MsgBody[c]).MsgType?n.setTextElement(a.MsgContent.Text):"TIMCustomElem"===a.MsgType?n.setCustomElement({data:a.MsgContent.Data||"",description:a.MsgContent.Desc||"",extension:a.MsgContent.Ext||""}):"TIMFaceElem"===a.MsgType&&n.setFaceElement({index:a.MsgContent.Index,data:a.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(d){n=null,Be.e("".concat(t," failed. error:"),d)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Qt.FAIL,this.getModule(Vn).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new wo("sendMessage");return n.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then((function(e){var i=m(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),Be.e("".concat(this._n,"._onSendMessageFailed error:"),t),Zo(new Ko({code:t&&t.code?t.code:po.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===k.CONV_C2C)return _o;if(e.conversationType===k.CONV_GROUP){var t=this.getModule(xn).getLocalGroupProfile(e.to);if(!t)return;var n=t.type;return St(n)?mo:vo}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this._getSendMessageSpecifiedKey(e);t&&this.getModule(ei).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=Math.abs(Date.now()-t),i=this._getSendMessageSpecifiedKey(e);if(i){var r=this.getModule(ei);r.addSuccessCount(i),r.addCost(i,n)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){var n=t.code,i=void 0===n?-1:n,r=this.getModule(ei),o=this._getSendMessageSpecifiedKey(e);_s(i)&&o&&r.addFailedCountOfUserSide(o)}}]),n}(si),Is=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="PluginModule",i.plugins={},i}return a(n,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach((function(n){t.plugins[n]=e[n]})),new wo("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),n}(si),Ts=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="SyncUnreadMessageModule",t._cookie="",t._onlineSyncFlag=!1,t.getInnerEmitterInstance().on($o,t._onLoginSuccess,g(t)),t}return a(i,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,i=e.cookie,r=e.syncFlag,o=e.isOnlineSync,a="".concat(this._n,"._startSync");Be.l("".concat(a," cookie:").concat(i," syncFlag:").concat(r," isOnlineSync:").concat(o)),this.request({protocolName:hi,requestData:{cookie:i,syncFlag:r,isOnlineSync:o}}).then((function(e){var i=e.data,r=i.cookie,o=i.syncFlag;n._cookie=r,Yt(r)||(0===o||1===o?(n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:r,syncFlag:o,isOnlineSync:0})):2===o&&n._dispatchUnreadMessage(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){Be.e("".concat(a," failed. error:"),e)}))}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.getModule(Yn).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.getModule(Nn).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList})}},{key:"startOnlineSync",value:function(){Be.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){Be.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),i}(si),Cs={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList"},ignoreKeyWord:["C2C","ID","USP"]};function Ss(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");var n;return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=Es(e)),e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),n=e,t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}var Es=function(e){for(var t=!1,n=!1,i=!1,r=0;r<e.length;r++){var o=e[r];t&&/[a-zA-Z]/.test(o)&&o.toUpperCase()===o?(e=e.slice(0,r)+"-"+e.slice(r),t=!1,i=n,n=!0,r++):n&&i&&/[a-zA-Z]/.test(o)&&o.toLowerCase()===o?(e=e.slice(0,r-1)+"-"+e.slice(r-1),i=n,n=!1,t=!0):(t=o.toLowerCase()===o&&o.toUpperCase()!==o,i=n,n=o.toUpperCase()===o&&o.toLowerCase()!==o)}return e};function bs(e,t){var n=0;return function e(t,i){if(++n>100)return n--,t;if(ot(t)){var r=t.map((function(t){return it(t)?e(t,i):t}));return n--,r}if(it(t)){var o=(a=t,s=function(e,t){if(!dt(t))return!1;if((r=t)!==Ss(r))for(var n=0;n<Cs.ignoreKeyWord.length&&!t.includes(Cs.ignoreKeyWord[n]);n++);var r;return at(i[t])?function(e){return"OPPOChannelID"===e?e:e[0].toUpperCase()+Ss(e).slice(1)}(t):i[t]},c=Object.create(null),Object.keys(a).forEach((function(e){var t=s(a[e],e);t&&(c[t]=a[e])})),c);return o=Dt(o,(function(t,n){return ot(t)||it(t)?e(t,i):t})),n--,o}var a,s,c}(e,t)}function Ms(e,t){if(ot(e))return e.map((function(e){return it(e)?Ms(e,t):e}));if(it(e)){var n=(i=e,r=function(e,n){return at(t[n])?Ss(n):t[n]},o={},Object.keys(i).forEach((function(e){o[r(i[e],e)]=i[e]})),o);return Dt(n,(function(e){return ot(e)||it(e)?Ms(e,t):e}))}var i,r,o}var ks=String.fromCharCode,ws=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320){var n=0|e.charCodeAt(1);if(56320<=n&&n<=57343){if((t=(t<<10)+n-56613888|0)>65535)return ks(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533}else t<=57343&&(t=65533);return t<=2047?ks(192|t>>>6,128|63&t):ks(224|t>>>12,128|t>>>6&63,128|63&t)},Ds=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ws),n=0|t.length,i=new Uint8Array(n),r=0;r<n;r=r+1|0)i[r]=0|t.charCodeAt(r);return i},As=function(e){for(var t=new Uint8Array(e),n="",i=0,r=t.length;i<r;){var o=t[i],a=0,s=0;if(o<=127?(a=0,s=255&o):o<=223?(a=1,s=31&o):o<=239?(a=2,s=15&o):o<=244&&(a=3,s=7&o),r-i-a>0)for(var c=0;c<a;)s=s<<6|63&(o=t[i+c+1]),c+=1;else s=65533,a=r-i;n+=String.fromCodePoint(s),i+=a+1}return n},Rs=function(){function e(t){r(this,e),this._handler=t;var n=t.getURL();if(this._socket=null,this._workerSocket=null,this._id=gt(),this._handler.getIsWorkerEnabled()){var i=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"}));this._workerSocket=new Worker(i);var o=this;this._workerSocket.onmessage=function(e){var t=e.data,n=t.callback,i=t.e;"onOpen"===n?o._onOpen():"onClose"===n?o._onClose(i):"onError"===n?o._onError(i):"onMessage"===n&&o._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:n})}else oe?te?(se.connectSocket({url:n,header:{"content-type":"application/json"}}),se.onSocketClose(this._onClose.bind(this)),se.onSocketOpen(this._onOpen.bind(this)),se.onSocketMessage(this._onMessage.bind(this)),se.onSocketError(this._onError.bind(this))):(this._socket=se.connectSocket({url:n,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):ae&&(this._socket=new WebSocket(n),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this));this._canIUseBinaryFrame=t.canIUseBinaryFrame()}return a(e,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){this._handler.onMessage({data:this._canIUseBinaryFrame?As(e.data):e.data})}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),te)return se.offSocketClose(),se.offSocketMessage(),se.offSocketOpen(),se.offSocketError(),void se.closeSocket();this._socket&&(oe?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):ae&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),ee?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){if(this._workerSocket)this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?Ds(e.data).buffer:e.data});else{if(te)return void se.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}});this._socket&&(oe?this._socket.send({data:this._canIUseBinaryFrame?Ds(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):ae&&this._socket.send(this._canIUseBinaryFrame?Ds(e.data).buffer:e.data))}}}]),e}(),Ls=4e3,Os=4001,Ns=["keyMap"],xs=["keyMap"],Ps="connected",Us="connecting",Gs="disconnected",Vs=function(){function e(t){r(this,e),this._channelModule=t,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=Gs,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=gt(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._setWebsocketHost(),this._initConnection()}return a(e,[{key:"_setWebsocketHost",value:function(){var e=this._channelModule.getModule(Fn),t=N;this._channelModule.isOversea()&&(t=x),e.isSingaporeSite()?t=P:e.isKoreaSite()?t=U:e.isGermanySite()?t=G:e.isIndiaSite()?t=V:e.isJapanSite()?t=F:e.isUSASite()&&(t=B),j.HOST.setCurrent(t)}},{key:"_initConnection",value:function(){at(j.HOST.CURRENT.BACKUP)||""===this._url?this._url=j.HOST.CURRENT.DEFAULT:this._url===j.HOST.CURRENT.DEFAULT?this._url=j.HOST.CURRENT.BACKUP:this._url===j.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?j.HOST.CURRENT.ANYCAST:j.HOST.CURRENT.DEFAULT:this._url===j.HOST.CURRENT.ANYCAST&&(j.HOST.CURRENT.ANYCAST="",this._url=j.HOST.CURRENT.DEFAULT);var e=this._channelModule.getModule(Fn).getProxyServer();Yt(e)||(this._url=e),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return ae&&j.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var i=t.reject,r=t.timestamp,o=15e3;-1!==n.indexOf(ci)&&(o=9e4),Date.now()-r>=o&&(Be.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),i(new Ko({code:po.NETWORK_TIMEOUT})),e._channelModule.onRequestTimeout(n))}))}},{key:"onOpen",value:function(e){if(""!==this._readyState){this._onOpenTs=Date.now();var t=e.id;this._socketID=t;var n=Date.now()-this._startTs;Be.l("".concat(this._n,"._onOpen cost ").concat(n," ms. socketID:").concat(t)),new wo("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage("socketID:".concat(t)).end(),e.id===this._socketID&&(this._readyState=Ps,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._channelModule.onReconnected(),this._reConnectFlag=!1),this._channelModule.onOpen())}}},{key:"onClose",value:function(e){var t=new wo("wsOnClose"),n=e.id,i=e.e,r="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(i.code," reason:").concat(i.reason),o=0;0!==this._onOpenTs&&(o=Date.now()-this._onOpenTs),t.setMessage(o).setCostTime(o).setMoreMessage(r).setCode(i.code).end(),Be.l("".concat(this._n,"._onClose ").concat(r," onlineTime:").concat(o)),n===this._socketID&&(this._readyState=Gs,o<1e3?this._channelModule.onReconnectFailed():this._channelModule.onClose())}},{key:"onError",value:function(e){var t=e.id,n=e.e,i="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new wo("wsOnError").setMessage(n.errMsg||pt(n)).setMoreMessage(i).setLevel("error").end(),Be.w("".concat(this._n,"._onError"),n,i),t===this._socketID&&(this._readyState="",this._channelModule.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(l){new wo("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n=this._getRequestIDFromHead(t.head),i=t.body;if(!this._isTRTCCommand(n)){var r=Pt(t.head);i=Ms(t.body,this._getResponseKeyMap(r))}if(Be.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(i)," requestID:").concat(n," has:").concat(this._promiseMap.has(n))),this._setNextPingTs(),this._promiseMap.has(n)){var o=this._promiseMap.get(n),a=o.resolve,s=o.reject,c=o.timestamp;return this._promiseMap.delete(n),this._calcRTT(c),void(i.errorCode&&0!==i.errorCode?(this._channelModule.onErrorCodeNotZero(i),s(new Ko({code:i.errorCode,message:i.errorInfo||"",data:n.includes(wi)||n.includes(mr)?{elements:i.elements,messageVersion:i.messageVersion,cloudCustomData:i.cloudCustomData}:void 0}))):a(zo(i)))}this._channelModule.onMessage({head:t.head,body:i})}}},{key:"_isTRTCCommand",value:function(e){for(var t=this._channelModule.getModule(ri).getCommandList(),n=!1,i=0;i<t.length;i++)if(e.startsWith(t[i])){n=!0;break}return n}},{key:"_calcRTT",value:function(e){var t=Date.now()-e;this._channelModule.getModule(ei).addRTT(t)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new Rs(this),this._socketID=this._socket.getID(),this._readyState=Us,Be.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new wo("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._channelModule.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=Lt();(te||X&&"windows"===e||ie)&&(this._canIUseBinaryFrame=!1);var t=-1;"ios"===e?t=me||-1:"android"===e&&(t=Ie||-1);var n=this._channelModule.getModule(Fn),i=this._channelModule.getPlatform(),r=n.getSDKAppID(),o=n.getInstanceID(),a="sdkappid=".concat(r,"&instanceid=").concat(o,"&random=").concat(this._getRandom(),"&platform=").concat(i,"&host=").concat(e,"&version=").concat(t);return this._canIUseBinaryFrame?"".concat(this._url,"/binfo?").concat(a):"".concat(this._url,"/info?").concat(a)}},{key:"_closeConnection",value:function(e){Be.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=Gs)}},{key:"_resend",value:function(){var e=this;if(Be.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),this._promiseMap.size>0&&this._promiseMap.forEach((function(t,n){var i=t.uplinkData,r=t.resolve,o=t.reject;e._promiseMap.set(n,{resolve:r,reject:o,timestamp:Date.now(),uplinkData:i}),e._execute(n,i)})),this._simpleRequestMap.size>0){var t,n=b(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var i=m(t.value,2),r=i[0],o=i[1];this._execute(r,o)}}catch(s){n.e(s)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this;e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var n=f(e,Ns),i=this._getRequestIDFromHead(e.head),r=JSON.stringify(n);return new Promise((function(e,o){t._promiseMap.set(i,{resolve:e,reject:o,timestamp:Date.now(),uplinkData:r}),Be.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(i," readyState:").concat(t._readyState)),t._readyState!==Ps?t._reConnect():(t._execute(i,r),t._channelModule.getModule(ei).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=f(e,xs),n=this._getRequestIDFromHead(e.head),i=JSON.stringify(t);this._readyState!==Ps?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(n,i):Be.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(n,i)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:oe?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Be.l("".concat(this._n,"._onSendFail requestID:").concat(e))}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=gt()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){var n=this._channelModule.getKeyMap(e);return t(t({},Cs.response),n.response)}},{key:"_reConnect",value:function(){this._readyState!==Ps&&this._readyState!==Us&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e=this,t="".concat(this._n,".forcedReconnect");Be.l("".concat(t," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(Os),this._initConnection()):(this._reConnectCount=0,this._channelModule.probeNetwork().then((function(n){var i=m(n,2),r=i[0];i[1],r?(Be.w("".concat(t," disconnected from wsserver but network is ok, continue...")),e._closeConnection(Os),e._initConnection()):e._channelModule.onReconnectFailed()})))}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===Ps}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(e){Be.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&ke}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){Be.l("".concat(this._n,".close")),this._closeConnection(Ls),this._promiseMap.clear(),this._startSequence=gt(),this._readyState=Gs,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),e}(),Fs=function(e){c(n,e);var t=v(n);function n(e){var i;if(r(this,n),(i=t.call(this,e))._n="ChannelModule",i._socketHandler=new Vs(g(i)),i._probing=!1,i._isAppShowing=!0,i._previousState=k.NET_STATE_CONNECTED,oe&&"function"==typeof se.onAppShow&&"function"==typeof se.onAppHide){var o=i._onAppHide.bind(g(i)),a=i._onAppShow.bind(g(i));"function"==typeof se.offAppHide&&se.offAppHide(o),"function"==typeof se.offAppShow&&se.offAppShow(a),se.onAppHide(o),se.onAppShow(a)}return i._timerForNotLoggedIn=-1,i._timerForNotLoggedIn=setInterval(i.onCheckTimer.bind(g(i)),1e3),i._fatalErrorFlag=!1,i}return a(n,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(this._timerForNotLoggedIn>0&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.getModule(Yn).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.getModule(Yn).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==k.NET_STATE_CONNECTED&&e.head.servcmd.includes(Fr)?(this.reConnect(),this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=j.HOST.CURRENT.STAT;return new Promise((function(n,i){var r="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),o=JSON.stringify(e.body),a="application/x-www-form-urlencoded;charset=UTF-8";if(oe)se.request({url:r,data:o,method:"POST",timeout:3e3,header:{"content-type":a},success:function(){n()},fail:function(){i(new Ko({code:po.NETWORK_ERROR}))}});else{var s=new XMLHttpRequest,c=setTimeout((function(){s.abort(),i(new Ko({code:po.NETWORK_TIMEOUT}))}),3e3);s.onreadystatechange=function(){4===s.readyState&&(clearTimeout(c),200===s.status||304===s.status?n():i(new Ko({code:po.NETWORK_ERROR})))},s.open("POST",r,!0),s.setRequestHeader("Content-type",a),s.send(o)}}))}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){oe&&!ie&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.getModule(Yn).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){}},{key:"onReconnected",value:function(){Be.l("".concat(this._n,".onReconnected")),this._m.restartTimer(),this.getModule(Yn).onReconnected(),this._emitNetStateChangeEvent(k.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Be.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;this._socketHandler&&(t=this._socketHandler.getReconnectFlag());var n="forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t);if(Be.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===k.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(k.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Be.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),this._previousState=e,this.emitOuterEvent(M.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e=this;if(!0!==this._probing){this._probing=!0;var t=this.getModule(Yn).getProtocolData({protocolName:Br});this.send(t).then((function(){e._probing=!1})).catch((function(t){if(Be.w("".concat(e._n,"._ping failed. error:"),t),e._probing=!1,t&&60002===t.code)return new wo("error").setMessage("code:".concat(t.code," message:").concat(t.message)).setNetworkType(e.getModule(qn).getNetworkType()).end(),e._fatalErrorFlag=!0,void e._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED);e.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];Be.l("".concat(e._n,"._ping failed. probe network, isAppShowing:").concat(e._isAppShowing," online:").concat(i," networkType:").concat(r)),i?e.reConnect():e._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}))}))}}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),this._timerForNotLoggedIn>-1&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._previousState=k.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3)}}]),n}(si),Bs=["a2","tinyid"],js=["a2","tinyid"],qs=function(){function e(t){r(this,e),this._n="ProtocolHandler",this._sessionModule=t,this._configMap=new Map,this._fillConfigMap()}return a(e,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionModule.genCommonHead(),n=this._sessionModule.genCosSpecifiedHead(),i=this._sessionModule.genSSOReportHead(),r=this._sessionModule.isIntl();this._configMap.set(ci,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}}(e)),this._configMap.set(ui,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}}(e)),this._configMap.set(li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.STAT_SERVICE,".").concat(j.CMD.KICK_OTHER)}),body:{}}}(e)),this._configMap.set(Ur,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_COS_SIGN,".").concat(j.CMD.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}}(n)),this._configMap.set(Gr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.CUSTOM_UPLOAD,".").concat(j.CMD.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}}(n)),this._configMap.set(Vr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.CUSTOM_UPLOAD,".").concat(j.CMD.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}}(n)),this._configMap.set(Zr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_CONFIG_MANAGER,".").concat(j.CMD.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(Xr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_CONFIG_MANAGER,".").concat(j.CMD.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(e)),this._configMap.set(Yr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_CONFIG_MANAGER,".").concat(j.CMD.FETCH_CLOUD_CONTROL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(Jr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_CONFIG_MANAGER,".").concat(j.CMD.PUSHED_CLOUD_CONTROL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(e)),this._configMap.set(Qr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OVERLOAD_PUSH,".").concat(j.CMD.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}}(e)),this._configMap.set(hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.GET_MESSAGES)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}}(e)),r||(this._configMap.set(pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.BIG_DATA_HALLWAY_AUTH_KEY)}),body:{}}}(e)),this._configMap.set(lo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_MSG_AUDIT_MGR,".").concat(j.CMD.GET_RPOFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}}(e))),this._configMap.set(fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.SEND_MESSAGE)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}}(e)),this._configMap.set(gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.SEND_GROUP_MESSAGE)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account"},response:{MsgTime:"time",MsgSeq:"sequence"}}}}(e)),this._configMap.set(Ti,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.REVOKE_C2C_MESSAGE)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}}(e)),this._configMap.set(rr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.REVOKE_GROUP_MESSAGE)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}(e)),this._configMap.set(bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.GET_C2C_ROAM_MESSAGES)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}}(e)),this._configMap.set(wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.MODIFY_C2C_MESSAGE)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(sr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_ROAM_MESSAGES)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList"}}}}(e)),this._configMap.set(Ci,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.SET_C2C_MESSAGE_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}}(e)),this._configMap.set(Si,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}}(e)),this._configMap.set(Ei,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{updateSequence:0},keyMap:{response:{MuteNotificationsList:"muteFlagList"}}}}(e)),this._configMap.set(or,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.SET_GROUP_MESSAGE_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}}(e)),this._configMap.set(ar,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.SET_ALL_MESSAGE_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}}(e)),this._configMap.set(ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.DELETE_C2C_MESSAGE)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}}(e)),this._configMap.set(vr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.DELETE_GROUP_MESSAGE)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}}(e)),this._configMap.set(ho,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_TRANSLATE,".").concat(j.CMD.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}}(e)),this._configMap.set(mr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.MODIFY_GROUP_MESSAGE)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(e)),this._configMap.set(cr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}}(e)),this._configMap.set(lr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}}(e)),this._configMap.set(ur,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}}(e)),this._configMap.set(dr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}}(e)),this._configMap.set(Di,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM_MSG_EXT,".").concat(j.CMD.MODIFY_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(Ai,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM_MSG_EXT,".").concat(j.CMD.GET_C2C_MESSAGE_EXTENSIONS)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}}(e)),this._configMap.set(Er,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM_MSG_EXT,".").concat(j.CMD.MODIFY_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}}(e)),this._configMap.set(br,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM_MSG_EXT,".").concat(j.CMD.GET_GROUP_MESSAGE_EXTENSIONS)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}}(e)),this._configMap.set(Mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.GET_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}(e)),this._configMap.set(Li,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,count:0},keyMap:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}}(e)),this._configMap.set(Ri,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.PAGING_GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:4,assistFlag:15},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID"}}}}(e)),this._configMap.set(Oi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.DELETE_CONVERSATION)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}}(e)),this._configMap.set(Ni,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.CLEAR_HISTORY_MESSAGE)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}}(e)),this._configMap.set(xi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.PIN_CONVERSATION)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}}(e)),this._configMap.set(Pi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.DELETE_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(Ui,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Gi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.MARK_CONVERSATION)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.CREATE_CONVERSATION_GROUP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}}(e)),this._configMap.set(Fi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.DELETE_CONVERSATION_GROUP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}}(e)),this._configMap.set(Bi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}}(e)),this._configMap.set(ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.UPDATE_CONVERSATION_GROUP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}}(e)),this._configMap.set(Hi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.RECENT_CONTACT,".").concat(j.CMD.GET_CONVERSATION_GROUP_LIST)}),body:{fromAccount:"",startTime:void 0,startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}}(e)),this._configMap.set(_i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.PROFILE,".").concat(j.CMD.PORTRAIT_GET)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(vi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.PROFILE,".").concat(j.CMD.PORTRAIT_SET)}),body:{fromAccount:"",profileItem:[{tag:qe.NICK,value:""},{tag:qe.GENDER,value:""},{tag:qe.ALLOWTYPE,value:""},{tag:qe.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(e)),this._configMap.set(mi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.FRIEND,".").concat(j.CMD.GET_BLACKLIST)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}}(e)),this._configMap.set(yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.FRIEND,".").concat(j.CMD.ADD_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(Ii,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.FRIEND,".").concat(j.CMD.DELETE_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(e)),this._configMap.set(io,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}}(e)),this._configMap.set(ro,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}}(e)),this._configMap.set(oo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.SUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(ao,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.UNSUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(e)),this._configMap.set(zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_JOINED_GROUPS)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}}(e)),this._configMap.set(Ki,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_INFO)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(Wi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.CREATE_GROUP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}}(e)),this._configMap.set(Yi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.DESTROY_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set(Ji,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.MODIFY_GROUP_INFO)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}}(e)),this._configMap.set(Zi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}}(e)),this._configMap.set(Xi,function(e){return e.a2,e.tinyid,{head:t(t({},f(e,Bs)),{},{servcmd:"".concat(j.NAME.BIG_GROUP_NO_AUTH,".").concat(j.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}}}(e)),this._configMap.set(Qi,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.QUIT_GROUP)}),body:{groupID:void 0}}}(e)),this._configMap.set($i,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.SEARCH_GROUP_BY_ID)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}}(e)),this._configMap.set(er,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.CHANGE_GROUP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}}(e)),this._configMap.set(tr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.HANDLE_APPLY_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(nr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.HANDLE_INVITE_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}}(e)),this._configMap.set(ir,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.HANDLE_GROUP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(e)),this._configMap.set(hr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_APPLICATION)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID"}}}}(e)),this._configMap.set(pr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.DELETE_GROUP_SYSTEM_MESSAGE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(e)),this._configMap.set(fr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.BIG_GROUP_LONG_POLLING,".").concat(j.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(gr,function(e){return e.a2,e.tinyid,{head:t(t({},f(e,js)),{},{servcmd:"".concat(j.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,".").concat(j.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(e)),this._configMap.set(_r,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_ONLINE_MEMBER_NUM)}),body:{groupID:void 0}}}(e)),this._configMap.set(yr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.SET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Ir,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.MODIFY_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(e)),this._configMap.set(Tr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.DELETE_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}}(e)),this._configMap.set(Cr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.CLEAR_GROUP_ATTRIBUTES)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}}(e)),this._configMap.set(Sr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_ATTR,".").concat(j.CMD.GET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}}(e)),this._configMap.set(Mr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_NOTIFY)}),body:{notifyType:1,groupID:"",beginTime:0,endTime:0,limit:20},keyMap:{request:{},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList"}}}}(e)),this._configMap.set(kr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.UPDATE_GROUP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}}(e)),this._configMap.set(wr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}}(e)),this._configMap.set($r,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_COMMUNITY,".").concat(j.CMD.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}}(e)),this._configMap.set(eo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_COMMUNITY,".").concat(j.CMD.DELETE_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}}(e)),this._configMap.set(to,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_COMMUNITY,".").concat(j.CMD.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}}(e)),this._configMap.set(no,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_COMMUNITY,".").concat(j.CMD.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}}(e)),this._configMap.set(Dr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_MEMBER_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:["Role","NameCard","ShutUpUntil","JoinTime"],memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}}(e)),this._configMap.set(Ar,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_AVCHATROOM,".").concat(j.CMD.GET_AVCHATROOM_MEMBER_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}}(e)),this._configMap.set(Rr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.GET_GROUP_MEMBER_INFO)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}}(e)),this._configMap.set(Lr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.ADD_GROUP_MEMBER)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}}(e)),this._configMap.set(Or,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.DELETE_GROUP_MEMBER)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}}(e)),this._configMap.set(Nr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.BAN_AVCHATROOM_MEMBER)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}}(e)),this._configMap.set(xr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP,".").concat(j.CMD.MODIFY_GROUP_MEMBER_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}}(e)),this._configMap.set(Pr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.GROUP_AVCHATROOM,".").concat(j.CMD.MARK_AVCHATROOM_MEMBER_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}}(e)),this._configMap.set(Fr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STAT,".").concat(j.CMD.TIM_WEB_REPORT_V2)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}}(i)),this._configMap.set(Br,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.HEARTBEAT,".").concat(j.CMD.ALIVE)}),body:{}}}(e)),this._configMap.set(jr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_PUSH,".").concat(j.CMD.MESSAGE_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}}(e)),this._configMap.set(qr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_PUSH,".").concat(j.CMD.MULTI_MESSAGE_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}}(e)),this._configMap.set(Hr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.OPEN_IM,".").concat(j.CMD.MESSAGE_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}}(e)),this._configMap.set(zr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}}(e)),this._configMap.set(Wr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_LONG_MESSAGE,".").concat(j.CMD.DOWNLOAD_MERGER_MESSAGE)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}}(e)),this._configMap.set(Kr,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_LONG_MESSAGE,".").concat(j.CMD.UPLOAD_MERGER_MESSAGE)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}}(e)),this._configMap.set(uo,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns"}}}}(e)),this._configMap.set(co,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.STAT_FOREGROUND)}),body:{isWebUniapp:0}}}(e)),this._configMap.set(so,function(e){return{head:t(t({},e),{},{servcmd:"".concat(j.NAME.IM_OPEN_STATUS,".").concat(j.CMD.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}}(e))}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Be.w("".concat(this._n,".getKeyMap unknown protocolName:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.protocolName,n=e.requestData,i=this.get(t),r=null;if(n){var o=this._simpleDeepCopy(i),a=this._updateService(n,o),s=a.body,c=Object.create(null);for(var u in s)if(Object.prototype.hasOwnProperty.call(s,u)){if(c[u]=s[u],void 0===n[u])continue;c[u]=n[u]}a.body=c,r=this._getUplinkData(a)}else r=this._getUplinkData(i);return r}},{key:"_getUplinkData",value:function(e){var t=this._requestDataCleaner(e),n=Pt(t.head),i=bs(t.body,this._getRequestKeyMap(n));return t.body=i,t}},{key:"_updateService",value:function(e,t){var n=Pt(t.head);if(this._isFromGroupRequest(t)){var i=e.type,r=e.groupID,o=void 0===r?void 0:r,a=e.groupIDList,s=void 0===a?[]:a;at(o)&&(o=s[0]||""),Et({type:i,groupID:o})&&(t.head.servcmd="".concat(j.NAME.GROUP_COMMUNITY,".").concat(n))}return t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(j.NAME.GROUP)||e.head.servcmd.includes(j.NAME.GROUP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){var n=this.getKeyMap(e);return t(t({},Cs.request),n.request)}},{key:"_requestDataCleaner",value:function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&dt(n)&&null!==e[n]&&void 0!==e[n]&&("object"!==i(e[n])?t[n]=e[n]:t[n]=this._requestDataCleaner.bind(this)(e[n]));return t}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),i={},r=0,o=n.length;r<o;r++)t=n[r],ot(e[t])?i[t]=Array.from(e[t]):it(e[t])?i[t]=this._simpleDeepCopy(e[t]):i[t]=e[t];return i}}]),e}(),Hs=[Hr],zs=function(){function e(t){r(this,e),this._sessionModule=t,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._keys=y(this._eventHandlerMap.keys())}return a(e,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(Nn);t&&(e.dataList.forEach((function(e){if(1===e.isSyncMessage){var t=e.from;e.from=e.to,e.to=t}})),1===e.needSync&&this._sessionModule.getModule(Wn).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(Nn);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionModule.getModule(xn);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionModule.getModule(xn);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionModule.getModule(xn);if(t){var n=e.event,i=e.dataList,r=e.isInstantMessage,o=void 0===r||r,a=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:i});break;case 5:for(var s=0;s<i.length;s++)if(ot(i[s].elements.revokedInfos))t.onGroupMessageRevoked({dataList:i});else if(ot(i[s].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:i});else{if(!ot(i[s].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:i,isInstantMessage:o,isSyncingEnded:a});break}t.onReadReceiptList({dataList:i})}break;case 12:this._sessionModule.getModule(Vn).onNewGroupAtTips({dataList:i});break;default:Be.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),i)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t=this,n=e.dataList;if(ot(n)){var i=this._sessionModule.getModule(Nn);n.forEach((function(e){if(rt(e))if(e.hasOwnProperty("kickoutMsgNotify")){var r=e.kickoutMsgNotify,o=r.kickType,a=r.newInstanceInfo,s=void 0===a?{}:a;1===o?t._sessionModule.onMultipleAccountKickedOut(s):2===o?t._sessionModule.onMultipleDeviceKickedOut(s):3===o&&t._sessionModule.onRestApiKickedOut(s)}else e.hasOwnProperty("c2cMessageRevokedNotify")?i&&i.onC2CMessageRevoked({dataList:n}):e.hasOwnProperty("c2cMessageReadReceipt")?i&&i.onC2CMessageReadReceipt({dataList:n}):e.hasOwnProperty("c2cMessageReadNotice")?i&&i.onC2CMessageReadNotice({dataList:n}):e.hasOwnProperty("muteNotificationsSync")&&t._sessionModule.getModule(Vn).onC2CMessageRemindTypeSynced({dataList:n})}))}}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionModule.getModule(Nn).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionModule.getModule(On).onProfileModified({dataList:e.dataList});var t=this._sessionModule.getModule(Pn);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionModule.getModule(On).onRelationChainModified({dataList:e.dataList});var t=this._sessionModule.getModule(Pn);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(e){var t=e.dataList;if(ot(t)){var n=this._sessionModule.getModule(Vn);n&&t.forEach((function(e){var t=e.pushType;if(1===t){var i=e.recentContactDeleteItem;n.onConversationDeleted(i.recentContactList)}else if(2===t){var r=e.recentContactTopItem;n.onConversationPinned(r.recentContactList)}else if(3===t){var o=e.recentContactTopItem;n.onConversationUnpinned(o.recentContactList)}else if(4===t){var a=e.recentContactMarkContact;n.onConversationMarkUpdated(a.recentContactMarkContactItem)}else if(5===t){var s=e.recentContactCreateContactGroup;n.onConversationGroupCreated(s.msgContactGroupContactItem)}else if(6===t){var c=e.recentContactDelContactGroup;n.onConversationGroupDeleted(c.msgGroupItem)}else if(7===t){var u=e.recentContactUpdateContactGroup,l=u.updateType,d=u.msgUpdateGroup,h=u.msgUpdateContact;if(1===l){var p=d.updateGroupType;1===p?n.onConversationGroupNameUpdated(d):2===p&&n.onConversationInGroupUpdated(d)}else 2===l&&n.onConversationAddedToOrDeletedFromGroup(h)}}))}}},{key:"_allMessageReadHandler",value:function(e){var t=e.dataList,n=this._sessionModule.getModule(Vn);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionModule.getModule(On).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionModule.getModule(Ln).onMessageExtensionNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var i=n.eventArray,r=n.isInstantMessage,o=n.isSyncingEnded,a=n.needSync;if(ot(i))for(var s=null,c=null,u=0,l=0,d=i.length;l<d;l++){u=(s=i[l]).event;var h=Object.keys(s).find((function(e){return-1!==t._keys.indexOf(e)}));h?(c=14===u?{readAllC2CMessage:s[h],groupMessageReadInfoList:s.groupMessageReadNotice||[]}:16===u?{userID:s.userID,readReceiptList:s[h]}:s[h],this._eventHandlerMap.get(h)({event:u,dataList:c,isInstantMessage:r,isSyncingEnded:o,needSync:a})):Be.l("".concat(this._n,".onMessage unknown eventItem:").concat(s))}}}},{key:"_filterMessageFromIMOpenPush",value:function(e){var t=e.head,n=e.body,i=t.servcmd,r=!1;if(at(i)||(r=i.includes(j.NAME.IM_CONFIG_MANAGER)||i.includes(j.NAME.OVERLOAD_PUSH)||i.includes(j.NAME.STAT_SERVICE)),!r)return!0;if(i.includes(j.CMD.PUSHED_CLOUD_CONTROL_CONFIG))this._sessionModule.getModule(Xn).onPushedCloudControlConfig(n);else if(i.includes(j.CMD.PUSHED_COMMERCIAL_CONFIG))this._sessionModule.getModule(ti).onPushedConfig(n);else if(i.includes(j.CMD.OVERLOAD_NOTIFY))this._sessionModule.onPushedServerOverload(n);else if(i.includes(j.CMD.KICK_OTHER)){var o=Date.now();this._sessionModule.reLoginOnKickOther();var a=new wo("kickOther"),s=this._sessionModule.getModule(An).getLastWsHelloTs(),c=o-s;a.setMessage("last wshello time:".concat(s," diff:").concat(c,"ms")).setNetworkType(this._sessionModule.getNetworkType()).end()}return!1}}]),e}(),Ks=[{cmd:j.CMD.GET_GROUP_INFO,interval:1,count:20},{cmd:j.CMD.GET_AVCHATROOM_MEMBER_LIST,interval:3,count:1},{cmd:j.CMD.GET_GROUP_APPLICATION,interval:1,count:15},{cmd:j.CMD.GET_TOPIC_LIST,interval:1,count:10},{cmd:j.CMD.SET_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:j.CMD.MODIFY_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:j.CMD.DELETE_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:j.CMD.CLEAR_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:j.CMD.GET_GROUP_ATTRIBUTES,interval:5,count:20},{cmd:j.CMD.UPDATE_GROUP_COUNTER,interval:5,count:20},{cmd:j.CMD.GET_GROUP_COUNTER,interval:5,count:20},{cmd:j.CMD.SET_ALL_MESSAGE_READ,interval:1,count:1},{cmd:j.CMD.GET_USER_STATUS,interval:5,count:20},{cmd:j.CMD.SUBSCRIBE_USER_STATUS,interval:5,count:20},{cmd:j.CMD.UNSUBSCRIBE_USER_STATUS,interval:5,count:20}],Ws=function(e){c(i,e);var n=v(i);function i(e){var t;return r(this,i),(t=n.call(this,e))._n="SessionModule",t._platform=t.getPlatform(),t._protocolHandler=new qs(g(t)),t._messageDispatcher=new zs(g(t)),t._commandFrequencyLimitMap=new Map,t._commandRequestInfoMap=new Map,t._serverOverloadInfoMap=new Map,t._init(),t.getInnerEmitterInstance().on(ea,t._onCloudConfigUpdated,g(t)),t}return a(i,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(Ks)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");at(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach((function(e){t._commandFrequencyLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"request",value:function(e){Be.d("".concat(this._n,".request options:"),e);var t=e.protocolName,n=e.tjgID;if(!this._protocolHandler.has(t))return Be.w("".concat(this._n,".request unknown protocol:").concat(t)),Zo({code:po.CANNOT_FIND_PROTOCOL});var i=this.getProtocolData(e),r=i.head.servcmd;if(this._isFrequencyOverLimit(r))return Zo({code:po.OVER_FREQUENCY_LIMIT});if(this._isServerOverload(r))return Zo({code:po.OPEN_SERVICE_OVERLOAD_ERROR});Yt(n)||(i.head.tjgID=n);var o=this.getModule(Jn);return Hs.includes(t)?o.simplySend(i):o.send(i)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.getModule(Fn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.getModule(Fn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"genSSOReportHead",value:function(){var e=this.getModule(Fn);return{ver:"v4",platform:this._platform,websdkappid:O,websdkversion:L,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd,i=e.data,r={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(Jn).send(r)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd,i=e.data,r={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:i};return this.getModule(Jn).send(r)}},{key:"onErrorCodeNotZero",value:function(e){var t=e.errorCode;if(t===po.HELLO_ANSWER_KICKED_OUT){var n=e.kickType,i=e.newInstanceInfo,r=void 0===i?{}:i;1===n?this.onMultipleAccountKickedOut(r):2===n?this.onMultipleDeviceKickedOut(r):3===n&&this.onRestApiKickedOut(r)}t!==po.MESSAGE_A2KEY_EXPIRED&&t!==po.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.getModule(Jn).reConnect())}},{key:"onMessage",value:function(e){var t=e.body,n=t.needAck,i=void 0===n?0:n,r=t.sessionData;1===i&&this._sendACK(r),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(){this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Be.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Be.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e=this;if(this.isLoggedIn()){var t=0,n=this.getModule(ni);n.canIUseOfflinePush()&&(t=n.getUniAppPlatform()),this.request({protocolName:ci,requestData:{isWebUniapp:t}}).then((function(t){var n=t.data.instanceID;e.getModule(Fn).setStatusInstanceID(n),Be.l("".concat(e._n,"._reLogin ok.")),e.getModule(Vn).syncConversationList().then((function(){Be.l("".concat(e._n,"._reLogin, sync conversation list ok.")),e.getModule($n).start()})),e.getModule(xn).updateLocalMainSequenceOnReconnected();var i=e.getModule(Gn);i.resetGetTopicTime(),i.getTopicListOnReconnected()}))}}},{key:"onMultipleAccountKickedOut",value:function(e){this.getModule(An).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.getModule(An).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.getModule(An).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.getModule(An).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.request({protocolName:Hr,requestData:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){var t=e.split(".")[1];if(!this._commandFrequencyLimitMap.has(t))return!1;if(!this._commandRequestInfoMap.has(t))return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(t),i=n.count,r=n.interval,o=this._commandRequestInfoMap.get(t),a=o.startTime,s=o.requestCount;if(Date.now()-a>1e3*r)return this._commandRequestInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;s+=1,this._commandRequestInfoMap.set(t,{startTime:a,requestCount:s});var c=!1;return s>i&&(c=!0),c}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=this._serverOverloadInfoMap.get(e),n=t.overloadTime,i=t.waitingTime,r=!1;return Date.now()-n<=1e3*i?r=!0:(this._serverOverloadInfoMap.delete(e),r=!1),r}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand,n=e.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),Be.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s"))}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(Ks),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear()}}]),i}(si),Ys=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="MessageLossDetectionModule",i._maybeLostSequencesMap=new Map,i._firstRoundRet=[],i}return a(n,[{key:"onMessageMaybeLost",value:function(e,t,n){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var i=this._maybeLostSequencesMap.get(e),r=0;r<n;r++)-1===i.indexOf(t+r)&&i.push(t+r)}},{key:"detectFirstRound",value:function(e,t){var n=this._maybeLostSequencesMap.get(e);if(!Yt(n)&&!Yt(t)){var i=n.filter((function(e){return-1===t.indexOf(e)}));0===i.length?Be.i("".concat(this._n,".detectFirstRound no message loss. conversationID:").concat(e)):this._firstRoundRet=this._firstRoundRet.concat(i),n.length=0}}},{key:"detectSecondRound",value:function(e,t){if(!Yt(this._firstRoundRet)&&!Yt(t)){var n=this._firstRoundRet.filter((function(e){return-1===t.indexOf(e)}));this._firstRoundRet.length=0;var i,r=n.length;0!==r&&(r<=5?i=e+"-"+n.join("-"):(n.sort((function(e,t){return e-t})),i=e+" start:"+n[0]+" end:"+n[r-1]+" count:"+r),new wo("messageLoss").setMessage(i).setNetworkType(this.getNetworkType()).setLevel("warning").end(),Be.i("".concat(this._n,".detectSecondRound message loss detected. conversationID:").concat(e," lostSequences:").concat(n)))}}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._maybeLostSequencesMap.clear(),this._firstRoundRet.length=0}}]),n}(si),Js=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="CloudControlModule",i._cloudConfig=new Map,i._expiredTime=0,i._version=0,i._isFetching=!1,i}return a(n,[{key:"getCloudConfig",value:function(e){return at(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetchConfig();if(Be.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(t)),t){var n=new wo("fetchCloudControlConfig"),i=this.getModule(Fn).getSDKAppID();this._isFetching=!0,this.request({protocolName:Yr,requestData:{SDKAppID:i,version:this._version}}).then((function(t){e._isFetching=!1,n.setMessage("version:".concat(e._version," newVersion:").concat(t.data.version," config:").concat(t.data.cloudControlConfig)).setNetworkType(e.getNetworkType()).end(),Be.l("".concat(e._n,".fetchConfig ok")),e._parseCloudControlConfig(t.data)})).catch((function(t){e._isFetching=!1,e.probeNetwork().then((function(e){var i=m(e,2),r=i[0],o=i[1];n.setError(t,r,o).end()})),Be.l("".concat(e._n,".fetchConfig failed. error:"),t),e._setExpiredTimeOnResponseError(12e4)}))}}},{key:"onPushedCloudControlConfig",value:function(e){Be.l("".concat(this._n,".onPushedCloudControlConfig")),new wo("pushedCloudControlConfig").setNetworkType(this.getNetworkType()).setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),i=e.errorCode,r=e.errorMessage,o=e.cloudControlConfig,a=e.version,s=e.expiredTime;if(0===i){if(this._version!==a){var c=null;try{c=JSON.parse(o)}catch(l){this.isPrivateNetWork()||Be.e("".concat(n," JSON parse error. cloudControlConfig:"),o)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=a,this.emitInnerEvent(ea))}this._expiredTime=Date.now()+1e3*s}else at(i)?(Be.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Be.e("".concat(n," errorCode:").concat(i," errorMessage:").concat(r)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),n}(si),Zs=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="RecoverMessageModule",i.PULL_LIMIT_COUNT=15,i}return a(n,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n=this,i=this._getLocalConversationList().filter((function(e){return e.type===k.CONV_GROUP&&e.groupProfile.type!==k.GRP_AVCHATROOM})),r=this.getModule(Vn),o=0,a=0,s=0;i.forEach((function(i){var c=i.conversationID,u=i.lastMessage;t=c.replace(k.CONV_GROUP,""),e=r.getLocalLastMessage(c),u&&0!==u.lastSequence&&e?(a=u.lastSequence,o=e.sequence,s=a-o,o>0&&s>=1&&s<300?n._recoverGroupMessage({groupID:t,localLastMessageSequence:o,remoteLastMessageSequence:a}):n._getGroupNotify(t)):n._getGroupNotify(t)}))}},{key:"_recoverC2CChat",value:function(){var e,t=this,n=this._getLocalConversationList().filter((function(e){return e.type===k.CONV_C2C})),i=this.getModule(Vn),r=0,o=0,a=0,s=[Promise.resolve()];n.forEach((function(n){var c=n.conversationID,u=n.lastMessage;e=i.getLocalLastMessage(c),u&&0!==u.lastTime&&e&&(o=u.lastTime,r=e.time,a=o-r,r>0&&a>=1&&a<=600&&s.push(t._recoverC2CMessage({conversationID:c,localLastMessageTime:r,remoteLastMessageTime:o})))})),Promise.all(s).then((function(){Be.l("".concat(t._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),t.getModule(Wn).startSyncOnReconnected()}))}},{key:"_getLocalConversationList",value:function(){return this.getModule(Vn).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage");Be.l("".concat(n," options:"),e);var i=e.groupID,r=e.localLastMessageSequence,o=e.remoteLastMessageSequence;this._getGroupRomaingMessage({groupID:i,sequence:r}).then((function(e){var r=e.data,a=r.complete,s=r.messageList;if(!at(s)){var c=s[0].sequence;Be.l("".concat(n," pkgLastMessageSequence:").concat(c," complete:").concat(a)),c<o&&2!==a&&t._recoverGroupMessage({groupID:i,localLastMessageSequence:c,remoteLastMessageSequence:o}),new wo("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("groupID:".concat(i," complete:").concat(a," messageList length:").concat(s.length)).end();var u=t.getModule(xn);s.length>1&&s.sort((function(e,t){return e.sequence-t.sequence}));for(var l=0;l<s.length;l++){var d=s[l];d.from!==k.CONV_SYSTEM?u.onNewGroupMessage({dataList:[d],isInstantMessage:!1,updateUnreadCount:!1}):u.onNewGroupTips({event:d.event,dataList:[d]})}t._getGroupNotify(i)}}))}},{key:"_getGroupNotify",value:function(e){this.getModule(xn).getGroupNotify(e)}},{key:"_getGroupRomaingMessage",value:function(e){var t=e.groupID,n=e.sequence;return this.request({protocolName:sr,requestData:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage");Be.l("".concat(this._n,"._recoverC2CMessage options:"),e);var i=e.conversationID,r=e.localLastMessageTime,o=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:i,time:r}).then((function(e){var r=e.data,a=r.complete,s=r.messageList;if(!at(s)){var c=s.length;new wo("recoverMessage").setNetworkType(t.getNetworkType()).setMessage("".concat(i," complete:").concat(a," messageList length:").concat(c)).end(),t.getModule(Nn).onNewC2CMessage({dataList:s,isInstantMessage:!0});var u=s[c-1].time;if(Be.l("".concat(n," pkgLastMessageTime:").concat(u," complete:").concat(a)),u<o&&1!==a)return t._recoverC2CMessage({conversationID:i,localLastMessageTime:u,remoteLastMessageTime:o})}}))}},{key:"_getC2CRoamingMessage",value:function(e){var t=e.conversationID,n=e.time;return this.request({protocolName:bi,requestData:{peerAccount:t.replace(k.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),n}(si),Xs=function(){function e(){r(this,e),this._n="AvgE2EDelay",this._e2eDelayArray=[]}return a(e,[{key:"addMessageDelay",value:function(e){var t=Ue()-e;t>=0&&this._e2eDelayArray.push(t)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),Ut(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,i=e.max;return t.filter((function(e){return n<=e&&e<i})).length}},{key:"_calcPercent",value:function(e,t){var n=Ut(e/t*100,2);return n>100&&(n=100),n}},{key:"_checkE2EDelayException",value:function(e,t){var n=e.filter((function(e){return e>t}));if(n.length>0){var i=n.length,r=Math.min.apply(Math,y(n)),o=Math.max.apply(Math,y(n)),a=this._calcAvg(n,i),s=Ut(i/e.length*100,2);s>50&&new wo("messageE2EDelayException").setMessage("count:".concat(i," min:").concat(r," max:").concat(o," avg:").concat(a," percent:").concat(s)).setLevel("warning").end()}}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=y(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),i=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),r=this._calcPercent(n,e),o=this._calcPercent(i,e),a=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:r,countLessThan3Second:i,percentOfCountLessThan3Second:o,avgDelay:a}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),e}(),Qs=function(){function e(){r(this,e),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}return a(e,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){if(0===t)return 0;var n=Ut(e/t*100,2);return n>100&&(n=100),n}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,y(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,y(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=y(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),i=this._calcSuccessRateOfRequest(n,e),r=this._calcAvg(t,n);return Be.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(r)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:i,avgRTT:r}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),e}(),$s=function(){function e(){r(this,e),this._map=new Map}return a(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(at(e)||!this._map.has(e))&&(this._map.get(e).totalCount+=1,!0)}},{key:"addSuccessCount",value:function(e){return!(at(e)||!this._map.has(e))&&(this._map.get(e).successCount+=1,!0)}},{key:"addFailedCountOfUserSide",value:function(e){return!(at(e)||!this._map.has(e))&&(this._map.get(e).failedCountOfUserSide+=1,!0)}},{key:"addCost",value:function(e,t){return!(at(e)||!this._map.has(e))&&(this._map.get(e).costArray.push(t),!0)}},{key:"addFileSize",value:function(e,t){return!(at(e)||!this._map.has(e))&&(this._map.get(e).fileSizeArray.push(t),!0)}},{key:"_calcSuccessRateOfBusiness",value:function(e){if(at(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=Ut(t.successCount/t.totalCount*100,2);return n>100&&(n=100),n}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(at(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=this._calcSuccessCountOfPlatform(e)/t.totalCount*100;return(n=Ut(n,2))>100&&(n=100),n}},{key:"_calcTotalCount",value:function(e){return at(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return at(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){if(at(e)||!this._map.has(e))return-1;var t=this._map.get(e);return t.successCount+t.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return at(e)||!this._map.has(e)?-1:e===Io?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),i=this._calcSuccessRateOfBusiness(e),r=this._calcSuccessCountOfPlatform(e),o=this._calcSuccessRateOfPlatform(e),a=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:i,successCountOfPlatform:r,successRateOfPlatform:o,avgValue:a}}},{key:"reset",value:function(e){at(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),e}(),ec=function(){function e(){r(this,e),this._lastMap=new Map,this._currentMap=new Map}return a(e,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(at(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var i=n.conversationID,r=n.sequence,o=i.replace(k.CONV_GROUP,"");if(0===this._lastMap.get(t).size)this._addCurrentMap(e);else if(this._lastMap.get(t).has(o)){var a=this._lastMap.get(t).get(o),s=a.length-1;r>a[0]&&r<a[s]?(a.push(r),a.sort(),this._lastMap.get(t).set(o,a)):this._addCurrentMap(e)}else this._addCurrentMap(e);return!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=e.message,i=n.conversationID,r=n.sequence,o=i.replace(k.CONV_GROUP,"");this._currentMap.get(t).has(o)||this._currentMap.get(t).set(o,[]),this._currentMap.get(t).get(o).push(r)}},{key:"_copyData",value:function(e){if(!at(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),i=b(this._currentMap.get(e));try{for(i.s();!(t=i.n()).done;){var r=m(t.value,2),o=r[0],a=r[1];n.set(o,a)}}catch(c){i.e(c)}finally{i.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(at(this._currentMap.get(e))||at(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,i){var r=y(e.values()),o=r.length,a=r[o-1]-r[0]+1;t+=a,n+=o})),0===t)return null;var i=Ut(n/t*100,2);return i>100&&(i=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:i}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),e}(),tc=function(e){c(i,e);var n=v(i);function i(e){var t;r(this,i),(t=n.call(this,e))._n="QualityStatModule",t.TAG="im-ssolog-quality-stat",t.reportIndex=0,t.wholePeriod=!1,t._qualityItems=[fo,go,_o,vo,mo,yo,Io,To,Co,So],t._messageSentItems=[_o,vo,mo,yo,Io],t._messageReceivedItems=[To,Co,So],t.REPORT_INTERVAL=120,t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._statInfoArr=[],t._avgRTT=new Qs,t._avgE2EDelay=new Xs,t._rateMessageSent=new $s,t._rateMessageReceived=new ec;var o=t.getInnerEmitterInstance();return o.on($o,t._onLoginSuccess,g(t)),o.on(ea,t._onCloudConfigUpdated,g(t)),t}return a(i,[{key:"_onLoginSuccess",value:function(){var e=this;this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems);var t=this.getModule(Bn),n=t.getItem(this.TAG,!1);!Yt(n)&&ct(n.forEach)&&(Be.l("".concat(this._n,"._onLoginSuccess get quality stat logs from local storage, count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");at(e)||(this.REPORT_INTERVAL=Number(e)),at(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),at(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Be.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Be.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Be.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Be.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Be.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Be.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},i=Mo[this.getNetworkType()];at(i)&&(i=8);var r={qualityType:Eo[e],timestamp:xe(),networkType:i,extension:""};switch(e){case fo:n=this._avgRTT.getStatResult();break;case go:n=this._avgE2EDelay.getStatResult();break;case _o:case vo:case mo:case yo:case Io:n=this._rateMessageSent.getStatResult(e);break;case To:case Co:case So:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},r),n)}},{key:"_report",value:function(e){var t=this,n=[],i=null;at(e)?this._qualityItems.forEach((function(e){null!==(i=t._getQualityItem(e))&&(i.reportIndex=t.reportIndex,i.wholePeriod=t.wholePeriod,n.push(i))})):null!==(i=this._getQualityItem(e))&&(i.reportIndex=this.reportIndex,i.wholePeriod=this.wholePeriod,n.push(i)),Be.d("".concat(this._n,"._report"),n),this._statInfoArr.length>0&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]);var r=this.getModule(Fn),o=r.getSDKAppID(),a=r.getTinyID();Gt(this.REPORT_SDKAPPID_BLACKLIST,o)&&!Vt(this.REPORT_TINYID_WHITELIST,a)&&(n=[]),n.length>0&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,i={header:ns(this),quality:e};this.request({protocolName:Fr,requestData:t({},i)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){Be.w("".concat(n._n,"._doReport, online:").concat(n.getNetworkType()," error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.getModule(Bn),t=e.getItem(this.TAG,!1),n=this._statInfoArr,i="".concat(this._n,"._flushAtOnce");if(Yt(t))Be.l("".concat(i," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>10&&(r=r.slice(0,10)),Be.l("".concat(i," count:").concat(r.length)),e.setItem(this.TAG,r,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),i}(si),nc=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="WorkerTimerModule",i._isWorkerEnabled=!0,i._workerTimer=null,i._timerID=-1,i._init(),i.getInnerEmitterInstance().on(ea,i._onCloudConfigUpdated,g(i)),i}return a(n,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&ke}},{key:"startWorkerTimer",value:function(){Be.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Be.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){if(ke){var e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"}));this._workerTimer=new Worker(e);var t=this;this._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Be.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()}}}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");Be.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),at(e)||"1"===e?!this._isWorkerEnabled&&ke&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&ke&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Be.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),n}(si),ic=function(){function e(){r(this,e),this._n="PurchasedFeatureHandler",this._purchasedFeatureMap=new Map}return a(e,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&e.length>=1&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){var t="".concat(this._n,".parsePurchaseBits");if(this.isValidPurchaseBits(e)){this._purchasedFeatureMap.clear();for(var n=null,i=e.length-1,r=0;i>=0;i--,r++)n=r<32?new D(0,Math.pow(2,r)).toString():new D(Math.pow(2,r-32),0).toString(),"1"===e[i]?this._purchasedFeatureMap.set(n,!0):this._purchasedFeatureMap.set(n,!1)}else Be.w("".concat(t," invalid purchase bits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._purchasedFeatureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,i=!0,r=t.length-1,o=0;r>=0;r--,o++)if("1"===t.charAt(r)&&(n=o<32?new D(0,Math.pow(2,o)).toString():new D(Math.pow(2,o-32),0).toString(),!this._purchasedFeatureMap.get(n))){i=!1;break}return Be.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," binaryString:").concat(t," ret:").concat(i)),Jo({enabled:i})}},{key:"clear",value:function(){this._purchasedFeatureMap.clear()}}]),e}(),rc=function(){function e(t){r(this,e),this._m=t,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new ic}return a(e,[{key:"_canFetch",value:function(){return this._getModule(Fn).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e=this,t=this._canFetch(),n="".concat(this._n,".fetchConfig");if(Be.l("".concat(n," canFetch:").concat(t)),t){var i=this._getModule(qn),r=new wo("fetchCommercialConfig");r.setNetworkType(i.getNetworkType());var o=this._getModule(Fn).getSDKAppID(),a=this._getModule(Yn);this._isFetching=!0,a.request({protocolName:Zr,requestData:{SDKAppID:o}}).then((function(t){r.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Be.l("".concat(n," ok.")),e._parseConfig(t.data),e._isFetching=!1})).catch((function(t){i.probe().then((function(e){var n=m(e,2),i=n[0],o=n[1];r.setError(t,i,o).end()})),e._isFetching=!1}))}}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig");Be.l("".concat(t)),new wo("pushedCommercialConfig").setNetworkType(this._getModule(qn).getNetworkType()).setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,i=e.errorMessage,r=e.purchaseBits,o=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(r),this._expiredTime=Date.now()+1e3*o):at(n)?(Be.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Be.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(i)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),e}(),oc=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._m=e,i._n="OfflinePushModule",i._offlinePushPlugin=void 0,i._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},i._deviceToken="",i._businessID=0,i._iosBusinessID=0,i._c2cUnreadCount=0,i._groupUnreadCount=0,i._isWebUniapp=0,i}return a(n,[{key:"registerPlugin",value:function(e){if(ie){this._offlinePushPlugin=e["tim-offline-push-plugin"];var t=e.offlinePushConfig||{},n=t.huaweiBusinessID,i=t.xiaomiBusinessID,r=t.xiaomiAppID,o=t.xiaomiAppKey,a=t.meizuBusinessID,s=t.meizuAppID,c=t.meizuAppKey,u=t.vivoBusinessID,l=t.oppoBusinessID,d=t.oppoAppKey,h=t.oppoAppSecret,p=t.honorBusinessID,f=t.iosBusinessID;this._androidPushConfig.huaweiPushBussinessId=n,this._androidPushConfig.xiaomiPushBussinessId=i,this._androidPushConfig.xiaomiPushAppId=r,this._androidPushConfig.xiaomiPushAppKey=o,this._androidPushConfig.meizuPushBussinessId=a,this._androidPushConfig.meizuPushAppId=s,this._androidPushConfig.meizuPushAppKey=c,this._androidPushConfig.vivoPushBussinessId=u,this._androidPushConfig.oppoPushBussinessId=l,this._androidPushConfig.oppoPushAppKey=d,this._androidPushConfig.oppoPushAppSecret=h,this._androidPushConfig.honorPushBussinessId=p,new wo("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!at(this._offlinePushPlugin))).end(!0),Be.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=f,this._setAppShowListener()}else this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e=this,t="".concat(this._n,".").concat("_getDeviceToken");if(ct(this._offlinePushPlugin.getDeviceToken)){var n="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID);Be.l("".concat(t," start. ").concat(n)),new wo("_getDeviceToken").setMessage("".concat(n)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(i){var r=new wo("getDeviceTokenRes"),o=i.code,a=i.msg;if(0===o){var s=i.data,c=s.deviceToken,u=s.deviceBrand,l=s.deviceType,d=s.bussinessId;e._deviceToken=c,e._businessID=d||e._iosBusinessID,n="deviceToken:".concat(c,", deviceBrand:").concat(u||l,", businessID:").concat(e._businessID),Be.l("".concat(t," ok. ").concat(n)),r.setMessage(n).end(!0),e._setToken()}else r.setMessage("code:".concat(o,", msg:").concat(a)).end(!0),Be.e("".concat(t," failed. error:"),i)}))}else Be.e("".concat(t," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return ie&&!at(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");at(this._offlinePushPlugin)?Be.e("".concat(t," offlinePushPlugin is undefined")):ct(this._offlinePushPlugin.setAppShowListener)?(new wo("_setAppShowListener").end(!0),Be.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){var i=(n||{}).appShow;new wo("setAppShowListenerRes").setMessage("appShow:".concat(i)).end(!0),Be.l("".concat(t," ok. appShow:").concat(i)),e._m.isReady()&&(0===i?(e._getConvUnreadCount(),e._onBackground()):1===i&&e._onForeground())}))):Be.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){if(!at(this._offlinePushPlugin)&&ct(this._offlinePushPlugin.getDeviceType)){var e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType;return Be.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}}},{key:"_setToken",value:function(){var e,t=this,n="".concat(this._n,"._setToken"),i=this.getModule(Fn),r=1,o="",a="";Yt(this._deviceToken)&&(r=0);var s=this.getUniAppPlatform(),c=this.getDeviceBrand();s===R.IOS||s===R.IPAD||s===R.MAC?a=this._deviceToken:s===R.ANDROID&&(o=this._deviceToken);var u=new wo("offlinePushSetToken");return e="deviceToken:".concat(a||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(c,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(r,", platform:").concat(s),u.setMessage("".concat(e)),Be.l("".concat(n," ").concat(e)),this.request({protocolName:uo,requestData:{tokenID:o,pushMsg:r,sdkAppID:i.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:c,deviceToken:a,isWebUniapp:this._isWebUniapp}}).then((function(e){return u.end(),Be.l("".concat(n," ok")),e})).catch((function(e){return t.probeNetwork().then((function(t){var n=m(t,2),i=n[0],r=n[1];u.setError(e,i,r).end()})),Be.e("".concat(n," failed. error:"),e),Zo(e)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.getModule(Vn).getLocalConversationList().forEach((function(t){t.type===k.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===k.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new wo("_onBackground");this.request({protocolName:so,requestData:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(i){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Be.l("".concat(t," ok")),i})).catch((function(i){e.probeNetwork().then((function(e){var t=m(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),Be.e("".concat(t," failed. error:"),i)}))}},{key:"_onForeground",value:function(){var e=this,t="".concat(this._n,".").concat("_onForeground"),n=new wo("_onForeground");this.request({protocolName:co,requestData:{isWebUniapp:this._isWebUniapp}}).then((function(e){return n.end(),Be.l("".concat(t," ok")),e})).catch((function(i){e.probeNetwork().then((function(e){var t=m(e,2),r=t[0],o=t[1];n.setError(i,r,o).end()})),Be.e("".concat(t," failed. error:"),i)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?R.IOS:"android"===e?R.ANDROID:1002===t?R.IPAD:1001===t?R.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Be.l("".concat(this._n,".reset"))}}]),n}(si),ac=function(e){c(n,e);var t=v(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._n="ProfanityFilterModule",i._plugin=null,i._filterConfigMap=new Map,i._startIndex=0,i._version=0,i._canIUseLexicon=!1,i._isFetching=!1,i._expiredTime=0,i}return a(n,[{key:"init",value:function(){var e=this.getModule(Kn).getPlugin("tim-profanity-filter-plugin");e?(this._plugin=new e({logger:Be,isArray:ot,isMap:Qe,isDevMode:this.isDevMode()}),this._getLexicon()):this.outputWarning("ProfanityPluginNotFound")}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;var i=e.type,r=e.conversationType;if(i!==k.MSG_TEXT&&i!==k.MSG_CUSTOM)return n;var o,a="".concat(this._n,".filterMessage");if(Be.l("".concat(a)),i===k.MSG_TEXT){if(r===k.CONV_C2C?o=H:r===k.CONV_GROUP&&(o=K),!this._isConfigOn(o))return n;var s=this._plugin.filter(e.payload.text),c=s.type,u=s.modifiedText;1===c?n=!1:2===c&&(e.payload.text=u)}else if(i===k.MSG_CUSTOM){if(r===k.CONV_C2C?o=z:r===k.CONV_GROUP&&(o=W),!this._isConfigOn(o))return n;var l=this._plugin.filter(e.payload.data),d=this._plugin.filter(e.payload.description),h=this._plugin.filter(e.payload.extension);1===l.type||1===d.type||1===h.type?n=!1:(2===l.type&&(e.payload.data=l.modifiedText),2===d.type&&(e.payload.description=d.modifiedText),2===h.type&&(e.payload.extension=h.modifiedText))}return Be.l("".concat(a," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),i={isAllowedToSend:!0,modifiedText:e};if(!this._plugin||!this._canIUseLexicon)return i;if(!this._isConfigOn(t))return i;Be.l("".concat(n));var r=this._plugin.filter(e),o=r.type,a=r.modifiedText;return 1===o?i.isAllowedToSend=!1:2===o&&(i.modifiedText=a),Be.l("".concat(n," done. ret:"),i),i}},{key:"_getLexicon",value:function(){var e=this,t=new wo("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.request({protocolName:lo,requestData:{startIndex:this._startIndex,version:this._version}}).then((function(i){var r=i.data,o=r.errorInfo,a=r.filterConfig,s=r.lexicon,c=r.strToken,u=r.completeFlag,l=r.nextStartIndex,d=r.version,h=r.expiredTime,p=o.errorCode,f=o.errorMessage;return 0!==p?(e._isFetching=!1,Be.w("".concat(n," failed. error:"),o),void t.setCode(p).setMessage(f).end()):(e._onFilterConfig(a),e._getToken(c),1===u?(Be.l("".concat(n," done. version:").concat(d," expiredTime:").concat(h)),e._version=d,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*h,void e._plugin.onLexiconCompleted(s)):(e._startIndex=l,e._plugin.onLexiconSliced(s),void e._getLexicon()))})).catch((function(i){e.probeNetwork().then((function(e){var n=m(e,2),r=n[0],o=n[1];t.setError(i,r,o).end()})),e._isFetching=!1,Be.l("".concat(n," failed. error:"),i)}))}},{key:"_onFilterConfig",value:function(e){var t=this;Yt(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Be.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(nt(e)){var t=e.length,n="";if(t%2==0)for(var i=0;i<=t-1;i+=2)n+=e[i+1],n+=e[i];else{for(var r=0;r<t-1;r+=2)n+=e[r+1],n+=e[r];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),n}(si),sc=function(){function e(t){r(this,e),this._m=t,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*"],this._m.getInnerEmitterInstance().on(ea,this._onCloudConfigUpdated,this)}return a(e,[{key:"_onCloudConfigUpdated",value:function(){var e=this,t=this._m.getModule(Xn).getCloudConfig("rtc_cmd");at(t)||(t=JSON.parse(t)).forEach((function(t){e._TRTCCommandList.includes(t)||e._TRTCCommandList.push(t)}))}},{key:"sendTRTCCustomData",value:function(e){var t=e.serviceCommand,n=e.data,i="".concat(j.NAME.TUIROOM_SVR,".*");return at(t)||(i=t),this._TRTCCommandList.includes(i)?this._trans({servcmd:i,data:n}):Zo({code:po.INVALID_TRTC_CMD})}},{key:"_trans",value:function(e){Be.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.servcmd,n=e.data;return this._m.getModule(Yn).trans({servcmd:t,data:nt(n)?JSON.parse(n):n})}},{key:"getCommandList",value:function(){return this._TRTCCommandList}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),e}(),cc=function(){function e(t){r(this,e),this._m=t,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}return a(e,[{key:"_init",value:function(){var e=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(e){var t=JSON.parse(e);this._needToUpdate(t)?this._fetch():this._fillMap(t.message)}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime,n=e.localSavedVersion,i=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,r=!n||"2.27.3"!==n;return Be.l("".concat(this._n,"._needToUpdate isTimeout:").concat(i," isDifferentVersion:").concat(r)),i||r}},{key:"_fetch",value:function(){if(!this._m.getModule(Fn).isPrivateNetWork()){var e="https://web.sdk.qcloud.com/im/download/error-message/0.0.1/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),i=this;if(oe)se.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){i._fillAndSave(e.data),Be.l("".concat(n," mini program"))},fail:function(){}});else{var r=new XMLHttpRequest,o=setTimeout((function(){r.abort()}),3e3);r.onreadystatechange=function(){4===r.readyState&&(clearTimeout(o),200!==r.status&&304!==r.status||(Be.l("".concat(n," browser")),i._fillAndSave(r.responseText)))},r.open("GET",e,!0),r.setRequestHeader("Content-type",t),r.send()}}}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"2.27.3"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.getModule(Bn)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,i,r=e.split(";\n"),o=r.length,a=new RegExp(/'/g),s=0;s<o;s++)if(t=r[s].indexOf(":"),n=r[s].slice(0,t),i=r[s].slice(t+1,r[s].length),!n.startsWith("//")){if(at(i))continue;this._map.set(n,i.replace(a,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,i=e.replacement1,r=e.replacement2,o="".concat(n,t?"_en":"_cn");!this._map.has(o)&&this._map.has(n)&&(o=n);var a="";return this._map.has(o)?(a=this._map.get(o),at(i)||(a=a.replace("$replacement1",i)),at(r)||(a=a.replace("$replacement2",r)),a):a}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset"))}}]),e}(),uc=function(){function e(t){r(this,e);var n=new wo("sdkConstruct");this._n="ModuleManager",this._isReady=!1,this._reason=po.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(Fn,new Xa(this,t)),this._moduleMap.set(ti,new rc(this)),this._moduleMap.set(Xn,new Js(this)),this._moduleMap.set(Qn,new nc(this)),this._moduleMap.set(ei,new tc(this)),this._moduleMap.set(Jn,new Fs(this)),this._moduleMap.set(Yn,new Ws(this)),this._moduleMap.set(An,new Qa(this)),this._moduleMap.set(Rn,new vs(this)),this._moduleMap.set(Ln,new ms(this)),this._moduleMap.set(oi,new ys(this)),this._moduleMap.set(On,new Za(this)),this._moduleMap.set(Nn,new Xo(this)),this._moduleMap.set(Vn,new ma(this)),this._moduleMap.set(xn,new Ga(this)),this._moduleMap.set(Un,new Fa(this)),this._moduleMap.set(Gn,new Ha(this)),this._moduleMap.set(Bn,new es(this)),this._moduleMap.set(ai,new cc(this)),this._moduleMap.set(jn,new is(this)),this._moduleMap.set(qn,new ss(this)),this._moduleMap.set(Hn,new us(this)),this._moduleMap.set(zn,new ds(this)),this._moduleMap.set(Kn,new Is(this)),this._moduleMap.set(Wn,new Ts(this)),this._moduleMap.set(Zn,new Ys(this)),this._moduleMap.set($n,new Zs(this)),this._moduleMap.set(ni,new oc(this)),this._moduleMap.set(ii,new ac(this)),this._moduleMap.set(ri,new sc(this)),this._eventThrottleMap=new Map;var i=t.instanceID,o=t.oversea,a=t.SDKAppID,s="instanceID:".concat(i," SDKAppID:").concat(a," host:").concat(Lt()," oversea:").concat(o," inBrowser:").concat(ae," inMiniApp:").concat(oe)+" workerAvailable:".concat(ke," UserAgent:").concat(ce);wo.bindEventStatModule(this._moduleMap.get(jn)),n.setMessage("".concat(s," ").concat(function(){var e="";if(oe)try{var t=se.getSystemInfoSync(),n=t.model,i=t.version,r=t.system,o=t.platform,a=t.SDKVersion;e="model:".concat(n," version:").concat(i," system:").concat(r," platform:").concat(o," SDKVersion:").concat(a)}catch(s){e=""}return e}())).end(),Be.i("SDK ".concat(s)),Ko.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}return a(e,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(Qn),t=e.isWorkerEnabled();Be.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Be.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(Qn),t=e.isWorkerEnabled();Be.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Be.l("".concat(this._n,"._stopMainThreadTimer")),this._checkTimer>0&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Be.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(Jn);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Be.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(Jn);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Be.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Be.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=b(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(r){t.e(r)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(An),this._moduleMap.get(Vn)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e=!0;if(this._readyList.forEach((function(t){t.isReady()||(e=!1)})),e&&!this._isReady){this._isReady=!0,this._outerEmitter.emit(M.SDK_READY);var t=Date.now()-this._startLoginTs;Be.w("SDK is ready. cost ".concat(t," ms")),this._startLoginTs=Date.now();var n=this._moduleMap.get(qn).getNetworkType(),i=this._ssoLogForReady.getStartTs()+Ne;this._ssoLogForReady.setNetworkType(n).setMessage(t).start(i).end()}}},{key:"login",value:function(){0===this._startLoginTs&&(Pe(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(qn).start(),this._ssoLogForReady=new wo("sdkReady"),this._reason=po.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return null===this._outerEmitter&&(this._outerEmitter=new cs,Yo(this._outerEmitter),this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=this;if(e===M.CONVERSATION_LIST_UPDATED||e===M.FRIEND_LIST_UPDATED||e===M.GROUP_LIST_UPDATED||e===M.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED)if(this._eventThrottleMap.has(e)){var i=Date.now(),r=this._eventThrottleMap.get(e);i-r.last<=1e3?(r.timeoutID&&clearTimeout(r.timeoutID),r.timeoutID=setTimeout((function(){r.last=Date.now(),n._outerEmitter._emit.apply(n._outerEmitter,[e,{name:e,data:n._getEventData(e)}])}),1e3)):(r.last=i,this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]))}else this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:this._getEventData(e)}]);else this._outerEmitter._emit.apply(this._outerEmitter,[e,{name:e,data:arguments[1]}])}.bind(this)),this._outerEmitter}},{key:"_getEventData",value:function(e){return e===M.CONVERSATION_LIST_UPDATED?this._moduleMap.get(Vn).getLocalConversationList():e===M.FRIEND_LIST_UPDATED?this._moduleMap.get(Pn).getLocalFriendList(!1):e===M.GROUP_LIST_UPDATED?this._moduleMap.get(xn).getLocalGroupList():e===M.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(Vn).getTotalUnreadMessageCount():void 0}},{key:"getInnerEmitterInstance",value:function(){return null===this._innerEmitter&&(this._innerEmitter=new cs,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){var n;n=rt(arguments[1])&&arguments[1].data?[e,{name:arguments[0],data:arguments[1].data}]:[e,{name:arguments[0],data:arguments[1]}],this._innerEmitter._emit.apply(this._innerEmitter,n)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"getModule",value:function(e){return this._moduleMap.get(e)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.getModule(Fn).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(ai).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){var i=this.getErrorMessage(e,t,n);i&&Be.w(i)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Be.w("Oops! ".concat(t)),new wo("error").setMessage(t).setNetworkType(this.getModule(qn).getNetworkType()).setLevel("error").end(),this.getOuterEmitterInstance().emit(M.ERROR,e)}},{key:"restartTimer",value:function(){Be.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer(),this.getModule(xn).restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(Qn);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._moduleMap.get(xn).getPollingTimerID(e)}},{key:"reset",value:function(){Be.l("".concat(this._n,".reset")),Pe();var e,t=b(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2)[1];n.reset&&n.reset()}}catch(s){t.e(s)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(M.SDK_NOT_READY);var i,r=b(this._eventThrottleMap);try{for(r.s();!(i=r.n()).done;){var o=m(i.value,2)[1];o.timeoutID&&clearTimeout(o.timeoutID)}}catch(s){r.e(s)}finally{r.f()}this._eventThrottleMap.clear()}}]),e}(),lc=function(){function e(t){r(this,e),this._funcMap=new Map,this._m=t}return a(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var i=null;return this._funcMap.get(e).has(t)?i=this._funcMap.get(e).get(t):(i=this._pack(e,t,n),this._funcMap.get(e).set(t,i)),i}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var i=this;return function(){try{t.apply(n,Array.from(arguments))}catch(u){var r=Object.values(M).indexOf(e),o="CallbackError";if(-1!==r){var a=Object.keys(M)[r];i._m.outputWarning(o,a,u)}var s=new wo(o);s.setMessage("eventName:".concat(e)).setMoreMessage(u.message).end()}}}}]),e}(),dc=function(){function e(t){r(this,e);var n={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:Rt(),devMode:t.devMode||!1,proxyServer:t.proxyServer||void 0,fileUploadProxy:t.fileUploadProxy||void 0,fileDownloadProxy:t.fileDownloadProxy||t.fileUploadProxy||void 0};this._m=new uc(n),this._safetyCallbackFactory=new lc(this._m)}return a(e,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._getModule(An).login(e)}},{key:"logout",value:function(){var e=this;return this._getModule(An).logout().then((function(t){return e._m.reset(),t}))}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_getModule",value:function(e){return this._m.getModule(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally((function(){e._m.stopTimer(),e._getModule(Qn).terminate(),e._getModule(Jn).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._getModule(Fn);t.emit(M.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})}))}},{key:"on",value:function(e,t,n){Be.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Be.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,i){Be.d("off","eventName:".concat(e));var r=this._safetyCallbackFactory.find(e,t);null!==r&&(this._m.getOuterEmitterInstance().off(e,r,n,i),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){at(e["tim-offline-push-plugin"])?this._getModule(Kn).registerPlugin(e):this._getModule(ni).registerPlugin(e)}},{key:"setLogLevel",value:function(e){if(e<=0){var t=this.getErrorMessage("TIM_ASCII_ART");t&&console.log(t);var n=this.getErrorMessage("API_REFER");n&&(Ht()?console.log("%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",n):console.log("IM SDK API ->",n));var i=this.getErrorMessage("DOCS_GUIDE");i&&console.log(i)}Be.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._getModule(Rn).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._getModule(Rn).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._getModule(Rn).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._getModule(Rn).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._getModule(Rn).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._getModule(Rn).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._getModule(Rn).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._getModule(Rn).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._getModule(Rn).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._getModule(Rn).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==k.MSG_MERGER?Zo({code:po.MESSAGE_MERGER_TYPE_INVALID}):Yt(e.payload.downloadKey)?Zo({code:po.MESSAGE_MERGER_KEY_INVALID}):this._getModule(Rn).downloadMergerMessage(e).catch((function(e){return Zo({code:po.MESSAGE_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._getModule(Rn).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof Ho?this._getModule(Rn).sendMessageInstance(e,t):Zo({code:po.MESSAGE_SEND_NEED_MESSAGE_INSTANCE})}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._getModule(oi).sendMessage(t):"handleGroupInvitation"===e?this._getModule(xn).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._getModule(ti).isFeatureEnabled(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e?this._getModule(ri).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():"getPollingTimerID"===e?this._m.getPollingTimerID(t):Zo({code:po.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._getModule(Rn).revokeMessage(e)}},{key:"resendMessage",value:function(e){return this._getModule(Rn).resendMessage(e)}},{key:"deleteMessage",value:function(e){return this._getModule(Rn).deleteMessage(e)}},{key:"translateText",value:function(e){return this._getModule(Rn).translateText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._getModule(Ln).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._getModule(Ln).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._getModule(Ln).deleteMessageExtensions(e,t)}},{key:"modifyMessage",value:function(e){return this._getModule(Rn).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._getModule(Vn).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._getModule(Vn).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._getModule(Vn).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._getModule(Vn).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){return this._getModule(xn).getReadReceiptDetail(e)}},{key:"findMessage",value:function(e){return this._getModule(Vn).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._getModule(Vn).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._getModule(Vn).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._getModule(Vn).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._getModule(Vn).deleteConversation(e)}},{key:"clearHistoryMessage",value:function(e){return this._getModule(Vn).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._getModule(Vn).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._getModule(Vn).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._getModule(Vn).setMessageRemindType(e)}},{key:"getTotalUnreadMessageCount",value:function(){return this._getModule(Vn).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._getModule(Vn).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._getModule(Vn).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._getModule(Vn).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._getModule(Vn).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._getModule(Vn).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._getModule(Vn).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._getModule(Vn).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._getModule(Vn).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._getModule(On).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._getModule(On).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._getModule(On).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._getModule(On).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._getModule(On).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._getModule(On).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._getModule(On).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._getModule(On).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._getModule(On).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._getModule(On).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._getModule(Pn);return e?e.getLocalFriendList():Zo({code:po.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._getModule(Pn);return t?t.addFriend(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._getModule(Pn);return t?t.deleteFriend(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._getModule(Pn);return t?t.checkFriend(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._getModule(Pn);return t?t.getFriendProfile(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._getModule(Pn);return t?t.updateFriend(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._getModule(Pn);return e?e.getLocalFriendApplicationList():Zo({code:po.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._getModule(Pn);return t?t.acceptFriendApplication(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._getModule(Pn);return t?t.refuseFriendApplication(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._getModule(Pn);return t?t.deleteFriendApplication(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._getModule(Pn);return e?e.setFriendApplicationRead():Zo({code:po.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._getModule(Pn);return e?e.getLocalFriendGroupList():Zo({code:po.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._getModule(Pn);return t?t.createFriendGroup(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._getModule(Pn);return t?t.deleteFriendGroup(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._getModule(Pn);return t?t.addToFriendGroup(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._getModule(Pn);return t?t.removeFromFriendGroup(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._getModule(Pn);return t?t.renameFriendGroup(e):Zo({code:po.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(e){return this._getModule(xn).getGroupList(e)}},{key:"getGroupProfile",value:function(e){return this._getModule(xn).getGroupProfile(e)}},{key:"createGroup",value:function(e){return this._getModule(xn).createGroup(e)}},{key:"dismissGroup",value:function(e){return this._getModule(xn).dismissGroup(e)}},{key:"updateGroupProfile",value:function(e){return this._getModule(xn).updateGroupProfile(e)}},{key:"joinGroup",value:function(e){return this._getModule(xn).joinGroup(e)}},{key:"quitGroup",value:function(e){return this._getModule(xn).quitGroup(e)}},{key:"searchGroupByID",value:function(e){return this._getModule(xn).searchGroupByID(e)}},{key:"getGroupOnlineMemberCount",value:function(e){return this._getModule(xn).getGroupOnlineMemberCount(e)}},{key:"changeGroupOwner",value:function(e){return this._getModule(xn).changeGroupOwner(e)}},{key:"getGroupApplicationList",value:function(){return this._getModule(xn).getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){return this._getModule(xn).handleGroupApplication(e)}},{key:"initGroupAttributes",value:function(e){return this._getModule(xn).initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._getModule(xn).setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._getModule(xn).deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._getModule(xn).getGroupAttributes(e)}},{key:"setGroupCounters",value:function(e){return this._getModule(xn).setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._getModule(xn).increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._getModule(xn).decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._getModule(xn).getGroupCounters(e)}},{key:"getGroupMemberList",value:function(e){return this._getModule(Un).getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._getModule(Un).getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._getModule(Un).addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._getModule(Un).deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._getModule(Un).setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._getModule(Un).setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._getModule(Un).setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._getModule(Un).setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._getModule(Un).markGroupMemberList(e)}},{key:"getJoinedCommunityList",value:function(){return this._getModule(Gn).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._getModule(Gn).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._getModule(Gn).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._getModule(Gn).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._getModule(Gn).getTopicList(e)}}]),e}(),hc={login:1,logout:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1};function pc(e,t){if(e.isReady()||1===hc[t])return!0;var n=e.getNotReadyReason(),i={code:n,message:"".concat(e.getErrorMessage(n)," | ").concat(t," | ").concat(e.getErrorMessage(po.SDK_IS_NOT_READY))};return e.onError(i),i}var fc={},gc={create:function(e){var n=0,i=e.SDKAppID;if(et(i))n=i;else if(n=parseInt(i),isNaN(i))return Be.e("".concat("TIM.create"," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(n&&fc[n])return fc[n];Be.l("".concat("TIM.create"));var r=new dc(t(t({},e),{},{SDKAppID:n}));r.on(M.SDK_DESTROY,(function(e){fc[e.data.SDKAppID]=null,delete fc[e.data.SDKAppID]}));var o=function(e){var t=Object.create(null);return Object.keys(Dn).forEach((function(n){if(e[n]){var i=new w;t[n]=function(){var t=Array.from(arguments);return i.use((function(t,i){var r=pc(e,n);return!0===r?i():Zo(r)})).use((function(e,t){if(!0===Jt(e,wn[n],n))return t()})).use((function(t,i){return e[n].apply(e,t)})),i.run(t)}}})),t}(r);return fc[n]=o,wn.hookGetAPITips(r.getErrorMessage.bind(r)),Be.l("".concat("TIM.create"," ok")),o}};return gc.TYPES=k,gc.EVENT=M,gc.VERSION="2.27.3",Be.l("TIM.VERSION:".concat(gc.VERSION)),gc}))},2741:function(e,t,n){n(7658),n(2801),n(2087),n(2062),n(1439),n(7585),n(5315),function(t,n){e.exports=n()}(0,(function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function i(){i=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(w){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r=t&&t.prototype instanceof h?t:h,o=Object.create(r.prototype),a=new E(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return M()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=l(e,t,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(w){return{type:"throw",arg:w}}}e.wrap=u;var d={};function h(){}function p(){}function f(){}var g={};c(g,o,(function(){return this}));var _=Object.getPrototypeOf,v=_&&_(_(b([])));v&&v!==t&&n.call(v,o)&&(g=v);var m=f.prototype=h.prototype=Object.create(g);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function i(r,o,a,s){var c=l(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var r;this._invoke=function(e,n){function o(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function b(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:M}}function M(){return{value:void 0,done:!0}}return p.prototype=f,c(m,"constructor",f),c(f,"constructor",p),p.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(I.prototype),c(I.prototype,a,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new I(u(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(m),c(m,s,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=b,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:b(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(i,r)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function s(e){o(a,i,r,s,c,"next",e)}function c(e){o(a,i,r,s,c,"throw",e)}s(void 0)}))}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,n){return g=f()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&p(r,n.prototype),r},g.apply(null,arguments)}function _(e){var t="function"==typeof Map?new Map:void 0;return _=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return g(e,arguments,h(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),p(i,e)},_(e)}function v(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){var t=f();return function(){var n,i=h(e);if(t){var r=h(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return v(this,n)}}function y(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=y(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},I.apply(this,arguments)}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(u){s=!0,r=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function M(e,t,n,i,r){var o={};return Object.keys(i).forEach((function(e){o[e]=i[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var k="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{},w=function(e){return e&&e.Math==Math&&e},D=w("object"==typeof globalThis&&globalThis)||w("object"==typeof window&&window)||w("object"==typeof self&&self)||w("object"==typeof k&&k)||function(){return this}()||Function("return this")(),A={},R=function(e){try{return!!e()}catch(t){return!0}},L=!R((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),O=!R((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),N=O,x=Function.prototype.call,P=N?x.bind(x):function(){return x.apply(x,arguments)},U={},G={}.propertyIsEnumerable,V=Object.getOwnPropertyDescriptor,F=V&&!G.call({1:2},1);U.f=F?function(e){var t=V(this,e);return!!t&&t.enumerable}:G;var B,j,q=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},H=O,z=Function.prototype,K=z.call,W=H&&z.bind.bind(K,K),Y=function(e){return H?W(e):function(){return K.apply(e,arguments)}},J=Y,Z=J({}.toString),X=J("".slice),Q=function(e){return X(Z(e),8,-1)},$=Q,ee=Y,te=function(e){if("Function"===$(e))return ee(e)},ne=R,ie=Q,re=Object,oe=te("".split),ae=ne((function(){return!re("z").propertyIsEnumerable(0)}))?function(e){return"String"==ie(e)?oe(e,""):re(e)}:re,se=function(e){return null==e},ce=se,ue=TypeError,le=function(e){if(ce(e))throw ue("Can't call method on "+e);return e},de=ae,he=le,pe=function(e){return de(he(e))},fe="object"==typeof document&&document.all,ge={all:fe,IS_HTMLDDA:void 0===fe&&void 0!==fe},_e=ge.all,ve=ge.IS_HTMLDDA?function(e){return"function"==typeof e||e===_e}:function(e){return"function"==typeof e},me=ve,ye=ge.all,Ie=ge.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:me(e)||e===ye}:function(e){return"object"==typeof e?null!==e:me(e)},Te=D,Ce=ve,Se=function(e){return Ce(e)?e:void 0},Ee=function(e,t){return arguments.length<2?Se(Te[e]):Te[e]&&Te[e][t]},be=te({}.isPrototypeOf),Me=Ee("navigator","userAgent")||"",ke=D,we=Me,De=ke.process,Ae=ke.Deno,Re=De&&De.versions||Ae&&Ae.version,Le=Re&&Re.v8;Le&&(j=(B=Le.split("."))[0]>0&&B[0]<4?1:+(B[0]+B[1])),!j&&we&&(!(B=we.match(/Edge\/(\d+)/))||B[1]>=74)&&(B=we.match(/Chrome\/(\d+)/))&&(j=+B[1]);var Oe=j,Ne=Oe,xe=R,Pe=!!Object.getOwnPropertySymbols&&!xe((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ne&&Ne<41})),Ue=Pe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ge=Ee,Ve=ve,Fe=be,Be=Object,je=Ue?function(e){return"symbol"==typeof e}:function(e){var t=Ge("Symbol");return Ve(t)&&Fe(t.prototype,Be(e))},qe=String,He=function(e){try{return qe(e)}catch(t){return"Object"}},ze=ve,Ke=He,We=TypeError,Ye=function(e){if(ze(e))return e;throw We(Ke(e)+" is not a function")},Je=Ye,Ze=se,Xe=function(e,t){var n=e[t];return Ze(n)?void 0:Je(n)},Qe=P,$e=ve,et=Ie,tt=TypeError,nt={exports:{}},it=D,rt=Object.defineProperty,ot=function(e,t){try{rt(it,e,{value:t,configurable:!0,writable:!0})}catch(i){it[e]=t}return t},at=ot,st="__core-js_shared__",ct=D[st]||at(st,{}),ut=ct;(nt.exports=function(e,t){return ut[e]||(ut[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"});var lt=le,dt=Object,ht=function(e){return dt(lt(e))},pt=ht,ft=te({}.hasOwnProperty),gt=Object.hasOwn||function(e,t){return ft(pt(e),t)},_t=te,vt=0,mt=Math.random(),yt=_t(1..toString),It=function(e){return"Symbol("+(void 0===e?"":e)+")_"+yt(++vt+mt,36)},Tt=D,Ct=nt.exports,St=gt,Et=It,bt=Pe,Mt=Ue,kt=Ct("wks"),wt=Tt.Symbol,Dt=wt&&wt.for,At=Mt?wt:wt&&wt.withoutSetter||Et,Rt=function(e){if(!St(kt,e)||!bt&&"string"!=typeof kt[e]){var t="Symbol."+e;bt&&St(wt,e)?kt[e]=wt[e]:kt[e]=Mt&&Dt?Dt(t):At(t)}return kt[e]},Lt=P,Ot=Ie,Nt=je,xt=Xe,Pt=function(e,t){var n,i;if("string"===t&&$e(n=e.toString)&&!et(i=Qe(n,e)))return i;if($e(n=e.valueOf)&&!et(i=Qe(n,e)))return i;if("string"!==t&&$e(n=e.toString)&&!et(i=Qe(n,e)))return i;throw tt("Can't convert object to primitive value")},Ut=TypeError,Gt=Rt("toPrimitive"),Vt=function(e,t){if(!Ot(e)||Nt(e))return e;var n,i=xt(e,Gt);if(i){if(void 0===t&&(t="default"),n=Lt(i,e,t),!Ot(n)||Nt(n))return n;throw Ut("Can't convert object to primitive value")}return void 0===t&&(t="number"),Pt(e,t)},Ft=Vt,Bt=je,jt=function(e){var t=Ft(e,"string");return Bt(t)?t:t+""},qt=Ie,Ht=D.document,zt=qt(Ht)&&qt(Ht.createElement),Kt=function(e){return zt?Ht.createElement(e):{}},Wt=Kt,Yt=!L&&!R((function(){return 7!=Object.defineProperty(Wt("div"),"a",{get:function(){return 7}}).a})),Jt=L,Zt=P,Xt=U,Qt=q,$t=pe,en=jt,tn=gt,nn=Yt,rn=Object.getOwnPropertyDescriptor;A.f=Jt?rn:function(e,t){if(e=$t(e),t=en(t),nn)try{return rn(e,t)}catch(i){}if(tn(e,t))return Qt(!Zt(Xt.f,e,t),e[t])};var on={},an=L&&R((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),sn=Ie,cn=String,un=TypeError,ln=function(e){if(sn(e))return e;throw un(cn(e)+" is not an object")},dn=L,hn=Yt,pn=an,fn=ln,gn=jt,_n=TypeError,vn=Object.defineProperty,mn=Object.getOwnPropertyDescriptor,yn="enumerable",In="configurable",Tn="writable";on.f=dn?pn?function(e,t,n){if(fn(e),t=gn(t),fn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Tn in n&&!n.writable){var i=mn(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:In in n?n.configurable:i.configurable,enumerable:yn in n?n.enumerable:i.enumerable,writable:!1})}return vn(e,t,n)}:vn:function(e,t,n){if(fn(e),t=gn(t),fn(n),hn)try{return vn(e,t,n)}catch(r){}if("get"in n||"set"in n)throw _n("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Cn=on,Sn=q,En=L?function(e,t,n){return Cn.f(e,t,Sn(1,n))}:function(e,t,n){return e[t]=n,e},bn={exports:{}},Mn=L,kn=gt,wn=Function.prototype,Dn=Mn&&Object.getOwnPropertyDescriptor,An=kn(wn,"name"),Rn={EXISTS:An,PROPER:An&&"something"===function(){}.name,CONFIGURABLE:An&&(!Mn||Mn&&Dn(wn,"name").configurable)},Ln=ve,On=ct,Nn=te(Function.toString);Ln(On.inspectSource)||(On.inspectSource=function(e){return Nn(e)});var xn,Pn,Un,Gn=On.inspectSource,Vn=ve,Fn=D.WeakMap,Bn=Vn(Fn)&&/native code/.test(String(Fn)),jn=nt.exports,qn=It,Hn=jn("keys"),zn=function(e){return Hn[e]||(Hn[e]=qn(e))},Kn={},Wn=Bn,Yn=D,Jn=Ie,Zn=En,Xn=gt,Qn=ct,$n=zn,ei=Kn,ti="Object already initialized",ni=Yn.TypeError,ii=Yn.WeakMap;if(Wn||Qn.state){var ri=Qn.state||(Qn.state=new ii);ri.get=ri.get,ri.has=ri.has,ri.set=ri.set,xn=function(e,t){if(ri.has(e))throw ni(ti);return t.facade=e,ri.set(e,t),t},Pn=function(e){return ri.get(e)||{}},Un=function(e){return ri.has(e)}}else{var oi=$n("state");ei[oi]=!0,xn=function(e,t){if(Xn(e,oi))throw ni(ti);return t.facade=e,Zn(e,oi,t),t},Pn=function(e){return Xn(e,oi)?e[oi]:{}},Un=function(e){return Xn(e,oi)}}var ai={set:xn,get:Pn,has:Un,enforce:function(e){return Un(e)?Pn(e):xn(e,{})},getterFor:function(e){return function(t){var n;if(!Jn(t)||(n=Pn(t)).type!==e)throw ni("Incompatible receiver, "+e+" required");return n}}},si=R,ci=ve,ui=gt,li=L,di=Rn.CONFIGURABLE,hi=Gn,pi=ai.enforce,fi=ai.get,gi=Object.defineProperty,_i=li&&!si((function(){return 8!==gi((function(){}),"length",{value:8}).length})),vi=String(String).split("String"),mi=bn.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!ui(e,"name")||di&&e.name!==t)&&(li?gi(e,"name",{value:t,configurable:!0}):e.name=t),_i&&n&&ui(n,"arity")&&e.length!==n.arity&&gi(e,"length",{value:n.arity});try{n&&ui(n,"constructor")&&n.constructor?li&&gi(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(o){}var i=pi(e);return ui(i,"source")||(i.source=vi.join("string"==typeof t?t:"")),e};Function.prototype.toString=mi((function(){return ci(this)&&fi(this).source||hi(this)}),"toString");var yi=ve,Ii=on,Ti=bn.exports,Ci=ot,Si=function(e,t,n,i){i||(i={});var r=i.enumerable,o=void 0!==i.name?i.name:t;if(yi(n)&&Ti(n,o,i),i.global)r?e[t]=n:Ci(t,n);else{try{i.unsafe?e[t]&&(r=!0):delete e[t]}catch(s){}r?e[t]=n:Ii.f(e,t,{value:n,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e},Ei={},bi=Math.ceil,Mi=Math.floor,ki=Math.trunc||function(e){var t=+e;return(t>0?Mi:bi)(t)},wi=function(e){var t=+e;return t!=t||0===t?0:ki(t)},Di=wi,Ai=Math.max,Ri=Math.min,Li=function(e,t){var n=Di(e);return n<0?Ai(n+t,0):Ri(n,t)},Oi=wi,Ni=Math.min,xi=function(e){return e>0?Ni(Oi(e),9007199254740991):0},Pi=xi,Ui=function(e){return Pi(e.length)},Gi=pe,Vi=Li,Fi=Ui,Bi=function(e){return function(t,n,i){var r,o=Gi(t),a=Fi(o),s=Vi(i,a);if(e&&n!=n){for(;a>s;)if((r=o[s++])!=r)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},ji={includes:Bi(!0),indexOf:Bi(!1)},qi=gt,Hi=pe,zi=ji.indexOf,Ki=Kn,Wi=te([].push),Yi=function(e,t){var n,i=Hi(e),r=0,o=[];for(n in i)!qi(Ki,n)&&qi(i,n)&&Wi(o,n);for(;t.length>r;)qi(i,n=t[r++])&&(~zi(o,n)||Wi(o,n));return o},Ji=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zi=Yi,Xi=Ji.concat("length","prototype");Ei.f=Object.getOwnPropertyNames||function(e){return Zi(e,Xi)};var Qi={};Qi.f=Object.getOwnPropertySymbols;var $i=Ee,er=Ei,tr=Qi,nr=ln,ir=te([].concat),rr=$i("Reflect","ownKeys")||function(e){var t=er.f(nr(e)),n=tr.f;return n?ir(t,n(e)):t},or=gt,ar=rr,sr=A,cr=on,ur=R,lr=ve,dr=/#|\.prototype\./,hr=function(e,t){var n=fr[pr(e)];return n==_r||n!=gr&&(lr(t)?ur(t):!!t)},pr=hr.normalize=function(e){return String(e).replace(dr,".").toLowerCase()},fr=hr.data={},gr=hr.NATIVE="N",_r=hr.POLYFILL="P",vr=hr,mr=D,yr=A.f,Ir=En,Tr=Si,Cr=ot,Sr=function(e,t,n){for(var i=ar(t),r=cr.f,o=sr.f,a=0;a<i.length;a++){var s=i[a];or(e,s)||n&&or(n,s)||r(e,s,o(t,s))}},Er=vr,br=function(e,t){var n,i,r,o,a,s=e.target,c=e.global,u=e.stat;if(n=c?mr:u?mr[s]||Cr(s,{}):(mr[s]||{}).prototype)for(i in t){if(o=t[i],r=e.dontCallGetSet?(a=yr(n,i))&&a.value:n[i],!Er(c?i:s+(u?".":"#")+i,e.forced)&&void 0!==r){if(typeof o==typeof r)continue;Sr(o,r)}(e.sham||r&&r.sham)&&Ir(o,"sham",!0),Tr(n,i,o,e)}},Mr=br,kr=R,wr=pe,Dr=A.f,Ar=L,Rr=kr((function(){Dr(1)}));Mr({target:"Object",stat:!0,forced:!Ar||Rr,sham:!Ar},{getOwnPropertyDescriptor:function(e,t){return Dr(wr(e),t)}});let Lr=!0,Or=!0;function Nr(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function xr(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Pr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Lr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ur(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Or=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Gr(){if("object"==typeof window){if(Lr)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Vr(e,t){Or&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Fr(e){return"[object Object]"===Object.prototype.toString.call(e)}function Br(e){return Fr(e)?Object.keys(e).reduce((function(t,n){const i=Fr(e[n]),r=i?Br(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function jr(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?jr(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{jr(e,e.get(t),n)}))})))}function qr(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&jr(e,n,r)}))})),r}const Hr=Gr;function zr(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),Hr("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return Hr("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function Kr(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Wr(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else xr(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Yr(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Jr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(o(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(r(t)))},n])})).then(n,i)}}function Zr(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>qr(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),xr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>qr(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Xr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function Qr(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Xr(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const r=this.getSenders().find((e=>e.track===t));if(r)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $r(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function eo(e,t){xr(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var to=Object.freeze({__proto__:null,shimMediaStream:Kr,shimOnTrack:Wr,shimGetSendersWithDtmf:Yr,shimGetStats:Jr,shimSenderReceiverGetStats:Zr,shimAddTrackRemoveTrackWithNative:Xr,shimAddTrackRemoveTrack:Qr,shimPeerConnection:$r,fixNegotiationNeeded:eo,shimGetUserMedia:zr,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),no={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" "),r=3;r<i.length;r++){var o=i[r],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=t.parseRtpMap(a),c=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){var i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));var r=0;return n.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),i+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach((function(e){i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){var n,i=[],r=t.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),r.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),i.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(t))}})),0===i.length&&c&&i.push({ssrc:c});var l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=l}))),i},t.parseRtcpParameters=function(e){var n={},i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;var o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.parseMsid=function(e){var n,i=t.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substr(7).split(" "))[0],track:n[1]};var r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(n=r[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,i=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");r.length>0&&(n=parseInt(r[0].substr(19),10)),isNaN(n)&&(n=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:n};if(t.matchPrefix(e,"a=sctpmap:").length>0){var a=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,i){var r=void 0!==n?n:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,i,r){var o=t.writeRtpDescription(e.kind,n);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),o},t.getDirection=function(e,n){for(var i=t.splitLines(e),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),i=0;i<n.length;i++)if(n[i].length<2||"="!==n[i].charAt(1))return!1;return!0},e.exports=t}(no);var io=no.exports,ro=no.exports;function oo(e,t,n,i,r){var o=ro.writeRtpDescription(e.kind,t);if(o+=ro.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=ro.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":r||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(i?i.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+ro.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+ro.localCName+"\r\n"),o}function ao(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var o=i(e.parameters.apt,n),a=i(t.parameters.apt,r);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(i){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&a.parameters.apt&&!r(i,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(i.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}})),n}function so(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function co(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function uo(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var lo=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function i(t,n,i,r){var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=r,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var r=function(n){var i=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=r[e].bind(r)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw uo("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;return r&&(i=[i]),i=i.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=r?i[0]:i,!!i.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=ro.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();i.iceTransport=r.iceTransport,i.dtlsTransport=r.dtlsTransport}return t||this.transceivers.push(i),i},r.prototype.addTrack=function(t,n){if(this._isClosed)throw uo("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find((function(e){return e.track===t})))throw uo("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},r.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),i.getTracks().forEach((function(e){n.addTrack(e,i)}))}},r.prototype.removeTrack=function(t){if(this._isClosed)throw uo("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw uo("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},r.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},r.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},r.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r},r.prototype._gather=function(t,n){var i=this,r=this.transceivers[n].iceGatherer;if(!r.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),r.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),a.component=1,a.ufrag=r.getLocalParameters().usernameFragment;var c=ro.writeCandidate(a);o.candidate=Object.assign(o.candidate,ro.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=ro.getMediaSections(i._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=ro.getDescription(i._localDescription.sdp)+u.join("");var l=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),s||i._dispatchEvent("icecandidate",o),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){r.onlocalcandidate(e)}))}),0)}},r.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,n,i){var r=ao(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:ro.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),i&&e.rtpReceiver&&r.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?r.encodings=e.recvEncodingParameters:r.encodings=[{}],r.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},r.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(uo("TypeError",'Unsupported type "'+e.type+'"'));if(!so("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(uo("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=ro.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=ro.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=ro.splitSections(i._remoteDescription.sdp),n=t.shift();var r=ro.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],a=o.iceGatherer,s=o.iceTransport,c=o.dtlsTransport,u=o.localCapabilities,l=o.remoteCapabilities;if((!ro.isRejected(e)||0!==ro.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var d=ro.getIceParameters(e,n),h=ro.getDtlsParameters(e,n);r&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===s.state&&s.start(a,d,r?"controlling":"controlled"),"new"===c.state&&c.start(h));var p=ao(u,l);i._transceive(o,p.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(r){var o=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(uo("TypeError",'Unsupported type "'+r.type+'"'));if(!so("setRemoteDescription",r.type,o.signalingState)||o._isClosed)return Promise.reject(uo("InvalidStateError","Can not set remote "+r.type+" in state "+o.signalingState));var a={};o.remoteStreams.forEach((function(e){a[e.id]=e}));var s=[],c=ro.splitSections(r.sdp),u=c.shift(),l=ro.matchPrefix(u,"a=ice-lite").length>0,d=ro.matchPrefix(u,"a=group:BUNDLE ").length>0;o.usingBundle=d;var h=ro.matchPrefix(u,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!h&&h.substr(14).split(" ").indexOf("trickle")>=0,c.forEach((function(i,c){var h=ro.splitLines(i),p=ro.getKind(i),f=ro.isRejected(i)&&0===ro.matchPrefix(i,"a=bundle-only").length,g=h[0].substr(2).split(" ")[2],_=ro.getDirection(i,u),v=ro.parseMsid(i),m=ro.getMid(i)||ro.generateIdentifier();if(f||"application"===p&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[c]={mid:m,kind:p,protocol:g,rejected:!0};else{var y,I,T,C,S,E,b,M,k;!f&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(p,!0));var w,D,A=ro.parseRtpParameters(i);f||(w=ro.getIceParameters(i,u),(D=ro.getDtlsParameters(i,u)).role="client"),b=ro.parseRtpEncodingParameters(i);var R=ro.parseRtcpParameters(i),L=ro.matchPrefix(i,"a=end-of-candidates",u).length>0,O=ro.matchPrefix(i,"a=candidate:").map((function(e){return ro.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===r.type||"answer"===r.type)&&!f&&d&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==r.type||f)"answer"!==r.type||f||(I=(y=o.transceivers[c]).iceGatherer,T=y.iceTransport,C=y.dtlsTransport,S=y.rtpReceiver,E=y.sendEncodingParameters,M=y.localCapabilities,o.transceivers[c].recvEncodingParameters=b,o.transceivers[c].remoteCapabilities=A,o.transceivers[c].rtcpParameters=R,O.length&&"new"===T.state&&(!l&&!L||d&&0!==c?O.forEach((function(e){co(y.iceTransport,e)})):T.setRemoteCandidates(O)),d&&0!==c||("new"===T.state&&T.start(I,w,"controlling"),"new"===C.state&&C.start(D)),!ao(y.localCapabilities,y.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,o._transceive(y,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!S||"sendrecv"!==_&&"sendonly"!==_?delete y.rtpReceiver:(k=S.track,v?(a[v.stream]||(a[v.stream]=new e.MediaStream),n(k,a[v.stream]),s.push([k,S,a[v.stream]])):(a.default||(a.default=new e.MediaStream),n(k,a.default),s.push([k,S,a.default]))));else{(y=o.transceivers[c]||o._createTransceiver(p)).mid=m,y.iceGatherer||(y.iceGatherer=o._createIceGatherer(c,d)),O.length&&"new"===y.iceTransport.state&&(!L||d&&0!==c?O.forEach((function(e){co(y.iceTransport,e)})):y.iceTransport.setRemoteCandidates(O)),M=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(M.codecs=M.codecs.filter((function(e){return"rtx"!==e.name}))),E=y.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,x=!1;"sendrecv"===_||"sendonly"===_?(x=!y.rtpReceiver,S=y.rtpReceiver||new e.RTCRtpReceiver(y.dtlsTransport,p),x&&(k=S.track,v&&"-"===v.stream||(v?(a[v.stream]||(a[v.stream]=new e.MediaStream,Object.defineProperty(a[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(k,"id",{get:function(){return v.track}}),N=a[v.stream]):(a.default||(a.default=new e.MediaStream),N=a.default)),N&&(n(k,N),y.associatedRemoteMediaStreams.push(N)),s.push([k,S,N]))):y.rtpReceiver&&y.rtpReceiver.track&&(y.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===y.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),y.associatedRemoteMediaStreams=[]),y.localCapabilities=M,y.remoteCapabilities=A,y.rtpReceiver=S,y.rtcpParameters=R,y.sendEncodingParameters=E,y.recvEncodingParameters=b,o._transceive(o.transceivers[c],!1,x)}}})),void 0===o._dtlsRole&&(o._dtlsRole="offer"===r.type?"active":"passive"),o._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(a).forEach((function(t){var n=a[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){o._dispatchEvent("addstream",r)}))}s.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&i(o,t,r,[n])}))}})),s.forEach((function(e){e[2]||i(o,e[0],e[1],[])})),e.setTimeout((function(){o&&o.transceivers&&o.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},r.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},r.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},r.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(uo("InvalidStateError","Can not call createOffer after close"));var i=n.transceivers.filter((function(e){return"audio"===e.kind})).length,r=n.transceivers.filter((function(e){return"video"===e.kind})).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(i=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(r=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)}));i>0||r>0;)i>0&&(n._createTransceiver("audio"),i--),r>0&&(n._createTransceiver("video"),r--);var a=ro.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,r){var o=i.track,a=i.kind,s=i.mid||ro.generateIdentifier();i.mid=s,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(r,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter((function(e){return"rtx"!==e.name}))),c.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=i.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=c,i.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){a+=oo(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,a+="a="+ro.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))}));var s=new e.RTCSessionDescription({type:"offer",sdp:a});return Promise.resolve(s)},r.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(uo("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(uo("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var i=ro.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(i+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n";var r=ro.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,o){if(!(o+1>r)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var a;e.stream&&("audio"===e.kind?a=e.stream.getAudioTracks()[0]:"video"===e.kind&&(a=e.stream.getVideoTracks()[0]),a&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var s=ao(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=oo(e,s,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}}));var o=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(o)},r.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,r){if(!n._remoteDescription)return r(uo("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var s=n.transceivers[o];if(!s)return r(uo("OperationError","Can not add ICE candidate"));if(s.rejected)return i();var c=Object.keys(e.candidate).length>0?ro.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return i();if(c.component&&1!==c.component)return i();if((0===o||o>0&&s.iceTransport!==n.transceivers[0].iceTransport)&&!co(s.iceTransport,c))return r(uo("OperationError","Can not add ICE candidate"));var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),(t=ro.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(c.type?u:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=ro.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var l=0;l<n.transceivers.length&&(n.transceivers[l].rejected||(n.transceivers[l].iceTransport.addRemoteCandidate({}),(t=ro.getMediaSections(n._remoteDescription.sdp))[l]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=ro.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));l++);i()}))},r.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw uo("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&i.push(e[t].getStats())}))})),Promise.all(i).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var i;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[n]).type]||i.type,t.set(n,e[n])})),t}))}}}));var o=["createOffer","createAnswer"];return o.forEach((function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),r};function ho(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e))))}}function po(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function fo(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=lo(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&Vr("RTCIceServer.url","RTCIceServer.urls");const i="string"==typeof t;return i&&(t=[t]),t=t.filter((e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))}(e.iceServers,t.version),Gr("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function go(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var _o=Object.freeze({__proto__:null,shimPeerConnection:fo,shimReplaceTrack:go,shimGetUserMedia:ho,shimGetDisplayMedia:po});function vo(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Vr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function mo(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yo(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(i){if("TypeError"!==i.name)throw i;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function Io(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function To(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),xr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Co(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Vr("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function So(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Eo(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function bo(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Mo(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ko(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var wo=Object.freeze({__proto__:null,shimOnTrack:mo,shimPeerConnection:yo,shimSenderGetStats:Io,shimReceiverGetStats:To,shimRemoveStream:Co,shimRTCDataChannel:So,shimAddTransceiver:Eo,shimGetParameters:bo,shimCreateOffer:Mo,shimCreateAnswer:ko,shimGetUserMedia:vo,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function Do(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ao(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Ro(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function Lo(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Oo(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Oo(e){return e&&void 0!==e.video?Object.assign({},e,{video:Br(e.video)}):e}function No(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(Vr("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function xo(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Po(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function Uo(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Go=Object.freeze({__proto__:null,shimLocalStreamsAPI:Do,shimRemoteStreamsAPI:Ao,shimCallbacksAPI:Ro,shimGetUserMedia:Lo,shimConstraints:Oo,shimRTCIceServerUrls:No,shimTrackEventTransceiver:xo,shimCreateOfferLegacy:Po,shimAudioContext:Uo});function Vo(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),i=io.parseCandidate(e.candidate),r=Object.assign(n,i);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,xr(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Fo(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=io.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=io.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},r=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=io.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=i(arguments[0]),t=r(e),n=o(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function Bo(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},xr(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function jo(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function qo(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Ho(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var zo=Object.freeze({__proto__:null,shimRTCIceCandidate:Vo,shimMaxMessageSize:Fo,shimSendThrowTypeError:Bo,shimConnectionState:jo,removeExtmapAllowMixed:qo,shimAddIceCandidateNullOrEmpty:Ho});!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=Gr,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Nr(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=Nr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Nr(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Nr(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:zo,extractVersion:Nr,disableLog:Pr,disableWarnings:Ur};switch(i.browser){case"chrome":if(!to||!$r||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=to,Ho(e,i),zr(e,i),Kr(e),$r(e,i),Wr(e),Qr(e,i),Yr(e),Jr(e),Zr(e),eo(e,i),Vo(e),jo(e),Fo(e,i),Bo(e),qo(e,i);break;case"firefox":if(!wo||!yo||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=wo,Ho(e,i),vo(e,i),yo(e,i),mo(e),Co(e),Io(e),To(e),So(e),Eo(e),bo(e),Mo(e),ko(e),Vo(e),jo(e),Fo(e,i),Bo(e);break;case"edge":if(!_o||!fo||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),r;n("adapter.js shimming edge."),r.browserShim=_o,ho(e),po(e),fo(e,i),go(e),Fo(e,i),Bo(e);break;case"safari":if(!Go||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Go,Ho(e,i),No(e),Po(e),Ro(e),Do(e),Ao(e),xo(e),Lo(e),Uo(e),Vo(e),Fo(e,i),Bo(e),qo(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Ko="4.15.8",Wo={},Yo=Yi,Jo=Ji,Zo=Object.keys||function(e){return Yo(e,Jo)},Xo=L,Qo=an,$o=on,ea=ln,ta=pe,na=Zo;Wo.f=Xo&&!Qo?Object.defineProperties:function(e,t){ea(e);for(var n,i=ta(t),r=na(t),o=r.length,a=0;o>a;)$o.f(e,n=r[a++],i[n]);return e};var ia,ra=Ee("document","documentElement"),oa=ln,aa=Wo,sa=Ji,ca=Kn,ua=ra,la=Kt,da=zn("IE_PROTO"),ha=function(){},pa=function(e){return"<script>"+e+"<\/script>"},fa=function(e){e.write(pa("")),e.close();var t=e.parentWindow.Object;return e=null,t},ga=function(){try{ia=new ActiveXObject("htmlfile")}catch(r){}var e,t;ga="undefined"!=typeof document?document.domain&&ia?fa(ia):((t=la("iframe")).style.display="none",ua.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(pa("document.F=Object")),e.close(),e.F):fa(ia);for(var n=sa.length;n--;)delete ga.prototype[sa[n]];return ga()};ca[da]=!0;var _a=Object.create||function(e,t){var n;return null!==e?(ha.prototype=oa(e),n=new ha,ha.prototype=null,n[da]=e):n=ga(),void 0===t?n:aa.f(n,t)},va=Rt,ma=_a,ya=on.f,Ia=va("unscopables"),Ta=Array.prototype;null==Ta[Ia]&&ya(Ta,Ia,{configurable:!0,value:ma(null)});var Ca,Sa,Ea,ba=function(e){Ta[Ia][e]=!0},Ma={},ka=!R((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),wa=gt,Da=ve,Aa=ht,Ra=ka,La=zn("IE_PROTO"),Oa=Object,Na=Oa.prototype,xa=Ra?Oa.getPrototypeOf:function(e){var t=Aa(e);if(wa(t,La))return t[La];var n=t.constructor;return Da(n)&&t instanceof n?n.prototype:t instanceof Oa?Na:null},Pa=R,Ua=ve,Ga=Ie,Va=xa,Fa=Si,Ba=Rt("iterator"),ja=!1;[].keys&&("next"in(Ea=[].keys())?(Sa=Va(Va(Ea)))!==Object.prototype&&(Ca=Sa):ja=!0);var qa=!Ga(Ca)||Pa((function(){var e={};return Ca[Ba].call(e)!==e}));qa&&(Ca={}),Ua(Ca[Ba])||Fa(Ca,Ba,(function(){return this}));var Ha={IteratorPrototype:Ca,BUGGY_SAFARI_ITERATORS:ja},za=on.f,Ka=gt,Wa=Rt("toStringTag"),Ya=function(e,t,n){e&&!n&&(e=e.prototype),e&&!Ka(e,Wa)&&za(e,Wa,{configurable:!0,value:t})},Ja=Ha.IteratorPrototype,Za=_a,Xa=q,Qa=Ya,$a=Ma,es=function(){return this},ts=function(e,t,n,i){var r=t+" Iterator";return e.prototype=Za(Ja,{next:Xa(+!i,n)}),Qa(e,r,!1),$a[r]=es,e},ns=ve,is=String,rs=TypeError,os=te,as=ln,ss=function(e){if("object"==typeof e||ns(e))return e;throw rs("Can't set "+is(e)+" as a prototype")},cs=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=os(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(r){}return function(n,i){return as(n),ss(i),t?e(n,i):n.__proto__=i,n}}():void 0),us=br,ls=P,ds=ve,hs=ts,ps=xa,fs=cs,gs=Ya,_s=En,vs=Si,ms=Ma,ys=Rn.PROPER,Is=Rn.CONFIGURABLE,Ts=Ha.IteratorPrototype,Cs=Ha.BUGGY_SAFARI_ITERATORS,Ss=Rt("iterator"),Es="keys",bs="values",Ms="entries",ks=function(){return this},ws=function(e,t,n,i,r,o,a){hs(n,t,i);var s,c,u,l=function(e){if(e===r&&g)return g;if(!Cs&&e in p)return p[e];switch(e){case Es:case bs:case Ms:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,p=e.prototype,f=p[Ss]||p["@@iterator"]||r&&p[r],g=!Cs&&f||l(r),_="Array"==t&&p.entries||f;if(_&&(s=ps(_.call(new e)))!==Object.prototype&&s.next&&(ps(s)!==Ts&&(fs?fs(s,Ts):ds(s[Ss])||vs(s,Ss,ks)),gs(s,d,!0)),ys&&r==bs&&f&&f.name!==bs&&(Is?_s(p,"name",bs):(h=!0,g=function(){return ls(f,this)})),r)if(c={values:l(bs),keys:o?g:l(Es),entries:l(Ms)},a)for(u in c)(Cs||h||!(u in p))&&vs(p,u,c[u]);else us({target:t,proto:!0,forced:Cs||h},c);return p[Ss]!==g&&vs(p,Ss,g,{name:r}),ms[t]=g,c},Ds=function(e,t){return{value:e,done:t}},As=pe,Rs=ba,Ls=Ma,Os=ai,Ns=on.f,xs=ws,Ps=Ds,Us=L,Gs="Array Iterator",Vs=Os.set,Fs=Os.getterFor(Gs),Bs=xs(Array,"Array",(function(e,t){Vs(this,{type:Gs,target:As(e),index:0,kind:t})}),(function(){var e=Fs(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,Ps(void 0,!0)):Ps("keys"==n?i:"values"==n?t[i]:[i,t[i]],!1)}),"values"),js=Ls.Arguments=Ls.Array;if(Rs("keys"),Rs("values"),Rs("entries"),Us&&"values"!==js.name)try{Ns(js,"name",{value:"values"})}catch(qY){}var qs={};qs[Rt("toStringTag")]="z";var Hs="[object z]"===String(qs),zs=Hs,Ks=ve,Ws=Q,Ys=Rt("toStringTag"),Js=Object,Zs="Arguments"==Ws(function(){return arguments}()),Xs=zs?Ws:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(qY){}}(t=Js(e),Ys))?n:Zs?Ws(t):"Object"==(i=Ws(t))&&Ks(t.callee)?"Arguments":i},Qs=Xs,$s=Hs?{}.toString:function(){return"[object "+Qs(this)+"]"};Hs||Si(Object.prototype,"toString",$s,{unsafe:!0});var ec={exports:{}},tc={},nc=jt,ic=on,rc=q,oc=function(e,t,n){var i=nc(t);i in e?ic.f(e,i,rc(0,n)):e[i]=n},ac=Li,sc=Ui,cc=oc,uc=Array,lc=Math.max,dc=function(e,t,n){for(var i=sc(e),r=ac(t,i),o=ac(void 0===n?i:n,i),a=uc(lc(o-r,0)),s=0;r<o;r++,s++)cc(a,s,e[r]);return a.length=s,a},hc=Q,pc=pe,fc=Ei.f,gc=dc,_c="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];tc.f=function(e){return _c&&"Window"==hc(e)?function(e){try{return fc(e)}catch(qY){return gc(_c)}}(e):fc(pc(e))};var vc=R((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),mc=R,yc=Ie,Ic=Q,Tc=vc,Cc=Object.isExtensible,Sc=mc((function(){Cc(1)}))||Tc?function(e){return!!yc(e)&&(!Tc||"ArrayBuffer"!=Ic(e))&&(!Cc||Cc(e))}:Cc,Ec=!R((function(){return Object.isExtensible(Object.preventExtensions({}))})),bc=br,Mc=te,kc=Kn,wc=Ie,Dc=gt,Ac=on.f,Rc=Ei,Lc=tc,Oc=Sc,Nc=Ec,xc=!1,Pc=It("meta"),Uc=0,Gc=function(e){Ac(e,Pc,{value:{objectID:"O"+Uc++,weakData:{}}})},Vc=ec.exports={enable:function(){Vc.enable=function(){},xc=!0;var e=Rc.f,t=Mc([].splice),n={};n[Pc]=1,e(n).length&&(Rc.f=function(n){for(var i=e(n),r=0,o=i.length;r<o;r++)if(i[r]===Pc){t(i,r,1);break}return i},bc({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Lc.f}))},fastKey:function(e,t){if(!wc(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Dc(e,Pc)){if(!Oc(e))return"F";if(!t)return"E";Gc(e)}return e[Pc].objectID},getWeakData:function(e,t){if(!Dc(e,Pc)){if(!Oc(e))return!0;if(!t)return!1;Gc(e)}return e[Pc].weakData},onFreeze:function(e){return Nc&&xc&&Oc(e)&&!Dc(e,Pc)&&Gc(e),e}};kc[Pc]=!0;var Fc=Ye,Bc=O,jc=te(te.bind),qc=function(e,t){return Fc(e),void 0===t?e:Bc?jc(e,t):function(){return e.apply(t,arguments)}},Hc=Ma,zc=Rt("iterator"),Kc=Array.prototype,Wc=function(e){return void 0!==e&&(Hc.Array===e||Kc[zc]===e)},Yc=Xs,Jc=Xe,Zc=se,Xc=Ma,Qc=Rt("iterator"),$c=function(e){if(!Zc(e))return Jc(e,Qc)||Jc(e,"@@iterator")||Xc[Yc(e)]},eu=P,tu=Ye,nu=ln,iu=He,ru=$c,ou=TypeError,au=function(e,t){var n=arguments.length<2?ru(e):t;if(tu(n))return nu(eu(n,e));throw ou(iu(e)+" is not iterable")},su=P,cu=ln,uu=Xe,lu=function(e,t,n){var i,r;cu(e);try{if(!(i=uu(e,"return"))){if("throw"===t)throw n;return n}i=su(i,e)}catch(qY){r=!0,i=qY}if("throw"===t)throw n;if(r)throw i;return cu(i),n},du=qc,hu=P,pu=ln,fu=He,gu=Wc,_u=Ui,vu=be,mu=au,yu=$c,Iu=lu,Tu=TypeError,Cu=function(e,t){this.stopped=e,this.result=t},Su=Cu.prototype,Eu=function(e,t,n){var i,r,o,a,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),g=du(t,l),_=function(e){return i&&Iu(i,"normal",e),new Cu(!0,e)},v=function(e){return d?(pu(e),f?g(e[0],e[1],_):g(e[0],e[1])):f?g(e,_):g(e)};if(h)i=e.iterator;else if(p)i=e;else{if(!(r=yu(e)))throw Tu(fu(e)+" is not iterable");if(gu(r)){for(o=0,a=_u(e);a>o;o++)if((s=v(e[o]))&&vu(Su,s))return s;return new Cu(!1)}i=mu(e,r)}for(c=h?e.next:i.next;!(u=hu(c,i)).done;){try{s=v(u.value)}catch(qY){Iu(i,"throw",qY)}if("object"==typeof s&&s&&vu(Su,s))return s}return new Cu(!1)},bu=be,Mu=TypeError,ku=function(e,t){if(bu(t,e))return e;throw Mu("Incorrect invocation")},wu=Rt("iterator"),Du=!1;try{var Au=0,Ru={next:function(){return{done:!!Au++}},return:function(){Du=!0}};Ru[wu]=function(){return this},Array.from(Ru,(function(){throw 2}))}catch(qY){}var Lu=function(e,t){if(!t&&!Du)return!1;var n=!1;try{var i={};i[wu]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(qY){}return n},Ou=ve,Nu=Ie,xu=cs,Pu=function(e,t,n){var i,r;return xu&&Ou(i=t.constructor)&&i!==n&&Nu(r=i.prototype)&&r!==n.prototype&&xu(e,r),e},Uu=br,Gu=D,Vu=te,Fu=vr,Bu=Si,ju=ec.exports,qu=Eu,Hu=ku,zu=ve,Ku=se,Wu=Ie,Yu=R,Ju=Lu,Zu=Ya,Xu=Pu,Qu=function(e,t,n){var i=-1!==e.indexOf("Map"),r=-1!==e.indexOf("Weak"),o=i?"set":"add",a=Gu[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=Vu(s[e]);Bu(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(r&&!Wu(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return r&&!Wu(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(r&&!Wu(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(Fu(e,!zu(a)||!(r||s.forEach&&!Yu((function(){(new a).entries().next()})))))c=n.getConstructor(t,e,i,o),ju.enable();else if(Fu(e,!0)){var d=new c,h=d[o](r?{}:-0,1)!=d,p=Yu((function(){d.has(1)})),f=Ju((function(e){new a(e)})),g=!r&&Yu((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));f||((c=t((function(e,t){Hu(e,s);var n=Xu(new a,e,c);return Ku(t)||qu(t,n[o],{that:n,AS_ENTRIES:i}),n}))).prototype=s,s.constructor=c),(p||g)&&(l("delete"),l("has"),i&&l("get")),(g||h)&&l(o),r&&s.clear&&delete s.clear}return u[e]=c,Uu({global:!0,constructor:!0,forced:c!=a},u),Zu(c,e),r||n.setStrong(c,e,i),c},$u=Si,el=function(e,t,n){for(var i in t)$u(e,i,t[i],n);return e},tl=Ee,nl=on,il=L,rl=Rt("species"),ol=function(e){var t=tl(e),n=nl.f;il&&t&&!t[rl]&&n(t,rl,{configurable:!0,get:function(){return this}})},al=on.f,sl=_a,cl=el,ul=qc,ll=ku,dl=se,hl=Eu,pl=ws,fl=Ds,gl=ol,_l=L,vl=ec.exports.fastKey,ml=ai.set,yl=ai.getterFor,Il={getConstructor:function(e,t,n,i){var r=e((function(e,r){ll(e,o),ml(e,{type:t,index:sl(null),first:void 0,last:void 0,size:0}),_l||(e.size=0),dl(r)||hl(r,e[i],{that:e,AS_ENTRIES:n})})),o=r.prototype,a=yl(t),s=function(e,t,n){var i,r,o=a(e),s=c(e,t);return s?s.value=n:(o.last=s={index:r=vl(t,!0),key:t,value:n,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=s),i&&(i.next=s),_l?o.size++:e.size++,"F"!==r&&(o.index[r]=s)),e},c=function(e,t){var n,i=a(e),r=vl(t);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key==t)return n};return cl(o,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,_l?e.size=0:this.size=0},delete:function(e){var t=this,n=a(t),i=c(t,e);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first==i&&(n.first=r),n.last==i&&(n.last=o),_l?n.size--:t.size--}return!!i},forEach:function(e){for(var t,n=a(this),i=ul(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),cl(o,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),_l&&al(o,"size",{get:function(){return a(this).size}}),r},setStrong:function(e,t,n){var i=t+" Iterator",r=yl(t),o=yl(i);pl(e,t,(function(e,t){ml(this,{type:i,target:e,state:r(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?fl("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,fl(void 0,!0))}),n?"entries":"values",!n,!0),gl(t)}};Qu("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Il);var Tl=Xs,Cl=String,Sl=function(e){if("Symbol"===Tl(e))throw TypeError("Cannot convert a Symbol value to a string");return Cl(e)},El=te,bl=wi,Ml=Sl,kl=le,wl=El("".charAt),Dl=El("".charCodeAt),Al=El("".slice),Rl=function(e){return function(t,n){var i,r,o=Ml(kl(t)),a=bl(n),s=o.length;return a<0||a>=s?e?"":void 0:(i=Dl(o,a))<55296||i>56319||a+1===s||(r=Dl(o,a+1))<56320||r>57343?e?wl(o,a):i:e?Al(o,a,a+2):r-56320+(i-55296<<10)+65536}},Ll={codeAt:Rl(!1),charAt:Rl(!0)},Ol=Ll.charAt,Nl=Sl,xl=ai,Pl=ws,Ul=Ds,Gl="String Iterator",Vl=xl.set,Fl=xl.getterFor(Gl);Pl(String,"String",(function(e){Vl(this,{type:Gl,string:Nl(e),index:0})}),(function(){var e,t=Fl(this),n=t.string,i=t.index;return i>=n.length?Ul(void 0,!0):(e=Ol(n,i),t.index+=e.length,Ul(e,!1))}));var Bl={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},jl=Kt("span").classList,ql=jl&&jl.constructor&&jl.constructor.prototype,Hl=ql===Object.prototype?void 0:ql,zl=D,Kl=Bl,Wl=Hl,Yl=Bs,Jl=En,Zl=Rt,Xl=Zl("iterator"),Ql=Zl("toStringTag"),$l=Yl.values,ed=function(e,t){if(e){if(e[Xl]!==$l)try{Jl(e,Xl,$l)}catch(qY){e[Xl]=$l}if(e[Ql]||Jl(e,Ql,t),Kl[t])for(var n in Yl)if(e[n]!==Yl[n])try{Jl(e,n,Yl[n])}catch(qY){e[n]=Yl[n]}}};for(var td in Kl)ed(zl[td]&&zl[td].prototype,td);ed(Wl,"DOMTokenList");var nd=O,id=Function.prototype,rd=id.apply,od=id.call,ad="object"==typeof Reflect&&Reflect.apply||(nd?od.bind(rd):function(){return od.apply(rd,arguments)}),sd=te([].slice),cd=TypeError,ud=function(e,t){if(e<t)throw cd("Not enough arguments");return e},ld=D,dd=ad,hd=ve,pd=sd,fd=ud,gd=/MSIE .\./.test(Me),_d=ld.Function,vd=function(e){return gd?function(t,n){var i=fd(arguments.length,1)>2,r=hd(t)?t:_d(t),o=i?pd(arguments,2):void 0;return e(i?function(){dd(r,this,o)}:r,n)}:e},md={setTimeout:vd(ld.setTimeout),setInterval:vd(ld.setInterval)},yd=md.setInterval;br({global:!0,bind:!0,forced:D.setInterval!==yd},{setInterval:yd});var Id=md.setTimeout;br({global:!0,bind:!0,forced:D.setTimeout!==Id},{setTimeout:Id}),Qu("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Il);var Td=Q,Cd=Array.isArray||function(e){return"Array"==Td(e)},Sd=te,Ed=R,bd=ve,Md=Xs,kd=Gn,wd=function(){},Dd=[],Ad=Ee("Reflect","construct"),Rd=/^\s*(?:class|function)\b/,Ld=Sd(Rd.exec),Od=!Rd.exec(wd),Nd=function(e){if(!bd(e))return!1;try{return Ad(wd,Dd,e),!0}catch(qY){return!1}},xd=function(e){if(!bd(e))return!1;switch(Md(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Od||!!Ld(Rd,kd(e))}catch(qY){return!0}};xd.sham=!0;var Pd=!Ad||Ed((function(){var e;return Nd(Nd.call)||!Nd(Object)||!Nd((function(){e=!0}))||e}))?xd:Nd,Ud=Cd,Gd=Pd,Vd=Ie,Fd=Rt("species"),Bd=Array,jd=function(e){var t;return Ud(e)&&(t=e.constructor,(Gd(t)&&(t===Bd||Ud(t.prototype))||Vd(t)&&null===(t=t[Fd]))&&(t=void 0)),void 0===t?Bd:t},qd=function(e,t){return new(jd(e))(0===t?0:t)},Hd=qc,zd=ae,Kd=ht,Wd=Ui,Yd=qd,Jd=te([].push),Zd=function(e){var t=1==e,n=2==e,i=3==e,r=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){for(var h,p,f=Kd(c),g=zd(f),_=Hd(u,l),v=Wd(g),m=0,y=d||Yd,I=t?y(c,v):n||a?y(c,0):void 0;v>m;m++)if((s||m in g)&&(p=_(h=g[m],m,f),e))if(t)I[m]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return m;case 2:Jd(I,h)}else switch(e){case 4:return!1;case 7:Jd(I,h)}return o?-1:i||r?r:I}},Xd={forEach:Zd(0),map:Zd(1),filter:Zd(2),some:Zd(3),every:Zd(4),find:Zd(5),findIndex:Zd(6),filterReject:Zd(7)},Qd=R,$d=Oe,eh=Rt("species"),th=function(e){return $d>=51||!Qd((function(){var t=[];return(t.constructor={})[eh]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},nh=Xd.map;br({target:"Array",proto:!0,forced:!th("map")},{map:function(e){return nh(this,e,arguments.length>1?arguments[1]:void 0)}});var ih=L,rh=Cd,oh=TypeError,ah=Object.getOwnPropertyDescriptor,sh=ih&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(qY){return qY instanceof TypeError}}(),ch=TypeError,uh=function(e){if(e>9007199254740991)throw ch("Maximum allowed index exceeded");return e},lh=He,dh=TypeError,hh=function(e,t){if(!delete e[t])throw dh("Cannot delete property "+lh(t)+" of "+lh(e))},ph=br,fh=ht,gh=Li,_h=wi,vh=Ui,mh=sh?function(e,t){if(rh(e)&&!ah(e,"length").writable)throw oh("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},yh=uh,Ih=qd,Th=oc,Ch=hh,Sh=th("splice"),Eh=Math.max,bh=Math.min;ph({target:"Array",proto:!0,forced:!Sh},{splice:function(e,t){var n,i,r,o,a,s,c=fh(this),u=vh(c),l=gh(e,u),d=arguments.length;for(0===d?n=i=0:1===d?(n=0,i=u-l):(n=d-2,i=bh(Eh(_h(t),0),u-l)),yh(u+n-i),r=Ih(c,i),o=0;o<i;o++)(a=l+o)in c&&Th(r,o,c[a]);if(r.length=i,n<i){for(o=l;o<u-i;o++)s=o+n,(a=o+i)in c?c[s]=c[a]:Ch(c,s);for(o=u;o>u-i+n;o--)Ch(c,o-1)}else if(n>i)for(o=u-i;o>l;o--)s=o+n-1,(a=o+i-1)in c?c[s]=c[a]:Ch(c,s);for(o=0;o<n;o++)c[o+l]=arguments[o+2];return mh(c,u-i+n),r}});var Mh=R,kh=function(e,t){var n=[][e];return!!n&&Mh((function(){n.call(null,t||function(){return 1},1)}))},wh=Xd.forEach,Dh=kh("forEach")?[].forEach:function(e){return wh(this,e,arguments.length>1?arguments[1]:void 0)};br({target:"Array",proto:!0,forced:[].forEach!=Dh},{forEach:Dh});var Ah=D,Rh=Bl,Lh=Hl,Oh=Dh,Nh=En,xh=function(e){if(e&&e.forEach!==Oh)try{Nh(e,"forEach",Oh)}catch(qY){e.forEach=Oh}};for(var Ph in Rh)Rh[Ph]&&xh(Ah[Ph]&&Ah[Ph].prototype);xh(Lh);var Uh=br,Gh=ae,Vh=pe,Fh=kh,Bh=te([].join),jh=Gh!=Object,qh=Fh("join",",");Uh({target:"Array",proto:!0,forced:jh||!qh},{join:function(e){return Bh(Vh(this),void 0===e?",":e)}});var Hh=Xd.filter;br({target:"Array",proto:!0,forced:!th("filter")},{filter:function(e){return Hh(this,e,arguments.length>1?arguments[1]:void 0)}});var zh=br,Kh=R,Wh=Cd,Yh=Ie,Jh=ht,Zh=Ui,Xh=uh,Qh=oc,$h=qd,ep=th,tp=Oe,np=Rt("isConcatSpreadable"),ip=tp>=51||!Kh((function(){var e=[];return e[np]=!1,e.concat()[0]!==e})),rp=ep("concat"),op=function(e){if(!Yh(e))return!1;var t=e[np];return void 0!==t?!!t:Wh(e)};zh({target:"Array",proto:!0,arity:1,forced:!ip||!rp},{concat:function(e){var t,n,i,r,o,a=Jh(this),s=$h(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(op(o=-1===t?a:arguments[t]))for(r=Zh(o),Xh(c+r),n=0;n<r;n++,c++)n in o&&Qh(s,c,o[n]);else Xh(c+1),Qh(s,c++,o);return s.length=c,s}});var ap=te,sp=Si,cp=Date.prototype,up="Invalid Date",lp="toString",dp=ap(cp.toString),hp=ap(cp.getTime);String(new Date(NaN))!=up&&sp(cp,lp,(function(){var e=hp(this);return e==e?dp(this):up}));var pp=wi,fp=Sl,gp=le,_p=RangeError,vp=function(e){var t=fp(gp(this)),n="",i=pp(e);if(i<0||1/0==i)throw _p("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(n+=t);return n},mp=te,yp=xi,Ip=Sl,Tp=le,Cp=mp(vp),Sp=mp("".slice),Ep=Math.ceil,bp=function(e){return function(t,n,i){var r,o,a=Ip(Tp(t)),s=yp(n),c=a.length,u=void 0===i?" ":Ip(i);return s<=c||""==u?a:((o=Cp(u,Ep((r=s-c)/u.length))).length>r&&(o=Sp(o,0,r)),e?a+o:o+a)}},Mp={start:bp(!1),end:bp(!0)},kp=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(Me),wp=Mp.start;br({target:"String",proto:!0,forced:kp},{padStart:function(e){return wp(this,e,arguments.length>1?arguments[1]:void 0)}});var Dp=ln,Ap=function(){var e=Dp(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Rp=R,Lp=D.RegExp,Op=Rp((function(){var e=Lp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Np=Op||Rp((function(){return!Lp("a","y").sticky})),xp={BROKEN_CARET:Op||Rp((function(){var e=Lp("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:Np,UNSUPPORTED_Y:Op},Pp=R,Up=D.RegExp,Gp=Pp((function(){var e=Up(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Vp=R,Fp=D.RegExp,Bp=Vp((function(){var e=Fp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),jp=P,qp=te,Hp=Sl,zp=Ap,Kp=xp,Wp=nt.exports,Yp=_a,Jp=ai.get,Zp=Gp,Xp=Bp,Qp=Wp("native-string-replace",String.prototype.replace),$p=RegExp.prototype.exec,ef=$p,tf=qp("".charAt),nf=qp("".indexOf),rf=qp("".replace),of=qp("".slice),af=function(){var e=/a/,t=/b*/g;return jp($p,e,"a"),jp($p,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),sf=Kp.BROKEN_CARET,cf=void 0!==/()??/.exec("")[1];(af||cf||sf||Zp||Xp)&&(ef=function(e){var t,n,i,r,o,a,s,c=this,u=Jp(c),l=Hp(e),d=u.raw;if(d)return d.lastIndex=c.lastIndex,t=jp(ef,d,l),c.lastIndex=d.lastIndex,t;var h=u.groups,p=sf&&c.sticky,f=jp(zp,c),g=c.source,_=0,v=l;if(p&&(f=rf(f,"y",""),-1===nf(f,"g")&&(f+="g"),v=of(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==tf(l,c.lastIndex-1))&&(g="(?: "+g+")",v=" "+v,_++),n=new RegExp("^(?:"+g+")",f)),cf&&(n=new RegExp("^"+g+"$(?!\\s)",f)),af&&(i=c.lastIndex),r=jp($p,p?n:c,v),p?r?(r.input=of(r.input,_),r[0]=of(r[0],_),r.index=c.lastIndex,c.lastIndex+=r[0].length):c.lastIndex=0:af&&r&&(c.lastIndex=c.global?r.index+r[0].length:i),cf&&r&&r.length>1&&jp(Qp,r[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r&&h)for(r.groups=a=Yp(null),o=0;o<h.length;o++)a[(s=h[o])[0]]=r[s[1]];return r});var uf=ef;br({target:"RegExp",proto:!0,forced:/./.exec!==uf},{exec:uf});var lf=te,df=Si,hf=uf,pf=R,ff=Rt,gf=En,_f=ff("species"),vf=RegExp.prototype,mf=function(e,t,n,i){var r=ff(e),o=!pf((function(){var t={};return t[r]=function(){return 7},7!=""[e](t)})),a=o&&!pf((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[_f]=function(){return n},n.flags="",n[r]=/./[r]),n.exec=function(){return t=!0,null},n[r](""),!t}));if(!o||!a||n){var s=lf(/./[r]),c=t(r,""[e],(function(e,t,n,i,r){var a=lf(e),c=t.exec;return c===hf||c===vf.exec?o&&!r?{done:!0,value:s(t,n,i)}:{done:!0,value:a(n,t,i)}:{done:!1}}));df(String.prototype,e,c[0]),df(vf,r,c[1])}i&&gf(vf[r],"sham",!0)},yf=Ll.charAt,If=function(e,t,n){return t+(n?yf(e,t).length:1)},Tf=te,Cf=ht,Sf=Math.floor,Ef=Tf("".charAt),bf=Tf("".replace),Mf=Tf("".slice),kf=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wf=/\$([$&'`]|\d{1,2})/g,Df=P,Af=ln,Rf=ve,Lf=Q,Of=uf,Nf=TypeError,xf=function(e,t){var n=e.exec;if(Rf(n)){var i=Df(n,e,t);return null!==i&&Af(i),i}if("RegExp"===Lf(e))return Df(Of,e,t);throw Nf("RegExp#exec called on incompatible receiver")},Pf=ad,Uf=P,Gf=te,Vf=mf,Ff=R,Bf=ln,jf=ve,qf=se,Hf=wi,zf=xi,Kf=Sl,Wf=le,Yf=If,Jf=Xe,Zf=function(e,t,n,i,r,o){var a=n+e.length,s=i.length,c=wf;return void 0!==r&&(r=Cf(r),c=kf),bf(o,c,(function(o,c){var u;switch(Ef(c,0)){case"$":return"$";case"&":return e;case"`":return Mf(t,0,n);case"'":return Mf(t,a);case"<":u=r[Mf(c,1,-1)];break;default:var l=+c;if(0===l)return o;if(l>s){var d=Sf(l/10);return 0===d?o:d<=s?void 0===i[d-1]?Ef(c,1):i[d-1]+Ef(c,1):o}u=i[l-1]}return void 0===u?"":u}))},Xf=xf,Qf=Rt("replace"),$f=Math.max,eg=Math.min,tg=Gf([].concat),ng=Gf([].push),ig=Gf("".indexOf),rg=Gf("".slice),og="$0"==="a".replace(/./,"$0"),ag=!!/./[Qf]&&""===/./[Qf]("a","$0"),sg=!Ff((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));Vf("replace",(function(e,t,n){var i=ag?"$":"$0";return[function(e,n){var i=Wf(this),r=qf(e)?void 0:Jf(e,Qf);return r?Uf(r,e,i,n):Uf(t,Kf(i),e,n)},function(e,r){var o=Bf(this),a=Kf(e);if("string"==typeof r&&-1===ig(r,i)&&-1===ig(r,"$<")){var s=n(t,o,a,r);if(s.done)return s.value}var c=jf(r);c||(r=Kf(r));var u=o.global;if(u){var l=o.unicode;o.lastIndex=0}for(var d=[];;){var h=Xf(o,a);if(null===h)break;if(ng(d,h),!u)break;""===Kf(h[0])&&(o.lastIndex=Yf(a,zf(o.lastIndex),l))}for(var p,f="",g=0,_=0;_<d.length;_++){for(var v=Kf((h=d[_])[0]),m=$f(eg(Hf(h.index),a.length),0),y=[],I=1;I<h.length;I++)ng(y,void 0===(p=h[I])?p:String(p));var T=h.groups;if(c){var C=tg([v],y,m,a);void 0!==T&&ng(C,T);var S=Kf(Pf(r,void 0,C))}else S=Zf(v,a,m,y,T,r);m>=g&&(f+=rg(a,g,m)+S,g=m+v.length)}return f+rg(a,g)}]}),!sg||!og||ag);var cg=P,ug=gt,lg=be,dg=Ap,hg=RegExp.prototype,pg=function(e){var t=e.flags;return void 0!==t||"flags"in hg||ug(e,"flags")||!lg(hg,e)?t:cg(dg,e)},fg=Rn.PROPER,gg=Si,_g=ln,vg=Sl,mg=R,yg=pg,Ig="toString",Tg=RegExp.prototype.toString,Cg=mg((function(){return"/a/b"!=Tg.call({source:"a",flags:"b"})})),Sg=fg&&Tg.name!=Ig;(Cg||Sg)&&gg(RegExp.prototype,Ig,(function(){var e=_g(this);return"/"+vg(e.source)+"/"+vg(yg(e))}),{unsafe:!0});var Eg=R,bg=Rt("iterator"),Mg=!Eg((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,i){t.delete("b"),n+=i+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[bg]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),kg=dc,wg=Math.floor,Dg=function(e,t){var n=e.length,i=wg(n/2);return n<8?Ag(e,t):Rg(e,Dg(kg(e,0,i),t),Dg(kg(e,i),t),t)},Ag=function(e,t){for(var n,i,r=e.length,o=1;o<r;){for(i=o,n=e[o];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==o++&&(e[i]=n)}return e},Rg=function(e,t,n,i){for(var r=t.length,o=n.length,a=0,s=0;a<r||s<o;)e[a+s]=a<r&&s<o?i(t[a],n[s])<=0?t[a++]:n[s++]:a<r?t[a++]:n[s++];return e},Lg=Dg,Og=br,Ng=D,xg=P,Pg=te,Ug=L,Gg=Mg,Vg=Si,Fg=el,Bg=Ya,jg=ts,qg=ai,Hg=ku,zg=ve,Kg=gt,Wg=qc,Yg=Xs,Jg=ln,Zg=Ie,Xg=Sl,Qg=_a,$g=q,e_=au,t_=$c,n_=ud,i_=Lg,r_=Rt("iterator"),o_="URLSearchParams",a_="URLSearchParamsIterator",s_=qg.set,c_=qg.getterFor(o_),u_=qg.getterFor(a_),l_=Object.getOwnPropertyDescriptor,d_=function(e){if(!Ug)return Ng[e];var t=l_(Ng,e);return t&&t.value},h_=d_("fetch"),p_=d_("Request"),f_=d_("Headers"),g_=p_&&p_.prototype,__=f_&&f_.prototype,v_=Ng.RegExp,m_=Ng.TypeError,y_=Ng.decodeURIComponent,I_=Ng.encodeURIComponent,T_=Pg("".charAt),C_=Pg([].join),S_=Pg([].push),E_=Pg("".replace),b_=Pg([].shift),M_=Pg([].splice),k_=Pg("".split),w_=Pg("".slice),D_=/\+/g,A_=Array(4),R_=function(e){return A_[e-1]||(A_[e-1]=v_("((?:%[\\da-f]{2}){"+e+"})","gi"))},L_=function(e){try{return y_(e)}catch(qY){return e}},O_=function(e){var t=E_(e,D_," "),n=4;try{return y_(t)}catch(qY){for(;n;)t=E_(t,R_(n--),L_);return t}},N_=/[!'()~]|%20/g,x_={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},P_=function(e){return x_[e]},U_=function(e){return E_(I_(e),N_,P_)},G_=jg((function(e,t){s_(this,{type:a_,iterator:e_(c_(e).entries),kind:t})}),"Iterator",(function(){var e=u_(this),t=e.kind,n=e.iterator.next(),i=n.value;return n.done||(n.value="keys"===t?i.key:"values"===t?i.value:[i.key,i.value]),n}),!0),V_=function(e){this.entries=[],this.url=null,void 0!==e&&(Zg(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===T_(e,0)?w_(e,1):e:Xg(e)))};V_.prototype={type:o_,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,r,o,a,s,c=t_(e);if(c)for(n=(t=e_(e,c)).next;!(i=xg(n,t)).done;){if(o=(r=e_(Jg(i.value))).next,(a=xg(o,r)).done||(s=xg(o,r)).done||!xg(o,r).done)throw m_("Expected sequence with length 2");S_(this.entries,{key:Xg(a.value),value:Xg(s.value)})}else for(var u in e)Kg(e,u)&&S_(this.entries,{key:u,value:Xg(e[u])})},parseQuery:function(e){if(e)for(var t,n,i=k_(e,"&"),r=0;r<i.length;)(t=i[r++]).length&&(n=k_(t,"="),S_(this.entries,{key:O_(b_(n)),value:O_(C_(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],S_(n,U_(e.key)+"="+U_(e.value));return C_(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var F_=function(){Hg(this,B_);var e=arguments.length>0?arguments[0]:void 0;s_(this,new V_(e))},B_=F_.prototype;if(Fg(B_,{append:function(e,t){n_(arguments.length,2);var n=c_(this);S_(n.entries,{key:Xg(e),value:Xg(t)}),n.updateURL()},delete:function(e){n_(arguments.length,1);for(var t=c_(this),n=t.entries,i=Xg(e),r=0;r<n.length;)n[r].key===i?M_(n,r,1):r++;t.updateURL()},get:function(e){n_(arguments.length,1);for(var t=c_(this).entries,n=Xg(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){n_(arguments.length,1);for(var t=c_(this).entries,n=Xg(e),i=[],r=0;r<t.length;r++)t[r].key===n&&S_(i,t[r].value);return i},has:function(e){n_(arguments.length,1);for(var t=c_(this).entries,n=Xg(e),i=0;i<t.length;)if(t[i++].key===n)return!0;return!1},set:function(e,t){n_(arguments.length,1);for(var n,i=c_(this),r=i.entries,o=!1,a=Xg(e),s=Xg(t),c=0;c<r.length;c++)(n=r[c]).key===a&&(o?M_(r,c--,1):(o=!0,n.value=s));o||S_(r,{key:a,value:s}),i.updateURL()},sort:function(){var e=c_(this);i_(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=c_(this).entries,i=Wg(e,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((t=n[r++]).value,t.key,this)},keys:function(){return new G_(this,"keys")},values:function(){return new G_(this,"values")},entries:function(){return new G_(this,"entries")}},{enumerable:!0}),Vg(B_,r_,B_.entries,{name:"entries"}),Vg(B_,"toString",(function(){return c_(this).serialize()}),{enumerable:!0}),Bg(F_,o_),Og({global:!0,constructor:!0,forced:!Gg},{URLSearchParams:F_}),!Gg&&zg(f_)){var j_=Pg(__.has),q_=Pg(__.set),H_=function(e){if(Zg(e)){var t,n=e.body;if(Yg(n)===o_)return t=e.headers?new f_(e.headers):new f_,j_(t,"content-type")||q_(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Qg(e,{body:$g(0,Xg(n)),headers:$g(0,t)})}return e};if(zg(h_)&&Og({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return h_(e,arguments.length>1?H_(arguments[1]):{})}}),zg(p_)){var z_=function(e){return Hg(this,g_),new p_(e,arguments.length>1?H_(arguments[1]):{})};g_.constructor=z_,z_.prototype=g_,Og({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:z_})}}var K_={URLSearchParams:F_,getState:c_},W_=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},Y_=P,J_=ln,Z_=se,X_=le,Q_=W_,$_=Sl,ev=Xe,tv=xf;mf("search",(function(e,t,n){return[function(t){var n=X_(this),i=Z_(t)?void 0:ev(t,e);return i?Y_(i,t,n):new RegExp(t)[e]($_(n))},function(e){var i=J_(this),r=$_(e),o=n(t,i,r);if(o.done)return o.value;var a=i.lastIndex;Q_(a,0)||(i.lastIndex=0);var s=tv(i,r);return Q_(i.lastIndex,a)||(i.lastIndex=a),null===s?-1:s.index}]})),(new Date).getTime();var nv=0,iv=function(){return(new Date).getTime()+nv},rv=function(){var e=new Date;return e.setTime(iv()),e.toLocaleString()},ov=P,av=ln,sv=se,cv=xi,uv=Sl,lv=le,dv=Xe,hv=If,pv=xf;mf("match",(function(e,t,n){return[function(t){var n=lv(this),i=sv(t)?void 0:dv(t,e);return i?ov(i,t,n):new RegExp(t)[e](uv(n))},function(e){var i=av(this),r=uv(e),o=n(t,i,r);if(o.done)return o.value;if(!i.global)return pv(i,r);var a=i.unicode;i.lastIndex=0;for(var s,c=[],u=0;null!==(s=pv(i,r));){var l=uv(s[0]);c[u]=l,""===l&&(i.lastIndex=hv(r,cv(i.lastIndex),a)),u++}return 0===u?null:c}]}));var fv=Ie,gv=Q,_v=Rt("match"),vv=function(e){var t;return fv(e)&&(void 0!==(t=e[_v])?!!t:"RegExp"==gv(e))},mv=on.f,yv=L,Iv=D,Tv=te,Cv=vr,Sv=Pu,Ev=En,bv=Ei.f,Mv=be,kv=vv,wv=Sl,Dv=pg,Av=xp,Rv=function(e,t,n){n in e||mv(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})},Lv=Si,Ov=R,Nv=gt,xv=ai.enforce,Pv=ol,Uv=Gp,Gv=Bp,Vv=Rt("match"),Fv=Iv.RegExp,Bv=Fv.prototype,jv=Iv.SyntaxError,qv=Tv(Bv.exec),Hv=Tv("".charAt),zv=Tv("".replace),Kv=Tv("".indexOf),Wv=Tv("".slice),Yv=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Jv=/a/g,Zv=/a/g,Xv=new Fv(Jv)!==Jv,Qv=Av.MISSED_STICKY,$v=Av.UNSUPPORTED_Y,em=yv&&(!Xv||Qv||Uv||Gv||Ov((function(){return Zv[Vv]=!1,Fv(Jv)!=Jv||Fv(Zv)==Zv||"/a/i"!=Fv(Jv,"i")})));if(Cv("RegExp",em)){for(var tm=function(e,t){var n,i,r,o,a,s,c=Mv(Bv,this),u=kv(e),l=void 0===t,d=[],h=e;if(!c&&u&&l&&e.constructor===tm)return e;if((u||Mv(Bv,e))&&(e=e.source,l&&(t=Dv(h))),e=void 0===e?"":wv(e),t=void 0===t?"":wv(t),h=e,Uv&&"dotAll"in Jv&&(i=!!t&&Kv(t,"s")>-1)&&(t=zv(t,/s/g,"")),n=t,Qv&&"sticky"in Jv&&(r=!!t&&Kv(t,"y")>-1)&&$v&&(t=zv(t,/y/g,"")),Gv&&(o=function(e){for(var t,n=e.length,i=0,r="",o=[],a={},s=!1,c=!1,u=0,l="";i<=n;i++){if("\\"===(t=Hv(e,i)))t+=Hv(e,++i);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:qv(Yv,Wv(e,i+1))&&(i+=2,c=!0),r+=t,u++;continue;case">"===t&&c:if(""===l||Nv(a,l))throw new jv("Invalid capture group name");a[l]=!0,o[o.length]=[l,u],c=!1,l="";continue}c?l+=t:r+=t}return[r,o]}(e),e=o[0],d=o[1]),a=Sv(Fv(e,t),c?this:Bv,tm),(i||r||d.length)&&(s=xv(a),i&&(s.dotAll=!0,s.raw=tm(function(e){for(var t,n=e.length,i=0,r="",o=!1;i<=n;i++)"\\"!==(t=Hv(e,i))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),r+=t):r+="[\\s\\S]":r+=t+Hv(e,++i);return r}(e),n)),r&&(s.sticky=!0),d.length&&(s.groups=d)),e!==h)try{Ev(a,"source",""===h?"(?:)":h)}catch(qY){}return a},nm=bv(Fv),im=0;nm.length>im;)Rv(tm,Fv,nm[im++]);Bv.constructor=tm,tm.prototype=Bv,Lv(Iv,"RegExp",tm,{constructor:!0})}Pv("RegExp");var rm=te(1..valueOf),om="\t\n\v\f\r                　\u2028\u2029\ufeff",am=le,sm=Sl,cm=te("".replace),um="[\t\n\v\f\r                　\u2028\u2029\ufeff]",lm=RegExp("^"+um+um+"*"),dm=RegExp(um+um+"*$"),hm=function(e){return function(t){var n=sm(am(t));return 1&e&&(n=cm(n,lm,"")),2&e&&(n=cm(n,dm,"")),n}},pm={start:hm(1),end:hm(2),trim:hm(3)},fm=L,gm=D,_m=te,vm=vr,mm=Si,ym=gt,Im=Pu,Tm=be,Cm=je,Sm=Vt,Em=R,bm=Ei.f,Mm=A.f,km=on.f,wm=rm,Dm=pm.trim,Am="Number",Rm=gm.Number,Lm=Rm.prototype,Om=gm.TypeError,Nm=_m("".slice),xm=_m("".charCodeAt),Pm=function(e){var t=Sm(e,"number");return"bigint"==typeof t?t:Um(t)},Um=function(e){var t,n,i,r,o,a,s,c,u=Sm(e,"number");if(Cm(u))throw Om("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=Dm(u),43===(t=xm(u,0))||45===t){if(88===(n=xm(u,2))||120===n)return NaN}else if(48===t){switch(xm(u,1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+u}for(a=(o=Nm(u,2)).length,s=0;s<a;s++)if((c=xm(o,s))<48||c>r)return NaN;return parseInt(o,i)}return+u};if(vm(Am,!Rm(" 0o1")||!Rm("0b1")||Rm("+0x1"))){for(var Gm,Vm=function(e){var t=arguments.length<1?0:Rm(Pm(e)),n=this;return Tm(Lm,n)&&Em((function(){wm(n)}))?Im(Object(t),n,Vm):t},Fm=fm?bm(Rm):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Bm=0;Fm.length>Bm;Bm++)ym(Rm,Gm=Fm[Bm])&&!ym(Vm,Gm)&&km(Vm,Gm,Mm(Rm,Gm));Vm.prototype=Lm,Lm.constructor=Vm,mm(gm,Am,Vm,{constructor:!0})}var jm=ji.includes,qm=ba;br({target:"Array",proto:!0,forced:R((function(){return!Array(1).includes()}))},{includes:function(e){return jm(this,e,arguments.length>1?arguments[1]:void 0)}}),qm("includes");var Hm=vv,zm=TypeError,Km=function(e){if(Hm(e))throw zm("The method doesn't accept regular expressions");return e},Wm=Rt("match"),Ym=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[Wm]=!1,"/./"[e](t)}catch(r){}}return!1},Jm=br,Zm=Km,Xm=le,Qm=Sl,$m=Ym,ey=te("".indexOf);Jm({target:"String",proto:!0,forced:!$m("includes")},{includes:function(e){return!!~ey(Qm(Xm(this)),Qm(Zm(e)),arguments.length>1?arguments[1]:void 0)}});var ty=br,ny=ji.indexOf,iy=kh,ry=te([].indexOf),oy=!!ry&&1/ry([1],1,-0)<0,ay=iy("indexOf");ty({target:"Array",proto:!0,forced:oy||!ay},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return oy?ry(this,e,t)||0:ny(this,e,t)}});var sy=ht,cy=xa,uy=ka;br({target:"Object",stat:!0,forced:R((function(){cy(1)})),sham:!uy},{getPrototypeOf:function(e){return cy(sy(e))}});var ly=ad,dy=Ye,hy=ln;br({target:"Reflect",stat:!0,forced:!R((function(){Reflect.apply((function(){}))}))},{apply:function(e,t,n){return ly(dy(e),t,hy(n))}});var py=L,fy=Rn.EXISTS,gy=te,_y=on.f,vy=Function.prototype,my=gy(vy.toString),yy=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Iy=gy(yy.exec);py&&!fy&&_y(vy,"name",{configurable:!0,get:function(){try{return Iy(yy,my(this))[1]}catch(qY){return""}}});var Ty=br,Cy=Date,Sy=te(Cy.prototype.getTime);Ty({target:"Date",stat:!0},{now:function(){return Sy(new Cy)}});var Ey,by,My,ky,wy="process"==Q(D.process),Dy=Pd,Ay=He,Ry=TypeError,Ly=function(e){if(Dy(e))return e;throw Ry(Ay(e)+" is not a constructor")},Oy=ln,Ny=Ly,xy=se,Py=Rt("species"),Uy=function(e,t){var n,i=Oy(e).constructor;return void 0===i||xy(n=Oy(i)[Py])?t:Ny(n)},Gy=/(?:ipad|iphone|ipod).*applewebkit/i.test(Me),Vy=D,Fy=ad,By=qc,jy=ve,qy=gt,Hy=R,zy=ra,Ky=sd,Wy=Kt,Yy=ud,Jy=Gy,Zy=wy,Xy=Vy.setImmediate,Qy=Vy.clearImmediate,$y=Vy.process,eI=Vy.Dispatch,tI=Vy.Function,nI=Vy.MessageChannel,iI=Vy.String,rI=0,oI={},aI="onreadystatechange";try{Ey=Vy.location}catch(qY){}var sI=function(e){if(qy(oI,e)){var t=oI[e];delete oI[e],t()}},cI=function(e){return function(){sI(e)}},uI=function(e){sI(e.data)},lI=function(e){Vy.postMessage(iI(e),Ey.protocol+"//"+Ey.host)};Xy&&Qy||(Xy=function(e){Yy(arguments.length,1);var t=jy(e)?e:tI(e),n=Ky(arguments,1);return oI[++rI]=function(){Fy(t,void 0,n)},by(rI),rI},Qy=function(e){delete oI[e]},Zy?by=function(e){$y.nextTick(cI(e))}:eI&&eI.now?by=function(e){eI.now(cI(e))}:nI&&!Jy?(ky=(My=new nI).port2,My.port1.onmessage=uI,by=By(ky.postMessage,ky)):Vy.addEventListener&&jy(Vy.postMessage)&&!Vy.importScripts&&Ey&&"file:"!==Ey.protocol&&!Hy(lI)?(by=lI,Vy.addEventListener("message",uI,!1)):by=aI in Wy("script")?function(e){zy.appendChild(Wy("script")).onreadystatechange=function(){zy.removeChild(this),sI(e)}}:function(e){setTimeout(cI(e),0)});var dI,hI,pI,fI,gI,_I,vI,mI,yI={set:Xy,clear:Qy},II=D,TI=/ipad|iphone|ipod/i.test(Me)&&void 0!==II.Pebble,CI=/web0s(?!.*chrome)/i.test(Me),SI=D,EI=qc,bI=A.f,MI=yI.set,kI=Gy,wI=TI,DI=CI,AI=wy,RI=SI.MutationObserver||SI.WebKitMutationObserver,LI=SI.document,OI=SI.process,NI=SI.Promise,xI=bI(SI,"queueMicrotask"),PI=xI&&xI.value;PI||(dI=function(){var e,t;for(AI&&(e=OI.domain)&&e.exit();hI;){t=hI.fn,hI=hI.next;try{t()}catch(qY){throw hI?fI():pI=void 0,qY}}pI=void 0,e&&e.enter()},kI||AI||DI||!RI||!LI?!wI&&NI&&NI.resolve?((vI=NI.resolve(void 0)).constructor=NI,mI=EI(vI.then,vI),fI=function(){mI(dI)}):AI?fI=function(){OI.nextTick(dI)}:(MI=EI(MI,SI),fI=function(){MI(dI)}):(gI=!0,_I=LI.createTextNode(""),new RI(dI).observe(_I,{characterData:!0}),fI=function(){_I.data=gI=!gI}));var UI=PI||function(e){var t={fn:e,next:void 0};pI&&(pI.next=t),hI||(hI=t,fI()),pI=t},GI=D,VI=function(e){try{return{error:!1,value:e()}}catch(qY){return{error:!0,value:qY}}},FI=function(){this.head=null,this.tail=null};FI.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var BI=FI,jI=D.Promise,qI="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,HI=!qI&&!wy&&"object"==typeof window&&"object"==typeof document,zI=D,KI=jI,WI=ve,YI=vr,JI=Gn,ZI=Rt,XI=HI,QI=qI,$I=Oe;KI&&KI.prototype;var eT=ZI("species"),tT=!1,nT=WI(zI.PromiseRejectionEvent),iT=YI("Promise",(function(){var e=JI(KI),t=e!==String(KI);if(!t&&66===$I)return!0;if(!$I||$I<51||!/native code/.test(e)){var n=new KI((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};if((n.constructor={})[eT]=i,!(tT=n.then((function(){}))instanceof i))return!0}return!t&&(XI||QI)&&!nT})),rT={CONSTRUCTOR:iT,REJECTION_EVENT:nT,SUBCLASSING:tT},oT={},aT=Ye,sT=TypeError,cT=function(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw sT("Bad Promise constructor");t=e,n=i})),this.resolve=aT(t),this.reject=aT(n)};oT.f=function(e){return new cT(e)};var uT,lT,dT,hT=br,pT=wy,fT=D,gT=P,_T=Si,vT=cs,mT=Ya,yT=ol,IT=Ye,TT=ve,CT=Ie,ST=ku,ET=Uy,bT=yI.set,MT=UI,kT=function(e,t){var n=GI.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},wT=VI,DT=BI,AT=ai,RT=jI,LT=oT,OT="Promise",NT=rT.CONSTRUCTOR,xT=rT.REJECTION_EVENT,PT=rT.SUBCLASSING,UT=AT.getterFor(OT),GT=AT.set,VT=RT&&RT.prototype,FT=RT,BT=VT,jT=fT.TypeError,qT=fT.document,HT=fT.process,zT=LT.f,KT=zT,WT=!!(qT&&qT.createEvent&&fT.dispatchEvent),YT="unhandledrejection",JT=function(e){var t;return!(!CT(e)||!TT(t=e.then))&&t},ZT=function(e,t){var n,i,r,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&tC(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),r=!0)),n===e.promise?u(jT("Promise-chain cycle")):(i=JT(n))?gT(i,n,c,u):c(n)):u(o)}catch(qY){l&&!r&&l.exit(),u(qY)}},XT=function(e,t){e.notified||(e.notified=!0,MT((function(){for(var n,i=e.reactions;n=i.get();)ZT(n,e);e.notified=!1,t&&!e.rejection&&$T(e)})))},QT=function(e,t,n){var i,r;WT?((i=qT.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),fT.dispatchEvent(i)):i={promise:t,reason:n},!xT&&(r=fT["on"+e])?r(i):e===YT&&kT("Unhandled promise rejection",n)},$T=function(e){gT(bT,fT,(function(){var t,n=e.facade,i=e.value;if(eC(e)&&(t=wT((function(){pT?HT.emit("unhandledRejection",i,n):QT(YT,n,i)})),e.rejection=pT||eC(e)?2:1,t.error))throw t.value}))},eC=function(e){return 1!==e.rejection&&!e.parent},tC=function(e){gT(bT,fT,(function(){var t=e.facade;pT?HT.emit("rejectionHandled",t):QT("rejectionhandled",t,e.value)}))},nC=function(e,t,n){return function(i){e(t,i,n)}},iC=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,XT(e,!0))},rC=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw jT("Promise can't be resolved itself");var i=JT(t);i?MT((function(){var n={done:!1};try{gT(i,t,nC(rC,n,e),nC(iC,n,e))}catch(qY){iC(n,qY,e)}})):(e.value=t,e.state=1,XT(e,!1))}catch(qY){iC({done:!1},qY,e)}}};if(NT&&(BT=(FT=function(e){ST(this,BT),IT(e),gT(uT,this);var t=UT(this);try{e(nC(rC,t),nC(iC,t))}catch(qY){iC(t,qY)}}).prototype,(uT=function(e){GT(this,{type:OT,done:!1,notified:!1,parent:!1,reactions:new DT,rejection:!1,state:0,value:void 0})}).prototype=_T(BT,"then",(function(e,t){var n=UT(this),i=zT(ET(this,FT));return n.parent=!0,i.ok=!TT(e)||e,i.fail=TT(t)&&t,i.domain=pT?HT.domain:void 0,0==n.state?n.reactions.add(i):MT((function(){ZT(i,n)})),i.promise})),lT=function(){var e=new uT,t=UT(e);this.promise=e,this.resolve=nC(rC,t),this.reject=nC(iC,t)},LT.f=zT=function(e){return e===FT||void 0===e?new lT(e):KT(e)},TT(RT)&&VT!==Object.prototype)){dT=VT.then,PT||_T(VT,"then",(function(e,t){var n=this;return new FT((function(e,t){gT(dT,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete VT.constructor}catch(qY){}vT&&vT(VT,BT)}hT({global:!0,constructor:!0,wrap:!0,forced:NT},{Promise:FT}),mT(FT,OT,!1),yT(OT);var oC=jI,aC=rT.CONSTRUCTOR||!Lu((function(e){oC.all(e).then(void 0,(function(){}))})),sC=P,cC=Ye,uC=oT,lC=VI,dC=Eu;br({target:"Promise",stat:!0,forced:aC},{all:function(e){var t=this,n=uC.f(t),i=n.resolve,r=n.reject,o=lC((function(){var n=cC(t.resolve),o=[],a=0,s=1;dC(e,(function(e){var c=a++,u=!1;s++,sC(n,t,e).then((function(e){u||(u=!0,o[c]=e,--s||i(o))}),r)})),--s||i(o)}));return o.error&&r(o.value),n.promise}});var hC=br,pC=rT.CONSTRUCTOR,fC=jI,gC=Ee,_C=ve,vC=Si,mC=fC&&fC.prototype;if(hC({target:"Promise",proto:!0,forced:pC,real:!0},{catch:function(e){return this.then(void 0,e)}}),_C(fC)){var yC=gC("Promise").prototype.catch;mC.catch!==yC&&vC(mC,"catch",yC,{unsafe:!0})}var IC=P,TC=Ye,CC=oT,SC=VI,EC=Eu;br({target:"Promise",stat:!0,forced:aC},{race:function(e){var t=this,n=CC.f(t),i=n.reject,r=SC((function(){var r=TC(t.resolve);EC(e,(function(e){IC(r,t,e).then(n.resolve,i)}))}));return r.error&&i(r.value),n.promise}});var bC=P,MC=oT;br({target:"Promise",stat:!0,forced:rT.CONSTRUCTOR},{reject:function(e){var t=MC.f(this);return bC(t.reject,void 0,e),t.promise}});var kC=ln,wC=Ie,DC=oT,AC=function(e,t){if(kC(e),wC(t)&&t.constructor===e)return t;var n=DC.f(e);return(0,n.resolve)(t),n.promise},RC=br,LC=rT.CONSTRUCTOR,OC=AC;Ee("Promise"),RC({target:"Promise",stat:!0,forced:LC},{resolve:function(e){return OC(this,e)}});var NC=ht,xC=Zo;br({target:"Object",stat:!0,forced:R((function(){xC(1)}))},{keys:function(e){return xC(NC(e))}});var PC="canvas",UC="audio",GC="video",VC="screen",FC="small",BC="big",jC="auxiliary",qC="aux",HC="smallVideo",zC="user",KC="environment",WC="mute",YC="unmute",JC="ended",ZC="playing",XC="pause",QC="error",$C="loadeddata",eS="audioinput",tS="videoinput",nS="detail",iS="text",rS="main",oS="backup",aS="banned",sS="kick",cS="user_time_out",uS="room_disband",lS="sei-message",dS="PLAYING",hS="PAUSED",pS="STOPPED",fS="inactive",gS="sendonly",_S="recvonly",vS="add",mS="remove",yS="replace",IS="track",TS="wss://trtc.rtc.qq.com",CS="wss://webrtc.qq.com",SS="qcloud",ES="trtc",bS="webrtc",MS="",kS="jssdk_log",wS="jssdk_event",DS="jssdk_new_endreport",AS=function(e){return MS=e},RS=1,LS=2,OS="live",NS=20,xS=21,PS="anchor",US="audience",GS="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",VS="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",FS=2,BS=rS,jS=jC,qS="unknown",HS="DISCONNECTED",zS="CONNECTING",KS="RECONNECTING",WS="CONNECTED",YS="new",JS="connecting",ZS="failed",XS="closed",QS="disconnected",$S="connected",eE="completed",tE=30,nE="join",iE="delta-join",rE="rejoin",oE="leave",aE="delta-leave",sE="publish",cE="delta-publish",uE="unpublish",lE="subscribe",dE="unsubscribe",hE="uplink-connection",pE="uplink-reconnection",fE="downlink-connection",gE="downlink-reconnection",_E="setLocalDescription",vE="setRemoteDescription",mE="iceConnectionState",yE="stream-initialize",IE="websocketConnectionState",TE="websocketReconnectionState",CE="update-stream",SE="recover-subscription",EE="start-mix-transcode",bE="stop-mix-transcode",ME="player-error",kE="schedule",wE="unsubscribe",DE="subscribe_change",AE="unified-plan",RE="plan-b",LE={MANUAL:"manual",PRESET_LAYOUT:"preset-layout"},OE={REMOTE:"$PLACE_HOLDER_REMOTE$"},NE={IT_AUDIO_VIDEO:0,IT_PICTURE:2,IT_CANVAS:3,IT_PURE_AUDIO:4,IT_PURE_VIDEO:5},xE="string",PE="number",UE="boolean",GE="array",VE="object",FE={ADD:vS,REMOVE:mS},BE={unknown:0,wifi:1,"4g":2,"3g":3,"2g":4,wired:5},jE=-1,qE=0,HE=1,zE=BC,KE=FC,WE=6048e5,YE="schedule.rtc.qq.com",JE="schedule.rtc.qcloud.com",ZE="schedule.rtc.tencentcloud.com",XE="schedule-ecdn.rtc.tencentcloud.com",QE="",$E=function(e){return QE=e},eb="TRTC",tb="Client",nb="LocalStream",ib="RemoteStream",rb="Stream",ob="web.sdk.qcloud.com",ab="web.sdk.tencent.cn",sb="web.sdk.cloud.tencent.cn",cb="https://console.cloud.tencent.com/trtc",ub="https://".concat(ob,"/trtc/webrtc/doc"),lb="".concat(ub,"/zh-cn/"),db="trtc_error_assistance",hb="default",pb="communications",fb={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},gb=Object.keys(fb),_b=["normal leave","timeout leave","kick","role change"],vb=2e3,mb="ric",yb="raf",Ib="interval",Tb="timeout",Cb="Resolution reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386",Sb={"TRTC.checkSystemRequirements":40001,"TRTC.isScreenShareSupported":40002,"TRTC.isSmallStreamSupported":40003,"TRTC.createClient.rtc":40004,"TRTC.createClient.live":40005,"TRTC.createClient.intRoomId":40006,"TRTC.createClient.stringRoomId":40007,"TRTC.createClient.autoSubscribe":40008,"TRTC.createClient.manualSubscribe":40009,"TRTC.enableUploadLog":40010,"TRTC.disableUploadLog":40011,"Client.publish":40012,"Client.publish.isAuxiliary":40013,"Client.switchRole":40014,"Client.startPublishCDNStream":40015,"Client.stopPublishCDNStream":40016,"Client.startMixTranscode":40017,"Client.stopMixTranscode":40018,"Client.enableAudioVolumeEvaluation":40019,"Client.enableSmallStream":40020,"Client.disableSmallStream":40021,"Client.setSmallStreamProfile":40022,"Client.setRemoteVideoStreamType":40023,"Client.sendSEIMessage":40024,"Client.setProxyServer":40025,"Client.setTurnServer":40026,"LocalStream.setAudioProfile.standard":40027,"LocalStream.setAudioProfile.high":40028,"LocalStream.setAudioProfile.standard-stereo":40029,"LocalStream.setAudioProfile.high-stereo":40030,"LocalStream.setVideoProfile.120p":40031,"LocalStream.setVideoProfile.120p_2":40032,"LocalStream.setVideoProfile.180p":40033,"LocalStream.setVideoProfile.180p_2":40034,"LocalStream.setVideoProfile.240p":40035,"LocalStream.setVideoProfile.240p_2":40036,"LocalStream.setVideoProfile.360p":40037,"LocalStream.setVideoProfile.360p_2":40038,"LocalStream.setVideoProfile.480p":40039,"LocalStream.setVideoProfile.480p_2":40040,"LocalStream.setVideoProfile.720p":40041,"LocalStream.setVideoProfile.1080p":40042,"LocalStream.setVideoProfile.1440p":40043,"LocalStream.setVideoProfile.4K":40044,"LocalStream.setScreenProfile.480p":40045,"LocalStream.setScreenProfile.480p_2":40046,"LocalStream.setScreenProfile.720p":40047,"LocalStream.setScreenProfile.720p_2":40048,"LocalStream.setScreenProfile.1080p":40049,"LocalStream.setScreenProfile.1080p_2":40050,"LocalStream.setVideoContentHint.motion":40051,"LocalStream.setVideoContentHint.detail":40052,"LocalStream.setVideoContentHint.text":40053,"LocalStream.setAudioCaptureVolume":40054,"LocalStream.getVideoFrame":40055,"RemoteStream.setAudioOutput":40056,"RemoteStream.getVideoFrame":40057,AI_DENOISER:1700,SPATIAL_AUDIO:1701,"2K_4K":1704},Eb=le,bb=Sl,Mb=/"/g,kb=te("".replace),wb=function(e,t,n,i){var r=bb(Eb(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+kb(bb(i),Mb,"&quot;")+'"'),o+">"+r+"</"+t+">"},Db=R,Ab=function(e){return Db((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))},Rb=wb;br({target:"String",proto:!0,forced:Ab("link")},{link:function(e){return Rb(this,"a","href",e)}}),br({target:"Array",stat:!0},{isArray:Cd});var Lb="AVOID_REPEATED_CALL",Ob="INVALID_PARAMETER_REQUIRED",Nb="INVALID_PARAMETER_TYPE",xb="INVALID_PARAMETER_EMPTY",Pb="INVALID_PARAMETER_INSTANCE",Ub="INVALID_PARAMETER_RANGE",Gb="API_CALL_TIMEOUT",Vb="SIGNAL_CHANNEL_RECONNECTION_FAILED",Fb="SIGNAL_CHANNEL_SETUP_FAILED",Bb="ERROR_MESSAGE",jb="EXCHANGE_SDP_TIMEOUT",qb="DOWNLINK_RECONNECTION_FAILED",Hb="EXCHANGE_SDP_FAILED",zb="UPLINK_RECONNECTION_FAILED",Kb="INVALID_PURE_AUDIO",Wb="INVALID_STREAMID",Yb="INVALID_USER_DEFINE_RECORDID",Jb="INVALID_USER_DEFINE_PUSH_ARGS",Zb="INVALID_PROXY",Xb="INVALID_JOIN",Qb="INVALID_ROOMID_STRING",$b="INVALID_ROOMID_INTEGER",eM="JOIN_ROOM_TIMEOUT",tM="JOIN_ROOM_FAILED",nM="REJOIN_ROOM_FAILED",iM="INVALID_DESTROY",rM="INVALID_PUBLISH",oM="INVALID_UNPUBLISH",aM="INVALID_AUDIENCE",sM="INVALID_INITIALIZE",cM="INVALID_DUPLICATE_PUBLISHING",uM="INVALID_REMOTE_STREAM",lM="SUBSCRIBE_FAILED",dM="INVALID_ROLE",hM="INVALID_OPERATION_SWITCH_ROLE",pM="SWITCH_ROLE_TIMEOUT",fM="SWITCH_ROLE_FAILED",gM="CLIENT_BANNED",_M="INVALID_OPERATION_START_PUBLISH_CDN",vM="INVALID_OPERATION_STOP_PUBLISH_CDN",mM="INVALID_STREAM_ID",yM="START_PUBLISH_CDN_FAILED",IM="STOP_PUBLISH_CDN_FAILED",TM="START_MIX_TRANSCODE",CM="STOP_MIX_TRANSCODE",SM="INVALID_AUDIO_VOLUME",EM="ENABLE_SMALL_STREAM_PUBLISHED",bM="DISABLE_SMALL_STREAM_PUBLISHED",MM="NOT_SUPPORTED_SMALL_STREAM",kM="INVALID_SMALL_STREAM_PROFILE",wM="INVALID_PARAMETER_REMOTE_STREAM",DM="INVALID_SWITCH_DEVICE",AM="INVALID_SWITCH_DEVICE_PUBLISHING",RM="INVALID_REPLACE_TRACK",LM="INVALID_INITIALIZE_LOCAL_STREAM",OM="INVALID_ADD_TRACK_REPETITIVE",NM="INVALID_ADD_TRACK_REMOVING",xM="INVALID_ADD_TRACK_PUBLISHING",PM="INVALID_STREAM_INITIALIZED",UM="INVALID_ADD_TRACK_NUMBER",GM="INVALID_REMOVE_AUDIO_TRACK",VM="INVALID_REMOVE_AUDIO_ADDING",FM="INVALID_REMOVE_AUDIO_ON",BM="INVALID_REMOVE_TRACK_PUBLISHING",jM="INVALID_REMOVE_TRACK_NOT_PUBLISHING",qM="INVALID_REMOVE_TRACK_NUMBER",HM="INVALID_REPLACE_TRACK_NO_TRACK",zM="REPEAT_JOIN",KM="CLIENT_DESTROYED",WM="START_MIX_TRANSCODE_FAILED",YM="STOP_MIX_TRANSCODE_FAILED",JM="MIX_TRANSCODE_NOT_STARTED",ZM="CANNOT_LESS_THAN_ZERO",XM="MIX_PARAMS_VIDEO_FRAMERATE",QM="MIX_PARAMS_VIDEO_GOP",$M="MIX_PARAMS_AUDIO_BITRATE",ek="MIX_PARAMS_USER_Z_ORDER",tk="MIX_PARAMS_NOT_SELF",nk="MIX_PARAMS_USER_STREAM",ik="INVALID_ELEMENT_ID",rk="INVALID_ELEMENT_ID_TYPE",ok="PLAY_FAILED",ak="INVALID_CREATE_STREAM_SOURCE",sk="INVALID_CREATE_STREAM_SCREEN",ck="INVALID_CREATE_STREAM_AUDIO",uk="INVALID_CREATE_STREAM_SCREEN_AUDIO",lk="NOT_SUPPORTED_HTTP",dk="NOT_SUPPORTED_WEBRTC",hk="NOT_SUPPORTED_PROFILE",pk="NOT_SUPPORTED_H264ENCODE",fk="NOT_SUPPORTED_H264DECODE",gk="NOT_SUPPORTED_TRACK",_k="NOT_SUPPORTED_SWITCH_DEVICE",vk="NOT_SUPPORTED_CAPTURE",mk="NOT_SUPPORTED_AUX",yk="MICROPHONE_NOT_FOUND",Ik="CAMERA_NOT_FOUND",Tk="SIGNAL_RESPONSE_FAILED",Ck="CATCH_HANDLER_ERROR",Sk="API_NOT_EXIST",Ek="CONNECTION_CLOSED",bk="SUBSCRIBE_ALL_FALSE",Mk="SEI_NOT_SUPPORT",kk="SEI_DISABLED",wk="SEI_EMPTY",Dk="SEI_OVERSIZE",Ak="SEI_BEFORE_PUBLISH",Rk="SEI_NOT_VIDEO",Lk="CALL_FREQUENCY_LIMIT",Ok="CONNECTION_ABORTED",Nk="API_CALL_ABORTED",xk="DUPLICATE_AUX",Pk={AVOID_REPEATED_CALL:function(e){return"previous ".concat(e.name,"() is ongoing, please avoid repeated calls.")},INVALID_PARAMETER_REQUIRED:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value;return"'".concat(t||n.name,"' is a required param when calling ").concat(i,"(), received: ").concat(r,".")},INVALID_PARAMETER_TYPE:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value,o="".concat(t||n.name),a="";return a=Array.isArray(n.type)?n.type.join("|"):n.type,"'".concat(o,"' must be type of ").concat(a," when calling ").concat(i,"(), received type: ").concat(CD(r),".")},INVALID_PARAMETER_EMPTY:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value;return"'".concat(t||n.name,"' cannot be '").concat(r,"' when calling ").concat(i,"().")},INVALID_PARAMETER_INSTANCE:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value,o="".concat(t||n.name),a="".concat(n.instanceOf.name||n.instanceOf);return"'".concat(o,"' must be instanceof ").concat(a," when calling ").concat(i,"(), received type: ").concat(CD(r),".")},INVALID_PARAMETER_RANGE:function(e){var t=e.key,n=e.rule,i=e.fnName,r=e.value;return"'".concat(t||n.name,"' must be one of ").concat(n.values.join("|")," when calling ").concat(i,"(), received: ").concat(r,".")},API_CALL_TIMEOUT:function(e){return"".concat(e.commandDesc||e.command," timeout observed.")},SIGNAL_CHANNEL_RECONNECTION_FAILED:"signal channel reconnection failed, please check your network.",SIGNAL_CHANNEL_SETUP_FAILED:function(e){return"SignalChannel setup failure: (errorCode: ".concat(e.errorCode,", errorMsg: ").concat(e.errorMsg," }).")},ERROR_MESSAGE:function(e){var t="".concat(e.type," failed");return e.message&&(t="".concat(t,": ").concat(e.message,".")),t},EXCHANGE_SDP_TIMEOUT:"exchange sdp timeout.",DOWNLINK_RECONNECTION_FAILED:"downlink reconnection failed, please check your network and re-join room.",EXCHANGE_SDP_FAILED:function(e){return"exchange sdp failed ".concat(e.errMsg,".")},UPDATE_OFFER_TIMEOUT:"update offer timeout observed.",UPLINK_RECONNECTION_FAILED:"uplink reconnection failed, please check your network and publish again.",INVALID_RECORDID:"recordId must be an integer number.",INVALID_PURE_AUDIO:"pureAudioPushMode must be 1 or 2.",INVALID_STREAMID:"streamId must be a sting literal within 64 bytes, and not be empty.",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty.",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty.",INVALID_PROXY:'proxy server url must start with "wss://".',INVALID_JOIN:"duplicate join() called.",INVALID_ROOMID_STRING:function(e){return"'".concat(e,"' must be validate string when useStringRoomId is true.")},INVALID_ROOMID_INTEGER:function(e){return"'".concat(e,"' must be an integer between [1, 4294967294] when useStringRoomId is false.")},INVALID_SIGNAL_CHANNEL:"SignalChannel is not ready yet.",JOIN_ROOM_TIMEOUT:"join room timeout.",JOIN_ROOM_FAILED:function(e){var t=e.error,n=e.code;return"Failed to join room - ".concat(t," code: ").concat(n)},REJOIN_ROOM_FAILED:function(e){return"reJoin room: ".concat(e.roomId," failed, please check your network.")},INVALID_DESTROY:"please call leave() before destroy().",INVALID_PUBLISH:"please call join() before publish().",INVALID_UNPUBLISH:"stream has not been published yet.",INVALID_AUDIENCE:"no permission to publish() under live/".concat(US,', please call switchRole("').concat(PS,'") firstly before publish().'),INVALID_INITIALIZE:"cannot publish stream because stream is not initialized, is switching device, or has been closed.",INVALID_DUPLICATE_PUBLISHING:function(e){return"duplicate ".concat(e," stream publishing, please unpublish your prev ").concat(e," stream and then re-publish.")},INVALID_SUBSCRIBE_UNDEFINED:"stream is undefined or null.",INVALID_SUBSCRIBE_LOCAL:"stream cannot be LocalStream.",INVALID_REMOTE_STREAM:"remoteStream does not exist because it has been unpublished by remote peer.",SUBSCRIBE_FAILED:function(e){var t=e.message,n=e.stream;return"failed to subscribe ".concat(n.getUserId()," ").concat(n.getType()," stream, reason: ").concat(t,".")},INVALID_ROLE:"switchRole can only be called in live mode.",INVALID_PARAMETER_SWITCH_ROLE:"role could only be set to a value as ".concat(PS," or ").concat(US,"."),INVALID_OPERATION_SWITCH_ROLE:"please call join() before switchRole().",SWITCH_ROLE_TIMEOUT:"switchRole timeout.",SWITCH_ROLE_FAILED:function(e){return"switchRole failed, errCode: ".concat(e.code," errMsg: ").concat(e.message,".")},CLIENT_BANNED:function(e){return"client was banned because of "+e.message+"."},INVALID_OPERATION_START_PUBLISH_CDN:"please call startPublishCDNStream() before client join the room or after client join the room and successfully publish the local stream.",INVALID_OPERATION_STOP_PUBLISH_CDN:"please call startPublishCDNStream() before stopPublishCDNStream().",START_PUBLISH_CDN_FAILED:function(e){return"startPublishCDNStream failed, errMsg: ".concat(e.message,".")},STOP_PUBLISH_CDN_FAILED:function(e){return"stopPublishCDNStream failed, errMsg: ".concat(e.message,".")},INVALID_STREAM_ID:function(e){return"'".concat(e,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.")},START_MIX_TRANSCODE:"please call startMixTranscode() after join().",STOP_MIX_TRANSCODE:"please call stopMixTranscode() after startMixTranscode().",INVALID_AUDIO_VOLUME:"interval must be a number.",ENABLE_SMALL_STREAM_PUBLISHED:"Cannot enable small stream after localStream published.",DISABLE_SMALL_STREAM_PUBLISHED:"Cannot disable small stream after localStream published.",NOT_SUPPORTED_SMALL_STREAM:"your browser does not support opening small stream.",INVALID_SMALL_STREAM_PROFILE:"small stream profile is invalid.",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream is invalid.",INVALID_OPERATION_CHANGE_SMALL:"cannot switch to the small stream without subscribing to the video of remoteStream.",REMOTE_NOT_PUBLISH_SMALL_STREAM:"remote peer does not publish small stream.",INVALID_SWITCH_DEVICE:"cannot switch device on current stream.",INVALID_SWITCH_DEVICE_PUBLISHING:"cannot switch device when publishing localStream.",INVALID_REPLACE_TRACK:"cannot replace track when publishing localStream.",INVALID_INITIALIZE_LOCAL_STREAM:"local stream has not initialized yet.",INVALID_ADD_TRACK_REPETITIVE:"previous addTrack is ongoing, please avoid repetitive execution.",INVALID_ADD_TRACK_REMOVING:"cannot add track when a track is removing.",INVALID_ADD_TRACK_PUBLISHING:"cannot add track when publishing localStream.",INVALID_STREAM_INITIALIZED:"your local stream haven't been initialized yet.",INVALID_ADD_TRACK_NUMBER:"a Stream has at most one audio track and one video track.",INVALID_REMOVE_AUDIO_TRACK:"remove audio track is not supported on your browser.",INVALID_REMOVE_AUDIO_ADDING:"cannot remove track when a track is adding.",INVALID_REMOVE_AUDIO_ON:"previous removeTrack is ongoing, please avoid repetitive execution.",INVALID_REMOVE_TRACK_PUBLISHING:"cannot remove track when publishing localStream.",INVALID_REMOVE_TRACK_NOT_PUBLISHING:"the track to be removed is not being publishing.",INVALID_REMOVE_TRACK_NUMBER:"remove the only video track is not supported, please use replaceTrack or muteVideo.",INVALID_REPLACE_TRACK_NO_TRACK:function(e){return"cannot replace ".concat(e.kind," track because stream has not ").concat(e.kind," track")},START_MIX_TRANSCODE_FAILED:function(e){return"startMixTranscode failed, errMsg: ".concat(e.message,".")},STOP_MIX_TRANSCODE_FAILED:function(e){return"stopMixTranscode failed, errMsg: ".concat(e.message,".")},MIX_TRANSCODE_NOT_STARTED:"mixTranscode has not been started.",CANNOT_LESS_THAN_ZERO:function(e){var t=e.key,n=e.rule,i=e.fnName;return e.value,"'".concat(t||n.name,"' cannot be less than 0 when calling ").concat(i,"().")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_USER_Z_ORDER:function(e){return"'".concat(e,"' is required and must be between 1 and 15.")},MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_PLAY:"duplicate play() call observed, please stop() firstly.",INVALID_ELEMENT_ID:function(e){var t=e.key,n=e.fnName;return"'".concat(t,"' is not found in the document object when calling ").concat(n,"().")},INVALID_ELEMENT_ID_TYPE:function(e){var t=e.key,n=e.fnName,i=e.type;return"the element corresponding to '".concat(t,"' must be instanceof HTMLDivElement when calling ").concat(n,"(), received: ").concat(i,".")},PLAY_FAILED:function(e){return"".concat(e.media," play failed，browser exception: ").concat(e.error.toString())},INVALID_USERID:"userId cannot be all spaces.",INVALID_CREATE_STREAM_SOURCE:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSource, but can not be mixed with audio/video and audioSource/videoSource.",INVALID_CREATE_STREAM_SCREEN:"screen/video cannot be both true.",INVALID_CREATE_STREAM_AUDIO:"audio/screenAudio cannot be both true.",INVALID_CREATE_STREAM_SCREEN_AUDIO:"when screen is true, screenAudio can be configured.",NOT_SUPPORTED_HTTP:"http protocol does not support the ability to capture and publish streams, please use the https protocol.",NOT_SUPPORTED_WEBRTC:"your browser or environment does not support full WebRTC capabilities.",NOT_SUPPORTED_PROFILE:"your browser does not support setVideoProfile.",NOT_SUPPORTED_MEDIA:"your browser or environment does not support navigator.mediaDevices.",NOT_SUPPORTED_H264ENCODE:"your device does not support H.264 encoding.",NOT_SUPPORTED_H264DECODE:"your device does not support H.264 decoding.",NOT_SUPPORTED_TRACK:function(e){return"".concat(e,"Track is not supported on your browser.")},NOT_SUPPORTED_SWITCH_DEVICE:"switchDevice is not supported on your browser.",NOT_SUPPORTED_CAPTURE:"Your browser or environment does not support screen sharing, please check whether the browser version.",MICROPHONE_NOT_FOUND:"no microphone detected, please check your microphone and the configuration on TRTC.createStream.",CAMERA_NOT_FOUND:"no camera detected, please check your camera and the configuration on TRTC.createStream.",SIGNAL_RESPONSE_FAILED:function(e){return"".concat(e.signalResponse," failed, response code is ").concat(e.code," , errMsg: ").concat(e.message,".")},CATCH_HANDLER_ERROR:function(e){var t=e.name,n=e.event;return"an error was caught on ".concat(t,".on('").concat(n,"', handler), please check your code on 'handler'.")},API_NOT_EXIST:function(e){var t=e.name;return"experimental api ".concat(t," does not exist.")},REPEAT_JOIN:function(e){return"[".concat(e,"] is calling client.join api or has already joined room, please avoid repeated join.")},CONNECTION_CLOSED:"remoteStream has been unsubscribed or unpublished by remote user.",SUBSCRIBE_ALL_FALSE:"cannot subscribe when both audio & video are false, use client.unsubscribe() instead",CLIENT_DESTROYED:function(e){var t=e.funName;return"failed to call ".concat(t,"() because client was destroyed.")},SEI_NOT_SUPPORT:function(e){return"not support to sendSEIMessage".concat(!1===e?" without using h264 codec":"")},SEI_DISABLED:"SEI is disabled, to enable SEI: TRTC.createClient({ enableSEI: true })",SEI_EMPTY:"buffer cannot be empty",SEI_OVERSIZE:function(e){return"buffer size(".concat(e,") is over 1000 Bytes")},SEI_BEFORE_PUBLISH:"please call sendSEIMessage() after publish() success",SEI_NOT_VIDEO:"cannot send sei when localStream has not video.",CALL_FREQUENCY_LIMIT:function(e){var t=e.isSize,n=e.name,i=e.timesInSecond,r=e.maxSizeInSecond;return"api ".concat(n," call ").concat(t?"size":"times"," is over ").concat(t?r+" bytes":i," in a second.")},CONNECTION_ABORTED:function(e){return"connection aborted due to: "+e},API_CALL_ABORTED:function(e){return e.message.includes("REMOTE_STREAM_NOT_EXIST")?"Subscribe ".concat(e.stream.getUserId()," ").concat(e.stream.getType()," stream aborted, reason: remote user ").concat(e.stream.getUserId()," unpublished stream."):"API aborted, reason: ".concat(e.message)},DUPLICATE_AUX:"only one auxiliary stream can be published in a room.",NOT_SUPPORTED_AUX:"publish auxiliary stream is not supported on your browser."},Uk=D,Gk=R,Vk=Sl,Fk=pm.trim,Bk=te("".charAt),jk=Uk.parseFloat,qk=Uk.Symbol,Hk=qk&&qk.iterator,zk=1/jk("\t\n\v\f\r                　\u2028\u2029\ufeff-0")!=-1/0||Hk&&!Gk((function(){jk(Object(Hk))}))?function(e){var t=Fk(Vk(e)),n=jk(t);return 0===n&&"-"==Bk(t,0)?-0:n}:jk;br({global:!0,forced:parseFloat!=zk},{parseFloat:zk});var Kk=window.navigator&&window.navigator.userAgent||"",Wk=/AppleWebKit\/([\d.]+)/i.exec(Kk);Wk&&parseFloat(Wk.pop());var Yk=/iPad/i.test(Kk),Jk=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/Macintosh/.test(Kk),Zk=/iPhone/i.test(Kk)&&!Yk,Xk=/iPod/i.test(Kk),Qk=Zk||Yk||Xk||Jk,$k=/Android/i.test(Kk);$k&&function(){var e=Kk.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}(),$k&&/webkit/i.test(Kk);var ew=/Firefox/i.test(Kk),tw=ew&&function(){var e=Kk.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),nw=/Edge\//i.test(Kk),iw=nw&&function(){var e=Kk.match(/Edge\/(\d+)/i);if(e&&e[1])return e[1]}(),rw=/Edg\//i.test(Kk),ow=rw&&function(){var e=Kk.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),aw=/SogouMobileBrowser\//i.test(Kk),sw=aw&&function(){var e=Kk.match(/SogouMobileBrowser\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),cw=/MetaSr\s/i.test(Kk),uw=cw&&function(){var e=Kk.match(/MetaSr(\s\d+(\.\d+)+)/);return e&&e[1]?parseFloat(e[1]):null}(),lw=/TBS\/\d+/i.test(Kk),dw=lw&&function(){var e=Kk.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),hw=/XWEB\/\d+/i.test(Kk),pw=hw&&function(){var e=Kk.match(/XWEB\/(\d+)/i);if(e&&e[1])return e[1]}();/MSIE\s8\.0/.test(Kk),/MSIE\/\d+/i.test(Kk)&&function(){var e=/MSIE\s(\d+)\.\d/.exec(Kk),t=e&&parseFloat(e[1]);!t&&/Trident\/7.0/i.test(Kk)&&/rv:11.0/.test(Kk)&&(t=11)}();var fw=/(micromessenger|webbrowser)/i.test(Kk),gw=fw&&function(){var e=Kk.match(/MicroMessenger\/(\d+)/i);if(e&&e[1])return e[1]}(),_w=!lw&&/MQQBrowser\/\d+/i.test(Kk)&&/COVC\/\d+/i.test(Kk),vw=!lw&&/MQQBrowser\/\d+/i.test(Kk)&&!/COVC\/\d+/i.test(Kk),mw=(vw||_w)&&function(){var e=Kk.match(/ MQQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),yw=!lw&&/ QQBrowser\/\d+/i.test(Kk),Iw=yw&&function(){var e=Kk.match(/ QQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Tw=!lw&&/QQBrowserLite\/\d+/i.test(Kk),Cw=Tw&&function(){var e=Kk.match(/QQBrowserLite\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Sw=!lw&&/MQBHD\/\d+/i.test(Kk),Ew=Sw&&function(){var e=Kk.match(/MQBHD\/([\d.]+)/);return e&&e[1]?e[1]:null}(),bw=/Windows/i.test(Kk),Mw=!Qk&&/MAC OS X/i.test(Kk),kw=!$k&&/Linux/i.test(Kk);/MicroMessenger/i.test(Kk);var ww=/UCBrowser/i.test(Kk);/Electron/i.test(Kk);var Dw,Aw,Rw=/MiuiBrowser/i.test(Kk),Lw=Rw&&function(){var e=Kk.match(/MiuiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Ow=/HuaweiBrowser/i.test(Kk),Nw=/Huawei/i.test(Kk),xw=Ow&&function(){var e=Kk.match(/HuaweiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Pw=/SamsungBrowser/i.test(Kk),Uw=Pw&&function(){var e=Kk.match(/SamsungBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Gw=/HeyTapBrowser/i.test(Kk),Vw=Gw&&function(){var e=Kk.match(/HeyTapBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Fw=/VivoBrowser/i.test(Kk),Bw=Fw&&function(){var e=Kk.match(/VivoBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),jw=function(){var e=Kk.match(/Chrome\/(\d+)/);return e&&e[1]?Number(e[1]):null},qw=/Chrome/i.test(Kk),Hw=!nw&&!cw&&!aw&&!lw&&!hw&&!rw&&!yw&&!Rw&&!Ow&&!Pw&&!Gw&&!Fw&&/Chrome/i.test(Kk),zw=Hw&&jw(),Kw=Hw&&function(){var e=Kk.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Ww=!qw&&!vw&&!_w&&!Tw&&!Sw&&/Safari/i.test(Kk),Yw=function(){if(Ww){var e=Kk.match(/Version\/([\d.]+)/);if(e&&e[1])return e[1]}return""}(),Jw=/Android.*(wv|.0.0.0)/.test(Kk),Zw=function(){if(Jk)return Yw;if(Qk){var e=Kk.match(/OS (\d+)_(\d+)/i);if(e&&e[1]){var t=e[1];return e[2]&&(t+=".".concat(e[2])),t}}return""}(),Xw="15.1"===Yw,Qw="15.1"===Zw,$w=14===(Dw=Number(Zw.split(".")[0]))||13===Dw,eD="file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname,tD=function(){if(gD(Aw))try{Aw=window.localStorage}catch(qY){UA.warn(qY),Aw=!1}return Aw},nD=new Map([[ew,["Firefox",tw]],[rw,["Edg",ow]],[Hw,["Chrome",Kw]],[Ww,["Safari",Yw]],[lw,["TBS",dw]],[hw,["XWEB",pw]],[fw&&Zk,["WeChat",gw]],[yw,["QQ(Win)",Iw]],[vw,["QQ(Mobile)",mw]],[_w,["QQ(Mobile X5)",mw]],[Tw,["QQ(Mac)",Cw]],[Sw,["QQ(iPad)",Ew]],[Rw,["MI",Lw]],[Ow,["HW",xw]],[Pw,["Samsung",Uw]],[Gw,["OPPO",Vw]],[Fw,["VIVO",Bw]],[nw,["EDGE",iw]],[aw,["SogouMobile",sw]],[cw,["Sogou",uw]]]);function iD(){var e="unknown",t="unknown";return nD.get(!0)&&(e=nD.get(!0)[0],t=nD.get(!0)[1]),{name:e,version:t}}var rD=function(e,t){return t?ub+"/"+e+"/"+t:ub+"/"+e+"/index.html"},oD=function(){if(!tD())return!1;var e=localStorage.getItem(db);e&&!function(e){var t=e.saveTime&&(new Date).getTime()-e.saveTime>=WE,n=!e.saveVersion||e.saveVersion!==Ko;return t||n}(JSON.parse(e))||(UA.info("init debug info"),function(){var e=new XMLHttpRequest;if(e.open("GET","https://web.sdk.qcloud.com/trtc/webrtc/download/error-message/0.0.3/script.js",!1),e.send(null),4===e.readyState&&200===e.status){var t=document.createElement("script");t.type="text/javascript",t.text=e.responseText,document.body.appendChild(t),localStorage.setItem(db,JSON.stringify({message:e.responseText,saveTime:(new Date).getTime(),saveVersion:Ko})),document.body.removeChild(t)}}())};function aD(e){var t=e.key,n=e.data,i=e.link,r=e.addDocLink,o=void 0===r||r,a="",s="",c="";fD(Pk[t])?a=Pk[t](n):_D(Pk[t])&&(a=Pk[t]);var u=function(){if(window.TRTC_ERROR_INFO&&window.TRTC_ERROR_LINK)return{TRTC_ERROR_INFO:window.TRTC_ERROR_INFO,TRTC_ERROR_LINK:window.TRTC_ERROR_LINK};var e=localStorage.getItem(db);if(e){e=JSON.parse(e);var t=document.createElement("script");t.type="text/javascript",t.text=e.message,document.body.appendChild(t);var n=window.TRTC_ERROR_INFO,i=window.TRTC_ERROR_LINK;return document.body.removeChild(t),{TRTC_ERROR_INFO:n,TRTC_ERROR_LINK:i}}return{}}(),l=u.TRTC_ERROR_INFO,d=u.TRTC_ERROR_LINK;i?c="".concat(i.className,".html#").concat(i.fnName):d&&d[t]&&(fD(d[t])?c=d[t](n):_D(d[t])&&(c=d[t]));var h=a;return wD()&&(l&&l[t]&&(fD(l[t])?s=l[t](n):_D(l[t])&&(s=l[t])),s&&(h=o?s+"\n请查看文档: "+rD("zh-cn",c)+"\n\n":s+"\n\n",h+=a)),o&&(h+=" \nRefer to: "+rD("en",c)+"\n"),h}var sD=function(){return function(e){var t=window.location.search.match(new RegExp("(\\?|&)"+e+"=([^&]*)(&|$)"));return t?decodeURIComponent(t[2]):""}("trtc_env")},cD=function(e){return(e=Number(e))>0&&e<14e8},uD=function(e,t){var n;n=MS?MS.includes("http")?MS:"https://"+MS:cD(e)?"https://apisgp.my-imcloud.com":"https://yun.tim.qq.com";var i=Math.floor(Math.random()*Math.pow(2,31));return"".concat(n,"/v5/AVQualityReportSvc/C2S?random=").concat(i,"&sdkappid=").concat(e,"&cmdtype=").concat(t)};function lD(){var e=navigator.userAgent,t=navigator.connection,n=e.match(/NetType\/\w+/)?e.match(/NetType\/\w+/)[0]:"";"3gnet"===(n=n.toLowerCase().replace("nettype/",""))&&(n="3g");var i=t&&t.type&&t.type.toLowerCase(),r=t&&t.effectiveType&&t.effectiveType.toLowerCase();"slow-2"===r&&(r="2g");var o=n||"unknown";if(i)switch(i){case"cellular":case"wimax":o=r||"unknown";break;case"wifi":o="wifi";break;case"ethernet":o="wired";break;case"none":case"other":case"unknown":o="unknown"}return o}var dD=function(e){if(!e||"object"!==r(e)||"[object Object]"!=Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)};function hD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<=1?n:hD(e-1,n,t+n)}function pD(e){var t=Math.round(e/2)+1;return t>6?13e3:1e3*hD(t)}var fD=function(e){return"function"==typeof e},gD=function(e){return void 0===e},_D=function(e){return"string"==typeof e},vD=function(e){return"number"==typeof e},mD=function(e){return"boolean"==typeof e},yD=function(e){return"object"===CD(e)},ID=function(e){return"array"===CD(e)},TD=function(e){return CD(e)==="MediaStreamTrack".toLowerCase()};function CD(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}function SD(e){var t={};return t.urls="turn:".concat(e.url),gD(e.username)||gD(e.credential)||(t.username=e.username,t.credential=e.credential,t.credentialType="password",gD(e.credentialType)||(t.credentialType=e.credentialType)),t}function ED(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}function bD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"big";if(!_D(e))return 0;var n=e.split(".");return"big"===t?(Number(n[0])<<24|Number(n[1])<<16|Number(n[2])<<8|Number(n[3]))>>>0:(Number(n[3])<<24|Number(n[2])<<16|Number(n[1])<<8|Number(n[0]))>>>0}var MD,kD,wD=function(){var e=navigator.language||navigator.userLanguage;return"zh"===e.substr(0,2)},DD=(MD=!1,kD=document.visibilityState,function(){document.visibilityState!==kD&&UA.info("visibility change: ".concat(document.visibilityState)),MD||(document.addEventListener("visibilitychange",(function(){UA.info("visibility change: "+document.visibilityState),kD=document.visibilityState})),MD=!0)});window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var AD=function(){return new window.AudioContext},RD=function(){var e;return function(){return e||(e=new window.AudioContext,e.onstatechange=function(){UA.info("gain context state: ".concat(e.state)),"suspended"===e.state?(e.resume(),document.addEventListener("click",e.resume)):"interrupted"===e.state?e.resume():document.removeEventListener("click",e.resume)},e)}}(),LD=!!window.AudioWorkletNode,OD=function(e,t){var n=e.emit;return e.emit=function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];try{n.apply(e,r)}catch(qY){var a=aD({key:Ck,data:{name:t,event:r[0]},addDocLink:!1});UA.warn(a+"\n\n"+qY.stack)}},e},ND=function(e){return+e<10?"0".concat(e):e},xD=function(e){var t=e.match(/^\d+\.\d+\.\d+/)[0];if(!t)return e;var n=t.split("."),i=ND(n[1])+ND(n[2]);return n[1]-15>0&&(n[1]="15"),n[2]-15>0&&(n[2]="15"),n.join(".")+"."+i};function PD(e){var t=e.url,n=e.body,i=e.method,r=e.timeout,o=new XMLHttpRequest;return new Promise((function(e,a){o.onload=function(t){if(o.status>=200&&o.status<300&&o.responseText.length>0)try{var n=JSON.parse(o.response);e({data:n})}catch(qY){e({data:o.response})}else o.status>0&&a({code:o.status,message:"request failed, readyState:".concat(o.readyState," status:").concat(o.status," loaded size:").concat(t.loaded)})};var s=function(e){a({code:o.readyState,message:"request ".concat(e.type,", readyState:").concat(o.readyState," status:").concat(o.status," loaded size:").concat(e.loaded)})};o.onerror=s,o.onabort=s,o.ontimeout=s,o.timeout=r||5e3,o.open(i||"POST",t,!0),o.send(n)}))}var UD={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,o),!0;case 6:return l.fn.call(l.context,t,i,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,r);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||r&&!s[c].once||i&&s[c].context!==i)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(UD);var GD=UD.exports,VD=new GD,FD=1,BD=2,jD=3,qD=4,HD=5,zD=20,KD=21,WD=22,YD=23,JD=24,ZD=27,XD=28,QD=29,$D=30,eA=33,tA=31,nA=32,iA=100,rA=101,oA=102,aA=103,sA=110,cA=111,uA=112,lA=113,dA=114,hA=115,pA=116,fA=120,gA=121,_A=122,vA=123,mA=130,yA=131,IA=132,TA=133,CA=134,SA=135,EA=136,bA=137,MA=200,kA=201,wA=300,DA=301,AA=302,RA=303;function LA(e){var t=e.retryFunction,n=e.settings,r=e.onError,o=e.onRetrying,s=e.onRetryFailed,c=e.context;return function(){for(var e=this,u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];var h=n.retries||5,p=0,f=-1,g=0,_=function(){var u=a(i().mark((function a(u,d){var v,m,y,I;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return v=c||e,i.prev=1,i.next=4,t.apply(v,l);case 4:m=i.sent,p=0,u(m),i.next=14;break;case 9:i.prev=9,i.t0=i.catch(1),y=function(){clearTimeout(f),p=0,g=2,d(i.t0)},I=function(){2!==g&&p<h?(p++,g=1,fD(o)&&o.call(v,p,y),f=setTimeout((function(){f=-1,_(u,d)}),gD(n.timeout)?1e3:n.timeout)):(y(),fD(s)&&s.call(v,i.t0))},fD(r)?r.call(v,i.t0,I,d,l):I();case 14:case"end":return i.stop()}}),a,null,[[1,9]])})));return function(e,t){return u.apply(this,arguments)}}();return new Promise(_)}}var OA=u((function e(t){s(this,e),this.log=t.log,this.level=t.level,this.userId=t.userId,this.sdkAppId=t.sdkAppId,this.forAllJoinedClients=t.forAllJoinedClients,this.uploaded=!1})),NA=function(){function e(t){s(this,e),this.id_=t.id,this.userId_=t.userId,this.sdkAppId_=t.sdkAppId,this.type_=t.type,this.isLocal_=!mD(t.isLocal)||t.isLocal}return u(e,[{key:"setUserId",value:function(e){this.userId_=e}},{key:"setSdkAppId",value:function(e){this.sdkAppId_=e}},{key:"log",value:function(e,t){UA.log({log:"[".concat(this.isLocal_?"↑":"↓").concat(this.id_,"] ").concat(this.type_?this.type_+" ":"").concat(t),level:e,forAllJoinedClients:gD(this.userId_),userId:this.userId_,sdkAppId:this.sdkAppId_})}},{key:"info",value:function(e){this.log(fb.INFO,e)}},{key:"debug",value:function(e){this.log(fb.DEBUG,e)}},{key:"warn",value:function(e){this.log(fb.WARN,e)}},{key:"error",value:function(e){this.log(fb.ERROR,e)}}]),e}(),xA=!(Qk||$k),PA=function(){function e(){var t=this;s(this,e),this.clients_=new Set,this.queue_=[],this.timeoutId_=-1,this.logLevel_=fb.DEBUG,this.logLevelToUpload_=fb.INFO,this.enableUploadLog_=!0,this.isAbleToUpload_=!1,this.checkURLParam(),VD.on($D,(function(e){var n=e.client;-1===t.timeoutId_&&t.startUpload(),t.clients_.add(n)})),VD.on(eA,(function(e){var n=e.client;return t.clients_.delete(n)})),VD.on(tA,(function(e){e&&dD(e.config)&&gb[e.config.logLevelToUpload]&&(t.logLevelToUpload_=e.config.logLevelToUpload)})),VD.on(qD,this.setIsAbleToUpload,this),VD.on(HD,this.setIsAbleToUpload,this)}var t,n;return u(e,[{key:"getIsAbleToUpload",value:function(){return this.isAbleToUpload_}},{key:"setIsAbleToUpload",value:function(){this.isAbleToUpload_=!0,VD.off(qD,this.setIsAbleToUpload,this),VD.off(HD,this.setIsAbleToUpload,this)}},{key:"startUpload",value:(n=a(i().mark((function e(){var t=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upload();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:this.timeoutId_=setTimeout((function(){return t.startUpload()}),2e3);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return n.apply(this,arguments)})},{key:"getLogsToUpload",value:function(){var e=this,t={map:new Map,splicedQueue:[]};if(this.queue_[0].forAllJoinedClients&&0===this.clients_.size)return t;for(var n=0,i=function(){if(50===n)return"break";var i=e.queue_[n];i.forAllJoinedClients?e.clients_.forEach((function(e){if(e.getIsJoined()){var n=e.getUserId(),r=e.getSDKAppId();t.map.has(n)?t.map.get(n).logs.push(i):t.map.set(n,{userId:n,sdkAppId:r,logs:[i]})}})):t.map.has(i.userId)?t.map.get(i.userId).logs.push(i):t.map.set(i.userId,{userId:i.userId,sdkAppId:i.sdkAppId,logs:[i]})};n<this.queue_.length;n++)if("break"===i())break;return t.map.size>0&&(t.splicedQueue=this.queue_.splice(0,n)),t}},{key:"upload",value:(t=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.queue_.length&&this.isAbleToUpload_){e.next=2;break}return e.abrupt("return");case 2:if(t=this.getLogsToUpload(),n=t.map,r=t.splicedQueue,0!==n.size){e.next=5;break}return e.abrupt("return");case 5:e.prev=5,o=C(n.values()),a=0;case 8:if(!(a<o.length)){e.next=16;break}return s=o[a],c=s.userId,u=s.sdkAppId,l=s.logs,e.next=12,this.uploadLogWithRetry(JSON.stringify({timestamp:rv(),sdkAppId:String(u),userId:c,version:Ko,log:l.map((function(e){return e.log})).join("\n")}),u);case 12:l.forEach((function(e){return e.uploaded=!0}));case 13:a++,e.next=8;break;case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(5);case 20:d=r.filter((function(e){return!e.uploaded})),d.length>0&&(this.queue_=d.concat(this.queue_));case 22:case"end":return e.stop()}}),e,this,[[5,18]])}))),function(){return t.apply(this,arguments)})},{key:"uploadLogWithRetry",value:function(e,t){return LA({retryFunction:function(){return PD({url:uD(t,kS),body:e,timeout:5e3})},settings:{retries:3,timeout:1e3},onError:function(e,t){t()}})()}},{key:"getPrefix",value:function(e){var t=new Date;return t.setTime(iv()),String.prototype.padStart?"[".concat(t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(t.getMilliseconds().toString().padStart(3,"0"),"] <").concat(gb[e],">"):"[".concat(t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(t.getMilliseconds(),"] <").concat(gb[e],">")}},{key:"getLogLevel",value:function(){return this.logLevel_}},{key:"setLogLevel",value:function(e){gD(gb[e])||(this.logLevel_!==e&&this.info("setLogLevel ".concat(e)),this.logLevel_=e)}},{key:"enableUploadLog",value:function(){this.enableUploadLog_=!0}},{key:"disableUploadLog",value:function(){this.enableUploadLog_=!1}},{key:"log",value:function(e){var t=e.log,n=e.level,i=e.forAllJoinedClients,r=void 0===i||i,o=e.userId,a=e.sdkAppId;if(t="".concat(this.getPrefix(n)," ").concat(t),this.enableUploadLog_&&n>=this.logLevelToUpload_&&this.queue_.push(new OA({log:t,level:n,userId:o,sdkAppId:a,forAllJoinedClients:r})),!(n<this.logLevel_)){var s=gb[n]?gb[n].toLowerCase():"info";xA?console[s]("%cTRTC%c%s","padding: 1px 4px;border-radius: 3px;color: #fff;background: #1E88E5;","display: inline",t):console[s](t)}}},{key:"debug",value:function(e){this.log({log:e,level:fb.DEBUG})}},{key:"info",value:function(e){this.log({log:e,level:fb.INFO})}},{key:"warn",value:function(e){this.log({log:e,level:fb.WARN})}},{key:"error",value:function(e){this.log({log:e,level:fb.ERROR})}},{key:"createLogger",value:function(e){return new NA(e)}},{key:"checkURLParam",value:function(){var e=new URLSearchParams(location.search).get("logLevelToUpload");gb[e]&&(this.logLevelToUpload_=e)}}]),e}(),UA=new PA,GA=!0,VA=Ie,FA=Math.floor,BA=Number.isInteger||function(e){return!VA(e)&&isFinite(e)&&FA(e)===e};br({target:"Number",stat:!0},{isInteger:BA});var jA,qA=br,HA=te,zA=A.f,KA=xi,WA=Sl,YA=Km,JA=le,ZA=Ym,XA=HA("".startsWith),QA=HA("".slice),$A=Math.min,eR=ZA("startsWith");qA({target:"String",proto:!0,forced:!(!eR&&(jA=zA(String.prototype,"startsWith"),jA&&!jA.writable))&&!eR},{startsWith:function(e){var t=WA(JA(this));YA(e);var n=KA($A(arguments.length>1?arguments[1]:void 0,t.length)),i=WA(e);return XA?XA(t,i,n):QA(t,n,n+i.length)===i}});var tR=L,nR=te,iR=P,rR=R,oR=Zo,aR=Qi,sR=U,cR=ht,uR=ae,lR=Object.assign,dR=Object.defineProperty,hR=nR([].concat),pR=!lR||rR((function(){if(tR&&1!==lR({b:1},lR(dR({},"a",{enumerable:!0,get:function(){dR(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=lR({},e)[n]||oR(lR({},t)).join("")!=i}))?function(e,t){for(var n=cR(e),i=arguments.length,r=1,o=aR.f,a=sR.f;i>r;)for(var s,c=uR(arguments[r++]),u=o?hR(oR(c),o(c)):oR(c),l=u.length,d=0;l>d;)s=u[d++],tR&&!iR(a,c,s)||(n[s]=c[s]);return n}:lR,fR=pR;br({target:"Object",stat:!0,arity:2,forced:Object.assign!==fR},{assign:fR});var gR=te,_R=Ye,vR=Ie,mR=gt,yR=sd,IR=O,TR=Function,CR=gR([].concat),SR=gR([].join),ER={},bR=function(e,t,n){if(!mR(ER,t)){for(var i=[],r=0;r<t;r++)i[r]="a["+r+"]";ER[t]=TR("C,a","return new C("+SR(i,",")+")")}return ER[t](e,n)},MR=IR?TR.bind:function(e){var t=_R(this),n=t.prototype,i=yR(arguments,1),r=function(){var n=CR(i,yR(arguments));return this instanceof r?bR(t,n.length,n):t.apply(e,n)};return vR(n)&&(r.prototype=n),r},kR=MR;br({target:"Function",proto:!0,forced:Function.bind!==kR},{bind:kR});var wR=br,DR=Xd.findIndex,AR=ba,RR="findIndex",LR=!0;RR in[]&&Array(1).findIndex((function(){LR=!1})),wR({target:"Array",proto:!0,forced:LR},{findIndex:function(e){return DR(this,e,arguments.length>1?arguments[1]:void 0)}}),AR(RR);var OR=L,NR=te,xR=Zo,PR=pe,UR=NR(U.f),GR=NR([].push),VR=function(e){return function(t){for(var n,i=PR(t),r=xR(i),o=r.length,a=0,s=[];o>a;)n=r[a++],OR&&!UR(i,n)||GR(s,e?[n,i[n]]:i[n]);return s}},FR={entries:VR(!0),values:VR(!1)}.values;br({target:"Object",stat:!0},{values:function(e){return FR(e)}});var BR=1,jR=5,qR=2,HR=3,zR=4,KR="DISCONNECTED",WR="CONNECTING",YR="RECONNECTING",JR="CONNECTED",ZR={CLIENT_BANNED:9,CHANNEL_SETUP_RESULT:19,CHANNEL_RECONNECT_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:4134,PEER_LEAVE:4135,STREAM_ADDED:16,STREAM_REMOVED:18,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,PUBLISH_RESULT:4098,PUBLISH_STATE_CHANGE_RESULT:4112,UNPUBLISH_RESULT:4100,SUBSCRIBE_RESULT:4102,UNSUBSCRIBE_RESULT:4104,SUBSCRIBE_CHANGE_RESULT:4106,MUTE_RESULT:4108,UPDATE_OFFER_RESULT:4128,START_PUBLISH_TENCENT_CDN_RES:1286,STOP_PUBLISH_TENCENT_CDN_RES:1288,START_PUBLISH_GIVEN_CDN_RES:777,STOP_PUBLISH_GIVEN_CDN_RES:779,START_MIX_TRANSCODE_RES:781,STOP_MIX_TRANSCODE_RES:783,USER_LIST_RES:4137,SWITCH_ROLE_RES:4110,UPDATE_CONSTRAINT_CONFIG_RES:772},XR=[ZR.UPDATE_REMOTE_MUTE_STAT,ZR.UPLINK_NETWORK_STATS,ZR.USER_LIST_RES,ZR.MUTE_RESULT],QR={CLIENT_BANNED:"client-banned",CHANNEL_SETUP_RESULT:"channel-setup-result",CHANNEL_RECONNECT_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",PUBLISH_RESULT:"publish-result",PUBLISH_STATE_CHANGE_RESULT:"publish-state-change-result",UNPUBLISH_RESULT:"unpublish-result",SUBSCRIBE_RESULT:"subscribe-result",SUBSCRIBE_CHANGE_RESULT:"subscribe-change-result",UNSUBSCRIBE_RESULT:"unsubscribe-result",UPDATE_OFFER_RESULT:"update-offer-result",START_PUBLISH_TENCENT_CDN_RES:"start-publish-tencent-cdn-res",STOP_PUBLISH_TENCENT_CDN_RES:"stop-publish-tencent-cdn-res",START_PUBLISH_GIVEN_CDN_RES:"start-publish-given-cdn-res",STOP_PUBLISH_GIVEN_CDN_RES:"stop-publish-given-cdn-res",START_MIX_TRANSCODE_RES:"start-mix-transcode-res",STOP_MIX_TRANSCODE_RES:"stop-mix-transcode-res",USER_LIST_RES:"user-list-res",SWITCH_ROLE_RES:"switch_role_res",MUTE_RESULT:"mute-result",UPDATE_CONSTRAINT_CONFIG_RES:"update-contraint-config-res"},$R="publish_change",eL="publish_state_change",tL="join",nL="leave",iL="quality_report",rL="mute_uplink",oL="publish",aL="unpublish",sL="subscribe",cL="unsubscribe",uL="subscribe_change",lL="start_publishing",dL="stop_publishing",hL="start_push_user_cdn",pL="stop_push_user_cdn",fL="start_mcu_mix",gL="stop_mcu_mix",_L="get_user_list",vL="change_role",mL="update_constraint_config",yL={INVALID_PARAMETER:4096,INVALID_OPERATION:4097,NOT_SUPPORTED:4098,DEVICE_NOT_FOUND:4099,INITIALIZE_FAILED:4100,SIGNAL_CHANNEL_SETUP_FAILED:16385,SIGNAL_CHANNEL_ERROR:16386,ICE_TRANSPORT_ERROR:16387,JOIN_ROOM_FAILED:16388,CREATE_OFFER_FAILED:16389,SIGNAL_CHANNEL_RECONNECTION_FAILED:16390,UPLINK_RECONNECTION_FAILED:16391,DOWNLINK_RECONNECTION_FAILED:16392,REMOTE_STREAM_NOT_EXIST:16400,CLIENT_BANNED:16448,SERVER_TIMEOUT:16449,SUBSCRIPTION_TIMEOUT:16450,PLAY_NOT_ALLOWED:16451,DEVICE_AUTO_RECOVER_FAILED:16452,START_PUBLISH_CDN_FAILED:16453,STOP_PUBLISH_CDN_FAILED:16454,START_MIX_TRANSCODE_FAILED:16455,STOP_MIX_TRANSCODE_FAILED:16456,NOT_SUPPORTED_H264:16457,SWITCH_ROLE_FAILED:16458,API_CALL_TIMEOUT:16459,SCHEDULE_FAILED:16460,API_CALL_ABORTED:16461,UNKNOWN:65535},IL=function(e){d(n,e);var t=m(n);function n(e){var i,r=e.name,o=void 0===r?"RtcError":r,a=e.message,c=e.code,u=void 0===c?yL.UNKNOWN:c,l=e.extraCode,d=void 0===l?0:l,h=e.constraint;s(this,n);var p="<".concat(function(e){for(var t in yL)if(yL[t]===e)return t;return"UNKNOWN"}(u)," 0x").concat(u.toString(16),">");return(i=t.call(this,a+"".concat(h?" constraint: ".concat(h):"")+"".concat(null!=a&&a.includes(p)?"":" "+p))).code_=u,i.extraCode_=d,i.name=o,i.message_=a,h&&(i.constraint=h),i}return u(n,[{key:"getCode",value:function(){return this.code_}},{key:"getExtraCode",value:function(){return this.extraCode_}}]),n}(_(Error)),TL=32768,CL=32769,SL=32770,EL=32771,bL=32772,ML=32773,kL=32774,wL=32775,DL=32777,AL=32778,RL=32779,LL=32780,OL=32781,NL=32782,xL=32783,PL=32784,UL=32785,GL=32786,VL=32787,FL=32788,BL=32789,jL=32790,qL=32791,HL=32792,zL=32793,KL=32794,WL=32795,YL=32796,JL=32797,ZL=32798,XL=32799,QL=32800,$L=32801,eO=32802,tO=32803,nO=32804,iO=new Map,rO=function(e,t){var n=iO.get(e);n||(iO.set(e,[]),n=iO.get(e)),n.push(t)},oO=function(e){var t=iO.get(e),n=[];return t?(iO.delete(e),n=t.map((function(e){return{uint32_event_id:e.eventId,uint64_date:e.timestamp,str_userid:e.remoteUserId,str_event_json:e.eventDesc}}))):n=[],n},aO=Object.prototype.hasOwnProperty;function sO(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(dD(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(var t in e)if(aO.call(e,t))return!1;return!0}return!1}var cO=function(){function e(){s(this,e);var t=iD(),n=t.name,i=t.version;this.roomIdMap_=new Map,this.configs_={sdkAppId:"",userId:"",version:Ko,env:SS,browserVersion:n+i,ua:navigator.userAgent}}return u(e,[{key:"setConfig",value:function(e){var t=e.sdkAppId,n=e.env,i=e.userId,r=e.roomId;t!==this.configs_.sdkAppId&&(this.configs_.sdkAppId=String(t)),this.configs_.env=n,this.configs_.userId=i,this.roomIdMap_.set(i,String(r))}},{key:"logEvent",value:function(e){if(!eD){var n=t(t(t({},e),this.configs_),{},{userId:e.userId||this.configs_.userId});gD(n.code)&&(n.code="failed"===n.result?yL.UNKNOWN:0),this.sendRequest(uD(this.configs_.sdkAppId,wS),n)}}},{key:"logSuccessEvent",value:function(e){eD||(this.logEvent(t(t({},e),{},{result:"success",roomId:this.roomIdMap_.get(e.userId)})),this.configs_.env===SS&&this.uploadEventToKibana(t(t({},e),{},{result:"success"})))}},{key:"logFailedEvent",value:function(e){if(!eD){var n=e.eventType,i=e.code,r=e.error,o=e.userId,a={roomId:this.roomIdMap_.get(o),userId:o,eventType:n,result:"failed",code:i||(r instanceof IL?r.getExtraCode()||r.getCode():yL.UNKNOWN)};this.logEvent(a),this.configs_.env===SS&&this.uploadEventToKibana(t(t({},a),{},{error:r}))}}},{key:"uploadEventToKibana",value:function(e){var t="stat-".concat(e.eventType,"-").concat(e.result);"delta-join"!==e.eventType&&"delta-leave"!==e.eventType&&"delta-publish"!==e.eventType||(t="".concat(e.eventType,":").concat(e.delta)),this.uploadEvent({log:t,userId:e.userId}),"failed"===e.result&&(t="stat-".concat(e.eventType,"-").concat(e.result,"-").concat(e.code),this.uploadEvent({log:t,userId:e.userId,error:e.error}))}},{key:"uploadEvent",value:function(e){var t=e.log,n=e.userId,i=e.error,r={timestamp:rv(),sdkAppId:this.configs_.sdkAppId,userId:n||this.configs_.userId,version:this.configs_.version,log:t};i&&(r.errorInfo=i.message),this.sendRequest(uD(this.configs_.sdkAppId,kS),r)}},{key:"sendRequest",value:function(e,t){var n=this;UA.getIsAbleToUpload()?PD({url:e,body:JSON.stringify(t)}).catch((function(){})):setTimeout((function(){n.sendRequest(e,t)}),1e3)}}]),e}(),uO=new cO,lO=function(){function e(t){s(this,e),this.client_=t.client,this.sdkAppId_=t.sdkAppId,this.userId_=t.userId,this.userSig_=t.userSig,this.url_=t.url,this.backupUrl_=t.backupUrl;var n="?sdkAppId=".concat(encodeURIComponent(this.sdkAppId_),"&userId=").concat(encodeURIComponent(this.userId_),"&userSig=").concat(encodeURIComponent(this.userSig_),"&roomId=").concat(t.roomId),i=this.client_.getSystemResult();if(i&&i.detail){var r=i.detail,o=r.isH264EncodeSupported,a=r.isVp8EncodeSupported,c=r.isH264DecodeSupported,u=r.isVp8DecodeSupported;n+="&enc264=".concat(Number(o),"&dec264=").concat(Number(c),"&encVp8=").concat(Number(a),"&decVp8=").concat(Number(u))}t.signalDomainWhenUnifiedProxy&&(n+="&signalDomain=".concat(t.signalDomainWhenUnifiedProxy)),this.urlWithParam_="".concat(this.url_).concat(n),this.backupUrlWithParam_="".concat(this.backupUrl_).concat(n),this.isConnected_=!1,this.isConnecting_=!1,this.socketInUse_=null,this.socket_=null,this.backupSocket_=null,this.backupTimer_=-1,this.signalInfo_={},this.currentState_=KR,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.lastMessageTime_=-1,this.seq_=0,this.log_=UA.createLogger({id:"ws|"+this.userId_,userId:this.userId_,sdkAppId:this.sdkAppId_}),this.emitter_=new GD}return u(e,[{key:"isOnline",get:function(){return this.currentState_===JR&&Date.now()-this.lastMessageTime_<12e3}},{key:"connect",value:function(){var e=this;return new Promise((function(t,n){e.log_.info("connect to url: ".concat(e.urlWithParam_)),e.emitConnectionStateChanged(WR),e.socket_=new WebSocket(e.urlWithParam_),e.bindSocket(e.socket_),e.backupTimer_=setTimeout((function(){e.isConnected_||(e.log_.info("trying to connect to backupUrl"),e.tryConnectBackup())}),5e3),e.once(HR,t),e.once(zR,n)}))}},{key:"tryConnectBackup",value:function(){this.backupSocket_||(this.unbindAndCloseSocket(rS),this.log_.debug("try to connect to url: ".concat(this.backupUrlWithParam_)),this.backupSocket_=new WebSocket(this.backupUrlWithParam_),this.bindSocket(this.backupSocket_))}},{key:"bindSocket",value:function(e){e.onopen=this.onopen.bind(this),e.onclose=this.onclose.bind(this),e.onerror=this.onerror.bind(this),e.onmessage=this.onmessage.bind(this)}},{key:"unbindSocket",value:function(e){e.onopen=function(){},e.onclose=function(){},e.onerror=function(){},e.onmessage=function(){}}},{key:"unbindAndCloseSocket",value:function(e){if(e===rS){if(this.socket_){this.unbindSocket(this.socket_);try{this.socket_.close(1e3)}catch(qY){}this.socket_=null}}else if(this.backupSocket_){this.unbindSocket(this.backupSocket_);try{this.backupSocket_.close(1e3)}catch(qY){}this.backupSocket_=null}}},{key:"clearBackupTimer",value:function(){-1!==this.backupTimer_&&(clearTimeout(this.backupTimer_),this.backupTimer_=-1)}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"onopen",value:function(e){if(!this.isConnected_){this.isConnected_=!0,this.isConnecting_=!1,this.isReconnecting_&&sO(this.signalInfo_)&&this.stopReconnection(),this.clearBackupTimer(),e.target===this.socket_?(this.unbindAndCloseSocket(oS),this.socketInUse_=this.socket_):(this.unbindAndCloseSocket(rS),this.socketInUse_=this.backupSocket_);var t=e.target.url;this.log_.info("websocket[".concat(t,"] is connected")),this.currentState_===WR?this.addSignalEvent(qL,"signal channel is connected"):this.currentState_===YR&&this.addSignalEvent(WL,"signal channel reconnect success"),this.emitConnectionStateChanged(JR),this.emitter_.emit(HR)}}},{key:"onclose",value:function(e){var t=e.target.url,n=e.target===this.socketInUse_;this.log_.info("websocket[".concat(t," InUse: ").concat(n,"] is closed with code: ").concat(e.code)),e.target===this.socketInUse_&&(this.isConnected_=!1,this.emitConnectionStateChanged(KR),this.addSignalEvent(jL,"signal channel is disconnected"),e.wasClean&&1e3===e.code||(this.log_.warn("onclose code:".concat(e.code," reason:").concat(e.reason)),this.log_.warn("close current websocket and schedule a reconnect timeout"),this.socketInUse_.onclose=function(){},this.socketInUse_.close(4011),this.socket_=this.backupSocket_=this.socketInUse_=null,this.reconnect(rS)))}},{key:"onerror",value:function(e){var t=e.target.url;this.log_.error("websocket[".concat(t,"] error observed")),this.isConnected_?e.target===this.socketInUse_&&(this.isConnected_=!1,this.unbindAndCloseSocket(rS),this.unbindAndCloseSocket(oS),this.socketInUse_=null,this.reconnect(rS)):(this.isReconnecting_||uO.logFailedEvent({userId:this.client_.getUserId(),eventType:IE,code:yL.UNKNOWN}),e.target==this.socket_?(this.unbindAndCloseSocket(rS),this.reconnect(oS)):(this.unbindAndCloseSocket(oS),this.reconnect(rS))),this.isConnecting_=!1,this.isConnected_=!1}},{key:"onmessage",value:function(e){if(this.isConnected_){this.lastMessageTime_=Date.now();var t=JSON.parse(e.data),n=t.cmd,i=t.data,r=Object.values(ZR),o=Object.keys(ZR)[r.indexOf(n)],a=QR[o];switch(XR.includes(n)||(this.log_.debug("received msg: ".concat(e.data)),this.log_.info("Received event: [ ".concat(a||"unknown cmd: "+n," ]"))),n){case ZR.CHANNEL_SETUP_RESULT:if(0===t.code)this.signalInfo_.clientIp=i.clientIp,this.signalInfo_.signalIp=i.signalInnerIp,this.signalInfo_.tinyId=t.tinyId,i.svrTime&&function(e){nv=e-(new Date).getTime();var t=new Date;t.setTime(e),UA.info("baseTime from server: "+t+" offset: "+nv)}(i.svrTime),this.log_.info("ChannelSetup Success"),uO.logSuccessEvent({userId:this.userId_,eventType:IE}),this.emitter_.emit(BR,{signalInfo:this.signalInfo_});else{var s=new IL({code:yL.SIGNAL_CHANNEL_SETUP_FAILED,extraCode:t.code,message:aD({key:Fb,data:{errorCode:t.code,errorMsg:t.message}})});this.log_.error("".concat(t.code,", ").concat(t.message)),this.close(),uO.logFailedEvent({userId:this.userId_,eventType:IE,error:s}),this.emitter_.emit(jR,s)}break;case ZR.JOIN_ROOM_RESULT:0===t.code&&(this.signalInfo_.relayIp=i.relayOuterIp,this.signalInfo_.relayInnerIp=i.relayInnerIp,this.signalInfo_.relayPort=i.relayPort,this.log_.info("signalIp:".concat(this.signalInfo_.signalIp," clientIp:").concat(this.signalInfo_.clientIp," relayIp: ").concat(this.signalInfo_.relayIp))),this.emitter_.emit(a,{data:t});break;case ZR.CHANNEL_RECONNECT_RESULT:0===t.code?(this.log_.warn("reconnect success"),this.stopReconnection(),uO.logSuccessEvent({userId:this.userId_,eventType:TE}),this.client_.syncUserList(),this.client_.checkConnectionsToReconnect()):(this.log_.warn("reconnect failed, ".concat(t.code," ").concat(t.message)),this.client_.reJoin());break;default:this.emitter_.emit(a,{data:t})}}}},{key:"addSignalEvent",value:function(e,t){rO(this.userId_,{eventId:e,eventDesc:t,timestamp:iv(),userId:this.userId_,tinyId:this.signalInfo_.tinyId})}},{key:"reconnect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rS;if(this.isConnecting_||-1!==this.reconnectionTimer_)this.log_.info("signal channel is reconnecting, ignoring current reconnection");else{if(this.reconnectionCount_>=tE){this.log_.warn("SDK has tried reconnect signal channel for ".concat(tE," times, but all failed. please check your network"));var n=new IL({code:yL.SIGNAL_CHANNEL_RECONNECTION_FAILED,message:aD({key:Vb})});return uO.logFailedEvent({userId:this.client_.getUserId(),eventType:TE,error:n}),this.addSignalEvent(YL,"signal channel reconnect fail"),void this.emitter_.emit(zR,n)}this.isConnecting_=!0,this.reconnectionCount_++,this.currentState_!==YR&&(this.emitConnectionStateChanged(YR),this.addSignalEvent(KL,"signal channel is reconnecting")),this.log_.warn("reconnecting to ".concat(t," signal channel [").concat(this.reconnectionCount_,"/").concat(tE,"]"));var i=this.getReconnectionUrl(t);t===rS?(this.socket_=new WebSocket(i),this.bindSocket(this.socket_)):(this.backupSocket_=new WebSocket(i),this.bindSocket(this.backupSocket_));var r=pD(this.reconnectionCount_);this.reconnectionTimer_=setTimeout((function(){e.log_.warn("reconnect ".concat(t," signal channel timeout(").concat(r/1e3,"s), close and try again")),e.isConnecting_=!1,e.clearReconnectionTimer(),e.unbindAndCloseSocket(t),e.reconnect(t===rS?oS:rS)}),r)}}},{key:"isConnected",value:function(){return this.isConnected_}},{key:"isReconnecting_",get:function(){return-1!==this.reconnectionTimer_}},{key:"getReconnectionUrl",value:function(e){var t=e===rS?this.urlWithParam_:this.backupUrlWithParam_;if(!sO(this.signalInfo_)&&-1===t.indexOf("&rc=1")){var n=this.client_.getRoomId(),i=this.client_.getUseStringRoomId();t+="&rc=1&relayInnerIp=".concat(this.signalInfo_.relayInnerIp,"&relayOuterIp=").concat(this.signalInfo_.relayIp,"&relayPort=").concat(this.signalInfo_.relayPort,"&roomId=").concat(n,"&useStringRoomId=").concat(i)}return t}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isConnected_){var n={cmd:e,data:t,userId:this.userId_,tinyId:this.signalInfo_.tinyId,seq:++this.seq_};return this.socketInUse_.send(JSON.stringify(n)),n.seq}}},{key:"sendWaitForResponse",value:function(e){var t=this,n=e.command,i=e.data,r=e.timeout,o=void 0===r?5e3:r,a=e.responseCommand,s=e.commandDesc,c=e.enableLog,u=void 0===c||c;return new Promise((function(e,r){var c=setTimeout((function(){t.off(a,l);var e=new IL({code:yL.API_CALL_TIMEOUT,message:aD({key:Gb,data:{commandDesc:s,command:n}})});u&&t.log_.warn(e),r(e)}),o),l=function n(i){i.data.seq===d&&(clearTimeout(c),t.off(a,n),e(i))};t.on(a,l);var d=t.send(n,i)}))}},{key:"sendWaitForResponseWithRetry",value:function(){var e=this,t=arguments.length<=0?void 0:arguments[0],n=t.commandDesc,i=t.command,r=t.retries,o=void 0===r?0:r,a=t.retryTimeout,s=void 0===a?0:a;return LA({retryFunction:this.sendWaitForResponse,onRetrying:function(t){e.log_.warn("".concat(n||i," timeout observed, retrying [").concat(t,"/").concat(o,"]"))},settings:{retries:o,timeout:s},context:this}).apply(void 0,arguments)}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"getSignalInfo",value:function(){return this.signalInfo_}},{key:"stopReconnection",value:function(){this.isReconnecting_&&(this.reconnectionCount_=0,this.clearReconnectionTimer())}},{key:"close",value:function(){this.log_.info("close SignalChannel"),this.clearBackupTimer(),this.stopReconnection(),this.signalInfo_={},this.isConnecting_=!1,this.isConnected_=!1,this.socketInUse_=null,this.unbindAndCloseSocket(rS),this.unbindAndCloseSocket(oS),this.emitConnectionStateChanged(KR)}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"removeListener",value:function(e,t,n){this.emitter_.removeListener(e,t,n)}},{key:"once",value:function(e,t,n){this.emitter_.once(e,t,n)}},{key:"off",value:function(e,t,n){this.emitter_.off(e,t,n)}},{key:"emitConnectionStateChanged",value:function(e){e!==this.currentState_&&(this.emitter_.emit(qR,{prevState:this.currentState_,state:e}),this.currentState_=e)}}]),e}(),dO=br,hO=Xd.find,pO=ba,fO="find",gO=!0;fO in[]&&Array(1).find((function(){gO=!1})),dO({target:"Array",proto:!0,forced:gO},{find:function(e){return hO(this,e,arguments.length>1?arguments[1]:void 0)}}),pO(fO);var _O={},vO={},mO={exports:{}},yO=mO.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(yO).forEach((function(e){yO[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=mO.exports,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(vO);var IO=mO.exports,TO=/%[sdv%]/g,CO=function(e){var t=1,n=arguments,i=n.length;return e.replace(TO,(function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},SO=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var o=t.names[r];t.name?i.push(n[t.name][o]):i.push(n[t.names[r]])}else i.push(n[t.name]);return CO.apply(null,i)},EO=["v","o","s","i","u","e","p","c","b","t","r","z","a"],bO=["i","c","b","a"],MO=vO,kO=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||EO,i=t.innerOrder||bO,r=[];return n.forEach((function(t){IO[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(SO(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(SO(t,n,e))}))}))})),e.media.forEach((function(e){r.push(SO("m",IO.m[0],e)),i.forEach((function(t){IO[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(SO(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(SO(t,n,e))}))}))}))})),r.join("\r\n")+"\r\n"};_O.write=kO,_O.parse=MO.parse,_O.parseParams=MO.parseParams,_O.parseFmtpConfig=MO.parseFmtpConfig,_O.parsePayloads=MO.parsePayloads,_O.parseRemoteCandidates=MO.parseRemoteCandidates,_O.parseImageAttributes=MO.parseImageAttributes,_O.parseSimulcastStreamList=MO.parseSimulcastStreamList;var wO=function(e){return _O.parse(e)},DO=function(e){return _O.write(e)},AO=function(e){var t=wO(e);return t.media.forEach((function(e){e.type===UC&&e.fmtp.forEach((function(e){e.config+=";sprop-stereo=1;stereo=1"}))})),DO(t)};function RO(e){var t=wO(e);return t.media.forEach((function(e){if(e.type===GC){var t=new Set;e.rtp.forEach((function(e){var n=e.payload;return"H264"===e.codec&&t.add(n)})),e.fmtp.forEach((function(e){var n=e.payload,i=e.config.match(/apt=(\d+)/);i&&i[1]&&t.has(Number(i[1]))&&t.add(n)}));var n=function(e){var n=e.payload;return!t.has(n)};e.rtp=e.rtp.filter(n),e.rtcpFb=e.rtcpFb.filter(n),e.fmtp=e.fmtp.filter(n),e.payloads=e.payloads.split(" ").filter((function(e){return!t.has(Number(e))})).join(" ")}})),DO(t)}var LO,OO,NO,xO,PO=br,UO=te,GO=wi,VO=rm,FO=vp,BO=R,jO=RangeError,qO=String,HO=Math.floor,zO=UO(FO),KO=UO("".slice),WO=UO(1..toFixed),YO=function(e,t,n){return 0===t?n:t%2==1?YO(e,t-1,n*e):YO(e*e,t/2,n)},JO=function(e,t,n){for(var i=-1,r=n;++i<6;)r+=t*e[i],e[i]=r%1e7,r=HO(r/1e7)},ZO=function(e,t){for(var n=6,i=0;--n>=0;)i+=e[n],e[n]=HO(i/t),i=i%t*1e7},XO=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var i=qO(e[t]);n=""===n?i:n+zO("0",7-i.length)+i}return n};PO({target:"Number",proto:!0,forced:BO((function(){return"0.000"!==WO(8e-5,3)||"1"!==WO(.9,0)||"1.25"!==WO(1.255,2)||"1000000000000000128"!==WO(0xde0b6b3a7640080,0)}))||!BO((function(){WO({})}))},{toFixed:function(e){var t,n,i,r,o=VO(this),a=GO(e),s=[0,0,0,0,0,0],c="",u="0";if(a<0||a>20)throw jO("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return qO(o);if(o<0&&(c="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*YO(2,69,1))-69)<0?o*YO(2,-t,1):o/YO(2,t,1),n*=4503599627370496,(t=52-t)>0){for(JO(s,0,n),i=a;i>=7;)JO(s,1e7,0),i-=7;for(JO(s,YO(10,i,1),0),i=t-1;i>=23;)ZO(s,1<<23),i-=23;ZO(s,1<<i),JO(s,1,1),ZO(s,2),u=XO(s)}else JO(s,0,n),JO(s,1<<-t,0),u=XO(s)+zO("0",a);return a>0?c+((r=u.length)<=a?"0."+zO("0",a-r)+u:KO(u,0,r-a)+"."+KO(u,r-a)):c+u}});var QO=(null===(LO=window)||void 0===LO?void 0:LO.requestIdleCallback)||function(e){var t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1e3)},$O=(null===(OO=window)||void 0===OO?void 0:OO.cancelIdleCallback)||function(e){clearTimeout(e)},eN=(null===(NO=window)||void 0===NO?void 0:NO.cancelAnimationFrame)||(null===(xO=window)||void 0===xO?void 0:xO.mozCancelAnimationFrame),tN=function(){function e(){s(this,e)}return u(e,null,[{key:"generateTaskID",value:function(){return this.currentTaskID++}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tb,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;i=t(t({},e===Ib?{delay:2e3,count:0,backgroundTask:!0}:e===mb?{delay:1e4,count:0}:e===yb?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0}),i),yD(n)&&(i=t(t({},i),n)),fD(e)&&(n=e,e=Tb);var r=t({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,ricID:null,taskName:e,callback:n},i);return this.taskMap.set(r.taskID,r),this[e](r),r.taskID}},{key:"interval",value:function(e){var t=this;return e.intervalID=setInterval((function(){e.callback(),e.loopCount+=1,t.isBreakLoop(e)}),e.delay)}},{key:"timeout",value:function(e){var t=this;return e.timeoutID=setTimeout((function n(){if(e.callback(),e.loopCount+=1,!t.isBreakLoop(e))return e.timeoutID=setTimeout(n,e.delay)}),e.delay)}},{key:"ric",value:function(e){var t,n=this,i=ED();return e.ricID=QO((function r(){if((t=ED()-i)>=e.delay&&(i=ED()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),!n.isBreakLoop(e))return e.ricID=QO(r,{timeout:e.delay})}),{timeout:e.delay})}},{key:"raf",value:function(e){var t=this;e.delay=(1e3/e.fps).toFixed(2);var n,i=ED(),r=function r(){if(document.hidden&&e.backgroundTask){if(n=ED()-i,i=ED(),e.callback(),e.loopCount+=1,t.isBreakLoop(e))return;return e.timeoutID=setTimeout(r,e.delay-Math.floor(n%e.delay))}if((n=ED()-i)>=e.delay&&(i=ED()-Math.floor(n%e.delay),e.callback(),e.loopCount+=1),!t.isBreakLoop(e))return e.rafID=requestAnimationFrame(r)};if(e.rafID=requestAnimationFrame(r),e.backgroundTask){var o=function(){if(document.hidden){var t=ED()-i;t>=e.delay?r():e.timeoutID=setTimeout(r,e.delay-t)}};document.addEventListener("visibilitychange",o),e.onVisibilitychange=o,document.hidden&&o()}return e.taskID}},{key:"hasTask",value:function(e){return this.taskMap.has(e)}},{key:"clearTask",value:function(e){if(!this.taskMap.has(e))return!0;var t=this.taskMap.get(e),n=t.intervalID,i=t.timeoutID,r=t.rafID,o=t.ricID,a=t.onVisibilitychange;return n&&clearInterval(n),i&&clearTimeout(i),r&&eN(r),o&&$O(o),a&&document.removeEventListener("visibilitychange",a),this.taskMap.delete(e),!0}},{key:"isBreakLoop",value:function(e){return!this.taskMap.has(e.taskID)||0!==e.count&&e.loopCount>=e.count&&(this.clearTask(e.taskID),!0)}}]),e}();l(tN,"taskMap",new Map),l(tN,"currentTaskID",1);var nN=function(){function e(){s(this,e),this.prefix_="TRTC",this.queue_=new Map,this.checkStorage()}return u(e,[{key:"getRealKey",value:function(e){return"".concat(this.prefix_,"_").concat(e)}},{key:"checkStorage",value:function(){var e=this;if(tD()){var t=Object.keys(localStorage).filter((function(t){if(t.startsWith(e.prefix_)){var n=JSON.parse(localStorage.getItem(t));if(n&&n.expiresIn<Date.now())return!0}return!1}));t.forEach((function(e){return localStorage.removeItem(e)}))}}},{key:"doFlush",value:function(){if(tD())try{var e,t=b(this.queue_);try{for(t.s();!(e=t.n()).done;){var n=T(e.value,2),i=n[0],r=n[1];localStorage.setItem(i,JSON.stringify(r))}}catch(a){t.e(a)}finally{t.f()}}catch(qY){UA.warn(qY)}}},{key:"getItem",value:function(e){if(!tD())return null;try{var t=JSON.parse(localStorage.getItem(this.getRealKey(e)));return t&&t.expiresIn>=Date.now()?t.value:null}catch(qY){UA.warn(qY)}}},{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(tD())try{var i={expiresIn:Date.now()+WE,value:t};n?localStorage.setItem(this.getRealKey(e),JSON.stringify(i)):(this.queue_.set(this.getRealKey(e),i),tN.hasTask(this.intervalId_)||(this.intervalId_=tN.run(mb,this.doFlush.bind(this),{count:1})))}catch(qY){UA.warn(qY)}}},{key:"deleteItem",value:function(e){if(!tD())return!1;try{return e=this.getRealKey(e),this.queue_.delete(e),localStorage.removeItem(e),!0}catch(qY){return UA.warn(qY),!1}}},{key:"clear",value:function(){if(tD())try{localStorage.clear()}catch(qY){UA.warn(qY)}}}]),e}(),iN=new nN,rN={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isMediaDevicesSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}},oN="checkResult",aN=function(){return!ww&&!nw&&!(rw&&ow<80)&&!(ew&&tw<56)},sN=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter((function(e){return e in window})).length>0},cN=function(){if(!navigator.mediaDevices)return!1;var e=["getUserMedia","enumerateDevices"];return e.filter((function(e){return e in navigator.mediaDevices})).length===e.length},uN=function(){var e=a(i().mark((function e(){var t,n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rN.detail.isH264EncodeSupported||!rN.detail.isVp8EncodeSupported){e.next=2;break}return e.abrupt("return",{isH264EncodeSupported:rN.detail.isH264EncodeSupported,isVp8EncodeSupported:rN.detail.isVp8EncodeSupported});case 2:return t="",n=!1,r=!1,e.prev=5,o=new RTCPeerConnection,(a=document.createElement(PC)).getContext("2d"),s=a.captureStream(0),o.addTrack(s.getVideoTracks()[0],s),e.next=13,o.createOffer();case 13:return-1!==(t=e.sent).sdp.toLowerCase().indexOf("h264")&&(n=!0),-1!==t.sdp.toLowerCase().indexOf("vp8")&&(r=!0),o.close(),rN.detail.isH264EncodeSupported=n,rN.detail.isVp8EncodeSupported=r,e.abrupt("return",{isH264EncodeSupported:rN.detail.isH264EncodeSupported,isVp8EncodeSupported:rN.detail.isVp8EncodeSupported});case 22:return e.prev=22,e.t0=e.catch(5),e.abrupt("return",{isH264EncodeSupported:!1,isVp8EncodeSupported:!1});case 25:case"end":return e.stop()}}),e,null,[[5,22]])})));return function(){return e.apply(this,arguments)}}();function lN(){return dN.apply(this,arguments)}function dN(){return dN=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=a(i().mark((function e(t){var n,r,o,s,c,u,l,d,h,p,f,g,_,v;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={encode:!1,decode:!1},r=null,e.prev=2,o=document.createElement("canvas"),s=o.getContext("2d"),o.width=640,o.height=480,c=setInterval((function(){s.fillText("test",Math.floor(640*Math.random()),Math.floor(480*Math.random()))}),33),u=-1,l=-1,r=function(){clearInterval(u),clearInterval(c),clearTimeout(l),h.close(),p.close(),d.getTracks().forEach((function(e){return e.stop()}))},l=setTimeout((function(){r(),t(n)}),3e3),d=o.captureStream(),h=new RTCPeerConnection({}),p=new RTCPeerConnection({offerToReceiveAudio:!0,offerToReceiveVideo:!0}),h.addEventListener("icecandidate",(function(e){return p.addIceCandidate(e.candidate)})),p.addEventListener("icecandidate",(function(e){return h.addIceCandidate(e.candidate)})),h.addTrack(d.getVideoTracks()[0],d),e.next=20,h.createOffer();case 20:return f=e.sent,e.next=23,h.setLocalDescription(f);case 23:return e.next=25,p.setRemoteDescription(f);case 25:return e.next=27,p.createAnswer();case 27:return g=e.sent,_=wO(g.sdp),v=_.media[0].rtp.findIndex((function(e){return"H264"===e.codec})),_.media[0].rtp=[_.media[0].rtp[v]],_.media[0].fmtp=_.media[0].fmtp.filter((function(e){return e.payload===_.media[0].rtp[0].payload})),_.media[0].rtcpFb=_.media[0].rtcpFb.filter((function(e){return e.payload===_.media[0].rtp[0].payload})),g.sdp=DO(_),e.next=36,p.setLocalDescription(g);case 36:return e.next=38,h.setRemoteDescription(g);case 38:u=setInterval(a(i().mark((function e(){var o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.encode&&n.decode&&(r(),t(n)),e.next=3,h.getStats();case 3:return o=e.sent,e.next=6,p.getStats();case 6:a=e.sent,n.encode||o.forEach((function(e){"outbound-rtp"===e.type&&e.mediaType===GC&&e.framesEncoded>0&&(n.encode=!0)})),n.decode||a.forEach((function(e){"inbound-rtp"===e.type&&e.mediaType===GC&&e.framesDecoded>0&&(n.decode=!0)}));case 9:case"end":return e.stop()}}),e)}))),500),e.next=46;break;case 41:e.prev=41,e.t0=e.catch(2),r(),UA.warn(e.t0),t(n);case 46:case"end":return e.stop()}}),e,null,[[2,41]])})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),dN.apply(this,arguments)}var hN=function(){var e=a(i().mark((function e(){var t,n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rN.detail.isH264DecodeSupported||!rN.detail.isVp8DecodeSupported){e.next=2;break}return e.abrupt("return",{isH264DecodeSupported:rN.detail.isH264DecodeSupported,isVp8DecodeSupported:rN.detail.isVp8DecodeSupported});case 2:return t="",n=!1,r=!1,e.prev=5,o=new RTCPeerConnection,e.next=9,o.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 9:return-1!==(t=e.sent).sdp.toLowerCase().indexOf("h264")&&(n=!0),-1!==t.sdp.toLowerCase().indexOf("vp8")&&(r=!0),o.close(),e.abrupt("return",{isH264DecodeSupported:n,isVp8DecodeSupported:r});case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",{isH264DecodeSupported:!1,isVp8DecodeSupported:!1});case 19:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(){return e.apply(this,arguments)}}(),pN=function(){var e=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d,h,p,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gN()){e.next=2;break}return e.abrupt("return",rN);case 2:return t=aN(),n=sN(),r=cN(),e.next=7,uN();case 7:return o=e.sent,a=o.isH264EncodeSupported,s=o.isVp8EncodeSupported,e.next=12,hN();case 12:if(c=e.sent,u=c.isH264DecodeSupported,l=c.isVp8DecodeSupported,a&&s){e.next=21;break}return e.next=18,uN();case 18:d=e.sent,a=d.isH264EncodeSupported,s=d.isVp8EncodeSupported;case 21:if(!(a&&u&&(Gw||Fw||Jw)&&!lw&&jw()<79)){e.next=29;break}return e.next=24,lN();case 24:h=e.sent,p=h.encode,f=h.decode,a=p,u=f;case 29:return rN.result=t&&n&&r&&(a||s)&&(u||l),rN.detail.isBrowserSupported=t,rN.detail.isWebRTCSupported=n,rN.detail.isMediaDevicesSupported=r,rN.detail.isH264EncodeSupported=a,rN.detail.isVp8EncodeSupported=s,rN.detail.isH264DecodeSupported=u,rN.detail.isVp8DecodeSupported=l,_N(),iN.setItem(oN,{ua:navigator.userAgent,checkResult:rN},!0),e.abrupt("return",rN);case 40:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fN=function(e,t){var n=null;return function(){if(n)return n;for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(n=e.apply(t||this,r)).then((function(e){return n=null,e})).catch((function(e){throw n=null,e})),n}}(pN);function gN(){return Object.keys(rN.detail).findIndex((function(e){return!rN.detail[e]}))>=0}function _N(){gN()&&(UA.warn(aD({key:dk})),UA.info("".concat(navigator.userAgent," ").concat(JSON.stringify(rN.detail))))}function vN(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)}function mN(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype}function yN(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype}function IN(){return"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype}function TN(){return"RTCPeerConnection"in window&&"addTransceiver"in window.RTCPeerConnection.prototype}function CN(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype}function SN(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&yN()}function EN(){return!!gD(navigator.mediaDevices)&&(UA.error(Pk.NOT_SUPPORTED_MEDIA),!0)}function bN(){return"http:"===location.protocol&&!eD&&(UA.warn(aD({key:lk})),!0)}var MN="RTCRtpSender"in window&&"createEncodedStreams"in window.RTCRtpSender.prototype&&jw()>=86;function kN(e){return!("candidate-pair"!==e.type||!e.nominated||"in-progress"!==e.state&&"succeeded"!==e.state)&&!(mD(e.selected)&&!e.selected)}var wN=new Map([[$k,"Android"],[Qk,"iOS"],[bw,"Windows"],[Mw,"MacOS"],[kw,"Linux"]]);function DN(){var e="unknown";return wN.get(!0)&&(e=wN.get(!0)),e}function AN(){var e="";return screen.width&&(e+=(screen.width?screen.width*window.devicePixelRatio:"")+" * "+(screen.height?screen.height*window.devicePixelRatio:"")),e}function RN(){var e=!1;return(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&(e=!0),e}function LN(){for(var e={isSupported:!1},t=["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"],n=0;n<t.length;n++)if(t[n]in window){e.isSupported=!0;break}return e.isSupported}function ON(){return!(fw&&jw()<86)&&!(Qk&&vD(Zw)&&Zw<15)&&!(zw&&zw<63)&&!(!aN()||!("captureStream"in HTMLCanvasElement.prototype))}var NN=window.MediaStreamTrack&&"getSettings"in MediaStreamTrack.prototype,xN=window.MediaStreamTrack&&"getCapabilities"in MediaStreamTrack.prototype,PN=function(){var e,t,n;return(null===(e=window)||void 0===e?void 0:e.OffscreenCanvas)&&(null===(t=window)||void 0===t?void 0:t.MediaStreamTrackProcessor)&&(null===(n=window)||void 0===n?void 0:n.MediaStreamTrackGenerator)};!function(){bN();var e=iN.getItem(oN);e&&e.ua===navigator.userAgent&&(rN=e.checkResult),fN()}();var UN={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_PUBLISHED:"stream-published",STREAM_SUBSCRIBED:"stream-subscribed",STREAM_UNSUBSCRIBED:"stream-unsubscribed",STATE_CHANGED:"state-changed",ERROR:"error",CONNECTION_STATE_CHANGED:"connection-state-changed",SEI_MESSAGE:lS},GN={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_SUBSCRIBED:"stream-subscribed",CONNECTION_STATE_CHANGED:"connection-state-changed",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",MUTE_AUDIO:"mute-audio",MUTE_VIDEO:"mute-video",UNMUTE_AUDIO:"unmute-audio",UNMUTE_VIDEO:"unmute-video",CLIENT_BANNED:"client-banned",NETWORK_QUALITY:"network-quality",AUDIO_VOLUME:"audio-volume",SEI_MESSAGE:lS,ERROR:"error"},VN="player-state-changed",FN="screen-sharing-stopped",BN="connection-state-changed",jN="device-auto-recovered",qN="error",HN="player-state-changed",zN=wb;br({target:"String",proto:!0,forced:Ab("small")},{small:function(){return zN(this,"small","","")}});var KN=function(){function e(t){s(this,e);var n=t.getUserId();this.log_=UA.createLogger({id:n,userId:n,sdkAppId:t.getSDKAppId()}),this.prevReportTime_=0,this.prevReport_={},this.prevEncoderImplementation_="",this.prevQualityLimitationReason_="",this.prevDecoderImplementationMap_=new Map}var t,n,r,o;return u(e,[{key:"statInterval",get:function(){return 0===this.prevReportTime_?2:(Date.now()-this.prevReportTime_)/1e3}},{key:"getSenderStats",value:(o=a(i().mark((function e(t){var n,r,o,a,s=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},small:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},auxiliary:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},rtt:0},r=t.getPeerConnection(),o=t.getSSRC(),!r){e.next=15;break}return e.prev=4,e.next=7,r.getStats();case 7:e.sent.forEach((function(e){if("outbound-rtp"===e.type)if(e.mediaType===GC){if(!ew&&0===e.bytesSent)return;e.ssrc!==o.video||gD(e.encoderImplementation)||s.prevEncoderImplementation_===e.encoderImplementation||(s.log_.info("encoderImplementation change to ".concat(e.encoderImplementation)),s.prevEncoderImplementation_=e.encoderImplementation),e.ssrc!==o.video||gD(e.qualityLimitationReason)||s.prevQualityLimitationReason_===e.qualityLimitationReason||(s.log_.info("qualityLimitationReason change to ".concat(e.qualityLimitationReason)),s.prevQualityLimitationReason_=e.qualityLimitationReason);var i=GC;e.ssrc===o.small?i=FC:e.ssrc===o.auxiliary&&(i=jC),n[i].bytesSent=e.bytesSent,n[i].packetsSent=e.packetsSent,n[i].framesEncoded=e.framesEncoded}else e.mediaType===UC&&(n.audio.bytesSent=e.bytesSent,n.audio.packetsSent=e.packetsSent);else"candidate-pair"===e.type?kN(e)&&vD(e.currentRoundTripTime)&&(n.rtt=Math.floor(1e3*e.currentRoundTripTime)):"media-source"===e.type&&(e.kind===UC?(n.audio.audioLevel=e.audioLevel||0,n.audio.totalAudioEnergy=e.totalAudioEnergy||0):e.kind===GC&&(e.trackIdentifier===t.getVideoTrackId(GC)?n.video.fpsCapture=e.framesPerSecond:e.trackIdentifier===t.getVideoTrackId(jC)?n.auxiliary.fpsCapture=e.framesPerSecond:n.small.fpsCapture=e.framesPerSecond));var r;gD(e.audioLevel)||(n.audio.audioLevel=e.audioLevel||0,n.audio.totalAudioEnergy=e.totalAudioEnergy||0),gD(e.frameWidth)||(e.trackIdentifier===t.getVideoTrackId(GC)||e.ssrc===o.video?r=GC:e.trackIdentifier===t.getVideoTrackId(jC)||e.ssrc===o.auxiliary?r=jC:e.trackIdentifier!==t.getVideoTrackId(FC)&&e.ssrc!==o.small||(r=FC),r&&(n[r].frameWidth=e.frameWidth,n[r].frameHeight=e.frameHeight,n[r].framesSent=e.framesSent))})),0===n.audio.audioLevel&&(n.audio.audioLevel=(null===(a=t.getLocalStream())||void 0===a?void 0:a.getInternalAudioLevel())||0),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),this.log_.warn("failed to getStats on sender connection "+e.t0);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return o.apply(this,arguments)})},{key:"getReceiverStats",value:(r=a(i().mark((function e(t){var n,r,o,a,s,c=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={tinyId:t.getTinyId(),userId:t.getUserId(),rtt:0,hasAudio:!1,hasVideo:!1,hasAuxiliary:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,jitter:0,audioLevel:0,totalAudioEnergy:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0},auxiliary:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0}},!(r=t.getPeerConnection())){e.next=16;break}return e.prev=3,o=t.getSSRC(),a=t.getTrackState(),e.next=8,r.getStats();case 8:e.sent.forEach((function(e){if("inbound-rtp"===e.type){if(e.mediaType===UC&&e.ssrc===o.audio&&a.audio)n.audio.packetsReceived=e.packetsReceived,n.audio.bytesReceived=e.bytesReceived,n.audio.packetsLost=e.packetsLost,n.audio.jitter=e.jitter,n.hasAudio=!0;else if(e.mediaType===GC){if(ew&&0===e.bytesReceived)return;e.ssrc===o.video&&a.video&&(n.video.packetsReceived=e.packetsReceived,n.video.bytesReceived=e.bytesReceived,n.video.packetsLost=e.packetsLost,n.video.framesReceived=e.framesReceived,n.video.framesDecoded=e.framesDecoded,n.video.fpsDecoded=e.framesPerSecond,n.hasVideo=!0,!e.decoderImplementation||c.prevDecoderImplementationMap_.has(n.userId)&&c.prevDecoderImplementationMap_.get(n.userId)===e.decoderImplementation||(c.log_.info("".concat(n.userId," decoderImplementation change to ").concat(e.decoderImplementation)),c.prevDecoderImplementationMap_.set(n.userId,e.decoderImplementation))),e.ssrc===o.auxiliary&&a.auxiliary&&(n.auxiliary.packetsReceived=e.packetsReceived,n.auxiliary.bytesReceived=e.bytesReceived,n.auxiliary.packetsLost=e.packetsLost,n.auxiliary.framesReceived=e.framesReceived,n.auxiliary.framesDecoded=e.framesDecoded,n.auxiliary.fpsDecoded=e.framesPerSecond,n.hasAuxiliary=!0)}}else"candidate-pair"===e.type&&kN(e)&&vD(e.currentRoundTripTime)&&(n.rtt=Math.floor(1e3*e.currentRoundTripTime));gD(e.frameWidth)||(e.trackIdentifier!==t.getMainStreamVideoTrackId()&&e.ssrc!==o.video||(n.video.frameWidth=e.frameWidth,n.video.frameHeight=e.frameHeight),e.trackIdentifier!==t.getAuxStreamVideoTrackId()&&e.ssrc!==o.auxiliary||(n.auxiliary.frameWidth=e.frameWidth,n.auxiliary.frameHeight=e.frameHeight)),gD(e.audioLevel)||(n.audio.audioLevel=e.audioLevel||0,n.audio.totalAudioEnergy=e.totalAudioEnergy||0)})),0===n.audio.audioLevel&&(n.audio.audioLevel=(null===(s=t.getMainStream())||void 0===s?void 0:s.getInternalAudioLevel())||0),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.log_.warn("failed to getStats on receiver connection "+e.t0);case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e){return r.apply(this,arguments)})},{key:"getStats",value:(n=a(i().mark((function e(t,n){var r,o,a,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!t){e.next=5;break}return e.next=4,this.getSenderStats(t);case 4:r=e.sent;case 5:o=[],a=b(n),e.prev=7,a.s();case 9:if((s=a.n()).done){e.next=17;break}return(c=T(s.value,2))[0],u=c[1],e.next=13,this.getReceiverStats(u);case 13:l=e.sent,o.push(l);case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),a.e(e.t0);case 22:return e.prev=22,a.f(),e.finish(22);case 25:return e.abrupt("return",{senderStats:r,receiverStats:o});case 26:case"end":return e.stop()}}),e,this,[[7,19,22,25]])}))),function(e,t){return n.apply(this,arguments)})},{key:"getDifferenceValue",value:function(e,t){if(sO(e))return t;var n=t-e;return n<0?0:n}},{key:"prepareReport",value:function(e){var t=this,n=e.stats,i=e.report,r=e.freezeMap;if(!sO(n.senderStats)){var o;o={uint32_audio_level:1e8*n.senderStats.audio.audioLevel,uint32_audio_energy:1e6*n.senderStats.audio.totalAudioEnergy,uint32_audio_codec_bitrate:n.senderStats.audio.bytesSent,audioLevel:n.senderStats.audio.audioLevel};var a=[],s={uint32_video_stream_type:2,uint32_video_codec_fps:n.senderStats.video.framesSent,uint32_video_capture_fps:n.senderStats.video.fpsCapture,uint32_video_width:n.senderStats.video.frameWidth,uint32_video_height:n.senderStats.video.frameHeight,uint32_video_codec_bitrate:n.senderStats.video.bytesSent,uint32_video_enc_fps:n.senderStats.video.framesEncoded};if(a.push(s),n.senderStats.small.bytesSent){var c={uint32_video_stream_type:3,uint32_video_codec_fps:n.senderStats.small.framesSent||0,uint32_video_capture_fps:n.senderStats.small.fpsCapture||0,uint32_video_width:n.senderStats.small.frameWidth||0,uint32_video_height:n.senderStats.small.frameHeight||0,uint32_video_codec_bitrate:n.senderStats.small.bytesSent,uint32_video_enc_fps:n.senderStats.small.framesEncoded||0};a.push(c)}if(n.senderStats.auxiliary.bytesSent){var u={uint32_video_stream_type:7,uint32_video_codec_fps:n.senderStats.auxiliary.framesSent||0,uint32_video_capture_fps:n.senderStats.auxiliary.fpsCapture||0,uint32_video_width:n.senderStats.auxiliary.frameWidth||0,uint32_video_height:n.senderStats.auxiliary.frameHeight||0,uint32_video_codec_bitrate:n.senderStats.auxiliary.bytesSent,uint32_video_enc_fps:n.senderStats.auxiliary.framesEncoded||0};a.push(u)}var l={uint32_bitrate:0,uint32_rtt:n.senderStats.rtt};i.msg_up_stream_info={msg_audio_status:o,msg_video_status:a,msg_network_status:l}}var d=this.statInterval;i.msg_down_stream_info=[],n.receiverStats.forEach((function(e){var t={};if(t.msg_user_info={str_identifier:e.userId,uint64_tinyid:e.tinyId},t.msg_network_status={uint32_rtt:e.rtt},t.msg_video_status={},e.hasAudio){var n={uint32_audio_codec_bitrate:e.audio.bytesReceived,uint32_audio_total_bitrate:e.audio.bytesReceived,uint32_audio_level:1e8*e.audio.audioLevel,uint32_audio_energy:1e6*e.audio.totalAudioEnergy,uint32_audio_receive:e.audio.packetsReceived,uint32_audio_origin_lost:e.audio.packetsLost,audioLevel:e.audio.audioLevel};t.msg_audio_status=n}if(t.msg_video_status=[],e.hasVideo){var o=r.get(e.userId+"_"+BS),a=o?o.duration:0,s={uint32_video_stream_type:2,uint32_video_receive_fps:e.video.framesReceived,uint32_video_width:e.video.frameWidth,uint32_video_height:e.video.frameHeight,uint32_video_codec_bitrate:e.video.bytesReceived,uint32_video_receive:e.video.packetsReceived,uint32_video_origin_lost:e.video.packetsLost,uint32_video_block_time:a,uint32_video_dec_fps:e.video.framesDecoded};t.msg_video_status.push(s)}if(e.hasAuxiliary){var c=r.get(e.userId+"_"+jS),u=c?c.duration:0,l={uint32_video_stream_type:7,uint32_video_receive_fps:e.auxiliary.framesReceived,uint32_video_width:e.auxiliary.frameWidth,uint32_video_height:e.auxiliary.frameHeight,uint32_video_codec_bitrate:e.auxiliary.bytesReceived,uint32_video_receive:e.auxiliary.packetsReceived+e.auxiliary.packetsLost,uint32_video_origin_lost:e.auxiliary.packetsLost,uint32_video_block_time:u,uint32_video_dec_fps:e.auxiliary.framesDecoded};t.msg_video_status.push(l)}i.msg_down_stream_info.push(t)}));var h=this.prevReport_;if(this.prevReport_=JSON.parse(JSON.stringify(i)),i.msg_up_stream_info.msg_audio_status&&h.msg_up_stream_info.msg_audio_status){var p=h.msg_up_stream_info.msg_audio_status,f=i.msg_up_stream_info.msg_audio_status,g=this.getDifferenceValue(p.uint32_audio_codec_bitrate,f.uint32_audio_codec_bitrate);f.uint32_audio_codec_bitrate=Math.round(8*g/d),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=f.uint32_audio_codec_bitrate}var _=h.msg_up_stream_info.msg_video_status;i.msg_up_stream_info.msg_video_status.forEach((function(e){var n=_.find((function(t){return t.uint32_video_stream_type===e.uint32_video_stream_type}));if(!n||0===n.uint32_video_codec_bitrate)return e.uint32_video_codec_bitrate=0,e.uint32_video_enc_fps=0,void(e.uint32_video_codec_fps=0);var r=n.uint32_video_codec_bitrate,o=n.uint32_video_enc_fps,a=n.uint32_video_codec_fps,s=t.getDifferenceValue(r,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*s/d),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=e.uint32_video_codec_bitrate,e.uint32_video_enc_fps=Math.round(t.getDifferenceValue(o,e.uint32_video_enc_fps)/d),e.uint32_video_codec_fps=Math.round(t.getDifferenceValue(a,e.uint32_video_codec_fps)/d)}));var v=i.msg_down_stream_info,m=h.msg_down_stream_info;return v.forEach((function(e){var n=m.find((function(t){return t.msg_user_info.uint64_tinyid===e.msg_user_info.uint64_tinyid}));if(n){if(e.msg_audio_status&&n.msg_audio_status){var i=e.msg_audio_status,r=n.msg_audio_status;i.uint32_audio_origin_lost=t.getDifferenceValue(r.uint32_audio_origin_lost,i.uint32_audio_origin_lost),i.uint32_audio_receive=t.getDifferenceValue(r.uint32_audio_receive,i.uint32_audio_receive),i.uint32_audio_receive+=i.uint32_audio_origin_lost;var o=t.getDifferenceValue(r.uint32_audio_codec_bitrate,i.uint32_audio_codec_bitrate);i.uint32_audio_codec_bitrate=Math.round(8*o/d),i.uint32_audio_total_bitrate=Math.round(8*o/d)}if(e.msg_video_status&&n.msg_video_status){var a=e.msg_video_status,s=n.msg_video_status;a.forEach((function(e){var n=s.find((function(t){return t.uint32_video_stream_type===e.uint32_video_stream_type}));if(!n)return e.uint32_video_receive=0,e.uint32_video_origin_lost=0,e.uint32_video_codec_bitrate=0,e.uint32_video_receive_fps=0,void(e.uint32_video_dec_fps=0);var i=n.uint32_video_receive,r=n.uint32_video_origin_lost,o=n.uint32_video_codec_bitrate,a=n.uint32_video_receive_fps,c=n.uint32_video_dec_fps;e.uint32_video_origin_lost=t.getDifferenceValue(r,e.uint32_video_origin_lost),e.uint32_video_receive=t.getDifferenceValue(i,e.uint32_video_receive)+e.uint32_video_origin_lost;var u=t.getDifferenceValue(o,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*u/d);var l=t.getDifferenceValue(a,e.uint32_video_receive_fps);e.uint32_video_receive_fps=Math.round(l/d),e.uint32_video_dec_fps=Math.round(t.getDifferenceValue(c,e.uint32_video_dec_fps)/d)}))}}})),i}},{key:"getStatsReport",value:(t=a(i().mark((function e(t){var n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uplinkConnection,r=t.downlinkConnections,o=t.freezeMap,a={msg_up_stream_info:{msg_audio_status:{uint32_audio_format:0,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_level:0,uint32_audio_energy:0,audioLevel:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_codec_fps:0,uint32_video_capture_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_final_lost:0,uint32_video_enc_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}},msg_down_stream_info:[{msg_user_info:{str_identifier:"",uint64_tinyid:""},msg_audio_status:{uint32_audio_format:0,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_total_bitrate:0,uint32_audio_level:0,uint32_audio_energy:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_final_lost:0,audioLevel:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_receive_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_block_time:0,uint32_video_dec_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0,uint32_jitter:0}}]},e.next=4,this.getStats(n,r);case 4:return s=e.sent,"{}"===JSON.stringify(this.prevReport_)&&(this.prevReport_=JSON.parse(JSON.stringify(a))),this.prepareReport({stats:s,report:a,freezeMap:o,uplinkConnection:n,downlinkConnections:r}),this.prevReportTime_=Date.now(),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"reset",value:function(){this.prevReportTime_=0,this.prevReport_={},this.prevEncoderImplementation_="",this.prevQualityLimitationReason_="",this.prevDecoderImplementationMap_=new Map}}]),e}(),WN=function(){function e(t){var n=t.signalChannel,i=t.connections,r=t.client;s(this,e),this.client_=r,this.signalChannel_=n,this.connections_=i,this.client_=r,this.log_=UA.createLogger({id:"q|"+this.client_.getUserId(),userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId()}),this.uplinkConnection_=null,this.uplinkNetworkQuality_=0,this.uplinkRTT_=0,this.uplinkLoss_=0,this.downlinkNetworkQuality_=0,this.downlinkRTT_=0,this.downlinkLoss_=0,this.downlinkPrevStatMap_=new Map,this.downlinkLossAndRTTMap_=new Map,this.interval_=-1,this.emitter_=new GD,this.initialize()}var t,n;return u(e,[{key:"uplinkNetworkQuality",get:function(){return this.uplinkNetworkQuality_},set:function(e){e!==this.uplinkNetworkQuality_&&this.log_.info("uplink network quality change ".concat(this.uplinkNetworkQuality," -> ").concat(e,", rtt: ").concat(this.uplinkRTT_,", loss: ").concat(this.uplinkLoss_)),this.uplinkNetworkQuality_=e}},{key:"downlinkNetworkQuality",get:function(){return this.downlinkNetworkQuality_},set:function(e){if(e!==this.downlinkNetworkQuality_){var t=this.getAverageLossAndRTT(C(this.downlinkLossAndRTTMap_.values())),n=t.rtt,i=t.loss;this.log_.info("downlink network quality change ".concat(this.downlinkNetworkQuality," -> ").concat(e,", rtt: ").concat(n,", loss: ").concat(i))}this.downlinkNetworkQuality_=e}},{key:"initialize",value:function(){var e=this;this.signalChannel_.on(QR.UPLINK_NETWORK_STATS,(function(t){e.handleUplinkNetworkQuality(t)})),this.signalChannel_.on(qR,this.handleSignalConnectionStateChange.bind(this)),this.start()}},{key:"handleUplinkNetworkQuality",value:function(e){if(!this.uplinkConnection_)return this.uplinkNetworkQuality=0,this.uplinkLoss_=0,void(this.uplinkRTT_=0);var t=this.uplinkConnection_.getPeerConnection();if(t&&this.isPeerConnectionDisconnected(t))return this.uplinkNetworkQuality=6,this.uplinkLoss_=0,void(this.uplinkRTT_=0);if(0===e.data.code){var n=e.data.data,i=n.expectAudPkg+n.expectVidPkg,r=n.recvAudPkg+n.recvVidPkg,o=i-r,a=n.delay;if(a&&this.updateDelay(a),0===i&&0===r)return;this.uplinkLoss_=o<=0?0:Math.round(o/i*100),this.uplinkRTT_=n.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this.uplinkLoss_,this.uplinkRTT_)}}},{key:"handleDownlinkNetworkQuality",value:(n=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d,h,p,f,g,_,v=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connections_&&0!==this.connections_.size){e.next=3;break}return this.downlinkNetworkQuality=0,e.abrupt("return");case 3:if(t=C(this.connections_.values()),n=t.filter((function(e){return e.getPeerConnection()&&e.getPeerConnection().connectionState===$S})),t.filter((function(e){return e.getPeerConnection()&&v.isPeerConnectionDisconnected(e.getPeerConnection())})).length!==t.length){e.next=9;break}return this.downlinkNetworkQuality=6,e.abrupt("return");case 9:r=0;case 10:if(!(r<n.length)){e.next=31;break}return o=n[r].getPeerConnection(),e.next=14,this.getStat(o);case 14:if(a=e.sent,s=a.rtt,c=a.totalPacketsLost,u=a.totalPacketsReceived,this.downlinkPrevStatMap_.has(o)){e.next=21;break}return this.downlinkPrevStatMap_.set(o,{totalPacketsLost:c,totalPacketsReceived:u}),e.abrupt("continue",28);case 21:l=0,d=this.downlinkPrevStatMap_.get(o),h=c-d.totalPacketsLost,p=u-d.totalPacketsReceived,l=h<=0||p<0?0:Math.round(h/(h+p)*100),this.downlinkPrevStatMap_.set(o,{totalPacketsLost:c,totalPacketsReceived:u}),this.downlinkLossAndRTTMap_.set(o,{rtt:s,loss:l,userId:n[r].getUserId()});case 28:r++,e.next=10;break;case 31:if(C(this.downlinkPrevStatMap_.keys()).forEach((function(e){v.isPeerConnectionDisconnected(e)&&(v.downlinkPrevStatMap_.delete(e),v.downlinkLossAndRTTMap_.delete(e))})),0!==this.downlinkLossAndRTTMap_.size){e.next=34;break}return e.abrupt("return");case 34:f=this.getAverageLossAndRTT(C(this.downlinkLossAndRTTMap_.values())),g=f.rtt,_=f.loss,this.downlinkRTT_=g,this.downlinkLoss_=_,this.downlinkNetworkQuality=this.getNetworkQuality(_,g);case 38:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getStat",value:(t=a(i().mark((function e(t){var n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={rtt:0,totalPacketsLost:0,totalPacketsReceived:0},t&&mN()){e.next=3;break}return e.abrupt("return",n);case 3:r=t.getReceivers(),e.prev=4,o=0;case 6:if(!(o<r.length)){e.next=15;break}return a=r[o],e.next=10,a.getStats();case 10:e.sent.forEach((function(e){"candidate-pair"===e.type&&vD(e.currentRoundTripTime)&&(n.rtt=Math.round(1e3*e.currentRoundTripTime)),"inbound-rtp"!==e.type||e.mediaType!==UC&&e.mediaType!==GC||(n.totalPacketsLost+=e.packetsLost,n.totalPacketsReceived+=e.packetsReceived)}));case 12:o++,e.next=6;break;case 15:return e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(4),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[4,18]])}))),function(e){return t.apply(this,arguments)})},{key:"getAverageLossAndRTT",value:function(e){var t={rtt:0,loss:0};return Array.isArray(e)&&e.length>0&&(e.forEach((function(e){t.rtt+=e.rtt,t.loss+=e.loss})),Object.keys(t).forEach((function(n){t[n]=Math.round(t[n]/e.length)}))),t}},{key:"getNetworkQuality",value:function(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:0}},{key:"handleSignalConnectionStateChange",value:function(e){e.state===KR?(this.uplinkRTT_=0,this.uplinkLoss_=0,this.uplinkNetworkQuality=6):e.state===JR&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}},{key:"handleUplinkConnectionStateChange",value:function(e){var t=e.state;t===HS?(this.uplinkLoss_=0,this.uplinkRTT_=0,this.uplinkNetworkQuality=6):t===WS&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}},{key:"isPeerConnectionDisconnected",value:function(e){return!(!e||e.connectionState!==QS&&e.connectionState!==ZS&&e.connectionState!==XS)}},{key:"setUplinkConnection",value:function(e){this.uplinkConnection_=e,this.uplinkConnection_?this.uplinkConnection_.on(UN.CONNECTION_STATE_CHANGED,this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=0,this.uplinkRTT_=0,this.uplinkLoss_=0)}},{key:"start",value:function(){var e=this;-1===this.interval_?(this.log_.info("start network quality calculating"),this.interval_=tN.run(mb,(function(){e.handleDownlinkNetworkQuality(),VD.emit(wA,{client:e.client_,uplinkNetworkQuality:e.uplinkNetworkQuality,downlinkNetworkQuality:e.downlinkNetworkQuality,uplinkRTT:e.uplinkRTT_,uplinkLoss:e.uplinkLoss_,downlinkRTT:e.downlinkRTT_,downlinkLoss:e.downlinkLoss_,downlinkLossAndRTTMap:e.downlinkLossAndRTTMap_}),e.emitter_.emit(GN.NETWORK_QUALITY,{uplinkNetworkQuality:e.uplinkNetworkQuality,downlinkNetworkQuality:e.downlinkNetworkQuality,uplinkRTT:e.uplinkRTT_,uplinkLoss:e.uplinkLoss_,downlinkRTT:e.downlinkRTT_,downlinkLoss:e.downlinkLoss_})}),{delay:2e3})):this.log_.info("network quality calculating is already started")}},{key:"stop",value:function(){this.log_.info("stop network quality calculating"),-1!==this.interval_&&(tN.clearTask(this.interval_),this.interval_=-1),this.downlinkLossAndRTTMap_.clear(),this.downlinkPrevStatMap_.clear()}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"updateDelay",value:function(e){var t=this;e.forEach((function(e){var n=e.srcTinyId,i=e.videoDelay,r=e.audioDelay,o=t.connections_.get(n);o&&o.setDelay({videoDelay:i,audioDelay:r})}))}}]),e}(),YN=function(){function e(t){s(this,e),this.log_=UA.createLogger({id:t.client.getUserId(),userId:t.client.getUserId(),sdkAppId:t.client.getSDKAppId()}),this.localStream_=null,this.prevDevices_=[],this.initialize()}var t,n;return u(e,[{key:"initialize",value:function(){navigator.mediaDevices&&(this.onDeviceChange=this.onDeviceChange.bind(this),navigator.mediaDevices.addEventListener("devicechange",this.onDeviceChange))}},{key:"destroy",value:function(){navigator.mediaDevices&&navigator.mediaDevices.removeEventListener("devicechange",this.onDeviceChange)}},{key:"onDeviceChange",value:(n=a(i().mark((function e(){var t,n,r,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localStream_&&this.localStream_.getMediaStream()&&!this.localStream_.getScreen()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,$N();case 4:t=e.sent,n=t.filter((function(e){return o.prevDevices_.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),r=this.prevDevices_.filter((function(e){return t.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),n.length>0&&this.handleDeviceAdded(this.prevDevices_,n),r.length>0&&this.handleDeviceRemoved(t,r),this.prevDevices_=t;case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setLocalStream",value:(t=a(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,$N();case 3:this.prevDevices_=e.sent;case 4:this.localStream_=t;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleDeviceAdded",value:function(e,t){var n,i;if(this.localStream_){this.log_.warn("devicesAdded: ".concat(JSON.stringify(t))),this.localStream_.updateDeviceIdInUse();var r=t.filter((function(e){return e.kind===tS})),o=t.filter((function(e){return e.kind===eS})),a=e.filter((function(e){return e.kind===tS})),s=e.filter((function(e){return e.kind===eS})),c=r.length>0&&0===a.length&&"live"!==(null===(n=this.localStream_.getVideoTrack())||void 0===n?void 0:n.readyState),u=o.length>0&&0===s.length&&"live"!==(null===(i=this.localStream_.getAudioTrack())||void 0===i?void 0:i.readyState);if(u&&c)return this.log_.info("new microphone and camera detected, but there was no device before."),void this.localStream_.recoverCapture({audio:!0,video:!0,cameraId:r[0].deviceId,microphoneId:o[0].deviceId});c&&(this.log_.info("new camera detected, but there was no camera before."),this.localStream_.recoverCapture({audio:!1,video:!0,cameraId:r[0].deviceId})),u&&(this.log_.info("new microphone detected, but there was no microphone before."),this.localStream_.recoverCapture({audio:!0,video:!1,microphoneId:o[0].deviceId}))}}},{key:"handleDeviceRemoved",value:function(e,t){if(this.localStream_){this.log_.warn("devicesRemoved: ".concat(JSON.stringify(t))),this.localStream_.updateDeviceIdInUse();var n=!1,i=!1,r=this.localStream_.getCameraId(),o=this.localStream_.getMicrophoneId();if(o===hb){var a=this.localStream_.getMicrophoneGroupId(),s=e.filter((function(e){return e.deviceId===hb&&e.kind===eS}))[0];s&&s.groupId!==a&&(i=!0)}if(t.forEach((function(e){var t=e.deviceId;r.length>0&&t===r?n=!0:o.length>0&&t===o&&(i=!0)})),n&&i)return this.log_.warn("current camera and microphone in use is lost, cameraId: ".concat(r,", microphoneId: ").concat(o)),void((this.localStream_.getAudio()||this.localStream_.getVideo())&&this.localStream_.recoverCapture({video:!0,audio:!0}));n&&(this.log_.warn("current camera in use is lost, deviceId: ".concat(r)),this.localStream_.getVideo()&&this.localStream_.recoverCapture({video:!0,audio:!1})),i&&(this.log_.warn("current microphone in use is lost, deviceId: ".concat(o)),this.localStream_.getAudio()&&this.localStream_.recoverCapture({video:!1,audio:!0}))}}}]),e}();function JN(){return JN=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!bN()&&!EN()){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,XN();case 4:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.kind===tS})).map((function(e,t){var n=e.label;e.label||(n="camera_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),e.getCapabilities&&(i.getCapabilities=function(){return e.getCapabilities()}),i})));case 6:case"end":return e.stop()}}),e)}))),JN.apply(this,arguments)}var ZN=new Set;function XN(){return QN.apply(this,arguments)}function QN(){return(QN=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!bN()&&!EN()){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return(t=e.sent).forEach((function(e){ZN.add("".concat(e.deviceId,"_").concat(e.kind))})),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $N(){return ex.apply(this,arguments)}function ex(){return ex=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XN();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.kind!==eS||e.deviceId!=pb})).map((function(e,t){var n=e.label;e.label||(n=e.kind+"_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),e.getCapabilities&&(i.getCapabilities=function(){return e.getCapabilities()}),i})));case 4:case"end":return e.stop()}}),e)}))),ex.apply(this,arguments)}function tx(){return nx.apply(this,arguments)}function nx(){return nx=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XN();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.kind===eS&&e.deviceId!==pb})).map((function(e,t){var n=e.label;e.label||(n="microphone_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),e.getCapabilities&&(i.getCapabilities=function(){return e.getCapabilities()}),i})));case 4:case"end":return e.stop()}}),e)}))),nx.apply(this,arguments)}function ix(){return ix=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XN();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return"audiooutput"===e.kind})).map((function(e,t){var n=e.label;e.label||(n="speaker_"+t);var i={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(i.groupId=e.groupId),i})));case 4:case"end":return e.stop()}}),e)}))),ix.apply(this,arguments)}function rx(e){var t;if(e instanceof CanvasCaptureMediaStreamTrack)return!1;if(!(e instanceof MediaStreamTrack))return!1;var n=e.label.toLocaleLowerCase();if(n.includes("camera")||n.includes("webcam"))return!0;var i="".concat(null===(t=e.getSettings())||void 0===t?void 0:t.deviceId,"_").concat(tS);return!!ZN.has(i)}function ox(e,t){return ax.apply(this,arguments)}function ax(){return(ax=a(i().mark((function e(t,n){var r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tx();case 2:if(r=e.sent,(null==(o=r.find((function(e){return e.deviceId===hb})))?void 0:o.groupId)!==t||o.label!==n){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var sx,cx=bn.exports,ux=on,lx=ln,dx=lu,hx=qc,px=P,fx=ht,gx=function(e,t,n,i){try{return i?t(lx(n)[0],n[1]):t(n)}catch(qY){dx(e,"throw",qY)}},_x=Wc,vx=Pd,mx=Ui,yx=oc,Ix=au,Tx=$c,Cx=Array,Sx=function(e){var t=fx(e),n=vx(this),i=arguments.length,r=i>1?arguments[1]:void 0,o=void 0!==r;o&&(r=hx(r,i>2?arguments[2]:void 0));var a,s,c,u,l,d,h=Tx(t),p=0;if(!h||this===Cx&&_x(h))for(a=mx(t),s=n?new this(a):Cx(a);a>p;p++)d=o?r(t[p],p):t[p],yx(s,p,d);else for(l=(u=Ix(t,h)).next,s=n?new this:[];!(c=px(l,u)).done;p++)d=o?gx(u,r,[c.value,p],!0):c.value,yx(s,p,d);return s.length=p,s},Ex=te,bx=2147483647,Mx=/[^\0-\u007E]/,kx=/[.\u3002\uFF0E\uFF61]/g,wx="Overflow: input needs wider integers to process",Dx=RangeError,Ax=Ex(kx.exec),Rx=Math.floor,Lx=String.fromCharCode,Ox=Ex("".charCodeAt),Nx=Ex([].join),xx=Ex([].push),Px=Ex("".replace),Ux=Ex("".split),Gx=Ex("".toLowerCase),Vx=function(e){return e+22+75*(e<26)},Fx=function(e,t,n){var i=0;for(e=n?Rx(e/700):e>>1,e+=Rx(e/t);e>455;)e=Rx(e/35),i+=36;return Rx(i+36*e/(e+38))},Bx=function(e){var t=[];e=function(e){for(var t=[],n=0,i=e.length;n<i;){var r=Ox(e,n++);if(r>=55296&&r<=56319&&n<i){var o=Ox(e,n++);56320==(64512&o)?xx(t,((1023&r)<<10)+(1023&o)+65536):(xx(t,r),n--)}else xx(t,r)}return t}(e);var n,i,r=e.length,o=128,a=0,s=72;for(n=0;n<e.length;n++)(i=e[n])<128&&xx(t,Lx(i));var c=t.length,u=c;for(c&&xx(t,"-");u<r;){var l=bx;for(n=0;n<e.length;n++)(i=e[n])>=o&&i<l&&(l=i);var d=u+1;if(l-o>Rx((bx-a)/d))throw Dx(wx);for(a+=(l-o)*d,o=l,n=0;n<e.length;n++){if((i=e[n])<o&&++a>bx)throw Dx(wx);if(i==o){for(var h=a,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(h<f)break;var g=h-f,_=36-f;xx(t,Lx(Vx(f+g%_))),h=Rx(g/_),p+=36}xx(t,Lx(Vx(h))),s=Fx(a,d,u==c),a=0,u++}}a++,o++}return Nx(t,"")},jx=br,qx=L,Hx=Mg,zx=D,Kx=qc,Wx=te,Yx=Si,Jx=function(e,t,n){return n.get&&cx(n.get,t,{getter:!0}),n.set&&cx(n.set,t,{setter:!0}),ux.f(e,t,n)},Zx=ku,Xx=gt,Qx=pR,$x=Sx,eP=dc,tP=Ll.codeAt,nP=function(e){var t,n,i=[],r=Ux(Px(Gx(e),kx,"."),".");for(t=0;t<r.length;t++)n=r[t],xx(i,Ax(Mx,n)?"xn--"+Bx(n):n);return Nx(i,".")},iP=Sl,rP=Ya,oP=ud,aP=K_,sP=ai,cP=sP.set,uP=sP.getterFor("URL"),lP=aP.URLSearchParams,dP=aP.getState,hP=zx.URL,pP=zx.TypeError,fP=zx.parseInt,gP=Math.floor,_P=Math.pow,vP=Wx("".charAt),mP=Wx(/./.exec),yP=Wx([].join),IP=Wx(1..toString),TP=Wx([].pop),CP=Wx([].push),SP=Wx("".replace),EP=Wx([].shift),bP=Wx("".split),MP=Wx("".slice),kP=Wx("".toLowerCase),wP=Wx([].unshift),DP="Invalid scheme",AP="Invalid host",RP="Invalid port",LP=/[a-z]/i,OP=/[\d+-.a-z]/i,NP=/\d/,xP=/^0x/i,PP=/^[0-7]+$/,UP=/^\d+$/,GP=/^[\da-f]+$/i,VP=/[\0\t\n\r #%/:<>?@[\\\]^|]/,FP=/[\0\t\n\r #/:<>?@[\\\]^|]/,BP=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,jP=/[\t\n\r]/g,qP=function(e){var t,n,i,r;if("number"==typeof e){for(t=[],n=0;n<4;n++)wP(t,e%256),e=gP(e/256);return yP(t,".")}if("object"==typeof e){for(t="",i=function(e){for(var t=null,n=1,i=null,r=0,o=0;o<8;o++)0!==e[o]?(r>n&&(t=i,n=r),i=null,r=0):(null===i&&(i=o),++r);return r>n&&(t=i,n=r),t}(e),n=0;n<8;n++)r&&0===e[n]||(r&&(r=!1),i===n?(t+=n?":":"::",r=!0):(t+=IP(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},HP={},zP=Qx({},HP,{" ":1,'"':1,"<":1,">":1,"`":1}),KP=Qx({},zP,{"#":1,"?":1,"{":1,"}":1}),WP=Qx({},KP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),YP=function(e,t){var n=tP(e,0);return n>32&&n<127&&!Xx(t,e)?e:encodeURIComponent(e)},JP={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ZP=function(e,t){var n;return 2==e.length&&mP(LP,vP(e,0))&&(":"==(n=vP(e,1))||!t&&"|"==n)},XP=function(e){var t;return e.length>1&&ZP(MP(e,0,2))&&(2==e.length||"/"===(t=vP(e,2))||"\\"===t||"?"===t||"#"===t)},QP=function(e){return"."===e||"%2e"===kP(e)},$P={},eU={},tU={},nU={},iU={},rU={},oU={},aU={},sU={},cU={},uU={},lU={},dU={},hU={},pU={},fU={},gU={},_U={},vU={},mU={},yU={},IU=function(e,t,n){var i,r,o,a=iP(e);if(t){if(r=this.parse(a))throw pP(r);this.searchParams=null}else{if(void 0!==n&&(i=new IU(n,!0)),r=this.parse(a,null,i))throw pP(r);(o=dP(new lP)).bindURL(this),this.searchParams=o}};IU.prototype={type:"URL",parse:function(e,t,n){var i,r,o,a,s,c=this,u=t||$P,l=0,d="",h=!1,p=!1,f=!1;for(e=iP(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=SP(e,BP,"")),e=SP(e,jP,""),i=$x(e);l<=i.length;){switch(r=i[l],u){case $P:if(!r||!mP(LP,r)){if(t)return DP;u=tU;continue}d+=kP(r),u=eU;break;case eU:if(r&&(mP(OP,r)||"+"==r||"-"==r||"."==r))d+=kP(r);else{if(":"!=r){if(t)return DP;d="",u=tU,l=0;continue}if(t&&(c.isSpecial()!=Xx(JP,d)||"file"==d&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&JP[c.scheme]==c.port&&(c.port=null));d="","file"==c.scheme?u=hU:c.isSpecial()&&n&&n.scheme==c.scheme?u=nU:c.isSpecial()?u=aU:"/"==i[l+1]?(u=iU,l++):(c.cannotBeABaseURL=!0,CP(c.path,""),u=vU)}break;case tU:if(!n||n.cannotBeABaseURL&&"#"!=r)return DP;if(n.cannotBeABaseURL&&"#"==r){c.scheme=n.scheme,c.path=eP(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,u=yU;break}u="file"==n.scheme?hU:rU;continue;case nU:if("/"!=r||"/"!=i[l+1]){u=rU;continue}u=sU,l++;break;case iU:if("/"==r){u=cU;break}u=_U;continue;case rU:if(c.scheme=n.scheme,r==sx)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=eP(n.path),c.query=n.query;else if("/"==r||"\\"==r&&c.isSpecial())u=oU;else if("?"==r)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=eP(n.path),c.query="",u=mU;else{if("#"!=r){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=eP(n.path),c.path.length--,u=_U;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=eP(n.path),c.query=n.query,c.fragment="",u=yU}break;case oU:if(!c.isSpecial()||"/"!=r&&"\\"!=r){if("/"!=r){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,u=_U;continue}u=cU}else u=sU;break;case aU:if(u=sU,"/"!=r||"/"!=vP(d,l+1))continue;l++;break;case sU:if("/"!=r&&"\\"!=r){u=cU;continue}break;case cU:if("@"==r){h&&(d="%40"+d),h=!0,o=$x(d);for(var g=0;g<o.length;g++){var _=o[g];if(":"!=_||f){var v=YP(_,WP);f?c.password+=v:c.username+=v}else f=!0}d=""}else if(r==sx||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()){if(h&&""==d)return"Invalid authority";l-=$x(d).length+1,d="",u=uU}else d+=r;break;case uU:case lU:if(t&&"file"==c.scheme){u=fU;continue}if(":"!=r||p){if(r==sx||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()){if(c.isSpecial()&&""==d)return AP;if(t&&""==d&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(d))return a;if(d="",u=gU,t)return;continue}"["==r?p=!0:"]"==r&&(p=!1),d+=r}else{if(""==d)return AP;if(a=c.parseHost(d))return a;if(d="",u=dU,t==lU)return}break;case dU:if(!mP(NP,r)){if(r==sx||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()||t){if(""!=d){var m=fP(d,10);if(m>65535)return RP;c.port=c.isSpecial()&&m===JP[c.scheme]?null:m,d=""}if(t)return;u=gU;continue}return RP}d+=r;break;case hU:if(c.scheme="file","/"==r||"\\"==r)u=pU;else{if(!n||"file"!=n.scheme){u=_U;continue}if(r==sx)c.host=n.host,c.path=eP(n.path),c.query=n.query;else if("?"==r)c.host=n.host,c.path=eP(n.path),c.query="",u=mU;else{if("#"!=r){XP(yP(eP(i,l),""))||(c.host=n.host,c.path=eP(n.path),c.shortenPath()),u=_U;continue}c.host=n.host,c.path=eP(n.path),c.query=n.query,c.fragment="",u=yU}}break;case pU:if("/"==r||"\\"==r){u=fU;break}n&&"file"==n.scheme&&!XP(yP(eP(i,l),""))&&(ZP(n.path[0],!0)?CP(c.path,n.path[0]):c.host=n.host),u=_U;continue;case fU:if(r==sx||"/"==r||"\\"==r||"?"==r||"#"==r){if(!t&&ZP(d))u=_U;else if(""==d){if(c.host="",t)return;u=gU}else{if(a=c.parseHost(d))return a;if("localhost"==c.host&&(c.host=""),t)return;d="",u=gU}continue}d+=r;break;case gU:if(c.isSpecial()){if(u=_U,"/"!=r&&"\\"!=r)continue}else if(t||"?"!=r)if(t||"#"!=r){if(r!=sx&&(u=_U,"/"!=r))continue}else c.fragment="",u=yU;else c.query="",u=mU;break;case _U:if(r==sx||"/"==r||"\\"==r&&c.isSpecial()||!t&&("?"==r||"#"==r)){if(".."===(s=kP(s=d))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"==r||"\\"==r&&c.isSpecial()||CP(c.path,"")):QP(d)?"/"==r||"\\"==r&&c.isSpecial()||CP(c.path,""):("file"==c.scheme&&!c.path.length&&ZP(d)&&(c.host&&(c.host=""),d=vP(d,0)+":"),CP(c.path,d)),d="","file"==c.scheme&&(r==sx||"?"==r||"#"==r))for(;c.path.length>1&&""===c.path[0];)EP(c.path);"?"==r?(c.query="",u=mU):"#"==r&&(c.fragment="",u=yU)}else d+=YP(r,KP);break;case vU:"?"==r?(c.query="",u=mU):"#"==r?(c.fragment="",u=yU):r!=sx&&(c.path[0]+=YP(r,HP));break;case mU:t||"#"!=r?r!=sx&&("'"==r&&c.isSpecial()?c.query+="%27":c.query+="#"==r?"%23":YP(r,HP)):(c.fragment="",u=yU);break;case yU:r!=sx&&(c.fragment+=YP(r,zP))}l++}},parseHost:function(e){var t,n,i;if("["==vP(e,0)){if("]"!=vP(e,e.length-1))return AP;if(t=function(e){var t,n,i,r,o,a,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,h=function(){return vP(e,d)};if(":"==h()){if(":"!=vP(e,1))return;d+=2,l=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=n=0;n<4&&mP(GP,h());)t=16*t+fP(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,u>6)return;for(i=0;h();){if(r=null,i>0){if(!("."==h()&&i<4))return;d++}if(!mP(NP,h()))return;for(;mP(NP,h());){if(o=fP(h(),10),null===r)r=o;else{if(0==r)return;r=10*r+o}if(r>255)return;d++}c[u]=256*c[u]+r,2!=++i&&4!=i||u++}if(4!=i)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(a=u-l,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[l+a-1],c[l+--a]=s;else if(8!=u)return;return c}(MP(e,1,-1)),!t)return AP;this.host=t}else if(this.isSpecial()){if(e=nP(e),mP(VP,e))return AP;if(t=function(e){var t,n,i,r,o,a,s,c=bP(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],i=0;i<t;i++){if(""==(r=c[i]))return e;if(o=10,r.length>1&&"0"==vP(r,0)&&(o=mP(xP,r)?16:8,r=MP(r,8==o?1:2)),""===r)a=0;else{if(!mP(10==o?UP:8==o?PP:GP,r))return e;a=fP(r,o)}CP(n,a)}for(i=0;i<t;i++)if(a=n[i],i==t-1){if(a>=_P(256,5-t))return null}else if(a>255)return null;for(s=TP(n),i=0;i<n.length;i++)s+=n[i]*_P(256,3-i);return s}(e),null===t)return AP;this.host=t}else{if(mP(FP,e))return AP;for(t="",n=$x(e),i=0;i<n.length;i++)t+=YP(n[i],HP);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return Xx(JP,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&ZP(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,r=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==r?(u+="//",e.includesCredentials()&&(u+=n+(i?":"+i:"")+"@"),u+=qP(r),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+yP(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw pP(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new TU(e.path[0]).origin}catch(qY){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+qP(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(iP(e)+":",$P)},getUsername:function(){return this.username},setUsername:function(e){var t=$x(iP(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=YP(t[n],WP)}},getPassword:function(){return this.password},setPassword:function(e){var t=$x(iP(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=YP(t[n],WP)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?qP(e):qP(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,uU)},getHostname:function(){var e=this.host;return null===e?"":qP(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,lU)},getPort:function(){var e=this.port;return null===e?"":iP(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=iP(e))?this.port=null:this.parse(e,dU))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+yP(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,gU))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=iP(e))?this.query=null:("?"==vP(e,0)&&(e=MP(e,1)),this.query="",this.parse(e,mU)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=iP(e))?("#"==vP(e,0)&&(e=MP(e,1)),this.fragment="",this.parse(e,yU)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var TU=function(e){var t=Zx(this,CU),n=oP(arguments.length,1)>1?arguments[1]:void 0,i=cP(t,new IU(e,!1,n));qx||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},CU=TU.prototype,SU=function(e,t){return{get:function(){return uP(this)[e]()},set:t&&function(e){return uP(this)[t](e)},configurable:!0,enumerable:!0}};if(qx&&(Jx(CU,"href",SU("serialize","setHref")),Jx(CU,"origin",SU("getOrigin")),Jx(CU,"protocol",SU("getProtocol","setProtocol")),Jx(CU,"username",SU("getUsername","setUsername")),Jx(CU,"password",SU("getPassword","setPassword")),Jx(CU,"host",SU("getHost","setHost")),Jx(CU,"hostname",SU("getHostname","setHostname")),Jx(CU,"port",SU("getPort","setPort")),Jx(CU,"pathname",SU("getPathname","setPathname")),Jx(CU,"search",SU("getSearch","setSearch")),Jx(CU,"searchParams",SU("getSearchParams")),Jx(CU,"hash",SU("getHash","setHash"))),Yx(CU,"toJSON",(function(){return uP(this).serialize()}),{enumerable:!0}),Yx(CU,"toString",(function(){return uP(this).serialize()}),{enumerable:!0}),hP){var EU=hP.createObjectURL,bU=hP.revokeObjectURL;EU&&Yx(TU,"createObjectURL",Kx(EU,hP)),bU&&Yx(TU,"revokeObjectURL",Kx(bU,hP))}rP(TU,"URL"),jx({global:!0,constructor:!0,forced:!Hx,sham:!qx},{URL:TU});var MU,kU,wU=new Blob(["class VolumeMeter extends AudioWorkletProcessor{constructor(){super();this.volume=0;this.intervalTime=200;this.tick=this.intervalTime;this.isStop=false;this.port.onmessage=event=>{const{data}=event;switch(data.name){case'setIntervalTime':this.intervalTime=data.intervalTime;break;case'stop':this.isStop=true;break}}}process(inputs){const input=inputs[0];if(this.isStop){return false}if(input.length>0){const firstChannel=input[0];let sum=0;let rms;for(let i=0;i<firstChannel.length;++i){sum+=firstChannel[i]*firstChannel[i]}rms=Math.sqrt(sum/firstChannel.length);this.volume=Math.max(rms,this.volume*0.95);this.tick-=firstChannel.length;if(this.tick<0){this.tick+=(this.intervalTime/1000)*sampleRate;this.port.postMessage({volume:this.volume})}}return true}}registerProcessor('volume-meter',VolumeMeter);"],{type:"application/javascript"}),DU=!1,AU=function(){function e(t){s(this,e),this.context_=t.context,this.addModuleToContext()}var t;return u(e,[{key:"addModuleToContext",value:(t=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.context_.audioWorklet.addModule(URL.createObjectURL(wU));case 3:UA.info("worklet addModule success"),VD.emit(AA),DU=!0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),UA.info("worklet addModule catch error. ".concat(e.t0.message)),VD.emit(RA);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return t.apply(this,arguments)})},{key:"initWorkletSuccess",get:function(){return DU}}]),e}(),RU=0,LU=function(){function e(t){s(this,e);var n=t.track,i=t.log,r=t.stream;this.volume_=0,this.log_=i,this.track_=n,this.stream_=r,MU||(MU=AD()),this.audioCtx_=MU,this.destination_=this.audioCtx_.destination;var o=new MediaStream;o.addTrack(this.track_),this.streamSource_=this.audioCtx_.createMediaStreamSource(o),this.audioWorkletNode_=null,this.scriptProcessorNode_=null,this.interval_=200,VD.on(DA,this.resume,this),VD.on(nA,this.handleAudioLevelInterval,this),LD?(VD.on(AA,this.initAudioWorklet,this),VD.on(RA,this.initScriptProcessor,this),this.preload()):this.initScriptProcessor(),RU+=1}return u(e,[{key:"preload",value:function(){kU?kU.initWorkletSuccess&&this.initAudioWorklet():kU=new AU({context:MU})}},{key:"initAudioWorklet",value:function(){var e=this;if(!this.audioWorkletNode_)try{this.audioWorkletNode_=new AudioWorkletNode(this.audioCtx_,"volume-meter"),this.audioWorkletNode_.port.onmessage=function(t){e.volume_=t.data.volume||0},this.streamSource_.connect(this.audioWorkletNode_).connect(this.destination_),this.handleAudioLevelInterval({interval:this.interval_})}catch(qY){this.log_.warn("load volume meter failed, load again."),this.initScriptProcessor()}}},{key:"initScriptProcessor",value:function(){var e=this;if(!this.scriptProcessorNode_)try{this.scriptProcessorNode_=this.audioCtx_.createScriptProcessor(2048,1,1),this.scriptProcessorNode_.onaudioprocess=function(t){for(var n=t.inputBuffer.getChannelData(0),i=0,r=0;r<n.length;++r)i+=n[r]*n[r];e.volume_=Math.sqrt(i/n.length)||0},this.streamSource_.connect(this.scriptProcessorNode_),this.scriptProcessorNode_.connect(this.destination_)}catch(qY){this.log_.error("volumeMeter init script processor error: "+qY)}}},{key:"destroy",value:function(){var e;this.streamSource_&&this.streamSource_.disconnect(),this.scriptProcessorNode_&&(this.scriptProcessorNode_.onaudioprocess=null,this.scriptProcessorNode_.disconnect()),this.audioWorkletNode_&&(this.audioWorkletNode_.port.postMessage({name:"stop"}),this.audioWorkletNode_.port.onmessage=null,this.audioWorkletNode_.disconnect()),this.audioWorkletNode_=null,this.scriptProcessorNode_=null,this.audioCtx_=null,VD.off(DA,this.resume,this),VD.off(nA,this.handleAudioLevelInterval,this),VD.off(AA,this.initAudioWorklet,this),VD.off(RA,this.initScriptProcessor,this),RU>0&&(RU-=1),0===RU&&(null===(e=MU)||void 0===e||e.close(),MU=null,kU=null)}},{key:"resume",value:function(){var e;null===(e=MU)||void 0===e||e.resume()}},{key:"getInternalAudioLevel",value:function(){return this.volume_}},{key:"getCalculatedVolume",value:function(){return this.volume_.toFixed(2)}},{key:"handleAudioLevelInterval",value:function(e){var t,n=e.interval;this.interval_=n,null===(t=this.audioWorkletNode_)||void 0===t||t.port.postMessage({name:"setIntervalTime",intervalTime:n})}}]),e}(),OU=function(){function e(t){s(this,e),this.stream_=t.stream,this.userId_=t.stream.getUserId(),this.log_=this.stream_.getLogger(),this.track_=t.track,t.gainedTrack&&(this.gainedTrack_=t.gainedTrack),this.div_=t.div,this.muted_=t.muted,this.outputDeviceId_=t.outputDeviceId,this.volume_=t.volume,this.pausedRetryCount_=5,this.emitter_=new GD,this.initializeElement(),this.state_="NONE",this.volumeMeter_=new LU({stream:this.stream_,track:this.gainedTrack_||this.track_,log:this.log_})}var t,n,r,o;return u(e,[{key:"isPlaying",get:function(){return this.state_===dS}},{key:"initializeElement",value:function(){if(this.isAudioElementInit()){var e=new MediaStream;e.addTrack(this.gainedTrack_||this.track_);var t=document.createElement(UC);t.srcObject=e,t.muted=this.muted_,t.setAttribute("id","audio_".concat(this.stream_.getId())),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),this.div_.appendChild(t),this.element_=t}this.handleEvents()}},{key:"setMuted",value:function(e){this.element_&&(this.element_.muted=e,this.muted_=e)}},{key:"play",value:(o=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.outputDeviceId_||!this.element_){e.next=3;break}return e.next=3,this.element_.setSinkId(this.outputDeviceId_);case 3:if(this.setVolume(this.volume_),e.prev=4,!this.element_){e.next=8;break}return e.next=8,this.element_.play();case 8:e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),t=aD({key:ok,data:{media:"Audio",error:e.t0}}),this.log_.warn(t),!t.includes("NotAllowedError")){e.next=16;break}throw new IL({code:yL.PLAY_NOT_ALLOWED,message:t});case 16:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return o.apply(this,arguments)})},{key:"handleEvents",value:function(){this.handleElementEvent=this.handleElementEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.element_&&(this.element_.addEventListener(ZC,this.handleElementEvent),this.element_.addEventListener(JC,this.handleElementEvent),this.element_.addEventListener(XC,this.handleElementEvent),this.element_.addEventListener(QC,this.handleElementEvent)),this.track_.addEventListener(JC,this.handleTrackEvent),this.track_.addEventListener(WC,this.handleTrackEvent),this.track_.addEventListener(YC,this.handleTrackEvent),this.track_.readyState===JC&&this.handleTrackEvent({type:JC}),this.track_.muted&&this.handleTrackEvent({type:WC})}},{key:"handleElementEvent",value:(r=a(i().mark((function e(t){var n,r,o,a,s,c,u,l=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.type,e.t0=n,e.next=e.t0===ZC?4:e.t0===JC?9:e.t0===XC?12:e.t0===QC?21:32;break;case 4:return this.log_.info("audio player is playing"),this.state_=dS,VD.emit(aA,{stream:this.stream_}),this.emitter_.emit(HN,{state:this.state_,reason:ZC}),e.abrupt("break",32);case 9:return this.log_.info("audio player is ended"),this.state_!==pS&&(this.state_=pS,this.emitter_.emit(HN,{state:this.state_,reason:JC})),e.abrupt("break",32);case 12:return this.log_.info("audio player is paused"),this.state_=hS,this.emitter_.emit(HN,{state:this.state_,reason:XC}),(r=this.div_&&document.getElementById(this.div_.id))||this.log_.warn("audio player has been remove, element ID: ".concat(this.div_.id)),o=jw(),this.pausedRetryCount_>0&&(vD(o)&&o<=70||!r)&&(this.resume(),this.pausedRetryCount_--),Qk&&(this.interval_=tN.run((function(){l.element_&&l.state_===hS&&l.resume()}),{delay:3e3})),e.abrupt("break",32);case 21:if(!this.element_||!this.element_.error){e.next=31;break}return a="".concat(DN(),"/").concat(iD().name,"/").concat(iD().version),e.next=25,jY.getSpeakers();case 25:s=e.sent,c=s[0].label,(u=s.find((function(e){return e.deviceId===l.outputDeviceId_})))&&(c=u.label),this.log_.error("audio player error observed. code: ".concat(this.element_.error.code," message: ").concat(this.element_.error.message," deviceInfo: ").concat(a," speaker: ").concat(c)),uO.uploadEvent("stat-".concat(this.stream_.getType(),"-audio-").concat(ME,"-").concat(this.element_.error.code,"-").concat(a,"-").concat(c),this.element_.error);case 31:return e.abrupt("break",32);case 32:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleTrackEvent",value:function(e){var t=e.type;switch(t){case JC:this.log_.info("audio track is ended"),this.state_!==pS&&(this.state_=pS,this.emitter_.emit(HN,{state:this.state_,reason:JC})),VD.emit(bA,{stream:this.stream_,type:t});break;case WC:this.log_.info("audio track is unable to provide media output"),this.stream_.isRemote()||DD(),this.state_!==hS&&(this.state_=hS,this.emitter_.emit(HN,{state:this.state_,reason:WC})),VD.emit(EA,{stream:this.stream_,type:t});break;case YC:this.log_.info("audio track is able to provide media output"),this.state_===hS&&(this.state_=dS,this.emitter_.emit(HN,{state:this.state_,reason:YC}))}}},{key:"unbindEvents",value:function(){this.element_&&(this.element_.removeEventListener(ZC,this.handleElementEvent),this.element_.removeEventListener(JC,this.handleElementEvent),this.element_.removeEventListener(XC,this.handleElementEvent),this.element_.removeEventListener(QC,this.handleElementEvent)),this.track_&&(this.track_.removeEventListener(JC,this.handleTrackEvent),this.track_.removeEventListener(WC,this.handleTrackEvent),this.track_.removeEventListener(YC,this.handleTrackEvent))}},{key:"setSinkId",value:(n=a(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.outputDeviceId_===t){e.next=5;break}if(!this.element_){e.next=4;break}return e.next=4,this.element_.setSinkId(t);case 4:this.outputDeviceId_=t;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setVolume",value:function(e){this.element_&&(this.log_.info("audioElement setVolume to : ".concat(e)),this.element_.volume=e)}},{key:"getAudioLevel",value:function(){return this.volumeMeter_.getCalculatedVolume()}},{key:"getInternalAudioLevel",value:function(){return this.volumeMeter_.getInternalAudioLevel()}},{key:"stop",value:function(){this.unbindEvents(),this.element_&&(this.div_.removeChild(this.element_),this.element_.srcObject=null,this.element_=null),this.volumeMeter_&&(this.volumeMeter_.destroy(),this.volumeMeter_=null),this.interval_>0&&tN.clearTask(this.interval_)}},{key:"resume",value:(t=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.volumeMeter_&&this.volumeMeter_.resume(),!this.element_){e.next=5;break}return e.next=5,this.element_.play();case 5:e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(0),t=aD({key:ok,data:{media:"Audio",error:e.t0}}),this.log_.warn(t),!t.includes("NotAllowedError")){e.next=13;break}throw new IL({code:yL.PLAY_NOT_ALLOWED,message:t});case 13:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return t.apply(this,arguments)})},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"isAudioElementInit",value:function(){return!("15.2"===Zw||"15.3"===Zw||"15.4"===Zw)||"local"!==this.stream_.getType()||!this.muted_||(this.log_.info("audioElement is muted."),!1)}}]),e}(),NU=Rn.PROPER,xU=R,PU=om,UU=pm.trim;br({target:"String",proto:!0,forced:function(e){return xU((function(){return!!PU[e]()||"​᠎"!=="​᠎"[e]()||NU&&PU[e].name!==e}))}("trim")},{trim:function(){return UU(this)}});var GU="trtc_autoplay",VU="".concat(GU,"_mask"),FU="".concat(GU,"_wrapper"),BU="".concat(GU,"_header"),jU="".concat(GU,"_content"),qU="".concat(GU,"_action_wrapper"),HU="".concat(GU,"_question"),zU="".concat(GU,"_collapse"),KU="".concat(GU,"_action_confirm"),WU="".concat(GU,"_detail"),YU="#2473E8",JU="dialog",ZU="".concat(JU,"-show"),XU="".concat(JU,"-1"),QU="".concat(JU,"-2"),$U=!1,eG=function(){return!!document.querySelector(".".concat(FU))},tG="".concat(ub,"/").concat(wD()?"zh-cn":"en","/tutorial-21-advanced-auto-play-policy.html"),nG="<br><a href='".concat(tG,"' target='_blank'>").concat(wD()?"其他方案？":"Any other solution?","</a>"),iG="".concat(wD()?"浏览器自动播放策略：在用户与页面产生交互（点击、触摸）之前，浏览器禁止播放有声媒体。该弹窗用于帮助用户恢复音视频播放。".concat(nG):"Autoplay Policy: Before user interacts with the web page (clicking, touching), page will not be allowed to play media with sound. This Dialog is used to help users resume playback. ".concat(nG)),rG=function(){function e(){if(s(this,e),this.dialogNode_=null,this.bodyPosition_="",this.content="音视频播放被浏览器拦截，请点击“恢复播放”。",wD()||(this.content='Media playback failed. Click the "Resume" to resume playback.'),!$U){var t=document.createElement("style");t.innerHTML=".".concat(VU,"{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.5);z-index:1500;}.").concat(VU," div:not(.").concat(qU,"){display:block !important;}.").concat(FU,"{padding:14px;background:#fff;border-radius:3px;box-shadow:0px 3px 15px #434343;border:1px solid #d1cfcf;max-width:500px;}.").concat(FU," a{color:").concat(YU,";}.").concat(BU,"{overflow:hidden;text-overflow:ellipsis;font-size:16px;font-weight:600;}.").concat(jU,"{margin:8px 0;}.").concat(qU,"{width:100%;display:flex !important;align-items:center;justify-content:right;float:right;}.").concat(zU,"{margin-right:auto;cursor:pointer}.").concat(HU,"{height:100%;line-height:16px;cursor:pointer;}.").concat(KU,"{margin-left:8px;color:#fff;background:").concat(YU,";padding:4px 12px;outline:none;border:1px solid;border-radius:3px;font-weight:bold;}.").concat(KU,":hover{opacity:0.9;}.").concat(zU,",.").concat(KU,",.").concat(jU,",.").concat(HU,"{font-size:14px;}@media screen and (max-width:750px){.").concat(FU,"{width:80vw;}}"),document.head.appendChild(t),$U=!0}this.showDetail_=!1,this.isCollapseClicked_=!1,this.isQuestionClicked_=!1,this.addDiaLog()}return u(e,[{key:"createDiaLog",value:function(){var e=document.createElement("template");e.innerHTML='<div class="'.concat(VU,"\"><div class='").concat(FU,"'><div class='").concat(BU,"'>").concat(location.host,"</div><div class='").concat(jU,"'>").concat(this.content,"</div><div class='").concat(WU,'\' style="visibility:hidden;width:100%;height:0;font-size:12px;color:gray;">').concat(iG,"</div><div class='").concat(qU,"'></div></div></div>").trim();var t=document.createElement("button");t.className=KU,t.innerText=wD()?"恢复播放":"Resume",t.onclick=this.onConfirm.bind(this);var n=document.createElement("div");n.className=HU,n.innerHTML='<?xml version="1.0" encoding="UTF-8"?>\n    <svg class="icon" width="18" height="18" p-id="2030" t="1639646523624" version="1.1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n    <path d="m464 784.35c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z" p-id="2031"/>\n    <path d="m512 960c-247.04 0-448-200.96-448-448s200.96-448 448-448 448 200.96 448 448-200.96 448-448 448zm0-831.71c-211.58 0-383.71 172.13-383.71 383.71 0 211.55 172.13 383.71 383.71 383.71 211.55 0 383.71-172.16 383.71-383.71 0-211.58-172.16-383.71-383.71-383.71z" p-id="2032"/>\n    <path d="m512 673.7c-17.665 0-32.001-14.336-32.001-31.999v-54.112c0-52.353 40-92.352 75.328-127.65 25.887-25.92 52.672-52.672 52.672-74.017 0-53.343-43.072-96.735-95.999-96.735-53.823 0-95.999 41.536-95.999 94.559 0 17.665-14.336 31.999-32.001 31.999s-32.001-14.336-32.001-31.999c0-87.424 71.775-158.56 160-158.56s160 72.095 160 160.74c0 47.904-36.32 84.192-71.424 119.3-27.84 27.776-56.576 56.512-56.576 82.336v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="2033"/>\n    </svg>\n    ',n.onclick=this.onQuestionClick.bind(this);var i=document.createElement("div");i.className=zU,i.innerText="".concat(wD()?"详情 >":"Detail >"),i.onclick=this.onCollapseClick.bind(this);var r=e.content.firstChild,o=r.querySelector(".".concat(qU));return o.appendChild(i),o.appendChild(n),o.appendChild(t),r}},{key:"addDiaLog",value:function(){eG()||(this.dialogNode_=this.createDiaLog(),document.body.appendChild(this.dialogNode_),this.dialogNode_.onclick=this.onConfirm.bind(this),this.dialogNode_.querySelector(".".concat(FU)).onclick=function(e){return e.stopPropagation()},this.bodyPosition_=document.body.style.position,document.body.style.position="fixed",UA.info("show autoplay dialog"),uO.uploadEvent({log:ZU}))}},{key:"deleteDiaLog",value:function(){this.dialogNode_&&(document.body.removeChild(this.dialogNode_),document.body.style.position=this.bodyPosition_,this.dialogNode_=null)}},{key:"onConfirm",value:function(){UA.warn("confirm clicked, try resume stream"),VD.emit(DA),this.deleteDiaLog()}},{key:"onCollapseClick",value:function(){var e=this.dialogNode_.querySelector(".".concat(WU));e.style.visibility="".concat(this.showDetail_?"hidden":"visible"),e.style.height="".concat(this.showDetail_?0:"fit-content"),this.showDetail_=!this.showDetail_,this.isCollapseClicked_||uO.uploadEvent({log:XU}),this.isCollapseClicked_=!0}},{key:"onQuestionClick",value:function(){window.open(tG,"_blank"),this.isQuestionClicked_||uO.uploadEvent({log:QU}),this.isQuestionClicked_=!0}}]),e}(),oG=function(){function e(t){s(this,e),this.stream_=t.stream,this.userId_=t.stream.getUserId(),this.log_=this.stream_.getLogger(),this.track_=t.track,this.div_=t.div,this.muted_=t.muted,this.objectFit_=t.objectFit,this.mirror_=t.mirror,this.emitter_=new GD,this.initializeElement(),this.state_="NONE",this.pausedRetryCount_=5}var t;return u(e,[{key:"isPlaying",get:function(){return this.state_===dS}},{key:"initializeElement",value:function(){var e=new MediaStream;e.addTrack(this.track_);var t=document.createElement(GC);t.srcObject=e,t.muted=!0;var n="width: 100%; height: 100%; object-fit: ".concat(this.objectFit_,";");this.mirror_&&(n+="transform: scaleX(-1);"),t.setAttribute("id","video_".concat(this.stream_.getId())),t.setAttribute("style",n),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),this.div_&&this.div_.appendChild(t),this.element_=t,this.handleEvents()}},{key:"setRect",value:function(e){var t=e.width,n=e.height;this.element_&&(this.element_.style.width=t+"px",this.element_.style.height=n+"px")}},{key:"setMirror",value:function(e){this.element_&&(this.element_.style.transform=e?"scaleX(-1)":"",this.mirror_=e)}},{key:"setObjectFit",value:function(e){this.element_&&(this.element_.style.objectFit="".concat(e),this.objectFit_=e)}},{key:"play",value:(t=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.element_.play();case 3:e.next=11;break;case 5:if(e.prev=5,e.t0=e.catch(0),t=aD({key:ok,data:{media:"Video",error:e.t0}}),this.log_.warn(t),!t.includes("NotAllowedError")){e.next=11;break}throw new IL({code:yL.PLAY_NOT_ALLOWED,message:t});case 11:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"handleEvents",value:function(){this.handleElementEvent=this.handleElementEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.element_.addEventListener(ZC,this.handleElementEvent),this.element_.addEventListener(JC,this.handleElementEvent),this.element_.addEventListener(XC,this.handleElementEvent),this.element_.addEventListener(QC,this.handleElementEvent),this.element_.addEventListener($C,this.handleElementEvent),this.track_.addEventListener(JC,this.handleTrackEvent),this.track_.addEventListener(WC,this.handleTrackEvent),this.track_.addEventListener(YC,this.handleTrackEvent),this.track_.readyState===JC&&this.handleTrackEvent({type:JC}),this.track_.muted&&this.handleTrackEvent({type:WC})}},{key:"handleElementEvent",value:function(e){var t=this;switch(e.type){case ZC:this.log_.info("video player is playing"),this.state_=dS,VD.emit(oA,{stream:this.stream_}),this.emitter_.emit(HN,{state:this.state_,reason:ZC}),this.interval_&&(tN.clearTask(this.interval_),this.interval_=null);break;case JC:this.log_.info("video player is ended"),this.state_!==pS&&(this.state_=pS,this.emitter_.emit(HN,{state:this.state_,reason:JC}));break;case XC:this.log_.info("video player is paused"),this.div_&&!document.getElementById(this.div_.id)&&this.log_.warn("video player has been remove, element ID: ".concat(this.div_.id)),this.state_=hS,this.emitter_.emit(HN,{state:this.state_,reason:XC}),this.pausedRetryCount_>0&&!eG()&&(this.log_.info("video player auto resume when video paused"),this.resume(),this.pausedRetryCount_--),Qk&&(this.interval_=tN.run((function(){t.element_&&t.state_===hS&&t.resume()}),{delay:3e3}));break;case QC:if(this.element_&&this.element_.error){var n="".concat(DN(),"/").concat(iD().name,"/").concat(iD().version);this.log_.error("video player error observed. code: ".concat(this.element_.error.code," message: ").concat(this.element_.error.message," deviceInfo: ").concat(n)),uO.uploadEvent("stat-".concat(this.stream_.getType(),"-video-").concat(ME,"-").concat(this.element_.error.code,"-").concat(n),this.element_.error)}break;case $C:VD.emit(TA,{stream:this.stream_})}}},{key:"handleTrackEvent",value:function(e){var t=e.type;switch(t){case JC:this.log_.info("video track is ended"),VD.emit(SA,{stream:this.stream_,type:t}),this.state_!==pS&&(this.state_=pS,this.emitter_.emit(HN,{state:this.state_,reason:JC}));break;case WC:this.log_.info("video track is unable to provide media output"),this.stream_.isRemote()||DD(),VD.emit(mA,{stream:this.stream_,type:t}),this.state_!==hS&&(this.state_=hS,this.emitter_.emit(HN,{state:this.state_,reason:WC}));break;case YC:this.log_.info("video track is able to provide media output"),VD.emit(yA,{stream:this.stream_}),this.state_===hS&&(this.state_=dS,this.emitter_.emit(HN,{state:this.state_,reason:YC}))}}},{key:"unbindEvents",value:function(){this.element_&&(this.element_.removeEventListener(ZC,this.handleElementEvent),this.element_.removeEventListener(JC,this.handleElementEvent),this.element_.removeEventListener(XC,this.handleElementEvent),this.element_.removeEventListener(QC,this.handleElementEvent),this.element_.removeEventListener($C,this.handleElementEvent)),this.track_&&(this.track_.removeEventListener(JC,this.handleTrackEvent),this.track_.removeEventListener(WC,this.handleTrackEvent),this.track_.removeEventListener(YC,this.handleTrackEvent))}},{key:"stop",value:function(){this.unbindEvents(),this.div_&&this.div_.removeChild(this.element_),this.element_.srcObject=null,this.element_=null,this.interval_&&tN.clearTask(this.interval_)}},{key:"resume",value:function(){return this.play()}},{key:"getVideoFrame",value:function(){var e=document.createElement("canvas");return e.width=this.element_.videoWidth,e.height=this.element_.videoHeight,e.getContext("2d").drawImage(this.element_,0,0),e.toDataURL("image/png")}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"getElement",value:function(){return this.element_?this.element_:null}}]),e}(),aG="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,sG=wi,cG=xi,uG=RangeError,lG=function(e){if(void 0===e)return 0;var t=sG(e),n=cG(t);if(t!==n)throw uG("Wrong length or index");return n},dG=Array,hG=Math.abs,pG=Math.pow,fG=Math.floor,gG=Math.log,_G=Math.LN2,vG={pack:function(e,t,n){var i,r,o,a=dG(n),s=8*n-t-1,c=(1<<s)-1,u=c>>1,l=23===t?pG(2,-24)-pG(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=hG(e))!=e||1/0===e?(r=e!=e?1:0,i=c):(i=fG(gG(e)/_G),e*(o=pG(2,-i))<1&&(i--,o*=2),(e+=i+u>=1?l/o:l*pG(2,1-u))*o>=2&&(i++,o/=2),i+u>=c?(r=0,i=c):i+u>=1?(r=(e*o-1)*pG(2,t),i+=u):(r=e*pG(2,u-1)*pG(2,t),i=0));t>=8;)a[h++]=255&r,r/=256,t-=8;for(i=i<<t|r,s+=t;s>0;)a[h++]=255&i,i/=256,s-=8;return a[--h]|=128*d,a},unpack:function(e,t){var n,i=e.length,r=8*i-t-1,o=(1<<r)-1,a=o>>1,s=r-7,c=i-1,u=e[c--],l=127&u;for(u>>=7;s>0;)l=256*l+e[c--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[c--],s-=8;if(0===l)l=1-a;else{if(l===o)return n?NaN:u?-1/0:1/0;n+=pG(2,t),l-=a}return(u?-1:1)*n*pG(2,l-t)}},mG=ht,yG=Li,IG=Ui,TG=function(e){for(var t=mG(this),n=IG(t),i=arguments.length,r=yG(i>1?arguments[1]:void 0,n),o=i>2?arguments[2]:void 0,a=void 0===o?n:yG(o,n);a>r;)t[r++]=e;return t},CG=D,SG=te,EG=L,bG=aG,MG=Rn,kG=En,wG=el,DG=R,AG=ku,RG=wi,LG=xi,OG=lG,NG=vG,xG=xa,PG=cs,UG=Ei.f,GG=on.f,VG=TG,FG=dc,BG=Ya,jG=MG.PROPER,qG=MG.CONFIGURABLE,HG=ai.get,zG=ai.set,KG="ArrayBuffer",WG="DataView",YG="Wrong index",JG=CG.ArrayBuffer,ZG=JG,XG=ZG&&ZG.prototype,QG=CG.DataView,$G=QG&&QG.prototype,eV=Object.prototype,tV=CG.Array,nV=CG.RangeError,iV=SG(VG),rV=SG([].reverse),oV=NG.pack,aV=NG.unpack,sV=function(e){return[255&e]},cV=function(e){return[255&e,e>>8&255]},uV=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},lV=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},dV=function(e){return oV(e,23,4)},hV=function(e){return oV(e,52,8)},pV=function(e,t){GG(e.prototype,t,{get:function(){return HG(this)[t]}})},fV=function(e,t,n,i){var r=OG(n),o=HG(e);if(r+t>o.byteLength)throw nV(YG);var a=HG(o.buffer).bytes,s=r+o.byteOffset,c=FG(a,s,s+t);return i?c:rV(c)},gV=function(e,t,n,i,r,o){var a=OG(n),s=HG(e);if(a+t>s.byteLength)throw nV(YG);for(var c=HG(s.buffer).bytes,u=a+s.byteOffset,l=i(+r),d=0;d<t;d++)c[u+d]=l[o?d:t-d-1]};if(bG){var _V=jG&&JG.name!==KG;if(DG((function(){JG(1)}))&&DG((function(){new JG(-1)}))&&!DG((function(){return new JG,new JG(1.5),new JG(NaN),1!=JG.length||_V&&!qG})))_V&&qG&&kG(JG,"name",KG);else{(ZG=function(e){return AG(this,XG),new JG(OG(e))}).prototype=XG;for(var vV,mV=UG(JG),yV=0;mV.length>yV;)(vV=mV[yV++])in ZG||kG(ZG,vV,JG[vV]);XG.constructor=ZG}PG&&xG($G)!==eV&&PG($G,eV);var IV=new QG(new ZG(2)),TV=SG($G.setInt8);IV.setInt8(0,2147483648),IV.setInt8(1,2147483649),!IV.getInt8(0)&&IV.getInt8(1)||wG($G,{setInt8:function(e,t){TV(this,e,t<<24>>24)},setUint8:function(e,t){TV(this,e,t<<24>>24)}},{unsafe:!0})}else XG=(ZG=function(e){AG(this,XG);var t=OG(e);zG(this,{bytes:iV(tV(t),0),byteLength:t}),EG||(this.byteLength=t)}).prototype,QG=function(e,t,n){AG(this,$G),AG(e,XG);var i=HG(e).byteLength,r=RG(t);if(r<0||r>i)throw nV("Wrong offset");if(r+(n=void 0===n?i-r:LG(n))>i)throw nV("Wrong length");zG(this,{buffer:e,byteLength:n,byteOffset:r}),EG||(this.buffer=e,this.byteLength=n,this.byteOffset=r)},$G=QG.prototype,EG&&(pV(ZG,"byteLength"),pV(QG,"buffer"),pV(QG,"byteLength"),pV(QG,"byteOffset")),wG($G,{getInt8:function(e){return fV(this,1,e)[0]<<24>>24},getUint8:function(e){return fV(this,1,e)[0]},getInt16:function(e){var t=fV(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=fV(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return lV(fV(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return lV(fV(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return aV(fV(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return aV(fV(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){gV(this,1,e,sV,t)},setUint8:function(e,t){gV(this,1,e,sV,t)},setInt16:function(e,t){gV(this,2,e,cV,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){gV(this,2,e,cV,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){gV(this,4,e,uV,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){gV(this,4,e,uV,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){gV(this,4,e,dV,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){gV(this,8,e,hV,t,arguments.length>2?arguments[2]:void 0)}});BG(ZG,KG),BG(QG,WG);var CV={ArrayBuffer:ZG,DataView:QG},SV=br,EV=te,bV=R,MV=ln,kV=Li,wV=xi,DV=Uy,AV=CV.ArrayBuffer,RV=CV.DataView,LV=RV.prototype,OV=EV(AV.prototype.slice),NV=EV(LV.getUint8),xV=EV(LV.setUint8);SV({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:bV((function(){return!new AV(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(OV&&void 0===t)return OV(MV(this),e);for(var n=MV(this).byteLength,i=kV(e,n),r=kV(void 0===t?n:t,n),o=new(DV(this,AV))(wV(r-i)),a=new RV(this),s=new RV(o),c=0;i<r;)xV(s,c++,NV(a,i++));return o}}),br({global:!0,constructor:!0,forced:!aG},{DataView:CV.DataView});var PV=br,UV=Cd,GV=te([].reverse),VV=[1,2];PV({target:"Array",proto:!0,forced:String(VV)===String(VV.reverse())},{reverse:function(){return UV(this)&&(this.length=this.length),GV(this)}});var FV=Ye,BV=ht,jV=ae,qV=Ui,HV=TypeError,zV=function(e){return function(t,n,i,r){FV(n);var o=BV(t),a=jV(o),s=qV(o),c=e?s-1:0,u=e?-1:1;if(i<2)for(;;){if(c in a){r=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw HV("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(r=n(r,a[c],c,o));return r}},KV={left:zV(!1),right:zV(!0)},WV=KV.left,YV=Oe,JV=wy;br({target:"Array",proto:!0,forced:!kh("reduce")||!JV&&YV>79&&YV<83},{reduce:function(e){var t=arguments.length;return WV(this,e,t,t>1?arguments[1]:void 0)}});var ZV=ol,XV="ArrayBuffer",QV=CV.ArrayBuffer;br({global:!0,constructor:!0,forced:D.ArrayBuffer!==QV},{ArrayBuffer:QV}),ZV(XV);var $V=br,eF=Cd,tF=Pd,nF=Ie,iF=Li,rF=Ui,oF=pe,aF=oc,sF=Rt,cF=sd,uF=th("slice"),lF=sF("species"),dF=Array,hF=Math.max;$V({target:"Array",proto:!0,forced:!uF},{slice:function(e,t){var n,i,r,o=oF(this),a=rF(o),s=iF(e,a),c=iF(void 0===t?a:t,a);if(eF(o)&&(n=o.constructor,(tF(n)&&(n===dF||eF(n.prototype))||nF(n)&&null===(n=n[lF]))&&(n=void 0),n===dF||void 0===n))return cF(o,s,c);for(i=new(void 0===n?dF:n)(hF(c-s,0)),r=0;s<c;s++,r++)s in o&&aF(i,r,o[s]);return i.length=r,i}});var pF=D,fF=R,gF=te,_F=Sl,vF=pm.trim,mF=om,yF=pF.parseInt,IF=pF.Symbol,TF=IF&&IF.iterator,CF=/^[+-]?0x/i,SF=gF(CF.exec),EF=8!==yF(mF+"08")||22!==yF(mF+"0x16")||TF&&!fF((function(){yF(Object(TF))}))?function(e,t){var n=vF(_F(e));return yF(n,t>>>0||(SF(CF,n)?16:10))}:yF;br({global:!0,forced:parseInt!=EF},{parseInt:EF});var bF,MF,kF,wF={exports:{}},DF=aG,AF=L,RF=D,LF=ve,OF=Ie,NF=gt,xF=Xs,PF=He,UF=En,GF=Si,VF=on.f,FF=be,BF=xa,jF=cs,qF=Rt,HF=It,zF=ai.enforce,KF=ai.get,WF=RF.Int8Array,YF=WF&&WF.prototype,JF=RF.Uint8ClampedArray,ZF=JF&&JF.prototype,XF=WF&&BF(WF),QF=YF&&BF(YF),$F=Object.prototype,eB=RF.TypeError,tB=qF("toStringTag"),nB=HF("TYPED_ARRAY_TAG"),iB="TypedArrayConstructor",rB=DF&&!!jF&&"Opera"!==xF(RF.opera),oB=!1,aB={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},sB={BigInt64Array:8,BigUint64Array:8},cB=function(e){var t=BF(e);if(OF(t)){var n=KF(t);return n&&NF(n,iB)?n.TypedArrayConstructor:cB(t)}},uB=function(e){if(!OF(e))return!1;var t=xF(e);return NF(aB,t)||NF(sB,t)};for(bF in aB)(kF=(MF=RF[bF])&&MF.prototype)?zF(kF).TypedArrayConstructor=MF:rB=!1;for(bF in sB)(kF=(MF=RF[bF])&&MF.prototype)&&(zF(kF).TypedArrayConstructor=MF);if((!rB||!LF(XF)||XF===Function.prototype)&&(XF=function(){throw eB("Incorrect invocation")},rB))for(bF in aB)RF[bF]&&jF(RF[bF],XF);if((!rB||!QF||QF===$F)&&(QF=XF.prototype,rB))for(bF in aB)RF[bF]&&jF(RF[bF].prototype,QF);if(rB&&BF(ZF)!==QF&&jF(ZF,QF),AF&&!NF(QF,tB))for(bF in oB=!0,VF(QF,tB,{get:function(){return OF(this)?this[nB]:void 0}}),aB)RF[bF]&&UF(RF[bF],nB,bF);var lB={NATIVE_ARRAY_BUFFER_VIEWS:rB,TYPED_ARRAY_TAG:oB&&nB,aTypedArray:function(e){if(uB(e))return e;throw eB("Target is not a typed array")},aTypedArrayConstructor:function(e){if(LF(e)&&(!jF||FF(XF,e)))return e;throw eB(PF(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,i){if(AF){if(n)for(var r in aB){var o=RF[r];if(o&&NF(o.prototype,e))try{delete o.prototype[e]}catch(qY){try{o.prototype[e]=t}catch(s){}}}QF[e]&&!n||GF(QF,e,n?t:rB&&YF[e]||t,i)}},exportTypedArrayStaticMethod:function(e,t,n){var i,r;if(AF){if(jF){if(n)for(i in aB)if((r=RF[i])&&NF(r,e))try{delete r[e]}catch(qY){}if(XF[e]&&!n)return;try{return GF(XF,e,n?t:rB&&XF[e]||t)}catch(qY){}}for(i in aB)!(r=RF[i])||r[e]&&!n||GF(r,e,t)}},getTypedArrayConstructor:cB,isView:function(e){if(!OF(e))return!1;var t=xF(e);return"DataView"===t||NF(aB,t)||NF(sB,t)},isTypedArray:uB,TypedArray:XF,TypedArrayPrototype:QF},dB=D,hB=R,pB=Lu,fB=lB.NATIVE_ARRAY_BUFFER_VIEWS,gB=dB.ArrayBuffer,_B=dB.Int8Array,vB=!fB||!hB((function(){_B(1)}))||!hB((function(){new _B(-1)}))||!pB((function(e){new _B,new _B(null),new _B(1.5),new _B(e)}),!0)||hB((function(){return 1!==new _B(new gB(2),1,void 0).length})),mB=wi,yB=RangeError,IB=function(e){var t=mB(e);if(t<0)throw yB("The argument can't be less than 0");return t},TB=RangeError,CB=function(e,t){var n=IB(e);if(n%t)throw TB("Wrong offset");return n},SB=Xs,EB=te("".slice),bB=Vt,MB=TypeError,kB=function(e){var t=bB(e,"number");if("number"==typeof t)throw MB("Can't convert number to bigint");return BigInt(t)},wB=qc,DB=P,AB=Ly,RB=ht,LB=Ui,OB=au,NB=$c,xB=Wc,PB=function(e){return"Big"===EB(SB(e),0,3)},UB=lB.aTypedArrayConstructor,GB=kB,VB=br,FB=D,BB=P,jB=L,qB=vB,HB=lB,zB=CV,KB=ku,WB=q,YB=En,JB=BA,ZB=xi,XB=lG,QB=CB,$B=jt,ej=gt,tj=Xs,nj=Ie,ij=je,rj=_a,oj=be,aj=cs,sj=Ei.f,cj=function(e){var t,n,i,r,o,a,s,c,u=AB(this),l=RB(e),d=arguments.length,h=d>1?arguments[1]:void 0,p=void 0!==h,f=NB(l);if(f&&!xB(f))for(c=(s=OB(l,f)).next,l=[];!(a=DB(c,s)).done;)l.push(a.value);for(p&&d>2&&(h=wB(h,arguments[2])),n=LB(l),i=new(UB(u))(n),r=PB(i),t=0;n>t;t++)o=p?h(l[t],t):l[t],i[t]=r?GB(o):+o;return i},uj=Xd.forEach,lj=ol,dj=on,hj=A,pj=Pu,fj=ai.get,gj=ai.set,_j=ai.enforce,vj=dj.f,mj=hj.f,yj=Math.round,Ij=FB.RangeError,Tj=zB.ArrayBuffer,Cj=Tj.prototype,Sj=zB.DataView,Ej=HB.NATIVE_ARRAY_BUFFER_VIEWS,bj=HB.TYPED_ARRAY_TAG,Mj=HB.TypedArray,kj=HB.TypedArrayPrototype,wj=HB.aTypedArrayConstructor,Dj=HB.isTypedArray,Aj="BYTES_PER_ELEMENT",Rj="Wrong length",Lj=function(e,t){wj(e);for(var n=0,i=t.length,r=new e(i);i>n;)r[n]=t[n++];return r},Oj=function(e,t){vj(e,t,{get:function(){return fj(this)[t]}})},Nj=function(e){var t;return oj(Cj,e)||"ArrayBuffer"==(t=tj(e))||"SharedArrayBuffer"==t},xj=function(e,t){return Dj(e)&&!ij(t)&&t in e&&JB(+t)&&t>=0},Pj=function(e,t){return t=$B(t),xj(e,t)?WB(2,e[t]):mj(e,t)},Uj=function(e,t,n){return t=$B(t),!(xj(e,t)&&nj(n)&&ej(n,"value"))||ej(n,"get")||ej(n,"set")||n.configurable||ej(n,"writable")&&!n.writable||ej(n,"enumerable")&&!n.enumerable?vj(e,t,n):(e[t]=n.value,e)};jB?(Ej||(hj.f=Pj,dj.f=Uj,Oj(kj,"buffer"),Oj(kj,"byteOffset"),Oj(kj,"byteLength"),Oj(kj,"length")),VB({target:"Object",stat:!0,forced:!Ej},{getOwnPropertyDescriptor:Pj,defineProperty:Uj}),wF.exports=function(e,t,n){var i=e.match(/\d+$/)[0]/8,r=e+(n?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=FB[r],c=s,u=c&&c.prototype,l={},d=function(e,t){vj(e,t,{get:function(){return function(e,t){var n=fj(e);return n.view[o](t*i+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){var o=fj(e);n&&(r=(r=yj(r))<0?0:r>255?255:255&r),o.view[a](t*i+o.byteOffset,r,!0)}(this,t,e)},enumerable:!0})};Ej?qB&&(c=t((function(e,t,n,r){return KB(e,u),pj(nj(t)?Nj(t)?void 0!==r?new s(t,QB(n,i),r):void 0!==n?new s(t,QB(n,i)):new s(t):Dj(t)?Lj(c,t):BB(cj,c,t):new s(XB(t)),e,c)})),aj&&aj(c,Mj),uj(sj(s),(function(e){e in c||YB(c,e,s[e])})),c.prototype=u):(c=t((function(e,t,n,r){KB(e,u);var o,a,s,l=0,h=0;if(nj(t)){if(!Nj(t))return Dj(t)?Lj(c,t):BB(cj,c,t);o=t,h=QB(n,i);var p=t.byteLength;if(void 0===r){if(p%i)throw Ij(Rj);if((a=p-h)<0)throw Ij(Rj)}else if((a=ZB(r)*i)+h>p)throw Ij(Rj);s=a/i}else s=XB(t),o=new Tj(a=s*i);for(gj(e,{buffer:o,byteOffset:h,byteLength:a,length:s,view:new Sj(o)});l<s;)d(e,l++)})),aj&&aj(c,Mj),u=c.prototype=rj(kj)),u.constructor!==c&&YB(u,"constructor",c),_j(u).TypedArrayConstructor=c,bj&&YB(u,bj,r);var h=c!=s;l[r]=c,VB({global:!0,constructor:!0,forced:h,sham:!Ej},l),Aj in c||YB(c,Aj,i),Aj in u||YB(u,Aj,i),lj(r)}):wF.exports=function(){},(0,wF.exports)("Uint8",(function(e){return function(t,n,i){return e(this,t,n,i)}}));var Gj=ht,Vj=Li,Fj=Ui,Bj=hh,jj=Math.min,qj=[].copyWithin||function(e,t){var n=Gj(this),i=Fj(n),r=Vj(e,i),o=Vj(t,i),a=arguments.length>2?arguments[2]:void 0,s=jj((void 0===a?i:Vj(a,i))-o,i-r),c=1;for(o<r&&r<o+s&&(c=-1,o+=s-1,r+=s-1);s-- >0;)o in n?n[r]=n[o]:Bj(n,r),r+=c,o+=c;return n},Hj=lB,zj=te(qj),Kj=Hj.aTypedArray;(0,Hj.exportTypedArrayMethod)("copyWithin",(function(e,t){return zj(Kj(this),e,t,arguments.length>2?arguments[2]:void 0)}));var Wj=Xd.every,Yj=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("every",(function(e){return Wj(Yj(this),e,arguments.length>1?arguments[1]:void 0)}));var Jj=TG,Zj=kB,Xj=Xs,Qj=P,$j=R,eq=lB.aTypedArray,tq=lB.exportTypedArrayMethod,nq=te("".slice);tq("fill",(function(e){var t=arguments.length;eq(this);var n="Big"===nq(Xj(this),0,3)?Zj(e):+e;return Qj(Jj,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),$j((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var iq=Ui,rq=Uy,oq=lB.aTypedArrayConstructor,aq=lB.getTypedArrayConstructor,sq=function(e){return oq(rq(e,aq(e)))},cq=function(e,t){for(var n=0,i=iq(t),r=new e(i);i>n;)r[n]=t[n++];return r},uq=sq,lq=Xd.filter,dq=function(e,t){return cq(uq(e),t)},hq=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("filter",(function(e){var t=lq(hq(this),e,arguments.length>1?arguments[1]:void 0);return dq(this,t)}));var pq=Xd.find,fq=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("find",(function(e){return pq(fq(this),e,arguments.length>1?arguments[1]:void 0)}));var gq=Xd.findIndex,_q=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("findIndex",(function(e){return gq(_q(this),e,arguments.length>1?arguments[1]:void 0)}));var vq=Xd.forEach,mq=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("forEach",(function(e){vq(mq(this),e,arguments.length>1?arguments[1]:void 0)}));var yq=ji.includes,Iq=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("includes",(function(e){return yq(Iq(this),e,arguments.length>1?arguments[1]:void 0)}));var Tq=ji.indexOf,Cq=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("indexOf",(function(e){return Tq(Cq(this),e,arguments.length>1?arguments[1]:void 0)}));var Sq=D,Eq=R,bq=te,Mq=lB,kq=Bs,wq=Rt("iterator"),Dq=Sq.Uint8Array,Aq=bq(kq.values),Rq=bq(kq.keys),Lq=bq(kq.entries),Oq=Mq.aTypedArray,Nq=Mq.exportTypedArrayMethod,xq=Dq&&Dq.prototype,Pq=!Eq((function(){xq[wq].call([1])})),Uq=!!xq&&xq.values&&xq[wq]===xq.values&&"values"===xq.values.name,Gq=function(){return Aq(Oq(this))};Nq("entries",(function(){return Lq(Oq(this))}),Pq),Nq("keys",(function(){return Rq(Oq(this))}),Pq),Nq("values",Gq,Pq||!Uq,{name:"values"}),Nq(wq,Gq,Pq||!Uq,{name:"values"});var Vq=lB.aTypedArray,Fq=lB.exportTypedArrayMethod,Bq=te([].join);Fq("join",(function(e){return Bq(Vq(this),e)}));var jq=ad,qq=pe,Hq=wi,zq=Ui,Kq=kh,Wq=Math.min,Yq=[].lastIndexOf,Jq=!!Yq&&1/[1].lastIndexOf(1,-0)<0,Zq=Kq("lastIndexOf"),Xq=Jq||!Zq?function(e){if(Jq)return jq(Yq,this,arguments)||0;var t=qq(this),n=zq(t),i=n-1;for(arguments.length>1&&(i=Wq(i,Hq(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in t&&t[i]===e)return i||0;return-1}:Yq,Qq=ad,$q=Xq,eH=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return Qq($q,eH(this),t>1?[e,arguments[1]]:[e])}));var tH=Xd.map,nH=sq,iH=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("map",(function(e){return tH(iH(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(nH(e))(t)}))}));var rH=KV.left,oH=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return rH(oH(this),e,t,t>1?arguments[1]:void 0)}));var aH=KV.right,sH=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return aH(sH(this),e,t,t>1?arguments[1]:void 0)}));var cH=lB.aTypedArray,uH=lB.exportTypedArrayMethod,lH=Math.floor;uH("reverse",(function(){for(var e,t=this,n=cH(t).length,i=lH(n/2),r=0;r<i;)e=t[r],t[r++]=t[--n],t[n]=e;return t}));var dH=D,hH=P,pH=lB,fH=Ui,gH=CB,_H=ht,vH=R,mH=dH.RangeError,yH=dH.Int8Array,IH=yH&&yH.prototype,TH=IH&&IH.set,CH=pH.aTypedArray,SH=pH.exportTypedArrayMethod,EH=!vH((function(){var e=new Uint8ClampedArray(2);return hH(TH,e,{length:1,0:3},1),3!==e[1]})),bH=EH&&pH.NATIVE_ARRAY_BUFFER_VIEWS&&vH((function(){var e=new yH(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));SH("set",(function(e){CH(this);var t=gH(arguments.length>1?arguments[1]:void 0,1),n=_H(e);if(EH)return hH(TH,this,n,t);var i=this.length,r=fH(n),o=0;if(r+t>i)throw mH("Wrong length");for(;o<r;)this[t+o]=n[o++]}),!EH||bH);var MH=sq,kH=sd,wH=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("slice",(function(e,t){for(var n=kH(wH(this),e,t),i=MH(this),r=0,o=n.length,a=new i(o);o>r;)a[r]=n[r++];return a}),R((function(){new Int8Array(1).slice()})));var DH=Xd.some,AH=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("some",(function(e){return DH(AH(this),e,arguments.length>1?arguments[1]:void 0)}));var RH=Me.match(/firefox\/(\d+)/i),LH=!!RH&&+RH[1],OH=/MSIE|Trident/.test(Me),NH=Me.match(/AppleWebKit\/(\d+)\./),xH=!!NH&&+NH[1],PH=te,UH=R,GH=Ye,VH=Lg,FH=LH,BH=OH,jH=Oe,qH=xH,HH=lB.aTypedArray,zH=lB.exportTypedArrayMethod,KH=D.Uint16Array,WH=KH&&PH(KH.prototype.sort),YH=!(!WH||UH((function(){WH(new KH(2),null)}))&&UH((function(){WH(new KH(2),{})}))),JH=!!WH&&!UH((function(){if(jH)return jH<74;if(FH)return FH<67;if(BH)return!0;if(qH)return qH<602;var e,t,n=new KH(516),i=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,i[e]=e-2*t+3;for(WH(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==i[e])return!0}));zH("sort",(function(e){return void 0!==e&&GH(e),JH?WH(this,e):VH(HH(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!JH||YH);var ZH=xi,XH=Li,QH=sq,$H=lB.aTypedArray;(0,lB.exportTypedArrayMethod)("subarray",(function(e,t){var n=$H(this),i=n.length,r=XH(e,i);return new(QH(n))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,ZH((void 0===t?i:XH(t,i))-r))}));var ez=ad,tz=lB,nz=R,iz=sd,rz=D.Int8Array,oz=tz.aTypedArray,az=tz.exportTypedArrayMethod,sz=[].toLocaleString,cz=!!rz&&nz((function(){sz.call(new rz(1))}));az("toLocaleString",(function(){return ez(sz,cz?iz(oz(this)):oz(this),iz(arguments))}),nz((function(){return[1,2].toLocaleString()!=new rz([1,2]).toLocaleString()}))||!nz((function(){rz.prototype.toLocaleString.call([1,2])})));var uz=lB.exportTypedArrayMethod,lz=R,dz=te,hz=D.Uint8Array,pz=hz&&hz.prototype||{},fz=[].toString,gz=dz([].join);lz((function(){fz.call({})}))&&(fz=function(){return gz(this)});var _z=pz.toString!=fz;uz("toString",fz,_z);var vz=function(){function e(t,n,i){s(this,e),this.isUplink_=i,this.connection_=t,this.log_=n,this.seiMessageList_=[],this.seiPayloadType_=243,this.mainVideoSenderOrReceiver_=null,this.mainVideoAbortController_=null,this.abortMap_=new Map,this.onSEIMessage=null}return u(e,[{key:"isRunning",get:function(){return!!this.mainVideoAbortController_}},{key:"start",value:function(e){this.mainVideoSenderOrReceiver_=e;var t=e.createEncodedStreams(),n=t.readable,i=t.writable,r=new TransformStream({transform:this.isUplink_?this.encodeVideoFrame.bind(this):this.decodeVideoFrame.bind(this)});this.mainVideoAbortController_=new AbortController,n.pipeThrough(r).pipeTo(i,{signal:this.mainVideoAbortController_.signal}).catch((function(){}))}},{key:"restart",value:function(e){this.stop(),this.start(e)}},{key:"stop",value:function(){var e;null===(e=this.mainVideoAbortController_)||void 0===e||e.abort(),this.mainVideoAbortController_=null}},{key:"destroy",value:function(){this.stop(),this.abortMap_.forEach((function(e){return e.abort()})),this.abortMap_.clear(),this.log_=null,this.onSEIMessage=null,this.mainVideoSenderOrReceiver_=null,this.connection_=null}},{key:"handleEncodedStreams",value:function(){var e=this;try{var t=this.connection_.getPeerConnection();this.clearUnusedSenderOrReceiver(t),this.isUplink_?t.getSenders().forEach((function(t,n){if(1===n){if(t===e.mainVideoSenderOrReceiver_)return;e.isRunning?e.restart(t):e.start(t)}else{if(e.abortMap_.has(t))return;e.pipeSenderOrReceiver(t)}})):t.getReceivers().forEach((function(t,n){var i;e.abortMap_.has(t)||t===e.mainVideoSenderOrReceiver_||(1===n&&(null===(i=t.track)||void 0===i?void 0:i.kind)===GC?e.isRunning?e.restart(t):e.start(t):e.pipeSenderOrReceiver(t))}))}catch(qY){this.log_.warn(qY)}}},{key:"pipeSenderOrReceiver",value:function(e){var t=e.createEncodedStreams(),n=t.readable,i=t.writable,r=new AbortController;this.abortMap_.set(e,r),n.pipeTo(i,{signal:r.signal}).catch((function(){}))}},{key:"clearUnusedSenderOrReceiver",value:function(e){var t=this;this.abortMap_.forEach((function(n,i){(t.isUplink_?e.getSenders():e.getReceivers()).find((function(e){return e===i}))||(n.abort(),t.abortMap_.delete(i))}))}},{key:"push",value:function(e,t){t&&t.seiPayloadType&&(this.seiPayloadType_=t.seiPayloadType),this.seiMessageList_.push(e)}},{key:"hasSEI",value:function(e){var t=new DataView(e);return 1===t.getInt32(0)&&6===t.getInt8(4)}},{key:"isEmptyFrame",value:function(e){return"empty"===e.type||0===e.data.byteLength}},{key:"getNaluCount",value:function(e){for(var t=0,n=0,i=new DataView(e),r=0;r<e.byteLength;r++)switch(i.getUint8(r)){case 0:t++;break;case 1:2!==t&&3!==t||n++,t=0;break;default:t=0}return n}},{key:"encodeVideoFrame",value:function(e,t){try{if(this.connection_.isH264&&this.seiMessageList_.length>0&&!this.isEmptyFrame(e)){var n=9-this.getNaluCount(e.data);if(n<=0)return;for(var i=this.seiMessageList_.splice(0,n).reverse().map(this.encodeSEINalu.bind(this)),r=i.reduce((function(e,t){return e+t.dataView.byteLength}),0),o=new ArrayBuffer(r+e.data.byteLength),a=new DataView(o),s=new DataView(e.data),c=0,u=0;u<i.length;u++)for(var l=0;l<i[u].dataView.byteLength;l++)a.setInt8(c++,i[u].dataView.getInt8(l));for(var d=0;d<e.data.byteLength;d++)a.setInt8(c++,s.getInt8(d));e.data=o,this.log_.debug("".concat(i.length," sei sent"))}}catch(qY){this.log_.warn(qY)}t.enqueue(e)}},{key:"decodeVideoFrame",value:function(e,t){var n=this;try{if(this.connection_.isH264&&!this.isEmptyFrame(e)&&this.hasSEI(e.data)){for(var i=[],r=new DataView(e.data),o=0,a=-1,s=-1,c=0;c<e.data.byteLength;c++){var u=r.getUint8(c);if(0===u)o++;else if(1===u){if(2===o||3===o){var l=c-o;if(-1===a?a=l:-1===s&&(s=l,i.push(new mz(new DataView(r.buffer.slice(a,s)))),a=l,s=-1),6!==r.getUint8(c+1)){e.data=new DataView(r.buffer.slice(l)).buffer;break}}o=0}else o=0}this.log_.debug("".concat(i.length," sei received")),fD(this.onSEIMessage)&&i.reverse().forEach((function(e){n.onSEIMessage({seiPayloadType:e.seiPayloadType,data:e.seiPayload.buffer})}))}}catch(qY){this.log_.warn(qY)}t.enqueue(e)}},{key:"encodeSEINalu",value:function(e){var t=e.byteLength,n=parseInt(t/255),i=t%255,r=[];r.push(0,0,0,1,6,this.seiPayloadType_);for(var o=0;o<n;o++)r.push(255);r.push(i);var a=new DataView(e);return r.push.apply(r,C(new Uint8Array(a.buffer))),r.push(128),new mz(new DataView(new Uint8Array(r).buffer),!0)}}]),e}(),mz=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s(this,e),this.dataView=t,this.isSEI&&(n?this.addPreventionByte():this.removePreventionByte())}return u(e,[{key:"addPreventionByte",value:function(){for(var e=this.seiPayloadStartIndex,t=this.dataView.byteLength-2,n=[],i=0,r=e;r<=t;r++){var o=this.dataView.getInt8(r);switch(o){case 0:case 1:case 2:case 3:2===i&&(n.push(3),i=0),0==o?i++:i=0,n.push(o);break;default:i=0,n.push(o)}}n.push(this.dataView.getInt8(this.dataView.byteLength-1));var a=new DataView(new Uint8Array([].concat(C(new Uint8Array(this.dataView.buffer).slice(0,e)),n)).buffer);this.dataView=a}},{key:"removePreventionByte",value:function(){for(var e=this.seiPayloadStartIndex,t=this.dataView.byteLength-1,n=[],i=0,r=e;r<=t;r++)switch(this.dataView.getInt8(r)){case 0:i++,n.push(this.dataView.getInt8(r));break;case 3:2!==i&&n.push(this.dataView.getInt8(r)),i=0;break;default:n.push(this.dataView.getInt8(r)),i=0}var o=new DataView(new Uint8Array([].concat(C(new Uint8Array(this.dataView.buffer).slice(0,e)),n)).buffer);this.dataView=o}},{key:"isSEI",get:function(){return 6===this.dataView.getUint8(4)}},{key:"seiPayloadStartIndex",get:function(){for(var e=6,t=6;t<this.dataView.buffer.byteLength&&(e++,255===this.dataView.getUint8(t));t++);return e}},{key:"seiPayloadType",get:function(){return this.isSEI?this.dataView.getUint8(5):null}},{key:"seiPayload",get:function(){if(!this.isSEI)return null;for(var e=0,t=6,n=6;n<this.dataView.buffer.byteLength;n++){var i=this.dataView.getUint8(n);if(t++,255!==i){e+=i;break}e+=255}for(var r=new ArrayBuffer(e),o=new DataView(r),a=0;a<r.byteLength;a++,t++)o.setInt8(a,this.dataView.getInt8(t));return o}}]),e}(),yz=function(){function e(t){s(this,e),this.userId_=t.userId,this.tinyId_=t.tinyId,this.client_=t.client,this.sdpSemantics_=t.client.getSdpSemantics(),this.isUplink_=t.isUplink,this.log_=UA.createLogger({id:"n|"+this.userId_,userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId(),isLocal:this.isUplink_}),this.signalChannel_=t.signalChannel,this.peerConnection_=null,this.isErrorObserved_=!1,this.emitter_=new GD,this.currentState_=HS,this.waitForPeerConnectionConnectedPromise_=null,this.isReconnecting_=!1,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.isFirstConnection_=!0,this.delay_={audioDelay:0,videoDelay:0},this.enableSEI_=t.enableSEI,this.enableSEI_&&MN&&(this.sei_=new vz(this,this.log_,this.isUplink_))}var t;return u(e,[{key:"initialize",value:function(){var e={encodedInsertableStreams:this.enableSEI_&&MN,iceServers:this.client_.getIceServers(),iceTransportPolicy:this.client_.getIceTransportPolicy(),sdpSemantics:this.sdpSemantics_,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this.peerConnection_=new RTCPeerConnection(e),this.peerConnection_.onconnectionstatechange=this.onConnectionStateChange.bind(this)}},{key:"close",value:function(){this.log_.info("closing connection"),this.closePeerConnection(),this.sei_&&(this.sei_.destroy(),this.sei_=null)}},{key:"closePeerConnection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.peerConnection_&&(this.peerConnection_.onconnectionstatechange=function(){},this.peerConnection_.close(),this.peerConnection_=null,e&&this.emitConnectionStateChangedEvent(HS))}},{key:"getDTLSTransportState",value:function(){if(!this.peerConnection_)return qS;var e=null;if(this.isUplink_){if(!yN()||0===this.peerConnection_.getSenders().length)return qS;e=this.peerConnection_.getSenders()[0].transport}else{if(!mN()||0===this.peerConnection_.getReceivers().length)return qS;e=this.peerConnection_.getReceivers()[0].transport}return e?e.state:qS}},{key:"onConnectionStateChange",value:function(e){var t=this.peerConnection_.iceConnectionState,n=this.getDTLSTransportState();if(this.log_.info("onConnectionStateChange() connectionState: "+e.target.connectionState),this.log_.info("ICE Transport state: ".concat(t,", DTLS Transport state: ").concat(n)),e.target.connectionState===JS&&this.emitConnectionStateChangedEvent(zS),e.target.connectionState===ZS||e.target.connectionState===XS){var i="".concat(this.isUplink_?"uplink":"downlink"," ICE/DTLS Transport connection ").concat(e.target.connectionState,". ICE Transport state: ").concat(t,", DTLS Transport state: ").concat(n),r=new IL({message:i,code:yL.ICE_TRANSPORT_ERROR});uO.logFailedEvent({userId:this.client_.getUserId(),eventType:mE,error:r}),this.emitConnectionStateChangedEvent(HS),this.isErrorObserved_||this.emitter_.emit(UN.ERROR,r)}e.target.connectionState!==$S&&e.target.connectionState!==eE||(this.logSelectedCandidate(),uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:mE}),this.emitConnectionStateChangedEvent(WS))}},{key:"emitConnectionStateChangedEvent",value:function(e){e!==this.currentState_&&(this.currentState_===KS&&e===zS||(VD.emit(MA,{client:this.client_,connection:this,prevState:this.currentState_,state:e}),this.emitter_.emit(UN.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:e}),this.currentState_=e))}},{key:"hitTest",value:function(e){return(0===e||"0"===e)&&this.isUplink_||e===this.tinyId_}},{key:"addEventInternal",value:function(e,t){var n=this.client_.getUserId(),i={eventId:e,eventDesc:t,timestamp:iv(),userId:n,tinyId:this.client_.getTinyId()};this.isUplink_||(i.remoteUserId=this.userId_,i.remoteTinyId=this.tinyId_),rO(n,i)}},{key:"getPeerConnection",value:function(){return this.peerConnection_}},{key:"getClient",value:function(){return this.client_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"logSelectedCandidate",value:(t=a(i().mark((function e(){var t,n,r,o,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConnection_){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.peerConnection_.getStats();case 4:t=e.sent,n=b(t),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=18;break}if((o=T(r.value,2))[0],!kN(a=o[1])){e.next=16;break}return s=t.get(a.localCandidateId),c=t.get(a.remoteCandidateId),s&&this.log_.info("local candidate: ".concat(s.candidateType," ").concat(s.protocol,":").concat(s.ip||s.address,":").concat(s.port," ").concat(s.networkType||""," ").concat("relay"===s.candidateType?"relayProtocol:"+s.relayProtocol:"")),c&&this.log_.info("remote candidate: ".concat(c.candidateType," ").concat(c.protocol,":").concat(c.ip||c.address,":").concat(c.port)),e.abrupt("break",18);case 16:e.next=8;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[6,20,23,26]])}))),function(){return t.apply(this,arguments)})},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"waitForPeerConnectionConnected",value:function(){var e=this;return this.waitForPeerConnectionConnectedPromise_||(this.waitForPeerConnectionConnectedPromise_=new Promise((function(t,n){if(e.currentState_===WS)return t();var i=-1,r=function(e){e.state===WS&&(clearTimeout(i),a(),t())},o=function(t){t.client===e.client_&&(clearTimeout(i),a(),n(new IL({code:yL.API_CALL_ABORTED,message:aD({key:Ok,data:"leave room"})})))},a=function(){VD.off(WD,o,e),e.emitter_.off(UN.CONNECTION_STATE_CHANGED,r,e)};i=setTimeout((function(){a();var e=new IL({code:yL.API_CALL_TIMEOUT,message:"connection timeout"});n(e)}),1e4),VD.on(WD,o,e),e.emitter_.on(UN.CONNECTION_STATE_CHANGED,r,e)})),this.waitForPeerConnectionConnectedPromise_=this.waitForPeerConnectionConnectedPromise_.then((function(t){return e.waitForPeerConnectionConnectedPromise_=null,t})).catch((function(t){throw e.waitForPeerConnectionConnectedPromise_=null,t}))),this.waitForPeerConnectionConnectedPromise_}},{key:"getReconnectionCount",value:function(){return this.reconnectionCount_}},{key:"startReconnection",value:function(){this.isReconnecting_=!0,this.emitConnectionStateChangedEvent(KS),this.reconnect(),this.addEventInternal(this.isUplink_?JL:QL,"".concat(this.isUplink_?"uplink":"downlink","-connection is reconnecting"))}},{key:"stopReconnection",value:function(){this.log_.info("stop reconnection"),this.isReconnecting_=!1,this.reconnectionCount_=0,this.clearReconnectionTimer(),this.signalChannel_.off(HR,this.reconnect,this)}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){this.emitter_.off(e,t,n)}},{key:"setDelay",value:function(e){var t=e.audioDelay,n=e.videoDelay;this.delay_={audioDelay:t,videoDelay:n}}},{key:"getDelay",value:function(){return this.delay_}},{key:"isH264",get:function(){var e,t;return!(null===(e=this.peerConnection_)||void 0===e||null===(t=e.remoteDescription)||void 0===t||!t.sdp.includes("H264"))}}]),e}(),Iz=function(){function e(){s(this,e),this.set_=new Set,VD.on(FD,this.add,this),VD.on(qD,this.add,this),VD.on(HD,this.delete,this),VD.on(WD,this.delete,this)}return u(e,[{key:"add",value:function(e){var t=e.client,n=e.roomId;if("rtc"!==t.getMode()){var i=this.getKey(t.getUserId(),n||t.getRoomId(),t.getSDKAppId(),t.getUseStringRoomId());this.set_.add(i)}}},{key:"delete",value:function(e){var t=e.client;if("rtc"!==t.getMode()){var n=this.getKey(t.getUserId(),t.getRoomId(),t.getSDKAppId(),t.getUseStringRoomId());this.set_.delete(n)}}},{key:"getKey",value:function(e,t,n,i){return"".concat(n,"_").concat(t,"_").concat(e,"_").concat(i)}},{key:"isJoined",value:function(e){var t=e.userId,n=e.roomId,i=e.sdkAppId,r=e.client;return"rtc"!==r.getMode()&&this.set_.has(this.getKey(t,n,i,r.getUseStringRoomId()))}}]),e}(),Tz=new Iz;function Cz(e,t,n,i){if(this.useStringRoomId_){if(!_D(e)||!/^[A-Za-z\d\s!#$%&()+\-:;<=.>?@[\]^_{}|~,]{1,64}$/.test(e))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Qb,data:t,link:{className:i,fnName:n}})})}else if(!(vD(e)&&/^[1-9]\d*$/.test(String(e))&&e<4294967295))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:$b,data:t,link:{className:i,fnName:n}})})}function Sz(e,t,n,i){if(!/^[A-Za-z\d_-]*$/.test(e))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:mM,data:t,link:{className:i,fnName:n}})})}var Ez={createClient:{name:"clientConfig",required:!0,type:VE,properties:{sdkAppId:{required:!0,type:PE,allowEmpty:!1},userId:{required:!0,type:xE,allowEmpty:!1},userSig:{required:!0,type:xE,allowEmpty:!1},mode:{required:!0,type:xE,values:["rtc",OS]},useStringRoomId:{type:UE},autoSubscribe:{type:UE},enableAutoPlayDialog:{type:UE},streamId:{type:xE},userDefineRecordId:{type:xE},pureAudioPushMode:{type:PE,values:[1,2]},enableSEI:{type:UE}}},createStream:{name:"streamConfig",required:!0,type:VE,properties:{userId:{type:xE},audio:{type:UE},video:{type:UE},screen:{type:UE},screenAudio:{type:UE},microphoneId:{type:xE},cameraId:{type:xE},facingMode:{type:[xE,VE]},audioSource:{instanceOf:window.MediaStreamTrack},videoSource:{instanceOf:window.MediaStreamTrack}},validate:function(e){if(!gD(e.screen)&&e.screen&&gD(e.audio)&&(e.audio=!1),!(gD(e.audio)&&gD(e.video)||gD(e.audioSource)&&gD(e.videoSource)))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:ak})});if(!gD(e.screen)&&!0===e.screen&&!0===e.video)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:sk})});if(e.audio&&e.screenAudio)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:ck})});if(!0!==e.screen&&!0===e.screenAudio)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:uk})});if(!gD(e.screen)&&!0===e.screen&&!this.isScreenShareSupported())throw new IL({code:yL.INVALID_OPERATION,message:aD({key:vk})})}}},bz={join:{name:"options",required:!0,type:VE,properties:{roomId:{required:!0,type:[PE,xE],allowEmpty:!1,validate:Cz},role:{type:[xE],values:[PS,US]},privateMapKey:{type:[xE]}},validate:function(e){if(this.isJoined_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:Xb})});if(this.checkDestroy(),Tz.isJoined({userId:this.userId_,roomId:e.roomId,sdkAppId:this.sdkAppId_,client:this}))throw new IL({code:yL.INVALID_OPERATION,message:aD({key:zM,data:this.userId_})})}},publish:[{name:"stream",required:!0,instanceOf:nb,validate:function(e){if(!this.isJoined_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:rM})});if(this.mode_===OS&&this.role_===US)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:aM})});if(!e.getIsReadyToPublish())throw new IL({code:yL.INVALID_OPERATION,message:aD({key:sM})});if(this.notPublishWithoutH264Supported_)throw new IL({code:yL.NOT_SUPPORTED_H264,message:aD({key:pk})})}},{name:"options",type:VE,defaultValue:{isAuxiliary:!1},properties:{isAuxiliary:{type:UE,defaultValue:!1,validate:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e&&!TN())throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:mk})});if(this.uplinkConnection_&&(e&&this.uplinkConnection_.isAuxStreamPublished||!e&&this.uplinkConnection_.isMainStreamPublished))throw new IL({code:yL.INVALID_OPERATION,message:aD({key:cM,data:e?jC:"local"})});var t=this.localScreenStream_||C(this.connections_.values()).findIndex((function(e){return e.getTrackState().auxiliary}))>=0;if(!this.enableMultiAuxStream_&&e&&t)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:xk})})}}}}],unpublish:{name:"stream",required:!0,instanceOf:nb,validate:function(e){if(e!==this.localStream_&&e!==this.localAuxStream_){if(this.localStream_||this.localAuxStream_)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:oM})});this.log_.warn("Client currently has no published stream, please call publish() first.")}}},subscribe:[{name:"stream",required:!0,instanceOf:ib,validate:function(e){if(!e.getConnection())throw new IL({code:yL.INVALID_OPERATION,message:aD({key:uM})});if(this.notSubscribeWithoutH264Supported_)throw new IL({code:yL.NOT_SUPPORTED_H264,message:aD({key:fk})})}},{name:"options",type:VE,properties:{audio:{type:UE},video:{type:UE},smallVideo:{type:UE}},validate:function(e){var t=e.audio,n=e.video,i=e.smallVideo;if(!1===t&&!1===n&&(gD(i)||!1===i))throw new IL({code:yL.INVALID_OPERATION,message:aD({key:bk})})}}],unsubscribe:{name:"stream",required:!0,instanceOf:ib,validate:function(e){if(!e.getConnection())throw new IL({code:yL.INVALID_OPERATION,message:aD({key:uM})})}},switchRole:{name:"role",required:!0,values:[PS,US],validate:function(){if(this.mode_!==OS)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:dM})});if(!this.isJoined_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:hM})})}},startPublishCDNStream:{name:"options",required:!1,properties:{streamId:{type:xE,validate:Sz},streamType:{type:xE,values:["main","auxiliary"]},appId:{type:PE,allowEmpty:!1},bizId:{type:PE,allowEmpty:!1},url:{type:xE,allowEmpty:!1}},validate:function(){if(this.isDestroyed_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:KM,data:{funName:"startPublishCDNStream"}})})}},startMixTranscode:{name:"config",required:!0,type:VE,properties:{mode:{type:xE,values:["preset-layout","manual"]},streamId:{type:xE,validate:Sz},videoWidth:{type:PE,notLessThanZero:!0},videoHeight:{type:PE,notLessThanZero:!0},videoBitrate:{type:PE,notLessThanZero:!0,allowEmpty:!1},videoFramerate:{type:PE,validate:function(e,t,n,i){if(e<=0||e>30)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:XM,link:{className:i,fnName:n}})})}},videoGop:{type:PE,validate:function(e,t,n,i){if(e<1||e>8)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:QM,link:{className:i,fnName:n}})})}},audioSampleRate:{type:PE,notLessThanZero:!0},audioBitrate:{type:PE,validate:function(e,t,n,i){if(e<32||e>192)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:$M,link:{className:i,fnName:n}})})}},audioChannels:{type:PE,values:[1,2]},backgroundColor:{type:PE},backgroundImage:{type:xE},mixUsers:{required:!0,type:GE,arrayItem:{require:!0,type:VE,properties:{userId:{required:!0,type:xE},roomId:{type:[xE,PE],validate:Cz},pureAudio:{type:UE},width:{type:PE,notLessThanZero:!0},height:{type:PE,notLessThanZero:!0},locationX:{type:PE,notLessThanZero:!0},locationY:{type:PE,notLessThanZero:!0},zOrder:{type:PE},streamType:{type:xE,values:["main","auxiliary"]},renderMode:{type:PE,values:[0,1,2,4]}}}}},validate:function(e,t,n,i,r){var o=0,a=0,s=e.mixUsers,c=[];if(s.forEach((function(e,t){if(c.push(e.userId),!e.pureAudio){if(!e.zOrder||e.zOrder<1||e>15)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:ek,data:"config.mixUsers[".concat(t,"].zOrder"),link:{className:i,fnName:n}})});e.width+e.locationX>o&&(o=e.width+e.locationX),e.height+e.locationY>a&&(a=e.height+e.locationY)}})),c.indexOf(this.getUserId())<0)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:tk,link:{className:i,fnName:n}})});if(e.videoWidth<o||e.videoHeight<a)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:nk,link:{className:i,fnName:n}})})}},sendSEIMessage:[{name:"buffer",required:!0,instanceOf:ArrayBuffer,validate:function(e){if(!MN)throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:Mk})});if(!this.enableSEI_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:kk})});if(e.byteLength>1e3)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Dk,data:e.byteLength})});if(0===e.byteLength)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:wk})});if(!this.uplinkConnection_||!this.localStream_)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Ak})});if(!this.localStream_.hasVideo())throw new IL({code:yL.INVALID_OPERATION,message:aD({key:Rk})});var t=this.uplinkConnection_.isH264;if(!t)throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:Mk,data:t})})}},{name:"options",type:VE,properties:{seiPayloadType:{type:PE,values:[5,243]}}}]},Mz={play:[{name:"elementId",required:!0,type:[xE,"HTMLDivElement"],validate:function(e,t,n){if(_D(e)){var i=document.getElementById(e);if(!i)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:ik,data:{key:t,fnName:n}})});if(!(i instanceof HTMLDivElement))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:rk,data:{key:t,fnName:n,type:CD(i)}})})}}},{name:"options",type:VE,properties:{objectFit:{type:xE,values:["contain","cover","fill"]},muted:{type:UE},mirror:{type:UE}}}],addTrack:{name:IS,instanceOf:MediaStreamTrack,validate:function(e){if(this.isAddingTrack_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:OM})});if(this.isRemovingTrack_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:NM})});if(this.publishState_===qE)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:xM})});var t=this.getMediaStream();if(!t)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:PM})});if(e.kind===UC&&t.getAudioTracks().length>0||e.kind===GC&&t.getVideoTracks().length>0)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:UM})});if(!IN()&&!yN())throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:gk,data:vS})})}},removeTrack:{name:IS,instanceOf:MediaStreamTrack,validate:function(e){if(this.isAddingTrack_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:VM})});if(this.isRemovingTrack_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:FM})});if(this.publishState_===qE)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:BM})});var t=this.getMediaStream();if(!t)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:PM})});if(-1===t.getTracks().indexOf(e))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:jM})});if(!IN()){if(1===t.getTracks().length)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:qM})});if(e.kind===UC)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:GM})});if(!yN())throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:gk,data:mS})})}}},replaceTrack:{name:IS,instanceOf:MediaStreamTrack,validate:function(e){var t=this.getMediaStream();if(!t)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:LM})});if(this.publishState_===qE)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:RM})});if(e.kind===UC&&t.getAudioTracks().length<=0||e.kind===GC&&t.getVideoTracks().length<=0)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:HM,data:e})});if(!CN())throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:gk,data:yS})})}}},kz={TRTC:Ez,CLIENT:bz,LOCAL_STREAM:{switchDevice:[{name:"type",required:!0,type:xE,values:[UC,GC]},{name:"deviceId",required:!0,type:xE,validate:function(){if(this.screen_&&!this.audio_||this.audioSource_||this.videoSource_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:DM})});if(this.publishState_===qE)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:AM})});if(!CN())throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:_k})})}}],setAudioCaptureVolume:{name:"volume",type:PE}},STREAM:Mz};function wz(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,i){var r=i.value;return i.value=function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return Az.call(this,t,i,n,this.name_),r.apply(this,i)},i}}function Dz(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,r){var o=r.value;return r.value=a(i().mark((function e(){var r,a,s,c=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=c.length,a=new Array(r),s=0;s<r;s++)a[s]=c[s];return Az.call(this,t,a,n,this.name_),e.abrupt("return",o.apply(this,a));case 3:case"end":return e.stop()}}),e,this)}))),r}}function Az(e,t,n,i){try{for(var r=0;r<e.length;r++)Rz.call(this,{rule:e[r],value:t[r],key:e[r].name,fnName:n,className:i})}catch(qY){throw UA.error(qY),qY}}function Rz(e){var t=this,n=e.rule,i=e.value,r=e.key,o=e.fnName,a=e.className;if(gD(i)){if(n.required)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Ob,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(gD(n.defaultValue))return;i=n.defaultValue}if(Array.isArray(n.type)){if(!n.type.map((function(e){return e.toLowerCase()})).includes(CD(i)))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Nb,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})})}else if(!gD(n.type)&&CD(i)!==n.type)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Nb,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(!1===n.allowEmpty){var s=vD(i)&&(0===i||Number.isNaN(i)),c=_D(i)&&""===i.trim();if(s||c)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:xb,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})})}if(n.notLessThanZero&&vD(i)&&i<0)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:ZM,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(_D(n.instanceOf)){if(!i||i.name_!==n.instanceOf)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Pb,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})})}else if(fD(n.instanceOf)&&!(i instanceof n.instanceOf))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Pb,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});if(n.values&&!n.values.includes(i))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Ub,data:{key:r,rule:n,fnName:o,value:i},link:{className:a,fnName:o}})});var u=n.properties;dD(u)&&yD(i)&&Object.keys(u).forEach((function(e){Rz.call(t,{rule:u[e],value:i&&i[e],key:"".concat(r,".").concat(e),fnName:o,className:a})}));var l=n.arrayItem;dD(l)&&ID(i)&&i.forEach((function(e,n){Rz.call(t,{rule:l,value:e,key:"".concat(r,"[").concat(n,"]"),fnName:o,className:a})})),fD(n.validate)&&n.validate.call(this,i,r,o,a,this)}br({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var Lz=br,Oz=R,Nz=tc.f;Lz({target:"Object",stat:!0,forced:Oz((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:Nz});var xz,Pz,Uz=Sx;function Gz(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{retries:5,timeout:2e3};return function(t,n,i){var r=LA({retryFunction:i.value,settings:e,onError:e.onError,onRetrying:e.onRetrying,onRetryFailed:e.onRetryFailed});return i.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.apply(this,t)},i}}br({target:"Array",stat:!0,forced:!Lu((function(e){Array.from(e)}))},{from:Uz});var Vz,Fz,Bz,jz,qz=5e3,Hz={msg_user_info:0,uint32_video_avg_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_avg_bitrate:0,uint32_video_block_time:0,uint32_video_play_time:0,uint32_audio_block_time:0,uint32_audio_play_time:0,uint32_audio_play_db:0,uint32_avg_down_loss:0,uint32_stream_type:0,uint32_video_render_first:0,uint32_video_block_count:0,uint32_audio_block_count:0,uint32_audio_bitrate:0,uint32_video_black_screen_subjective:0,uint32_audio_recv_bitrate:0,uint32_video_external_block_time:0},zz=u((function e(t){s(this,e),this.str_identifier=String(t.userId),this.uint64_tinyid=Number(t.tinyId),this.uint32_role=t.role})),Kz=(xz=Gz({timeout:500,retries:3}),Pz=function(){function e(t){var n=this;s(this,e),this.frameWorkType_=t.frameWorkType||30,this.component_=t.component||0,this.client_=t.client,this.keyPrefix_="key_point",this.storageKey_="".concat(this.keyPrefix_,"_").concat(this.client_.getUserId()),this.log_=UA.createLogger({id:"kpm|"+this.client_.getUserId(),userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId()}),Object.getOwnPropertyNames(this.__proto__).forEach((function(e){e.startsWith("handle")&&fD(n[e])&&(n[e]=function(e){var t=e.fn,n=e.context;return a(i().mark((function e(){var r,o,a,s=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,r=s.length,o=new Array(r),a=0;a<r;a++)o[a]=s[a];return e.next=4,t.apply(n||this,o);case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(0),UA.error("".concat(t.name,"() error observed ")+e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))}({fn:n[e],context:n}))})),this.initData(),this.installEvents(),this.intervalId_=tN.run(mb,this.setStorage.bind(this),{delay:2e4})}var n,r,o;return u(e,[{key:"initData",value:function(){this.firstPublishedUserList_=[],this.networkQuality_={totalUplinkRTT:0,totalUplinkLoss:0,count:0,totalDownlinkRTTAndLossMap:new Map},this.basicInfo={string_sdk_version:Ko,uint32_os_type:15,string_device_name:"",string_http_user_agent:navigator.userAgent,string_os_version:"",string_domain:location.host,uint32_avg_rtt:0,uint32_avg_up_loss:0,uint32_scene:"live"===this.client_.getMode()?1:0,uint32_joining_duration:0,uint32_networkType:BE[lD()],uint32_framework:this.frameWorkType_,uint32_component:this.component_},this.pathJoinRoom_={uint64_start_time:0,uint64_init_audio_start_time:0,uint64_init_audio_end_time:0,uint64_init_camera_start_time:0,uint64_init_camera_end_time:0,uint64_send_request_acc_ip_cmd_start_time:0,uint64_send_request_acc_ip_cmd_end_time:0,uint64_send_request_enter_room_cmd_start_time:0,uint64_send_request_enter_room_cmd_end_time:0,uint64_send_first_video_frame_time:0,uint64_recv_userlist_time:0,uint64_end_time:0,int32_init_audio_ret:0,int32_init_camera_ret:0,int32_send_request_acc_ip_cmd_ret:0,int32_send_request_enter_room_cmd_ret:0,int32_end_ret:0},this.pathLeaveRoom_={uint64_start_time:0,uint64_send_request_exit_room_cmd_start_time:0,uint64_send_request_exit_room_cmd_end_time:0,uint64_end_time:0,int32_send_request_exit_room_cmd_ret:0,int32_end_ret:0},this.pathMainVideoMap_=new Map,this.pathMainAudioMap_=new Map,this.pathAuxiliaryMap_=new Map,this.localStreamStats_={totalVideoBitrate:0,totalVideoFPS:0,totalVideoHeight:0,totalVideoWidth:0,totalAudioLevel:0,videoCount:0,audioLevelCount:0,publishStartTime:0,statsToReport:{uint32_audio_capture_db:0,uint32_video_big_capture_fps:0,uint32_video_big_bitrate:0,uint32_video_big_resolution:0}},this.remoteStreamStatsMap_=new Map}},{key:"installEvents",value:function(){VD.on(FD,this.handleJoinStart,this),VD.on(XD,this.handleWSStart,this),VD.on(QD,this.handleWSEnd,this),VD.on(BD,this.handleJoinSendCMD,this),VD.on(jD,this.handleJoinReceivedCMDResponce,this),VD.on(qD,this.handleJoinSuccess,this),VD.on(HD,this.handleJoinFailed,this),VD.on(JD,this.handleReceivedPublishUserList,this),VD.on(MA,this.handleConnectionStateChanged,this),VD.on(zD,this.handleLeaveStart,this),VD.on(WD,this.handleLeaveSuccess,this),VD.on(KD,this.handleLeaveSendCMD,this),VD.on(kA,this.handleSendSubscribeCMD,this),VD.on(oA,this.handleVideoPlaying,this),VD.on(aA,this.handleAudioPlaying,this),VD.on(wA,this.handleNetworkQuality,this),VD.on(YD,this.handleHeartbeatStats,this),VD.on(cA,this.handleRemoteStreamAdded,this),VD.on(uA,this.handleRemoteStreamSubscribeStart,this),VD.on(lA,this.handleRemoteStreamSubscribed,this),VD.on(pA,this.handleRemoteStreamRemoved,this),VD.on(TA,this.handleVideoLoadedData,this),VD.on(IA,this.handlePlayStream,this),VD.on(ZD,this.handlePublishStart,this),VD.on(gA,this.handleLocalStreamInitStart,this),VD.on(_A,this.handleLocalStreamInitEnd,this),VD.on(vA,this.handleLocalStreamInitFailed,this)}},{key:"uninstallEvents",value:function(){VD.off(FD,this.handleJoinStart,this),VD.off(XD,this.handleWSStart,this),VD.off(QD,this.handleWSEnd,this),VD.off(BD,this.handleJoinSendCMD,this),VD.off(jD,this.handleJoinReceivedCMDResponce,this),VD.off(JD,this.handleReceivedPublishUserList,this),VD.off(MA,this.handleConnectionStateChanged,this),VD.off(zD,this.handleLeaveStart,this),VD.off(WD,this.handleLeaveSuccess,this),VD.off(qD,this.handleJoinSuccess,this),VD.off(HD,this.handleJoinFailed,this),VD.off(KD,this.handleLeaveSendCMD,this),VD.off(kA,this.handleSendSubscribeCMD,this),VD.off(oA,this.handleVideoPlaying,this),VD.off(aA,this.handleAudioPlaying,this),VD.off(wA,this.handleNetworkQuality,this),VD.off(YD,this.handleHeartbeatStats,this),VD.off(cA,this.handleRemoteStreamAdded,this),VD.off(uA,this.handleRemoteStreamSubscribeStart,this),VD.off(lA,this.handleRemoteStreamSubscribed,this),VD.off(pA,this.handleRemoteStreamRemoved,this),VD.off(TA,this.handleVideoLoadedData,this),VD.off(IA,this.handlePlayStream,this),VD.off(ZD,this.handlePublishStart,this),VD.off(gA,this.handleLocalStreamInitStart,this),VD.off(_A,this.handleLocalStreamInitEnd,this),VD.off(vA,this.handleLocalStreamInitFailed,this)}},{key:"destroy",value:function(){this.uninstallEvents(),tN.clearTask(this.intervalId_),this.client_=null}},{key:"handleJoinStart",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_start_time&&(this.pathJoinRoom_.uint64_start_time=Date.now(),this.checkStorage())}},{key:"handleWSStart",value:function(e){var t=e.client;this.hitTest(t)&&0===this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_start_time&&(this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_start_time=Date.now())}},{key:"handleWSEnd",value:function(e){var t=e.client,n=e.error;this.hitTest(t)&&0===this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_end_time&&(this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_end_time=Date.now(),n&&(this.pathJoinRoom_.int32_send_request_acc_ip_cmd_ret=n instanceof IL?Number(n.getExtraCode()||n.getCode()):yL.UNKNOWN,this.pathJoinRoom_.int32_end_ret=2))}},{key:"handleJoinSendCMD",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_send_request_enter_room_cmd_start_time&&(this.pathJoinRoom_.uint64_send_request_enter_room_cmd_start_time=Date.now())}},{key:"handleJoinReceivedCMDResponce",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_send_request_enter_room_cmd_end_time&&(this.pathJoinRoom_.uint64_send_request_enter_room_cmd_end_time=Date.now(),this.pathJoinRoom_.int32_send_request_enter_room_cmd_ret=e.code,0!==e.code&&(this.pathJoinRoom_.int32_end_ret=3))}},{key:"handleJoinSuccess",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_end_time&&(this.pathJoinRoom_.uint64_end_time=Date.now(),this.pathJoinRoom_.int32_end_ret=0)}},{key:"handleJoinFailed",value:function(e){var t=e.client;this.hitTest(t)&&(this.pathJoinRoom_.uint64_end_time=Date.now(),0===this.pathJoinRoom_.int32_end_ret&&(this.pathJoinRoom_.int32_end_ret=3),this.prepareReport(),this.report())}},{key:"handleReceivedPublishUserList",value:function(e){this.hitTest(e.client)&&0===this.pathJoinRoom_.uint64_recv_userlist_time&&(this.pathJoinRoom_.uint64_recv_userlist_time=Date.now(),this.firstPublishedUserList_=e.data.data&&e.data.data.userList||[])}},{key:"handleConnectionStateChanged",value:function(e){var t=e.client,n=e.state,i=e.connection;if(this.hitTest(t)&&n===WS){this.client_.getUplinkConnection()===i&&0===this.pathJoinRoom_.uint64_send_first_video_frame_time&&this.localStreamStats_.publishStartTime>this.pathJoinRoom_.uint64_end_time&&this.localStreamStats_.publishStartTime-this.pathJoinRoom_.uint64_end_time<=100&&(this.pathJoinRoom_.uint64_send_first_video_frame_time=Date.now());var r=this.pathMainVideoMap_.get("".concat(i.getUserId(),"_").concat(BS));r&&0===r.statsToReport.uint64_pc_connected_time&&(r.statsToReport.uint64_pc_connected_time=Date.now())}}},{key:"handleLeaveStart",value:function(e){this.hitTest(e.client)&&(this.pathLeaveRoom_.uint64_start_time=Date.now())}},{key:"handleLeaveSuccess",value:function(e){this.hitTest(e.client)&&0===this.pathLeaveRoom_.uint64_end_time&&(this.pathLeaveRoom_.uint64_end_time=Date.now(),0!==this.pathJoinRoom_.uint64_end_time?this.basicInfo.uint32_joining_duration=this.pathLeaveRoom_.uint64_end_time-this.pathJoinRoom_.uint64_end_time:this.log_.warn("pathJoinRoom endTime is 0"),this.report())}},{key:"handleLeaveSendCMD",value:function(e){this.hitTest(e.client)&&(this.pathLeaveRoom_.uint64_send_request_exit_room_cmd_start_time=Date.now(),this.pathLeaveRoom_.uint64_send_request_exit_room_cmd_end_time=Date.now())}},{key:"handleRemoteStreamAdded",value:function(e){var n=e.client,i=e.stream;if(this.hitTest(n)){var r=i.getUserId(),o=i.getType(),a="".concat(r,"_").concat(o),s=this.remoteStreamStatsMap_.get(a);if(s)s.stream=i;else{var c={userId:r,totalVideoFPS:0,totalVideoBitrate:0,totalAudioLevel:0,totalAudioBitrate:0,totalLoss:0,audioCount:0,audioLevelCount:0,videoCount:0,networkQualityCount:0,streamAddedTime:Date.now(),subscribeStartTime:0,subscribedTime:0,playStreamTime:0,statsToReport:t({},Hz),stream:i};c.statsToReport.msg_user_info=new zz({userId:r,tinyId:i.getTinyId(),role:NS}),c.statsToReport.uint32_stream_type=o===BS?2:7,this.remoteStreamStatsMap_.set(a,c)}}}},{key:"handleRemoteStreamSubscribeStart",value:function(e){var t=e.client,n=e.stream;if(this.hitTest(t)){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r),a=this.remoteStreamStatsMap_.get(o);a&&0===a.subscribeStartTime&&(a.subscribeStartTime=Date.now())}}},{key:"handleSendSubscribeCMD",value:function(e){if(this.hitTest(e.client)){var t=new zz(e),n=Date.now(),i="".concat(e.userId,"_").concat(BS);e.trackState.video&&e.subscribeState.video&&!this.pathMainVideoMap_.has(i)&&this.pathMainVideoMap_.set(i,{statsToReport:{msg_user_info:t,uint64_start_enter_time:this.pathJoinRoom_.uint64_start_time,uint64_render_first_frame_time:0,uint64_combine_first_frame_time:0,uint64_pc_connected_time:0},userId:e.userId,sendSubscribeCMDTime:n}),e.trackState.audio&&e.subscribeState.audio&&!this.pathMainAudioMap_.has(i)&&this.pathMainAudioMap_.set(i,{statsToReport:{msg_user_info:t,uint64_start_enter_time:this.pathJoinRoom_.uint64_start_time,uint64_play_first_frame_time:0},userId:e.userId,sendSubscribeCMDTime:n});var r="".concat(e.userId,"_").concat(jS);e.trackState.auxiliary&&e.subscribeState.auxiliary&&!this.pathAuxiliaryMap_.has(r)&&this.pathAuxiliaryMap_.set(r,{sendSubscribeCMDTime:n})}}},{key:"handleRemoteStreamSubscribed",value:function(e){var t=e.client,n=e.stream;if(this.hitTest(t)){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r),a=this.remoteStreamStatsMap_.get(o);a&&0===a.subscribedTime&&(a.subscribedTime=Date.now(),a.stream=n)}}},{key:"handleRemoteStreamRemoved",value:function(e){var t=e.client,n=e.stream;if(this.hitTest(t)){var i=n.getUserId(),r=n.getType(),o=this.remoteStreamStatsMap_.get("".concat(i,"_").concat(r));o&&(o.stream=null)}}},{key:"handlePlayStream",value:function(e){var t=e.stream;if(t.isRemote()&&t.getConnection()&&this.hitTest(t.getConnection().getClient())){var n=t.getConnection().getUserId(),i="".concat(n,"_").concat(t.getType());if(this.remoteStreamStatsMap_.has(i)){var r=this.remoteStreamStatsMap_.get(i);0===r.playStreamTime&&(r.playStreamTime=Date.now())}}}},{key:"handleVideoLoadedData",value:function(e){var t=e.stream;if(t.isRemote()&&t.getConnection()&&this.hitTest(t.getConnection().getClient())){var n=t.getConnection().getUserId(),i="".concat(n,"_").concat(t.getType());if(this.pathMainVideoMap_.has(i)){var r=this.pathMainVideoMap_.get(i);0===r.statsToReport.uint64_combine_first_frame_time&&(r.statsToReport.uint64_combine_first_frame_time=Date.now())}}}},{key:"handleVideoPlaying",value:function(e){var t=e.stream;if(t.isRemote()&&t.getConnection()&&this.hitTest(t.getConnection().getClient())){var n=t.getConnection().getUserId(),i="".concat(n,"_").concat(t.getType()),r=Date.now();if(this.pathMainVideoMap_.has(i)){var o=this.pathMainVideoMap_.get(i);if(0===o.statsToReport.uint64_render_first_frame_time&&(o.statsToReport.uint64_render_first_frame_time=r),this.remoteStreamStatsMap_.has(i)){var a=this.remoteStreamStatsMap_.get(i),s=a.statsToReport,c=a.playStreamTime,u=a.subscribedTime;0===s.uint32_video_render_first&&c-u<=100&&(s.uint32_video_render_first=r-o.sendSubscribeCMDTime)}}if(t.getType()===jS&&this.pathAuxiliaryMap_.has(i)&&this.remoteStreamStatsMap_.has(i)){var l=this.remoteStreamStatsMap_.get(i),d=l.statsToReport,h=l.playStreamTime,p=l.subscribedTime;0===d.uint32_video_render_first&&h-p<=100&&(d.uint32_video_render_first=r-this.pathAuxiliaryMap_.get(i).sendSubscribeCMDTime)}}}},{key:"handleAudioPlaying",value:function(e){if(e.stream.isRemote()&&e.stream.getConnection()&&this.hitTest(e.stream.getConnection().getClient())){var t=e.stream.getConnection().getUserId(),n="".concat(t,"_").concat(e.stream.getType());if(this.pathMainAudioMap_.has(n)){var i=this.pathMainAudioMap_.get(n);0===i.statsToReport.uint64_play_first_frame_time&&(i.statsToReport.uint64_play_first_frame_time=Date.now())}}}},{key:"handleNetworkQuality",value:function(e){var t=this;this.hitTest(e.client)&&(this.networkQuality_.totalUplinkLoss+=e.uplinkLoss,this.networkQuality_.totalUplinkRTT+=e.uplinkRTT,this.networkQuality_.count++,e.downlinkLossAndRTTMap.forEach((function(e){var n=e.rtt,i=e.loss,r=e.userId,o=t.networkQuality_.totalDownlinkRTTAndLossMap.get(r);o?(o.totalRTT+=n,o.totalLoss+=i,o.count++):t.networkQuality_.totalDownlinkRTTAndLossMap.set(r,{totalRTT:n,totalLoss:i,count:1})})))}},{key:"handleHeartbeatStats",value:function(e){var t=this;if(this.hitTest(e.client)){var n=e.stats,i=n.msg_up_stream_info,r=n.msg_down_stream_info;if(i.msg_video_status[0]){var o=i.msg_video_status[0],a=o.uint32_video_codec_bitrate,s=o.uint32_video_enc_fps,c=o.uint32_video_width,u=o.uint32_video_height;this.localStreamStats_.totalVideoBitrate+=a,this.localStreamStats_.totalVideoFPS+=s,this.localStreamStats_.totalVideoWidth+=c,this.localStreamStats_.totalVideoHeight+=u,this.localStreamStats_.videoCount++}if(i.msg_audio_status){var l=i.msg_audio_status.audioLevel;Math.floor(100*l)>0&&(this.localStreamStats_.totalAudioLevel+=l,this.localStreamStats_.audioLevelCount++)}r.forEach((function(e){var n=e.msg_user_info,i=e.msg_audio_status,r=e.msg_video_status,o=n.str_identifier;if(r.forEach((function(e){var n=2===e.uint32_video_stream_type,i=7===e.uint32_video_stream_type,r="".concat(o,"_").concat(n?BS:jS);if(t.remoteStreamStatsMap_.has(r)){var a,s,c=t.remoteStreamStatsMap_.get(r);(n&&null!==(a=c.stream)&&void 0!==a&&a.isMainVideoSubscribed||i&&null!==(s=c.stream)&&void 0!==s&&s.isAuxVideoSubscribed)&&(c.totalVideoFPS+=e.uint32_video_receive_fps,c.totalVideoBitrate+=e.uint32_video_codec_bitrate,c.videoCount++,0===c.statsToReport.uint32_video_width&&(c.statsToReport.uint32_video_width=e.uint32_video_width),0===c.statsToReport.uint32_video_height&&(c.statsToReport.uint32_video_height=e.uint32_video_height))}})),i){var a="".concat(o,"_").concat(BS);if(t.remoteStreamStatsMap_.has(a)){var s,c=t.remoteStreamStatsMap_.get(a);null!==(s=c.stream)&&void 0!==s&&s.isMainAudioSubscribed&&(c.totalAudioBitrate+=i.uint32_audio_codec_bitrate,c.audioCount++,Math.floor(100*i.audioLevel)>0&&(c.totalAudioLevel+=i.audioLevel,c.audioLevelCount++))}}}))}}},{key:"handlePublishStart",value:function(e){var t=e.client;this.hitTest(t)&&0===this.localStreamStats_.publishStartTime&&(this.localStreamStats_.publishStartTime=Date.now())}},{key:"handleLocalStreamInitStart",value:function(e){var t=e.audio,n=e.video;t&&0===this.pathJoinRoom_.uint64_init_audio_start_time&&(this.pathJoinRoom_.uint64_init_audio_start_time=Date.now()),n&&0===this.pathJoinRoom_.uint64_init_camera_start_time&&(this.pathJoinRoom_.uint64_init_camera_start_time=Date.now())}},{key:"handleLocalStreamInitEnd",value:function(e){var t=e.audio,n=e.video;t&&0===this.pathJoinRoom_.uint64_init_audio_end_time&&(this.pathJoinRoom_.uint64_init_audio_end_time=Date.now()),n&&0===this.pathJoinRoom_.uint64_init_camera_end_time&&(this.pathJoinRoom_.uint64_init_camera_end_time=Date.now())}},{key:"handleLocalStreamInitFailed",value:function(e){var t=e.audio,n=e.video,i=e.error,r=i instanceof IL?i.getExtraCode()||i.getCode():{NotFoundError:1,NotAllowedError:2,NotReadableError:3,OverConstrainedError:4,AbortError:5}[i.name]||yL.UNKNOWN;t&&0===this.pathJoinRoom_.uint64_init_audio_end_time&&(this.pathJoinRoom_.int32_init_audio_ret=r,this.pathJoinRoom_.uint64_init_audio_end_time=Date.now()),n&&0===this.pathJoinRoom_.uint64_init_camera_end_time&&(this.pathJoinRoom_.int32_init_camera_ret=r,this.pathJoinRoom_.uint64_init_camera_end_time=Date.now())}},{key:"hasVideoFlag",value:function(e){return this.firstPublishedUserList_.findIndex((function(t){return t.userId===e&&1&t.flag}))>=0}},{key:"hasAudioFlag",value:function(e){return this.firstPublishedUserList_.findIndex((function(t){return t.userId===e&&8&t.flag}))>=0}},{key:"hasAuxFlag",value:function(e){return this.firstPublishedUserList_.findIndex((function(t){return t.userId===e&&4&t.flag}))>=0}},{key:"hitTest",value:function(e){return e===this.client_}},{key:"checkStorage",value:(o=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=iN.getItem(this.storageKey_))){e.next=6;break}return e.next=5,this.upload(t);case 5:iN.deleteItem(this.storageKey_);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.log_.warn(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return o.apply(this,arguments)})},{key:"setStorage",value:function(){this.prepareReport();var e=this.getReportData();0!==e.msg_path_enter_room.uint64_start_time&&iN.setItem(this.storageKey_,e)}},{key:"prepareReport",value:function(){var e=this;if(this.networkQuality_.count>0&&(this.basicInfo.uint32_avg_rtt=Math.floor(this.networkQuality_.totalUplinkRTT/this.networkQuality_.count),this.basicInfo.uint32_avg_up_loss=Math.floor(this.networkQuality_.totalUplinkLoss/this.networkQuality_.count)),this.localStreamStats_.videoCount>0){this.localStreamStats_.statsToReport.uint32_video_big_capture_fps=Math.floor(this.localStreamStats_.totalVideoFPS/this.localStreamStats_.videoCount),this.localStreamStats_.statsToReport.uint32_video_big_bitrate=Math.floor(this.localStreamStats_.totalVideoBitrate/this.localStreamStats_.videoCount);var t=Math.floor(this.localStreamStats_.totalVideoWidth/this.localStreamStats_.videoCount),n=Math.floor(this.localStreamStats_.totalVideoHeight/this.localStreamStats_.videoCount);this.localStreamStats_.statsToReport.uint32_video_big_resolution=t<<16|n}this.localStreamStats_.audioLevelCount>0&&(this.localStreamStats_.statsToReport.uint32_audio_capture_db=Math.floor(this.localStreamStats_.totalAudioLevel/this.localStreamStats_.audioLevelCount*100)),this.remoteStreamStatsMap_.forEach((function(t,n){var i=t.userId;if(e.networkQuality_.totalDownlinkRTTAndLossMap.has(i)){var r=e.networkQuality_.totalDownlinkRTTAndLossMap.get(i),o=r.totalLoss,a=r.count;t.statsToReport.uint32_avg_down_loss=Math.floor(o/a)}t.videoCount>0&&(t.statsToReport.uint32_video_avg_fps=Math.floor(t.totalVideoFPS/t.videoCount),t.statsToReport.uint32_video_avg_bitrate=Math.floor(t.totalVideoBitrate/t.videoCount)),t.audioCount>0&&(t.statsToReport.uint32_audio_recv_bitrate=t.statsToReport.uint32_audio_bitrate=Math.floor(t.totalAudioBitrate/t.audioCount)),t.audioLevelCount>0&&(t.statsToReport.uint32_audio_play_db=Math.floor(t.totalAudioLevel/t.audioLevelCount*100));var s=e.client_.getCallDurationCalculator();s&&(t.statsToReport.uint32_audio_play_time=s.getDuration(n,UC),t.statsToReport.uint32_video_play_time=s.getDuration(n,GC)),t.statsToReport.uint32_video_render_first=Math.min(t.statsToReport.uint32_video_render_first,qz);var c=e.client_.getBadCaseDetector();if(c){var u=c.getDataFreezeDuration(n),l=u.dataFreeze,d=u.count,h=c.getRenderFreezeDuration(n).renderFreeze;t.statsToReport.uint32_video_block_count=d,t.statsToReport.uint32_video_block_time=Math.min(l,t.statsToReport.uint32_video_play_time),t.statsToReport.uint32_video_external_block_time=Math.min(h,t.statsToReport.uint32_video_play_time),c.isBlackStream(n)&&0===t.statsToReport.uint32_video_avg_fps?t.statsToReport.uint32_video_black_screen_subjective=1:t.statsToReport.uint32_video_black_screen_subjective=0}(0===t.subscribeStartTime||t.subscribeStartTime-t.streamAddedTime>100||0===t.playStreamTime)&&(e.pathMainAudioMap_.delete(n),e.pathMainVideoMap_.delete(n),t.statsToReport.uint32_video_render_first=0)})),this.pathMainAudioMap_.forEach((function(t,n){e.hasAudioFlag(t.userId)?t.statsToReport.uint64_play_first_frame_time-t.statsToReport.uint64_start_enter_time>qz&&(t.statsToReport.uint64_play_first_frame_time=t.statsToReport.uint64_start_enter_time+qz):e.pathMainAudioMap_.delete(n)})),this.pathMainVideoMap_.forEach((function(t,n){e.hasVideoFlag(t.userId)?t.statsToReport.uint64_render_first_frame_time-t.statsToReport.uint64_start_enter_time>qz&&(t.statsToReport.uint64_render_first_frame_time=t.statsToReport.uint64_start_enter_time+qz):e.pathMainVideoMap_.delete(n)})),this.pathJoinRoom_.uint64_end_time-this.pathJoinRoom_.uint64_start_time>qz&&(this.pathJoinRoom_.uint64_end_time=this.pathJoinRoom_.uint64_start_time+qz)}},{key:"getReportData",value:function(){var e=this.client_.getSignalInfo();return{uint32_sdk_app_id:Number(this.client_.getSDKAppId()),msg_user_info:new zz({userId:this.client_.getUserId(),tinyId:this.client_.getTinyId(),role:this.client_.getRole()===PS?NS:xS}),msg_basic_info:this.basicInfo,uint32_acc_ip:bD(e.relayIp),uint32_client_ip:bD(e.clientIp,"small"),uint32_acc_port:0,uint64_timestamp:Date.now(),uint32_seq:Math.floor(Math.random()*Math.pow(2,31)),msg_path_enter_room:this.pathJoinRoom_,msg_path_exit_room:this.pathLeaveRoom_,msg_path_recv_video:C(this.pathMainVideoMap_.values()).map((function(e){return e.statsToReport})),msg_quality_statistics:C(this.remoteStreamStatsMap_.values()).map((function(e){return e.statsToReport})),str_room_name:String(this.client_.getRoomId()),msg_path_recv_audio:C(this.pathMainAudioMap_.values()).map((function(e){return e.statsToReport})),uint32_info_client_ip:bD(e.clientIp,"small"),error_code:[],msg_local_statistics:this.localStreamStats_.statsToReport,msg_function_state:Wz.getStateArray()}}},{key:"report",value:(r=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.getReportData(),e.next=4,this.upload(t);case 4:iN.deleteItem(this.storageKey_),Wz.clearStateArray(),this.initData(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.log_.warn(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return r.apply(this,arguments)})},{key:"upload",value:(n=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(eD||0===t.msg_path_enter_room.uint64_start_time||[ob,ab,sb].findIndex((function(e){return e===location.host}))>=0)){e.next=2;break}return e.abrupt("return");case 2:return n=Number(this.client_.getSDKAppId()),r=uD(n,DS),e.next=6,PD({url:r,body:JSON.stringify(t)});case 6:if("ok"===(o=e.sent).data){e.next=9;break}throw"key point upload failed: ".concat(o.data);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}(),M(Pz.prototype,"upload",[xz],Object.getOwnPropertyDescriptor(Pz.prototype,"upload"),Pz.prototype),Pz),Wz=function(){function e(){s(this,e)}return u(e,null,[{key:"handleFunctionState",value:function(e){var t,n,i,r,o=e.className,a=e.fnName,s=e.params;if(!(eD||[ob,ab,sb].findIndex((function(e){return e===location.host}))>=0)){var c,u=[];if(o)switch(a){case"createClient":null!==(t=s[0])&&void 0!==t&&t.mode&&u.push("".concat(o,".").concat(a,".").concat(s[0].mode)),null!==(n=s[0])&&void 0!==n&&n.useStringRoomId?u.push("".concat(o,".").concat(a,".stringRoomId")):u.push("".concat(o,".").concat(a,".intRoomId")),null!==(i=s[0])&&void 0!==i&&i.autoSubscribe?u.push("".concat(o,".").concat(a,".autoSubscribe")):u.push("".concat(o,".").concat(a,".manualSubscribe"));break;case"publish":null!==(r=s[1])&&void 0!==r&&r.isAuxiliary?u.push("".concat(o,".").concat(a,".isAuxiliary")):u.push("".concat(o,".").concat(a));break;case"setAudioProfile":case"setVideoProfile":case"setScreenProfile":case"setVideoContentHint":_D(s[0])&&u.push("".concat(o,".").concat(a,".").concat(s[0]));break;default:u.push("".concat(o,".").concat(a))}else u.push(a);for(var l=0;l<u.length;l++){if(!(c=Sb[u[l]]))return;this.stateMap.has(c)?this.stateMap.get(c).int32_call_times+=1:this.stateMap.set(c,{int32_id:c,int32_call_times:1})}}}},{key:"getStateArray",value:function(){return Array.from(this.stateMap.values())}},{key:"clearStateArray",value:function(){this.stateMap.clear()}}]),e}();function Yz(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];try{e||(e=this.name_),Wz.handleFunctionState({className:e,fnName:n,params:i}),e=void 0}catch(qY){this.log_.info(qY)}return r.apply(this,i)},i}}l(Wz,"stateMap",new Map);var Jz=(Vz=Dz.apply(void 0,C(kz.STREAM.play)),Fz=Yz(),Bz=Yz(),jz=function(){function e(t){s(this,e),this.name_=rb,this.userId_=t.userId,this.isRemote_=t.isRemote,this.type_=t.type,this.log_=UA.createLogger({id:"s".concat(t.seq?t.seq:"","|").concat(this.userId_),userId:gD(t.client)?void 0:t.client.getUserId(),sdkAppId:gD(t.client)?void 0:t.client.getSDKAppId(),isLocal:!this.isRemote_,type:this.isRemote_?this.type_:""}),this.client_=null,gD(t.client)||(this.client_=t.client),this.mediaStream_=null,this.div_=null,this.isPlaying_=!1,this.connection_=null,this.audioPlayer_=null,this.videoPlayer_=null,this.muted_=!1,this.objectFit_="cover",this.mirror_=!1,this.id_="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),this.audioOutputDeviceId_=0,this.audioVolume_=1,this.emitter_=OD(new GD,this.name_),this.connectionState_=HS,this.installEvents(),gD(t.mirror)||this.log_.warn('TRTC.createStream "mirror" option was deprecated since v4.12.1，please use localStream.play to set up preview mirror. refer to '.concat(ub,"/en/LocalStream.html#play. TRTC.createStream 接口的 mirror 选项从 v4.12.1 开始被废弃，请使用 localStream.play 设置本地流预览镜像，参考文档：").concat(ub,"/zh-cn/LocalStream.html#play。"))}var n,r,o,c,l;return u(e,[{key:"installEvents",value:function(){VD.on(DA,this.restartPlayback,this)}},{key:"uninstallEvents",value:function(){VD.off(DA,this.restartPlayback,this)}},{key:"getType",value:function(){return this.type_}},{key:"getLogger",value:function(){return this.log_}},{key:"isSubscribed",get:function(){return this.type_===BS&&this.connection_.isMainStreamSubscribed||this.type_===jS&&this.connection_.isAuxStreamSubscribed}},{key:"isMainVideoSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===BS&&e&&e.video}},{key:"isMainAudioSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===BS&&e&&e.audio}},{key:"isAuxVideoSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===jS&&e&&e.auxiliary}},{key:"isSmallVideoSubscribed",get:function(){var e=this.getSubscribedState();return this.type_===BS&&e&&e.smallVideo}},{key:"emitConnectionStateChanged",value:function(e){e.state!==this.connectionState_&&(e.state!==HS&&this.isRemote_&&!this.isSubscribed||(this.emitter_.emit(BN,e),this.connectionState_=e.state))}},{key:"setConnection",value:function(e){this.connection_!==e&&(e instanceof yz?(null!==this.connection_&&this.connection_.off(UN.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this),e.on(UN.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this)):null===e&&this.connection_.off(UN.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this),this.connection_=e)}},{key:"getConnection",value:function(){return this.connection_}},{key:"play",value:(l=a(i().mark((function e(t,n){var r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log_.info("stream ".concat(this.isPlaying_?"update":"start to"," play with elementId: ").concat(t," and options: ").concat(JSON.stringify(n),".")),!this.isPlaying_){e.next=9;break}return n&&!gD(n.muted)&&(this.muted_=n.muted),n&&!gD(n.objectFit)&&(this.objectFit_=n.objectFit),this.isScreenShare()?this.mirror_=!1:n&&!gD(n.mirror)&&(this.mirror_=n.mirror),this.audioPlayer_&&this.audioPlayer_.setMuted(this.muted_),this.videoPlayer_&&(this.videoPlayer_.setObjectFit(this.objectFit_),this.videoPlayer_.setMirror(this.mirror_)),this.elementId_!==t&&(r=t,_D(t)&&(r=document.getElementById(t)),r.appendChild(this.div_),this.elementId_=t),e.abrupt("return");case 9:return this.isPlaying_=!0,(o=document.createElement("div")).setAttribute("id","player_".concat(this.id_)),o.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),a=t,_D(t)&&(a=document.getElementById(t)),a.appendChild(o),this.elementId_=t,this.div_=o,this.isRemote_||(this.muted_=!0),n&&!gD(n.muted)&&(this.muted_=n.muted),this.isScreenShare()&&(this.objectFit_="contain"),n&&!gD(n.objectFit)&&(this.objectFit_=n.objectFit),this.isScreenShare()?this.mirror_=!1:(this.isRemote_||(this.mirror_=!0),n&&!gD(n.mirror)&&(this.mirror_=n.mirror)),VD.emit(IA,{stream:this}),e.next=26,Promise.all([this.playAudio(),this.playVideo()]);case 26:VD.emit(iA,{stream:this});case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"playAudio",value:(c=a(i().mark((function e(){var n,r,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasAudio()&&(!this.isRemote_||this.isMainAudioSubscribed)){e.next=2;break}return e.abrupt("return");case 2:if(n=this.getAudioTrack(),this.audioPlayer_||!n){e.next=17;break}return this.log_.info("create AudioPlayer and play"),this.audioPlayer_=new OU({stream:this,track:n,gainedTrack:null===(r=this.gain_)||void 0===r?void 0:r.audioTrack,div:this.div_,muted:this.muted_,outputDeviceId:this.audioOutputDeviceId_,volume:this.audioVolume_}),this.audioPlayer_.on(HN,(function(e){var n={type:UC,state:e.state,reason:e.reason};VD.emit(rA,t({stream:o},n)),o.emitter_.emit(VN,n)})),e.prev=7,e.next=10,this.audioPlayer_.play();case 10:e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(7),this.client_&&this.client_.getEnableAutoPlayDialog()&&new rG,this.emitter_.emit(qN,e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[7,12]])}))),function(){return c.apply(this,arguments)})},{key:"playVideo",value:(o=a(i().mark((function e(){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasVideo()&&(!this.isRemote_||this.isMainVideoSubscribed||this.isAuxVideoSubscribed||this.isSmallVideoSubscribed)){e.next=2;break}return e.abrupt("return");case 2:if(n=this.getVideoTrack(),this.videoPlayer_||!n){e.next=18;break}return VD.emit(CA,{stream:this}),this.log_.info("create VideoPlayer and play"),this.videoPlayer_=new oG({stream:this,track:n,div:this.div_,muted:this.muted_,objectFit:this.objectFit_,mirror:this.mirror_}),this.videoPlayer_.on(HN,(function(e){var n={type:GC,state:e.state,reason:e.reason};VD.emit(rA,t({stream:r},n)),r.emitter_.emit(VN,n)})),e.prev=8,e.next=11,this.videoPlayer_.play();case 11:e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(8),this.client_&&this.client_.getEnableAutoPlayDialog()&&new rG,this.emitter_.emit(qN,e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return o.apply(this,arguments)})},{key:"stopAudio",value:function(){this.audioPlayer_&&(this.log_.info("stop AudioPlayer"),this.audioPlayer_.stop(),this.audioPlayer_=null)}},{key:"stopVideo",value:function(){this.videoPlayer_&&(this.log_.info("stop VideoPlayer"),this.videoPlayer_.stop(),this.videoPlayer_=null)}},{key:"restartPlayback",value:function(){this.audioPlayer_&&!this.audioPlayer_.isPlaying&&this.restartAudio(),this.videoPlayer_&&!this.videoPlayer_.isPlaying&&this.restartVideo()}},{key:"restartAudio",value:function(){this.isPlaying_&&(this.stopAudio(),this.playAudio().catch((function(e){})))}},{key:"restartVideo",value:function(){this.isPlaying_&&(this.stopVideo(),this.playVideo().catch((function(e){})))}},{key:"stop",value:function(){this.isPlaying_&&(this.isPlaying_=!1,this.stopAudio(),this.stopVideo(),this.div_.parentNode.removeChild(this.div_))}},{key:"resume",value:(r=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPlaying_){e.next=2;break}return e.abrupt("return");case 2:if(this.log_.info("resume"),!this.audioPlayer_){e.next=6;break}return e.next=6,this.audioPlayer_.resume();case 6:if(!this.videoPlayer_){e.next=9;break}return e.next=9,this.videoPlayer_.resume();case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"close",value:function(){this.log_.info("close stream"),this.isPlaying_&&this.stop(),this.isRemote_||(this.mediaStream_&&(this.mediaStream_.preventEvent=1,this.mediaStream_.getTracks().forEach((function(e){e.stop()})),this.mediaStream_=null),this.uninstallEvents())}},{key:"muteAudio",value:function(){return this.addRemoteEvent(!0,UC),this.doEnableTrack(UC,!1)}},{key:"muteVideo",value:function(){return this.addRemoteEvent(!0,GC),this.doEnableTrack(GC,!1)}},{key:"unmuteAudio",value:function(){return this.addRemoteEvent(!1,UC),this.doEnableTrack(UC,!0)}},{key:"unmuteVideo",value:function(){return this.addRemoteEvent(!1,GC),this.doEnableTrack(GC,!0)}},{key:"addRemoteEvent",value:function(e,t){if(this.isRemote_&&this.client_){var n=this.client_.getUserId(),i="".concat(e?WC:YC," remote ").concat(t);rO(n,{eventId:t===UC?e?UL:VL:e?PL:GL,eventDesc:i,timestamp:(new Date).getTime(),userId:n,tinyId:this.client_.getTinyId(),remoteUserId:this.userId_,remoteTinyId:this.connection_.getTinyId()})}}},{key:"doEnableTrack",value:function(e,t){var n=!1;return e===UC?this.mediaStream_.getAudioTracks().forEach((function(e){n=!0,e.enabled=t})):this.mediaStream_.getVideoTracks().forEach((function(e){n=!0,e.enabled=t})),n}},{key:"getId",value:function(){return this.id_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.connection_?this.connection_.getTinyId():""}},{key:"isPlaying",value:function(){return this.isPlaying_}},{key:"setAudioOutput",value:(n=a(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioOutputDeviceId_=t,!this.audioPlayer_){e.next=4;break}return e.next=4,this.audioPlayer_.setSinkId(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setAudioVolume",value:function(e){this.audioVolume_=e,this.log_.info("setAudioVolume to ".concat(e)),this.audioPlayer_&&this.audioPlayer_.setVolume(e)}},{key:"getAudioLevel",value:function(){var e=0;return this.audioPlayer_&&(e=this.audioPlayer_.getAudioLevel()),e}},{key:"getInternalAudioLevel",value:function(){var e=0;return this.audioPlayer_&&(e=this.audioPlayer_.getInternalAudioLevel()),e}},{key:"hasAudio",value:function(){if(this.isRemote_){if(!this.connection_)return!1;var e=this.connection_.getTrackState();return this.type_===BS&&e.audio}return!!this.getAudioTrack()}},{key:"hasVideo",value:function(){if(this.isRemote_){if(!this.connection_)return!1;var e=this.connection_.getTrackState();return this.type_===jS?e.auxiliary:e.video}return!!this.getVideoTrack()}},{key:"getSubscribedState",value:function(){return this.isRemote_&&this.connection_?this.connection_.getSubscribeState():null}},{key:"getAudioTrack",value:function(){var e=null;if(this.mediaStream_){var t=this.mediaStream_.getAudioTracks();t.length>0&&(e=t[0])}return e}},{key:"getVideoTrack",value:function(){var e=null;if(this.mediaStream_){var t=this.mediaStream_.getVideoTracks();t.length>0&&(e=t[0])}return e}},{key:"getVideoFrame",value:function(){return this.videoPlayer_?this.videoPlayer_.getVideoFrame():null}},{key:"getMediaStream",value:function(){return this.mediaStream_}},{key:"setMediaStream",value:function(e){e!==this.mediaStream_&&(this.mediaStream_&&this.mediaStream_.getTracks().forEach((function(e){return e.stop()})),this.mediaStream_=e)}},{key:"updateVideoPlayingState",value:function(e){this.isPlaying_&&(e?(this.log_.info("playing state updated, play video"),this.playVideo().catch((function(e){}))):(this.log_.info("playing state updated, stop video"),this.stopVideo()))}},{key:"updateAudioPlayingState",value:function(e){this.isPlaying_&&(e?(this.log_.info("playing state updated, play audio"),this.playAudio().catch((function(e){}))):(this.log_.info("playing state updated, stop audio"),this.stopAudio()))}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,n)}},{key:"isRemote",value:function(){return this.isRemote_}},{key:"isScreenShare",value:function(){return!this.isRemote_&&this.screen_||this.isRemote_&&this.getType()===jC}},{key:"getDiv",value:function(){return this.div_}},{key:"getObjectFit",value:function(){return this.objectFit_}},{key:"getMuted",value:function(){return this.muted_}},{key:"getClient",value:function(){return this.client_}}]),e}(),M(jz.prototype,"play",[Vz],Object.getOwnPropertyDescriptor(jz.prototype,"play"),jz.prototype),M(jz.prototype,"setAudioOutput",[Fz],Object.getOwnPropertyDescriptor(jz.prototype,"setAudioOutput"),jz.prototype),M(jz.prototype,"getVideoFrame",[Bz],Object.getOwnPropertyDescriptor(jz.prototype,"getVideoFrame"),jz.prototype),jz),Zz=function(e){d(i,e);var n=m(i);function i(e){var r;s(this,i);var o={isRemote:!0,type:e.type},a=t(t({},e),o);return(r=n.call(this,a)).name_=ib,r.isStreamAddedEventEmitted_=!1,r.isAbleToCallSubscription_=!0,r}return u(i,[{key:"installEvents",value:function(){I(h(i.prototype),"installEvents",this).call(this),VD.on(lA,this.handleStreamSubscribed,this),VD.on(dA,this.handleStreamUnsubscribed,this)}},{key:"uninstallEvents",value:function(){I(h(i.prototype),"uninstallEvents",this).call(this),VD.off(lA,this.handleStreamSubscribed,this),VD.off(dA,this.handleStreamUnsubscribed,this)}},{key:"handleStreamSubscribed",value:function(e){e.client===this.client_&&e.stream===this&&this.connection_.getCurrentState()===WS&&this.emitConnectionStateChanged({prevState:HS,state:WS})}},{key:"handleStreamUnsubscribed",value:function(e){e.client===this.client_&&e.stream===this&&this.emitConnectionStateChanged({prevState:WS,state:HS})}},{key:"getType",value:function(){return I(h(i.prototype),"getType",this).call(this)}},{key:"getIsAbleToCallSubscription",value:function(){return this.isAbleToCallSubscription_}},{key:"setIsAbleToCallSubscription",value:function(e){this.isAbleToCallSubscription_=e}},{key:"setIsStreamAddedEventEmitted",value:function(e){this.isStreamAddedEventEmitted_=e}},{key:"getIsStreamAddedEventEmitted",value:function(){return this.isStreamAddedEventEmitted_}},{key:"getAudioTrack",value:function(){return this.connection_&&this.connection_.getTrackState().audio?I(h(i.prototype),"getAudioTrack",this).call(this):null}},{key:"getVideoTrack",value:function(){if(!this.connection_)return null;var e=this.connection_.getTrackState();return this.type_===BS&&!e.video||this.type_===jS&&!e.auxiliary?null:I(h(i.prototype),"getVideoTrack",this).call(this)}},{key:"close",value:function(){I(h(i.prototype),"close",this).call(this)}}]),i}(Jz),Xz=function(){function e(t){s(this,e),this.client_=t.client,this.subscribedStreams_=new Map,this.unsubscribedStreams_=new Map,this.subscriptedOptions_=new Map,this.autoRecoveryFlags_=new Map}var t,n,r;return u(e,[{key:"isEnabled",get:function(){return"webrtc"!==this.client_.getEnv()}},{key:"recover",value:(r=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getUserId(),r=t.getType(),this.hasAutoRecoveryFlag(n,r)){e.next=5;break}return e.abrupt("return");case 5:if(o=this.getUnsubscribedStream(n,r)?"unsubscribe":"subscribe",e.prev=6,UA.warn("recover() try to recover subscription [".concat(o,"][").concat(n,"][").concat(r,"]")),"subscribe"!==o){e.next=13;break}return e.next=11,this.recoverSubscription(n,t);case 11:e.next=15;break;case 13:return e.next=15,this.recoverUnsubscription(n,t);case 15:uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:SE}),UA.warn("recover() recover successfully [".concat(o,"][").concat(n,"][").concat(r,"]")),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),UA.error("recover() recover failed [".concat(o,"][").concat(n,"][").concat(r,"]"),e.t0),uO.logFailedEvent({userId:this.client_.getUserId(),eventType:SE,error:e.t0});case 23:this.deleteAutoRecoveryFlag(n,r);case 24:case"end":return e.stop()}}),e,this,[[6,19]])}))),function(e){return r.apply(this,arguments)})},{key:"recoverSubscription",value:(n=a(i().mark((function e(t,n){var r,o,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getOptions(t,n.getType()),o=this.getSubscribedStream(t,n.getType()),r&&o){e.next=4;break}return e.abrupt("return");case 4:a=this.getStreamMuteState(o),s=a.isAudioMuted,c=a.isVideoMuted,this.mergeStream(o,n),this.recoverPlayingState(o),s&&o.doEnableTrack(UC,!1),c&&o.doEnableTrack(GC,!1);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"recoverUnsubscription",value:(t=a(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getUnsubscribedStream(t,n.getType())){e.next=3;break}return e.abrupt("return");case 3:this.mergeStream(r,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getStreamMuteState",value:function(e){var t={isAudioMuted:!1,isVideoMuted:!1},n=e.getMediaStream();return n&&(t.isAudioMuted=n.getAudioTracks().map((function(e){return e.enabled})).includes(!1),t.isVideoMuted=n.getVideoTracks().map((function(e){return e.enabled})).includes(!1)),t}},{key:"recoverPlayingState",value:function(e){var t=e.isPlaying(),n=e.getDiv();if(t&&n){var i=n.parentNode;e.stop(),e.play(i,{objectFit:e.getObjectFit(),muted:e.getMuted()})}}},{key:"mergeStream",value:function(e,t){var n=t.getConnection(),i=t.getMediaStream();e.setConnection(n),n.setRemoteStream(i.id,e),e.setMediaStream(i),e.updateAudioPlayingState(t.hasAudio()),e.updateVideoPlayingState(t.hasVideo())}},{key:"addSubscriptionRecord",value:function(e,t,n){var i=t.getType();if(this.subscribedStreams_.has(e))this.subscribedStreams_.get(e).set(i,t);else{var r=new Map;r.set(t.getType(),t),this.subscribedStreams_.set(e,r)}if(this.subscriptedOptions_.has(e))this.subscriptedOptions_.get(e).set(i,n);else{var o=new Map;o.set(t.getType(),n),this.subscriptedOptions_.set(e,o)}this.deleteUnsubscriptionRecord(e,i)}},{key:"addUnsubscriptionRecord",value:function(e,t){if(this.unsubscribedStreams_.has(e))this.unsubscribedStreams_.get(e).set(t.getType(),t);else{var n=new Map;n.set(t.getType(),t),this.unsubscribedStreams_.set(e,n)}this.deleteSubscriptionRecord(e,t.getType())}},{key:"getSubscribedStream",value:function(e,t){return this.subscribedStreams_.has(e)&&this.subscribedStreams_.get(e).has(t)?this.subscribedStreams_.get(e).get(t):null}},{key:"getOptions",value:function(e,t){return this.subscriptedOptions_.has(e)&&this.subscriptedOptions_.get(e).has(t)?this.subscriptedOptions_.get(e).get(t):null}},{key:"getUnsubscribedStream",value:function(e,t){return this.unsubscribedStreams_.has(e)&&this.unsubscribedStreams_.get(e).has(t)?this.unsubscribedStreams_.get(e).get(t):null}},{key:"deleteSubscriptionRecord",value:function(e,t){this.subscribedStreams_.has(e)&&this.subscribedStreams_.get(e).delete(t),this.subscriptedOptions_.has(e)&&this.subscriptedOptions_.get(e).delete(t)}},{key:"deleteUnsubscriptionRecord",value:function(e,t){this.unsubscribedStreams_.has(e)&&this.unsubscribedStreams_.get(e).delete(t)}},{key:"markAllStream",value:function(){for(var e=0,t=C(this.subscribedStreams_.entries());e<t.length;e++)for(var n=T(t[e],2),i=n[0],r=0,o=C(n[1].entries());r<o.length;r++){var a=T(o[r],1)[0];this.setAutoRecoveryFlag(i,a)}for(var s=0,c=C(this.unsubscribedStreams_.entries());s<c.length;s++)for(var u=T(c[s],2),l=u[0],d=0,h=C(u[1].entries());d<h.length;d++){var p=T(h[d],1)[0];this.setAutoRecoveryFlag(l,p)}}},{key:"setAutoRecoveryFlag",value:function(e,t){if(UA.info("setAutoRecoveryFlag() mark [".concat(e,"][").concat(t,"]")),this.autoRecoveryFlags_.has(e))this.autoRecoveryFlags_.get(e).set(t);else{var n=new Map;n.set(t),this.autoRecoveryFlags_.set(e,n)}}},{key:"hasAutoRecoveryFlag",value:function(e,t){return!!this.isEnabled&&this.autoRecoveryFlags_.has(e)&&this.autoRecoveryFlags_.get(e).has(t)}},{key:"deleteAutoRecoveryFlag",value:function(e,t){this.autoRecoveryFlags_.has(e)&&this.autoRecoveryFlags_.get(e).delete(t)}},{key:"delete",value:function(e){this.unsubscribedStreams_.delete(e),this.subscribedStreams_.delete(e),this.subscriptedOptions_.delete(e),this.autoRecoveryFlags_.delete(e)}}]),e}(),Qz=function(){function e(t){s(this,e),this.player_=t,this.canvas_=document.createElement(PC),this.canvasCtx_=this.canvas_.getContext("2d")}return u(e,[{key:"setCanvasRect",value:function(e,t){this.canvas_.width=e,this.canvas_.height=t}},{key:"drawVideoToCanvas",value:function(){var e=this.player_.getElement(),t=e.videoHeight,n=e.videoWidth,i=n*this.canvas_.height/(t*this.canvas_.width);if(i>1.05||i<.95){var r=n*t/(this.canvas_.width*this.canvas_.height);this.setCanvasRect(n/Math.sqrt(r),t/Math.sqrt(r))}this.canvasCtx_.drawImage(e,0,0,this.canvas_.width,this.canvas_.height)}},{key:"generateVideoTrackFromCanvasCapture",value:function(e){return this.canvas_.captureStream(e).getVideoTracks()[0]}},{key:"generateStreamFromTrack",value:function(e){var t=new MediaStream;return t.addTrack(e),t}},{key:"destroy",value:function(){this.player_.stop(),this.canvas_.width=0,this.canvas_.height=0,this.canvas_=null,this.canvasCtx_=null}},{key:"canvas",get:function(){return this.canvas_}},{key:"canvasCtx",get:function(){return this.canvasCtx_}},{key:"canDrawVideoToCanvas",get:function(){if(this.player_){var e=this.player_.getElement();if(e)return e.readyState===e.HAVE_ENOUGH_DATA}return!1}}]),e}(),$z=new Blob(['let t,e,a,i;onmessage=function(n){const{action:h,data:s}=n.data;switch(h){case"render":a=s.canvas,t=a.width,e=a.height,i=a.getContext("2d"),function(t,e){const n=new TransformStream({async transform(t,e){const n=t.displayWidth,h=t.displayHeight,s=n*a.height/(h*a.width);if(s>1.05||s<.95){const t=n*h/(a.width*a.height);a.width=n/Math.sqrt(t),a.height=h/Math.sqrt(t)}i.drawImage(t,0,0,a.width,a.height);const o=new VideoFrame(a,{timestamp:t.timestamp});t.close(),e.enqueue(o)}});t.pipeThrough(n).pipeTo(e)}(s.readable,s.writable)}}'],{type:"application/javascript"}),eK=function(){function e(t){s(this,e);var n=t.videoTrack;this.width=void 0,this.height=void 0,this.canvas=document.createElement("canvas"),this.offscreen=null,this.smallGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.smallWritable=this.smallGenerator.writable,this.bigProcessor=new MediaStreamTrackProcessor({track:n}),this.bigReadable=this.bigProcessor.readable,this.initWorker()}return u(e,[{key:"initWorker",value:function(){try{this.worker=new Worker(URL.createObjectURL($z)),UA.info("init worker processor success")}catch(e){UA.warn("init worker processor failed. ".concat(e.error))}}},{key:"setCanvasRect",value:function(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.offscreen=this.canvas.transferControlToOffscreen(),this.worker.postMessage({action:"render",data:{canvas:this.offscreen,readable:this.bigReadable,writable:this.smallWritable}},[this.offscreen,this.bigReadable,this.smallWritable])}},{key:"generatorVideoTrack",value:function(){var e=new MediaStream([this.smallGenerator]);return null==e?void 0:e.getTracks()[0]}},{key:"destroy",value:function(){this.worker.terminate()}}]),e}(),tK=function(){function e(t){s(this,e),this.localStream_=t,this.player_=null,this.processor_=null,this.initOffscreenSuccess_=!1}var t;return u(e,[{key:"initialize",value:(t=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(PN()&&(null===(t=navigator)||void 0===t?void 0:t.hardwareConcurrency)>=6)){e.next=13;break}return e.prev=1,e.next=4,this.initOffscreen();case 4:this.initOffscreenSuccess_=!0,UA.info("Initialize VideoGenerator successfully!"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.initCanvas();case 11:e.next=14;break;case 13:this.initCanvas();case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return t.apply(this,arguments)})},{key:"generateSmallVideoTrack",value:function(e){var t,n=e.height,i=e.width,r=e.frameRate,o=this.getSmallVideoProfile(i,n);return this.initOffscreenSuccess_?(this.processor_.setCanvasRect(o.width,o.height),t=this.processor_.generatorVideoTrack()):(this.processor_.setCanvasRect(o.width,o.height),this.player_.setRect({width:o.width,height:o.height}),t=this.processor_.generateVideoTrackFromCanvasCapture(r),this.interval_=tN.run(yb,this.render.bind(this),{fps:r})),t}},{key:"render",value:function(){this.processor_.canDrawVideoToCanvas&&this.processor_.drawVideoToCanvas()}},{key:"destroy",value:function(){tN.clearTask(this.interval_),this.processor_&&this.processor_.destroy()}},{key:"initOffscreen",value:function(){this.processor_=new eK({videoTrack:this.localStream_.getVideoTrack()})}},{key:"initCanvas",value:function(){this.player_=new oG({stream:this.localStream_,track:this.localStream_.getVideoTrack(),muted:!0,objectFit:"cover",mirror:!1}),this.player_.play().then((function(){UA.info("VideoGenerator: play local video success")})).catch((function(){UA.error("VideoGenerator: Failed to play local video")})),this.processor_=new Qz(this.player_)}},{key:"getSmallVideoProfile",value:function(e,t){var n,i=this.localStream_.getVideoTrack(),r=this.localStream_.getVideoProfile();if(NN){var o=i.getSettings();o&&o.width&&o.height&&(r.width=o.width,r.height=o.height)}var a=r.width*r.height,s=e*t;return UA.info("big stream resolution: ".concat(r.width,"*").concat(r.height," small stream resolution: ").concat(e,"*").concat(t," ")),n=a>s?a/s:a/19200,{width:parseInt(r.width/Math.sqrt(n)),height:parseInt(r.height/Math.sqrt(n))}}}]),e}(),nK=new Map,iK=function(){var e=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!EN()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,oK(t);case 4:if(n=e.sent,UA.info("getUserMedia with constraints: "+JSON.stringify(n)),!n.audio){e.next=11;break}return e.next=9,jY.getMicrophones();case 9:r=e.sent,UA.info("microphones: ".concat(JSON.stringify(r)));case 11:if(!n.video){e.next=16;break}return e.next=14,jY.getCameras();case 14:o=e.sent,UA.info("cameras: ".concat(JSON.stringify(o)));case 16:return e.prev=16,e.next=19,navigator.mediaDevices.getUserMedia(n);case 19:return e.abrupt("return",e.sent);case 22:if(e.prev=22,e.t0=e.catch(16),"NotFoundError"!==e.t0.name){e.next=29;break}if(!o||0!==o.length){e.next=27;break}throw new IL({code:yL.DEVICE_NOT_FOUND,message:aD({key:Ik})});case 27:if(!r||0!==r.length){e.next=29;break}throw new IL({code:yL.DEVICE_NOT_FOUND,message:aD({key:yk})});case 29:throw new IL({code:yL.INITIALIZE_FAILED,name:e.t0.name,message:e.t0.message,constraint:e.t0.constraint});case 30:case"end":return e.stop()}}),e,null,[[16,22]])})));return function(t){return e.apply(this,arguments)}}(),rK=LA({retryFunction:iK,settings:{retries:3,timeout:500},onError:function(e,t,n,i){UA.warn("getUserMedia error: ".concat(e)),"NotReadableError"===e.name?t():e.message.includes("deviceId")&&i[0].retryWhenExactFailed?(i[0].useExact=!1,t()):n(e)},onRetrying:function(e){UA.warn("getUserMedia retrying [".concat(e,"/3]"))}});function oK(e){return aK.apply(this,arguments)}function aK(){return(aK=a(i().mark((function e(n){var r,o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={echoCancellation:n.echoCancellation,autoGainControl:n.autoGainControl,noiseSuppression:n.noiseSuppression},n.audio){e.next=5;break}r=!1,e.next=15;break;case 5:if(sO(n.microphoneId)){e.next=9;break}r=t({deviceId:n.useExact?{exact:n.microphoneId}:n.microphoneId,sampleRate:n.sampleRate,channelCount:n.channelCount},r),e.next=15;break;case 9:return r=t({sampleRate:n.sampleRate,channelCount:n.channelCount},r),e.next=12,jY.getMicrophones();case 12:o=e.sent,(a=o.filter((function(e){return e.deviceId.length>0}))).length>0&&(r.deviceId={exact:a[0].deviceId});case 15:return s={},c={ideal:n.width,max:n.width},u={ideal:n.height,max:n.height},ew&&Mw&&n.width*n.height<101376&&(c=n.width,u=n.height),s=!gD(n.facingMode)&&n.video?{facingMode:n.facingMode,width:c,height:u,frameRate:n.frameRate}:!sO(n.cameraId)&&n.video?{deviceId:n.useExact?{exact:n.cameraId}:n.cameraId,width:c,height:u,frameRate:n.frameRate}:!!n.video&&(!!gD(n.width)||{width:c,height:u,frameRate:n.frameRate}),e.abrupt("return",{audio:r,video:s});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var sK=function(){var e=a(i().mark((function e(t){var n,r,o,a,s,c,u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!EN()){e.next=2;break}return e.abrupt("return");case 2:if(n=null,!(Hw&&zw<74||Ww)){e.next=27;break}return r=uK(t),UA.info("getDisplayMedia with constraints: "+JSON.stringify(r)),e.next=8,navigator.mediaDevices.getDisplayMedia(r);case 8:if(o=e.sent,!t.screenAudio){e.next=14;break}return UA.warn("Your browser not support capture system audio"),e.abrupt("return",o);case 14:if(!t.audio){e.next=24;break}return a=cK(t),UA.info("getUserMedia with constraints: "+JSON.stringify(a)),e.next=19,navigator.mediaDevices.getUserMedia(a);case 19:return n=e.sent,o.addTrack(n.getAudioTracks()[0]),e.abrupt("return",o);case 24:return e.abrupt("return",o);case 25:e.next=53;break;case 27:if(!t.screenAudio){e.next=37;break}return t.audioConstraints={echoCancellation:t.echoCancellation,autoGainControl:t.autoGainControl,noiseSuppression:t.noiseSuppression,sampleRate:44100},s=uK(t),UA.info("getDisplayMedia with constraints: "+JSON.stringify(s)),e.next=33,navigator.mediaDevices.getDisplayMedia(s);case 33:return c=e.sent,e.abrupt("return",c);case 37:return u=uK(t),UA.info("getDisplayMedia with constraints: "+JSON.stringify(u)),e.next=41,navigator.mediaDevices.getDisplayMedia(u);case 41:if(l=e.sent,!t.audio){e.next=52;break}return d=cK(t),UA.info("getUserMedia with constraints: "+JSON.stringify(d)),e.next=47,navigator.mediaDevices.getUserMedia(d);case 47:return n=e.sent,l.addTrack(n.getAudioTracks()[0]),e.abrupt("return",l);case 52:return e.abrupt("return",l);case 53:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function cK(e){var t={echoCancellation:e.echoCancellation,autoGainControl:e.autoGainControl,noiseSuppression:e.noiseSuppression,sampleRate:e.sampleRate,channelCount:e.channelCount};return gD(e.microphoneId)||(t.deviceId=e.microphoneId),{audio:t,video:!1}}function uK(e){var t={systemAudio:"include",selfBrowserSurface:"include",surfaceSwitching:"include"},n={width:Ww?{max:e.width}:{ideal:e.width,max:e.width},height:Ww?{max:e.height}:{ideal:e.height,max:e.height},frameRate:e.frameRate,displaySurface:"monitor"};return t.video=n,gD(e.audioConstraints)||(t.audio=e.audioConstraints),t}var lK,dK,hK,pK,fK,gK,_K,vK,mK,yK,IK,TK,CK,SK,EK=new Map([["120p",{width:160,height:120,frameRate:15,bitrate:200}],["120p_2",{width:160,height:120,frameRate:15,bitrate:100}],["180p",{width:320,height:180,frameRate:15,bitrate:350}],["180p_2",{width:320,height:180,frameRate:15,bitrate:150}],["240p",{width:320,height:240,frameRate:15,bitrate:400}],["240p_2",{width:320,height:240,frameRate:15,bitrate:200}],["360p",{width:640,height:360,frameRate:15,bitrate:800}],["360p_2",{width:640,height:360,frameRate:15,bitrate:400}],["480p",{width:640,height:480,frameRate:15,bitrate:900}],["480p_2",{width:640,height:480,frameRate:15,bitrate:500}],["720p",{width:1280,height:720,frameRate:15,bitrate:1500}],["1080p",{width:1920,height:1080,frameRate:15,bitrate:2e3}],["1440p",{width:2560,height:1440,frameRate:30,bitrate:4860}],["4K",{width:3840,height:2160,frameRate:30,bitrate:9e3}]]),bK=new Map([["480p",{width:640,height:480,frameRate:5,bitrate:900}],["480p_2",{width:640,height:480,frameRate:30,bitrate:1e3}],["720p",{width:1280,height:720,frameRate:5,bitrate:1200}],["720p_2",{width:1280,height:720,frameRate:30,bitrate:3e3}],["1080p",{width:1920,height:1080,frameRate:5,bitrate:1600}],["1080p_2",{width:1920,height:1080,frameRate:30,bitrate:4e3}]]),MK=new Map([["standard",{sampleRate:48e3,channelCount:1,bitrate:40}],["standard-stereo",{sampleRate:48e3,channelCount:2,bitrate:64}],["high",{sampleRate:48e3,channelCount:1,bitrate:128}],["high-stereo",{sampleRate:48e3,channelCount:2,bitrate:192}]]),kK=(lK=Yz(nb),dK=Yz(nb),hK=Yz(nb),pK=Yz(nb),fK=Dz.apply(void 0,C(kz.LOCAL_STREAM.switchDevice)),gK=Dz(kz.STREAM.addTrack),_K=Dz(kz.STREAM.removeTrack),vK=Dz(kz.STREAM.replaceTrack),mK=Gz({retries:10,timeout:3e3,onRetryFailed:function(e){uO.logFailedEvent({userId:this.client_?this.client_.getUserId():this.userId_,eventType:CE,error:e}),this.emitter_.emit(qN,new IL({code:yL.DEVICE_AUTO_RECOVER_FAILED,message:e.message}))}}),yK=wz(kz.LOCAL_STREAM.setAudioCaptureVolume),IK=Yz(nb),TK=function(e){d(T,e);var n,o,c,l,p,f,g,_,v,y=m(T);function T(e){var n;s(this,T);var i=t(t({},e),{isRemote:!1,type:"local"});return(n=y.call(this,i)).name_=nb,n.client_=null,n.video_=e.video,n.audio_=e.audio,n.cameraId_=e.cameraId,n.cameraGroupId_="",n.facingMode_=e.facingMode,n.microphoneId_=e.microphoneId,n.microphoneGroupId_="",n.microphoneLabel_="",n.videoSource_=e.videoSource,n.audioSource_=e.audioSource,n.screen_=e.screen,n.screenAudio_=e.screenAudio,n.audioProfile_={echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,sampleRate:48e3,channelCount:1,bitrate:40},n.screenAudio_&&(n.audioProfile_.echoCancellation=!0,n.audioProfile_.autoGainControl=!1,n.audioProfile_.noiseSuppression=!1),mD(e.echoCancellation)&&(n.audioProfile_.echoCancellation=e.echoCancellation),mD(e.autoGainControl)&&(n.audioProfile_.autoGainControl=e.autoGainControl),mD(e.noiseSuppression)&&(n.audioProfile_.noiseSuppression=e.noiseSuppression),n.videoProfile_=EK.get("480p_2"),n.screenProfile_=bK.get("1080p"),n.videoSetting_=null,n.muteState_={video:!1,audio:!1,auxVideo:!1},n.beautyStatus_=!1,n.prevAudioRecoverTime_=0,n.prevVideoRecoverTime_=0,n.isAudioRecovering_=!1,n.isVideoRecovering_=!1,n.initState(),n.canvas_=null,n.canvasInterval_=null,n.canvasTrack_=null,n.gain_={audioTrack:null,source:null,gainNode:null},n.captureVolume_=100,n.enableAutoRecoverCapture_=!!gD(e.enableAutoRecoverCapture)||e.enableAutoRecoverCapture,n.log_.info("stream created: ".concat(n.id_," autoRecover: ").concat(n.enableAutoRecoverCapture_)),n.isAIDenoiser=!1,n}return u(T,[{key:"initState",value:function(){this.isAddingTrack_=!1,this.isRemovingTrack_=!1,this.setIsReadyToPublish(!1),this.setPublishState(jE)}},{key:"installEvents",value:function(){I(h(T.prototype),"installEvents",this).call(this),VD.on(SA,this.onVideoTrackStopped,this),VD.on(mA,this.onVideoTrackStopped,this),VD.on(bA,this.onAudioTrackStopped,this),VD.on(EA,this.onAudioTrackStopped,this)}},{key:"uninstallEvents",value:function(){I(h(T.prototype),"uninstallEvents",this).call(this),VD.off(SA,this.onVideoTrackStopped,this),VD.off(mA,this.onVideoTrackStopped,this),VD.off(bA,this.onAudioTrackStopped,this),VD.off(EA,this.onAudioTrackStopped,this)}},{key:"initialize",value:function(){var e=this;return new Promise((function(t,n){if(bN())n(new IL({code:yL.INVALID_OPERATION,message:aD({key:lk})}));else{if(gD(e.audio_)){var i=new MediaStream;return gD(e.audioSource_)||(i.addTrack(e.audioSource_),e.updateAudioPlayingState(!0)),gD(e.videoSource_)||(i.addTrack(e.videoSource_),e.updateVideoPlayingState(!0)),e.setMediaStream(i),uO.logSuccessEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yE,kind:"custom"}),e.setIsReadyToPublish(!0),t()}e.screen_?(e.log_.info("initialize stream audio: "+e.audio_+" screenAudio: "+e.screenAudio_+" screen: "+e.screen_),sK({audio:e.audio_,screenAudio:e.screenAudio_,microphoneId:e.microphoneId_,width:e.screenProfile_.width,height:e.screenProfile_.height,frameRate:e.screenProfile_.frameRate,sampleRate:e.audioProfile_.sampleRate,channelCount:e.audioProfile_.channelCount,autoGainControl:e.audioProfile_.autoGainControl,noiseSuppression:e.audioProfile_.noiseSuppression,echoCancellation:e.audioProfile_.echoCancellation}).then((function(n){e.setMediaStream(n),e.updateAudioPlayingState(e.audio_||e.screenAudio_),e.updateVideoPlayingState(!0);var i=e.getVideoTrack();return e.listenForScreenSharingStopped(i),e.setVideoContentHint(nS),e.updateDeviceIdInUse(),e.setIsReadyToPublish(!0),e.log_.info(JSON.stringify(i.getSettings())),uO.logSuccessEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yE,kind:"getDisplayMedia"}),t()})).catch((function(t){uO.logFailedEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yE,kind:"getDisplayMedia",error:t}),e.log_.error("getDisplayMedia error observed "+t),n(t instanceof IL?t:new IL({code:yL.INITIALIZE_FAILED,name:t.name,message:t.message}))}))):(VD.emit(gA,{stream:e,audio:e.audio_,video:e.video_}),e.log_.info("initialize stream audio: "+e.audio_+" video: "+e.video_),rK({audio:e.audio_,video:e.video_,facingMode:e.facingMode_,cameraId:e.cameraId_,microphoneId:e.microphoneId_,width:e.videoProfile_.width,height:e.videoProfile_.height,frameRate:e.videoProfile_.frameRate,sampleRate:e.audioProfile_.sampleRate,channelCount:e.audioProfile_.channelCount,autoGainControl:e.audioProfile_.autoGainControl,noiseSuppression:e.audioProfile_.noiseSuppression,echoCancellation:e.audioProfile_.echoCancellation,useExact:!0,retryWhenExactFailed:!0}).then((function(n){return VD.emit(_A,{stream:e,audio:e.audio_,video:e.video_}),e.setMediaStream(n),n.getTracks().forEach((function(t){t.kind===GC&&NN&&(e.videoSetting_=t.getSettings()),xN&&e.log_.info("".concat(t.kind," capabilities: ").concat(JSON.stringify(t.getCapabilities())))})),e.updateAudioPlayingState(e.audio_),e.updateVideoPlayingState(e.video_),e.updateDeviceIdInUse(),e.log_.info("gotStream hasAudio: "+e.hasAudio()+" hasVideo: "+e.hasVideo()),e.setIsReadyToPublish(!0),uO.logSuccessEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yE,kind:"getUserMedia"}),t()})).catch((function(t){VD.emit(vA,{stream:e,audio:e.audio_,video:e.video_,error:t}),uO.logFailedEvent({userId:e.client_?e.client_.getUserId():e.userId_,eventType:yE,kind:"getUserMedia",error:t}),e.log_.error("getUserMedia error observed "+t),n(t)})))}}))}},{key:"listenForScreenSharingStopped",value:function(e){var t=this;e.addEventListener("ended",(function(e){t.log_.info("screen sharing was stopped because the video track is ended"),t.emitter_.emit(FN)}))}},{key:"muteAudio",value:function(){var e=I(h(T.prototype),"muteAudio",this).call(this);return e&&(this.log_.info("localStream mute audio"),this.sendMutedFlag(UC,!0)),e}},{key:"muteVideo",value:function(){var e=I(h(T.prototype),"muteVideo",this).call(this);return e&&(this.log_.info("localStream mute video"),this.sendMutedFlag(GC,!0)),e}},{key:"unmuteAudio",value:function(){var e=I(h(T.prototype),"unmuteAudio",this).call(this);return e&&(this.log_.info("localStream unmute audio"),this.sendMutedFlag(UC,!1)),e}},{key:"unmuteVideo",value:function(){var e=I(h(T.prototype),"unmuteVideo",this).call(this);return e&&(this.log_.info("localStream unmute video"),this.sendMutedFlag(GC,!1)),e}},{key:"sendMutedFlag",value:function(e,t){this.setMuteState(e,t);var n=this.getConnection();if(n){n.sendMutedFlag(this.muteState_,this);var i=n.getUserId(),r=n.getTinyId(),o="".concat(t?WC:YC," local ").concat(e," track");rO(i,{eventId:e===UC?t?bL:kL:t?ML:wL,eventDesc:o,timestamp:iv(),userId:i,tinyId:r})}}},{key:"setMuteState",value:function(e,t){this.muteState_[e]=t,this.log_.info("set ".concat(e," muted state: [").concat(t?"mute":"unmute","]"))}},{key:"setAudioProfile",value:function(e){var n;"object"===r(e)?n=e:void 0===(n=MK.get(e))&&(n=MK.get("standard")),this.log_.info("setAudioProfile: "+JSON.stringify(n)),this.audioProfile_=t(t({},this.audioProfile_),n)}},{key:"setVideoProfile",value:(v=a(i().mark((function e(n){var r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connection_||SN()){e.next=2;break}throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:hk})});case 2:if(dD(n)?o=t(t({},this.videoProfile_),n):_D(n)&&(o=EK.get(n),gD(o)&&(o=EK.get("480p_2"))),null!==(r=this.client_)&&void 0!==r&&r.get2k4kFlag()&&(1!==this.client_.get2k4kFlag()&&!this.screen_&&o.height*o.width>=3686400?(o.width=1920,o.height=1080,this.log_.warn(Cb)):Wz.handleFunctionState({fnName:"2K_4K"})),o&&o.width*o.height>921600&&$w&&(o.width=1280,o.height=720,this.log_.warn("reset to 1280 * 720 on iOS 13~14")),this.log_.info("setVideoProfile "+JSON.stringify(o)),!(a=this.getVideoTrack())){e.next=10;break}return e.next=10,a.applyConstraints(o);case 10:if(s=this.videoProfile_.bitrate!==o.bitrate,this.videoProfile_=o,!s||!this.connection_){e.next=16;break}return e.next=15,this.connection_.setBandwidth({bandwidth:o.bitrate,type:GC,videoType:BC});case 15:this.connection_.sendMediaSettings(this);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getVideoBitrate",value:function(){return this.screen_?this.screenProfile_.bitrate:this.videoProfile_.bitrate}},{key:"getAudioBitrate",value:function(){return this.audioProfile_.bitrate}},{key:"setScreenProfile",value:function(e){var t=e;_D(e)&&(t=bK.get(e)||bK.get("1080p")),this.log_.info("setScreenProfile "+JSON.stringify(e)),this.screenProfile_=t}},{key:"getVideoProfile",value:function(){return this.screen_?this.screenProfile_:this.videoProfile_}},{key:"getAudioProfile",value:function(){return this.audioProfile_}},{key:"setVideoContentHint",value:function(e){var t=this.getVideoTrack();t&&"contentHint"in t&&(this.log_.info("set video track contentHint to: "+e),t.contentHint=e,t.contentHint!==e&&this.log_.warn("Invalid video track contentHint: "+e))}},{key:"switchDevice",value:(_=a(i().mark((function e(t,n){var r,o,a,s,c,u,l,d,h,p,f,g,_,v,m,y,I,T;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaStream_&&this.cameraId_!==n&&this.facingMode_!==n){e.next=2;break}return e.abrupt("return");case 2:if(o=t===GC,!(r=t===UC)||n!==this.microphoneId_){e.next=11;break}if(n===hb){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,ox(this.microphoneGroupId_,this.microphoneLabel_);case 9:if(!e.sent){e.next=11;break}return e.abrupt("return");case 11:return this.setIsReadyToPublish(!1),this.log_.info("switchDevice "+t+" to: "+n),r&&(a=this.getAudioTrack(),s=this.getMicrophoneTrackMixed(),a&&a.stop(),s&&s.stop()),o&&((c=this.getVideoTrack())&&c.stop(),Nw&&(u=this.getAudioTrack())&&(this.log_.info("stop audio track first in huawei env"),u.stop())),e.prev=15,e.next=18,rK({audio:r||Nw,video:o,facingMode:n===zC||n===KC?n:void 0,cameraId:o?n:this.cameraId_,microphoneId:r?n:this.microphoneId_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount,useExact:!0,retryWhenExactFailed:!1});case 18:if(l=e.sent,d=null,!r){e.next=25;break}(h=l.getAudioTracks()[0])&&this.isAudioTrackMixed()?(p=this.getAudioTrack(),f=jY.AudioMixerPlugin.getAudioTrackMap(),g=jY.AudioMixerPlugin.mix({targetTrack:h,sourceList:f.get(p.id).sourceList,trackList:f.get(p.id).trackList}),d=g):d=h,e.next=34;break;case 25:if(!(d=l.getVideoTracks()[0])||!this.isVideoTrackBeautified()){e.next=30;break}return e.next=29,this.generateBeautyTrack(d);case 29:d=e.sent;case 30:if(!(_=l.getAudioTracks()[0])||!Nw){e.next=34;break}return e.next=34,this.replaceTrack(_);case 34:return e.next=36,this.replaceTrack(d);case 36:this.updateDeviceIdInUse(),(v=this.getConnection())&&(m=v.getUserId(),y=v.getTinyId(),I=LL,T="switch camera",r&&(I=OL,T="switch microphone"),rO(m,{eventId:I,eventDesc:T,timestamp:iv(),userId:m,tinyId:y})),this.log_.info("switch ".concat(r?"microphone":"camera"," success ")),r&&(this.audio_=!0),o&&(this.video_=!0,n!==KC&&n!==zC||(this.facingMode_=n)),this.setIsReadyToPublish(!0),e.next=50;break;case 45:throw e.prev=45,e.t0=e.catch(15),this.log_.error(e.t0),r?this.recoverCapture({audio:!0,video:!1,microphoneId:this.microphoneId_}):this.recoverCapture({audio:!1,video:!0,cameraId:this.cameraId_,facingMode:this.facingMode_}),e.t0;case 50:case"end":return e.stop()}}),e,this,[[15,45]])}))),function(e,t){return _.apply(this,arguments)})},{key:"addTrack",value:(g=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.kind===GC&&NN&&(n=t.getSettings(),!this.videoSetting_||n.width===this.videoSetting_.width&&n.height===this.videoSetting_.height||this.log_.warn("video resolution of the track (".concat(n.width," x ").concat(n.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,". It may cause abnormal Cloud Recording."))),this.isAddingTrack_=!0,this.keepMuteState(t),this.mediaStream_.addTrack(t),!(r=this.getConnection())){e.next=11;break}return o=null,t.kind===GC&&(Qw||Xw)&&TD(t)&&(o=this.getCanvasTrack()),e.next=11,r.addTrack(o||t,this);case 11:t.kind===UC?(this.audio_=!0,this.updateAudioPlayingState(!0),100!==this.captureVolume_&&this.setAudioCaptureVolume(this.captureVolume_)):(this.video_=!0,this.updateVideoPlayingState(!0)),this.isAddingTrack_=!1,e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(0),this.mediaStream_.removeTrack(t),this.isAddingTrack_=!1,e.t0;case 20:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(e){return g.apply(this,arguments)})},{key:"removeTrack",value:(f=a(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isRemovingTrack_=!0,!(n=this.getConnection())){e.next=17;break}if(t.kind!==GC||!Qw&&!Xw||!this.canvasTrack_){e.next=10;break}return e.next=7,n.removeTrack(this.canvasTrack_,this);case 7:this.clearCanvas(),e.next=17;break;case 10:if(t.kind!==UC||!this.gain_.audioTrack){e.next=15;break}return e.next=13,n.removeTrack(this.gain_.audioTrack,this);case 13:e.next=17;break;case 15:return e.next=17,n.removeTrack(t,this);case 17:this.mediaStream_.removeTrack(t),t.kind===UC?(this.audio_=!1,this.updateAudioPlayingState(!1),this.stopGainNode()):(this.video_=!1,this.updateVideoPlayingState(!1)),this.isRemovingTrack_=!1,e.next=26;break;case 22:throw e.prev=22,e.t0=e.catch(0),this.isRemovingTrack_=!1,e.t0;case 26:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e){return f.apply(this,arguments)})},{key:"replaceTrack",value:(p=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.kind===GC&&NN&&(n=t.getSettings(),!this.videoSetting_||n.width===this.videoSetting_.width&&n.height===this.videoSetting_.height||this.log_.warn("video resolution of the track (".concat(n.width," x ").concat(n.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,". It may cause abnormal Cloud Recording."))),this.keepMuteState(t),r=this.mediaStream_,t.kind!==UC){e.next=12;break}if(r.removeTrack(r.getAudioTracks()[0]),r.addTrack(t),I(h(T.prototype),"restartAudio",this).call(this),!this.gain_.gainNode){e.next=10;break}return this.reconnectGainNode(t),e.abrupt("return");case 10:e.next=15;break;case 12:r.removeTrack(r.getVideoTracks()[0]),r.addTrack(t),I(h(T.prototype),"restartVideo",this).call(this);case 15:if(!(o=this.getConnection())){e.next=21;break}if(t.kind!==GC||!Qw&&!Xw||!this.canvasTrack_){e.next=19;break}return e.abrupt("return");case 19:return e.next=21,o.replaceTrack(t,this);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"recoverCapture",value:(l=a(i().mark((function e(t){var n,r,o,a,s,c,u,l,d,h,p,f,g,_,v,m,y;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.mediaStream_||!this.enableAutoRecoverCapture_||t.audio&&!t.video&&this.isAudioRecovering_||t.video&&!t.audio&&this.isVideoRecovering_)){e.next=2;break}return e.abrupt("return");case 2:return t.audio&&(this.isAudioRecovering_=!0),t.video&&(this.isVideoRecovering_=!0),this.log_.warn("recoverCapture() trying "+JSON.stringify(t)),n=this.audio_&&t.audio,r=this.video_&&t.video,e.prev=7,e.next=10,jY.getCameras();case 10:return o=e.sent,e.next=13,jY.getMicrophones();case 13:if(a=e.sent,r&&0===o.length&&(r=!1,this.log_.warn("recoverCapture() video flag is true, but no camera detected, set video to false")),n&&0===a.length&&(n=!1,this.log_.warn("recoverCapture() audio flag is true, but no microphone detected, set audio to false")),n||r){e.next=19;break}return this.log_.warn("recoverCapture() both audio and video are false, aborted"),e.abrupt("return");case 19:return s=t&&o.findIndex((function(e){return e.deviceId===t.cameraId}))>=0,c=t&&a.findIndex((function(e){return e.deviceId===t.microphoneId}))>=0,n&&(null===(u=this.getAudioTrack())||void 0===u||u.stop()),r&&(null===(l=this.getVideoTrack())||void 0===l||l.stop()),e.next=25,rK({audio:n,video:r,cameraId:s?t.cameraId:void 0,microphoneId:c?t.microphoneId:void 0,facingMode:this.facingMode_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount});case 25:d=e.sent,h=d.getTracks(),p=0;case 28:if(!(p<h.length)){e.next=55;break}if((f=h[p]).kind!==UC||!this.isAudioTrackMixed()){e.next=41;break}if(g=this.getAudioTrack(),_=jY.AudioMixerPlugin.getAudioTrackMap(),(v=_.get(g.id)).hasMicrophone){e.next=37;break}return f.stop(),e.abrupt("continue",52);case 37:return m=jY.AudioMixerPlugin.mix({targetTrack:f,sourceList:v.sourceList,trackList:v.trackList}),e.next=40,this.replaceTrack(m);case 40:return e.abrupt("continue",52);case 41:if(f.kind!==GC||!this.isVideoTrackBeautified()){e.next=48;break}return e.next=44,this.generateBeautyTrack(f);case 44:return y=e.sent,e.next=47,this.replaceTrack(y);case 47:return e.abrupt("continue",52);case 48:return e.next=50,this.replaceTrack(f);case 50:if("ended"!==f.readyState){e.next=52;break}throw new Error("new track is failed, muted ".concat(f.muted," readyState ").concat(f.readyState));case 52:p++,e.next=28;break;case 55:this.updateDeviceIdInUse(),uO.logSuccessEvent({userId:this.client_?this.client_.getUserId():this.userId_,eventType:CE}),t.audio&&(this.isAudioRecovering_=!1),t.video&&(this.isVideoRecovering_=!1),this.log_.warn("recoverCapture() successfully"),this.emitter_.emit(jN,{isCamera:t.video,isMicrophone:t.audio,cameraId:this.cameraId_,microphoneId:this.microphoneId_}),e.next=69;break;case 63:throw e.prev=63,e.t0=e.catch(7),t.audio&&(this.isAudioRecovering_=!1),t.video&&(this.isVideoRecovering_=!1),this.log_.warn("recoverCapture() failed, "+e.t0),e.t0;case 69:case"end":return e.stop()}}),e,this,[[7,63]])}))),function(e){return l.apply(this,arguments)})},{key:"updateDeviceIdInUse",value:function(){var e=this;if(!this.mediaStream_)return this.cameraId_="",this.cameraGroupId_="",this.microphoneId_="",void(this.microphoneGroupId_="");NN&&this.mediaStream_.getTracks().forEach((function(t){if(t.kind===UC&&e.isAudioTrackMixed()){var n=e.getMicrophoneTrackMixed();if(n){var i=n.getSettings(),r=i.deviceId,o=i.groupId;r&&(e.microphoneId_=r,e.microphoneGroupId_=o,e.microphoneLabel_=n.label)}}else if(t.kind===GC&&e.isVideoTrackBeautified()){var a=e.getBeautyOriginTrack();if(a){var s=a.getSettings(),c=s.deviceId,u=s.groupId;c&&(e.cameraId_=c,e.cameraGroupId_=u)}}else{var l=t.getSettings(),d=l.deviceId,h=l.groupId;d&&(t.kind===UC?(e.microphoneId_=d,e.microphoneGroupId_=h,e.microphoneLabel_=t.label):t.kind!==GC||e.screen_||(e.cameraId_=d,e.cameraGroupId_=h))}}));var t=this.mediaStream_.getAudioTracks(),n=this.mediaStream_.getVideoTracks();t&&0===t.length&&(this.microphoneId_="",this.microphoneGroupId_=""),n&&0===n.length&&(this.cameraId_="",this.cameraGroupId_="")}},{key:"isAudioTrackMixed",value:function(){if(jY.AudioMixerPlugin){var e=jY.AudioMixerPlugin.getAudioTrackMap(),t=this.getAudioTrack();if(e&&t&&e.has(t.id))return!0}return!1}},{key:"getMicrophoneTrackMixed",value:function(){if(jY.AudioMixerPlugin){var e=jY.AudioMixerPlugin.getAudioTrackMap(),t=this.getAudioTrack();if(e&&t&&e.has(t.id)){var n=e.get(t.id);return n.hasMicrophone?n.microphoneTrack:null}}return null}},{key:"isVideoTrackBeautified",value:function(){if(jY.beautyTrackMap){var e=jY.beautyTrackMap,t=this.getVideoTrack();if(t&&e.has(t.id))return!0}return!1}},{key:"getBeautyOriginTrack",value:function(){if(jY.beautyTrackMap){var e=jY.beautyTrackMap,t=this.getVideoTrack();if(t&&e.has(t.id)){var n=e.get(t.id);if(n.originTrack)return n.originTrack}}return null}},{key:"generateBeautyTrack",value:(c=a(i().mark((function e(t){var n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,r=this.getVideoTrack(),o=jY.beautyTrackMap.get(r.id),a=o.param,o.type){e.next=8;break}n=o.pluginInstance.generateBeautyTrack(t),e.next=22;break;case 8:e.t0=o.type,e.next="beauty"===e.t0?11:"virtual"===e.t0?13:"mixed"===e.t0?17:21;break;case 11:return n=o.pluginInstance.generateBeautyTrack(t),e.abrupt("break",22);case 13:return e.next=15,o.pluginInstance.generateVirtualTrack({videoTrack:t,type:a.type,img:a.img});case 15:case 19:return n=e.sent,e.abrupt("break",22);case 17:return e.next=19,o.pluginInstance.generateMixedTrack({videoTrack:t,type:a.type,img:a.img});case 21:return e.abrupt("break",22);case 22:return o.pluginInstance.deleteSource(r.id),this.log_.info("regenerate beauty track, track id = ".concat(t.id)),e.abrupt("return",n);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getScreen",value:function(){return this.screen_}},{key:"hasScreenTrack",value:function(){if(this.screen_)return!0;var e=this.getVideoTrack();return!!e&&(e.contentHint===nS||e.contentHint===iS)}},{key:"getVideo",value:function(){return this.video_}},{key:"getAudio",value:function(){return this.audio_}},{key:"getCameraId",value:function(){return this.cameraId_}},{key:"getMicrophoneId",value:function(){return this.microphoneId_}},{key:"getMicrophoneGroupId",value:function(){return this.microphoneGroupId_}},{key:"getIsReadyToPublish",value:function(){return this.isReadyToPublish_}},{key:"setIsReadyToPublish",value:function(e){this.isReadyToPublish_=e}},{key:"setPublishState",value:function(e){this.publishState_=e}},{key:"setBeautyStatus",value:function(e){this.beautyStatus_=!!e}},{key:"getBeautyStatus",value:function(){return this.beautyStatus_}},{key:"syncMuteState",value:function(){var e=this.getAudioTrack(),t=this.getVideoTrack();if(e){var n=!e.enabled;this.setMuteState(UC,n)}if(t){var i=!t.enabled;this.setMuteState(GC,i)}this.connection_&&this.connection_.sendMutedFlag(this.muteState_,this)}},{key:"keepMuteState",value:function(e){e instanceof MediaStreamTrack&&this.muteState_[e.kind]&&(e.enabled=!1,this.log_.warn("prev ".concat(e.kind," track is muted, keep mute state")))}},{key:"onVideoTrackStopped",value:(o=a(i().mark((function e(t){var n,r,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.stream,r=t.type,n===this&&this.video_&&this.cameraId_&&rx(this.getVideoTrack())&&!this.isVideoRecovering_&&(!(Mw&&Ww||Qk&&Number(Zw)>=15.1)||r!==WC)){e.next=3;break}return e.abrupt("return");case 3:if(!(Date.now()-this.prevVideoRecoverTime_<vb)){e.next=6;break}return setTimeout((function(){return o.onVideoTrackStopped({stream:n,type:r})}),vb),e.abrupt("return");case 6:r===WC?setTimeout((function(){var e=o.getVideoTrack();null!=e&&e.muted&&"visible"===document.visibilityState&&o.recoverVideoCapture(r)}),5e3):this.recoverVideoCapture(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"onAudioTrackStopped",value:(n=a(i().mark((function e(t){var n,r,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.stream,r=t.type,n===this&&this.audio_&&this.microphoneId_&&!this.isAudioRecovering_&&(!(Mw&&Ww||Qk&&Number(Zw)>=15.1)||r!==WC)){e.next=3;break}return e.abrupt("return");case 3:if(!(Date.now()-this.prevAudioRecoverTime_<vb)){e.next=6;break}return setTimeout((function(){return o.onAudioTrackStopped({stream:n,type:r})}),vb),e.abrupt("return");case 6:r===WC?setTimeout((function(){var e=o.getAudioTrack();null!=e&&e.muted&&"visible"===document.visibilityState&&o.recoverAudioCapture(r)}),5e3):this.recoverAudioCapture(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"recoverAudioCapture",value:function(e){this.prevAudioRecoverTime_=Date.now(),uO.uploadEvent({log:"stat-local-audio-".concat(e),userId:this.userId_}),this.recoverCapture({audio:!0,video:!1,microphoneId:this.microphoneId_})}},{key:"recoverVideoCapture",value:function(e){this.prevVideoRecoverTime_=Date.now(),uO.uploadEvent({log:"stat-local-video-".concat(e),userId:this.userId_}),this.recoverCapture({audio:!1,video:!0,cameraId:this.cameraId_})}},{key:"setAudioVolume",value:function(e){I(h(T.prototype),"setAudioVolume",this).call(this,e)}},{key:"clearCanvas",value:function(){this.canvasInterval_&&(tN.clearTask(this.canvasInterval_),this.canvasInterval_=null,this.canvas_=null,this.canvasTrack_=null)}},{key:"getCanvasTrack",value:function(){var e=this;if(this.canvasTrack_)return this.canvasTrack_;this.log_.info("gen canvas track");var t=this.getVideoTrack().getSettings(),n=t.width,i=t.height,r=t.frameRate;this.canvas_=document.createElement("canvas");var o=this.canvas_.getContext("2d");this.canvas_.width=n,this.canvas_.height=i,this.canvasInterval_=tN.run(yb,(function(){if(e.hasVideo()){var t=e.getVideoTrack().getSettings();t.width===e.canvas_.width&&t.height===e.canvas_.height||(e.canvas_.width=t.width,e.canvas_.height=t.height)}e.videoPlayer_&&e.videoPlayer_.element_&&o.drawImage(e.videoPlayer_.element_,0,0,e.canvas_.width,e.canvas_.height)}),{fps:Math.max(15,r)});var a=this.canvas_.captureStream();return this.canvasTrack_=a.getVideoTracks()[0],this.canvasTrack_}},{key:"setClient",value:function(e,t){e&&(this.log_.setUserId(e.getUserId()),this.log_.setSdkAppId(e.getSDKAppId()),t||this.syncMuteState()),this.client_=e}},{key:"setAudioCaptureVolume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!this.hasAudio()||t<0||!CN())return!1;if(this.captureVolume_===t)return!0;this.captureVolume_=t,this.log_.info("setCaptureVolume "+t),t/=100;var n=RD();if(this.gain_.gainNode)this.gain_.gainNode.gain.value=t;else{var i,r=new MediaStream;r.addTrack(this.getAudioTrack());var o=n.createMediaStreamDestination(),a=n.createMediaStreamSource(r),s=n.createGain();s.gain.value=t,a.connect(s),s.connect(o);var c=o.stream.getAudioTracks()[0],u=function(t){return e.log_.info("gained audio track ".concat(t))};c.onmute=function(){return u("muted")},c.onunmute=function(){return u("unmuted")},c.onended=function(){return u("ended")},this.gain_={source:a,audioTrack:c,gainNode:s},null===(i=this.connection_)||void 0===i||i.replaceTrack(c),I(h(T.prototype),"restartAudio",this).call(this)}return!0}},{key:"getGainedTrack",value:function(){return this.gain_.audioTrack}},{key:"reconnectGainNode",value:function(e){this.log_.warn("reconnect gain node");var t=new MediaStream;t.addTrack(e);var n=RD().createMediaStreamSource(t);n.connect(this.gain_.gainNode),this.gain_.source.disconnect(),this.gain_.source=n}},{key:"stopGainNode",value:function(){var e=this.gain_,t=e.audioTrack,n=e.source,i=e.gainNode;i&&(n.disconnect(),i.disconnect(),t.onmute=null,t.onunmute=null,t.onended=null,t.stop(),this.gain_={source:null,gainNode:null,audioTrack:null}),this.captureVolume_=100}},{key:"close",value:function(){this.setIsReadyToPublish(!1),this.stopGainNode(),I(h(T.prototype),"close",this).call(this)}},{key:"setIsAIDenoiser",value:function(e){this.isAIDenoiser=e}}]),T}(Jz),M(TK.prototype,"setAudioProfile",[lK],Object.getOwnPropertyDescriptor(TK.prototype,"setAudioProfile"),TK.prototype),M(TK.prototype,"setVideoProfile",[dK],Object.getOwnPropertyDescriptor(TK.prototype,"setVideoProfile"),TK.prototype),M(TK.prototype,"setScreenProfile",[hK],Object.getOwnPropertyDescriptor(TK.prototype,"setScreenProfile"),TK.prototype),M(TK.prototype,"setVideoContentHint",[pK],Object.getOwnPropertyDescriptor(TK.prototype,"setVideoContentHint"),TK.prototype),M(TK.prototype,"switchDevice",[fK],Object.getOwnPropertyDescriptor(TK.prototype,"switchDevice"),TK.prototype),M(TK.prototype,"addTrack",[gK],Object.getOwnPropertyDescriptor(TK.prototype,"addTrack"),TK.prototype),M(TK.prototype,"removeTrack",[_K],Object.getOwnPropertyDescriptor(TK.prototype,"removeTrack"),TK.prototype),M(TK.prototype,"replaceTrack",[vK],Object.getOwnPropertyDescriptor(TK.prototype,"replaceTrack"),TK.prototype),M(TK.prototype,"recoverCapture",[mK],Object.getOwnPropertyDescriptor(TK.prototype,"recoverCapture"),TK.prototype),M(TK.prototype,"setAudioCaptureVolume",[yK,IK],Object.getOwnPropertyDescriptor(TK.prototype,"setAudioCaptureVolume"),TK.prototype),TK),wK={voiceActivityDetection:!1},DK=(CK=Gz({retries:1,timeout:0,onRetrying:function(e){this.log_.warn("connection timeout, retrying [".concat(e,"]"))},onError:function(e,t,n){e.message.includes("timeout")?(this.reset(),this.initialize(),t()):n(e)}}),SK=function(e){d(R,e);var n,r,o,c,l,p,f,g,_,v,y,T,C,S,E,b,M,k,w,D,A=m(R);function R(e){var t;return s(this,R),(t=A.call(this,e)).localStream_=null,t.exchangeSDPTimeout_=-1,t.localAuxStream_=null,t.publishingStream_=null,t.isPublishingAuxStream_=!1,t.smallGenerator_=null,t.isSDPExchanging_=!1,t.ssrc_={audio:0,video:0,small:0,auxiliary:0},t.mediaSettings_={videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0},t.mixedAudioTrack_=null,t}return u(R,[{key:"isMainStreamPublished",get:function(){return!!this.localStream_}},{key:"isAuxStreamPublished",get:function(){return!!this.localAuxStream_}},{key:"publishState",get:function(){var e=this,t={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this.peerConnection_){var n,i,r,o,a=this.peerConnection_.getSenders();a&&(IN()?(t.audio=!(null===(n=a[0])||void 0===n||!n.track),t.bigVideo=!(null===(i=a[1])||void 0===i||!i.track),t.smallVideo=!(null===(r=a[2])||void 0===r||!r.track),t.auxVideo=!(null===(o=a[3])||void 0===o||!o.track)):a.forEach((function(n){n.track&&(n.track.kind===UC?t.audio=!0:(t.bigVideo=!0,e.smallGenerator_&&(t.smallVideo=!0)))})))}return t}},{key:"initialize",value:function(){I(h(R.prototype),"initialize",this).call(this),this.installEvents()}},{key:"reset",value:function(){this.isReconnecting_&&this.stopReconnection(),this.closePeerConnection(),this.uninstallEvents(),this.clearExchangeSDPTimeout(),this.localStream_&&this.localStream_.clearCanvas()}},{key:"close",value:function(){I(h(R.prototype),"close",this).call(this),this.reset(),this.emitConnectionStateChangedEvent(HS),this.smallGenerator_&&(this.smallGenerator_.destroy(),this.smallGenerator_=null)}},{key:"installEvents",value:function(){this.emitter_.on(UN.ERROR,this.handleError,this),this.emitter_.on(UN.CONNECTION_STATE_CHANGED,this.handleConnectionStateChange,this)}},{key:"uninstallEvents",value:function(){this.emitter_.off(UN.ERROR,this.handleError,this),this.emitter_.off(UN.CONNECTION_STATE_CHANGED,this.handleConnectionStateChange,this)}},{key:"publish",value:(D=a(i().mark((function e(t,n){var r,o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publishingStream_=t,this.isPublishingAuxStream_=n,a=t.getVideoTrack(),s=null,!a||n||!this.client_.getIsEnableSmallStream()){e.next=9;break}return this.smallGenerator_=new tK(t),e.next=8,this.smallGenerator_.initialize();case 8:s=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_);case 9:if(null===(r=this.client_)||void 0===r||!r.get2k4kFlag()){e.next=18;break}if(c=1===this.client_.get2k4kFlag(),u=t.getVideoProfile(),c||t.getScreen()||!(u.height*u.width>=3686400)){e.next=18;break}return u.width=1920,u.height=1080,this.log_.warn(Cb),e.next=18,t.setVideoProfile(u);case 18:if(this.updateMediaSettings(t,n),!TN()){e.next=24;break}return e.next=22,this.publishByTransceiver(t,s,n);case 22:e.next=26;break;case 24:return e.next=26,this.publishByAddTrack(t,s);case 26:return this.publishingStream_=null,this.isPublishingAuxStream_=!1,n?this.localAuxStream_=t:this.localStream_=t,null===(o=this.sei_)||void 0===o||o.handleEncodedStreams(),e.abrupt("return",t);case 31:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"publishByTransceiver",value:(w=a(i().mark((function e(t,n,r){var o,a,s,c,u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log_.info("publish by transceiver"),o=t.getMediaStream(),a=t.getAudioTrack(),s=t.getVideoTrack(),c=null,(Qw||Xw)&&TD(s)&&(c=t.getCanvasTrack()),0!==(u=this.peerConnection_.getTransceivers()).length){e.next=16;break}return this.peerConnection_.addTransceiver(a||UC,{direction:gS,streams:[o]}),this.peerConnection_.addTransceiver(r?GC:c||s||GC,{direction:gS,streams:[o]}),this.peerConnection_.addTransceiver(n||GC,{direction:gS,streams:[o]}),this.peerConnection_.addTransceiver(r?c||s:GC,{direction:gS,streams:[o]}),e.next=14,this.connect();case 14:e.next=46;break;case 16:if(l=[],!a){e.next=29;break}if(!u[0].sender.track){e.next=24;break}return this.mixAudioTrack(u[0].sender.track,a),e.next=22,u[0].sender.replaceTrack(this.mixedAudioTrack_);case 22:e.next=27;break;case 24:return e.next=26,u[0].sender.replaceTrack(a);case 26:l.push(0);case 27:return e.next=29,this.setBandwidth({bandwidth:t.getAudioBitrate(),type:UC});case 29:if(!s){e.next=42;break}return d=r?3:1,e.next=33,u[d].sender.replaceTrack(c||s);case 33:return e.next=35,this.setBandwidth({bandwidth:t.getVideoBitrate(),type:GC,videoType:r?jC:BC});case 35:if(l.push(d),!n){e.next=42;break}return e.next=39,u[2].sender.replaceTrack(n);case 39:return e.next=41,this.setBandwidth({bandwidth:this.client_.smallStreamConfig.bitrate,type:GC,videoType:FC});case 41:l.push(2);case 42:return e.next=44,this.setTransceiverDirection(gS,l);case 44:return e.next=46,this.doPublishChange();case 46:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return w.apply(this,arguments)})},{key:"publishByAddTrack",value:(k=a(i().mark((function e(t,n){var r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log_.info("publish by addtrack"),r=t.getMediaStream(),o=t.getAudioTrack(),a=t.getVideoTrack(),o&&this.peerConnection_.addTrack(o,r),a&&(this.peerConnection_.addTrack(a,r),n&&((s=new MediaStream).addTrack(n),this.peerConnection_.addTrack(n,s))),e.next=8,this.connect();case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"unpublish",value:(M=a(i().mark((function e(n){var r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IN()){e.next=2;break}return e.abrupt("return",this.doUnpublish());case 2:if(r=n.getAudioTrack(),o=n===this.localAuxStream_,a=this.peerConnection_.getSenders(),s=[],!r){e.next=17;break}if(!this.mixedAudioTrack_){e.next=14;break}return this.log_.info("has mixed audioTrack, use another audioTrack"),e.next=11,a[0].replaceTrack(o?this.localStream_.getAudioTrack():this.localAuxStream_.getAudioTrack());case 11:this.destroyMixedAudioTrack(),e.next=17;break;case 14:return e.next=16,a[0].replaceTrack(null);case 16:s.push(0);case 17:if(!o){e.next=25;break}return e.next=20,a[3].replaceTrack(null);case 20:this.localAuxStream_=null,this.mediaSettings_=t(t({},this.mediaSettings_),{},{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),s.push(3),e.next=32;break;case 25:return e.next=27,a[1].replaceTrack(null);case 27:return e.next=29,a[2].replaceTrack(null);case 29:this.localStream_=null,this.mediaSettings_=t(t({},this.mediaSettings_),{},{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),s.push(1,2);case 32:if(!this.localStream_&&!this.localAuxStream_){e.next=39;break}return e.next=35,this.setTransceiverDirection(fS,s);case 35:return e.next=37,this.doPublishChange();case 37:e.next=41;break;case 39:return e.next=41,this.doUnpublish();case 41:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"doPublishChange",value:(b=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={state:this.publishState,constraintConfig:this.mediaSettings_},e.next=3,this.signalChannel_.sendWaitForResponse({command:eL,data:t,responseCommand:QR.PUBLISH_STATE_CHANGE_RESULT});case 3:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"doUnpublish",value:function(){var e=this;return this.signalChannel_.sendWaitForResponse({command:aL,commandDesc:"unpublish",responseCommand:QR.UNPUBLISH_RESULT}).then((function(){e.close()})).catch((function(){e.close()}))}},{key:"updateMediaSettings",value:function(e,t){var n=this;this.localAuxStream_&&e===this.localAuxStream_&&(t=!0);var i=this.client_.getSystemResult().detail,r=i.isH264EncodeSupported,o=i.isVp8EncodeSupported;r?this.mediaSettings_.videoCodec="H264":o&&(this.mediaSettings_.videoCodec="VP8"),NN?e.getMediaStream().getTracks().forEach((function(i){var r=i.getSettings();if(i.kind===UC){var o=1;r.channelCount&&(o=r.channelCount),n.mediaSettings_.audioChannel=o,n.mediaSettings_.audioBps=1e3*e.getAudioBitrate(),n.mediaSettings_.audioFs=r.sampleRate}else if(i.kind===GC){if(t)return n.mediaSettings_.auxVideoWidth=r.width,n.mediaSettings_.auxVideoHeight=r.height,n.mediaSettings_.auxVideoFps=r.frameRate,void(n.mediaSettings_.auxVideoBps=1e3*e.getVideoBitrate());n.client_.getIsEnableSmallStream()&&(n.mediaSettings_.smallVideoWidth=n.client_.smallStreamConfig.width,n.mediaSettings_.smallVideoHeight=n.client_.smallStreamConfig.height,n.mediaSettings_.smallVideoFps=n.client_.smallStreamConfig.frameRate,n.mediaSettings_.smallVideoBps=1e3*n.client_.smallStreamConfig.bitrate),n.mediaSettings_.videoWidth=r.width,n.mediaSettings_.videoHeight=r.height,n.mediaSettings_.videoFps=r.frameRate,n.mediaSettings_.videoBps=1e3*e.getVideoBitrate()}})):this.updateMediaSettingsFromProfile(e),this.log_.info("updateMediaSettings: "+JSON.stringify(this.mediaSettings_))}},{key:"updateMediaSettingsFromProfile",value:function(e){if(e){if(e.hasAudio()){var t=e.getAudioProfile();this.mediaSettings_.audioChannel=t.channelCount,this.mediaSettings_.audioBps=1e3*t.bitrate,this.mediaSettings_.audioFs=t.sampleRate}if(e.hasVideo()){var n=e.getVideoProfile();this.mediaSettings_.videoWidth=n.width,this.mediaSettings_.videoHeight=n.height,this.mediaSettings_.videoFps=n.frameRate,this.mediaSettings_.videoBps=1e3*n.bitrate}}}},{key:"sendMediaSettings",value:function(e){var t=this;this.updateMediaSettings(e),this.signalChannel_.sendWaitForResponse({command:mL,data:this.mediaSettings_,responseCommand:QR.UPDATE_CONSTRAINT_CONFIG_RES}).then((function(e){0!==e.data.code&&t.log_.warn(e.data.message)})).catch(this.log_.warn)}},{key:"addTrack",value:(E=a(i().mark((function e(t,n){var r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConnection_){e.next=2;break}return e.abrupt("return");case 2:if(o=n===this.localAuxStream_,this.log_.info("is adding ".concat(t.kind," track to current published local ").concat(o?jC:rS," stream")),null===(r=this.sei_)||void 0===r||r.handleEncodedStreams(),!IN()){e.next=10;break}return e.next=8,this.addTrackByTransceiver(t,n);case 8:e.next=12;break;case 10:return e.next=12,this.addTrackBySender(t);case 12:rO(this.userId_,{eventId:t.kind===UC?CL:TL,eventDesc:"add ".concat(t.kind," track to current published stream"),timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"addTrackByTransceiver",value:(S=a(i().mark((function e(t,n){var r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n===this.localAuxStream_,o=this.peerConnection_.getTransceivers(),t.kind!==UC){e.next=13;break}if(!o[0].sender.track){e.next=9;break}return this.mixAudioTrack(o[0].sender.track,t),e.next=7,o[0].sender.replaceTrack(this.mixedAudioTrack_);case 7:e.next=11;break;case 9:return e.next=11,o[0].sender.replaceTrack(t);case 11:e.next=26;break;case 13:return a=r?3:1,e.next=16,o[a].sender.replaceTrack(t);case 16:if(1!==a||!this.client_.getIsEnableSmallStream()){e.next=23;break}return this.smallGenerator_=new tK(this.localStream_),e.next=20,this.smallGenerator_.initialize();case 20:return s=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),e.next=23,o[2].sender.replaceTrack(s);case 23:if(o[a].direction!==fS){e.next=26;break}return e.next=26,this.setTransceiverDirection(gS,[a]);case 26:return this.updateMediaSettings(n,r),e.next=29,this.doPublishChange();case 29:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"addTrackBySender",value:(C=a(i().mark((function e(t){var n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(IN()&&this.peerConnection_.getTransceivers().findIndex((function(e){return"stopped"===e.direction}))>=0)){e.next=4;break}return this.log_.warn("transceiver is stopping, negotiate sdp first"),e.next=4,this.updateOffer(FE.REMOVE,t);case 4:if(!(n=this.peerConnection_.getSenders().find((function(e){return e.track&&e.track.kind===t.kind})))){e.next=11;break}return this.log_.warn("sender already exists, remove sender first"),r=n.track,this.removeSender(n),e.next=11,this.updateOffer(FE.REMOVE,r);case 11:if(o=this.localStream_.getMediaStream(),this.peerConnection_.addTrack(t,o),t.kind!==GC||!this.client_.getIsEnableSmallStream()){e.next=21;break}return this.smallGenerator_=new tK(this.localStream_),e.next=17,this.smallGenerator_.initialize();case 17:a=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),(s=new MediaStream).addTrack(a),this.peerConnection_.addTrack(a,s);case 21:return e.next=23,this.updateOffer(FE.ADD,t);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"isNeedToResetOfferOrder",value:function(){if(this.sdpSemantics_===RE||!this.peerConnection_||!this.peerConnection_.localDescription)return!1;for(var e=this.peerConnection_.localDescription.sdp,t=wO(e),n=0;n<t.media.length;n++)if(0===t.media[n].mid&&t.media[n].type===GC)return!0;return!1}},{key:"removeSender",value:function(e){var t=null;IN()&&(t=this.peerConnection_.getTransceivers().find((function(t){return t.sender&&t.sender.track===e.track}))),this.peerConnection_.removeTrack(e),t&&fD(t.stop)&&(this.log_.info("stop transceiver"),t.stop())}},{key:"removeTrack",value:(T=a(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConnection_){e.next=2;break}return e.abrupt("return");case 2:if(this.log_.info("is removing ".concat(t.kind," track from current published local ").concat(n===this.localAuxStream_?jC:rS," stream")),!IN()){e.next=8;break}return e.next=6,this.removeTrackByTransceiver(t,n);case 6:e.next=10;break;case 8:return e.next=10,this.removeTrackBySender(t);case 10:rO(this.userId_,{eventId:t.kind===UC?EL:SL,eventDesc:"remove ".concat(t.kind," track from current published stream"),timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"removeTrackByTransceiver",value:(y=a(i().mark((function e(t,n){var r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n===this.localAuxStream_,o=this.peerConnection_.getTransceivers(),t.kind!==UC){e.next=13;break}if(!this.mixedAudioTrack_){e.next=9;break}return e.next=6,o[0].sender.replaceTrack(r?this.localStream_.getAudioTrack():this.localAuxStream_.getAudioTrack());case 6:this.destroyMixedAudioTrack(),e.next=11;break;case 9:return e.next=11,o[0].sender.replaceTrack(null);case 11:e.next=23;break;case 13:return a=r?3:1,e.next=16,o[a].sender.replaceTrack(null);case 16:if(1!==a||!this.smallGenerator_){e.next=21;break}return this.smallGenerator_.destroy(),this.smallGenerator_=null,e.next=21,o[2].sender.replaceTrack(null);case 21:return e.next=23,this.setTransceiverDirection(fS,[a]);case 23:return this.updateMediaSettings(n,r),e.next=26,this.doPublishChange();case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"setTransceiverDirection",value:(v=a(i().mark((function e(t,n){var r,o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ew){e.next=2;break}return e.abrupt("return");case 2:if(r=!1,o=!1,this.log_.info("setting transceiver ".concat(n.join(",")," direction to ").concat(t)),a=this.peerConnection_.getTransceivers(),n.forEach((function(e){a[e].direction!==t&&(a[e].direction=t,r=!0)})),!r){e.next=14;break}return this.log_.info("updating offer"),e.next=11,this.peerConnection_.createOffer();case 11:return s=e.sent,e.next=14,this.peerConnection_.setLocalDescription(s);case 14:if(c=-1,u=this.peerConnection_.remoteDescription.sdp.split("\r\n").map((function(e){if(e.match(new RegExp("a=(".concat(fS,"|").concat(_S,"|").concat(gS,")")))&&c++,n.includes(c)){if(t===fS&&e.includes("a=".concat(_S)))return o=!0,"a=".concat(t);if(t===gS&&e.includes("a=".concat(fS)))return o=!0,"a=".concat(_S)}return e})).join("\r\n"),!o){e.next=20;break}return this.log_.info("updating answer"),e.next=20,this.peerConnection_.setRemoteDescription({type:"answer",sdp:u});case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"removeTrackBySender",value:(_=a(i().mark((function e(t){var n,r,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.kind!==GC||!this.isNeedToResetOfferOrder()){e.next=7;break}return this.reset(),this.initialize(),null===(n=this.localStream_.getMediaStream())||void 0===n||n.removeTrack(t),e.next=6,this.publish(this.localStream_);case 6:return e.abrupt("return");case 7:return(r=this.peerConnection_.getSenders().find((function(e){return e.track===t})))&&(this.removeSender(r),t.kind===GC&&this.smallGenerator_&&(this.smallGenerator_.destroy(),this.smallGenerator_=null,this.peerConnection_.getSenders().forEach((function(e){e.track&&e.track.kind===GC&&o.removeSender(e)})))),e.next=11,this.updateOffer(FE.REMOVE,t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"replaceTrack",value:(g=a(i().mark((function e(t,n){var r,o,a,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=null===(r=this.peerConnection_)||void 0===r?void 0:r.getSenders())&&0!==o.length){e.next=3;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:RM})});case 3:if(a=n===this.localAuxStream_,this.log_.info("is replacing ".concat(t.kind," track to current published local ").concat(a?jC:rS," stream")),t.kind!==UC||!o[0]){e.next=16;break}if(!(this.mixedAudioTrack_&&null!==(s=this.localStream_)&&void 0!==s&&s.hasAudio()&&null!==(c=this.localAuxStream_)&&void 0!==c&&c.hasAudio())){e.next=14;break}return this.destroyMixedAudioTrack(),u=a?this.localStream_.getAudioTrack():this.localAuxStream_.getAudioTrack(),this.mixAudioTrack(t,u),e.next=12,o[0].replaceTrack(this.mixedAudioTrack_);case 12:e.next=16;break;case 14:return e.next=16,o[0].replaceTrack(t);case 16:if(t.kind!==GC){e.next=32;break}if(n!==this.localStream_||!o[1]){e.next=29;break}return e.next=20,o[1].replaceTrack(t);case 20:if(!this.smallGenerator_||!o[2]){e.next=29;break}return this.log_.info("replacing smallVideo"),this.smallGenerator_.destroy(),this.smallGenerator_=new tK(this.localStream_),e.next=26,this.smallGenerator_.initialize();case 26:return l=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),e.next=29,o[2].replaceTrack(l);case 29:if(n!==this.localAuxStream_||!o[3]){e.next=32;break}return e.next=32,o[3].replaceTrack(t);case 32:rO(this.userId_,{eventId:t.kind===UC?xL:NL,eventDesc:"replace ".concat(t.kind," track from current published stream"),timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_});case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"updateOffer",value:(f=a(i().mark((function e(t,n){var r,o,a,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection_.createOffer(wK);case 3:return r=e.sent,ew&&(r.sdp=this.setSDPDirection(r.sdp,"sendrecv")),e.next=7,this.peerConnection_.setLocalDescription(r);case 7:return o=this.updateMediaSettings(this.localStream_||this.localAuxStream_),a={action:t,trackId:n.id,kind:n.kind===GC?"bigVideo":n.kind,type:"offer",sdp:this.peerConnection_.localDescription.sdp,constraintConfig:o,state:this.publishState},this.log_.info("createOffer success, sending updated offer to remote server"),this.log_.debug("updatedOffer: "+a.sdp),e.next=13,this.signalChannel_.sendWaitForResponse({command:$R,data:a,responseCommand:QR.UPDATE_OFFER_RESULT,timeout:1e4,commandDesc:"update offer"});case 13:return s=e.sent,c=s.data,u=c.code,l=c.message,0!==u&&this.checkPublishResultCode(u,l),e.next=18,this.acceptAnswer(s.data.data);case 18:this.updateSSRC(r.sdp),uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:_E,kind:"offer"}),e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(0),this.log_.error(e.t0),uO.logFailedEvent({userId:this.client_.getUserId(),eventType:_E,kind:"offer",error:e.t0}),e.t0;case 27:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e,t){return f.apply(this,arguments)})},{key:"setBandwidth",value:(p=a(i().mark((function e(t){var n,r,o,a,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.bandwidth,r=t.type,o=t.videoType,a=void 0===o?"":o,s=t.sdp,SN()||!s){e.next=3;break}return e.abrupt("return",r===GC?this.updateVideoBandwidthRestriction(s,n,a):this.updateAudioBandwidthRestriction(s,n));case 3:if(c=0,r===GC&&(c=a===FC?2:a===jC?3:1),!(u=this.peerConnection_.getSenders()[c])){e.next=22;break}return(l=u.getParameters()).encodings&&0!==l.encodings.length||(l.encodings=[{}]),"unlimited"===n?delete l.encodings[0].maxBitrate:l.encodings[0].maxBitrate=1e3*n,e.prev=10,e.next=13,u.setParameters(l);case 13:return this.log_.info(a+r+" bandwidth was set to "+n+" kbps"),e.abrupt("return",s);case 17:if(e.prev=17,e.t0=e.catch(10),this.log_.info("failed to set bandwidth by setting maxBitrate: "+e.t0),!s){e.next=22;break}return e.abrupt("return",r===GC?this.updateVideoBandwidthRestriction(s,n,a):this.updateAudioBandwidthRestriction(s,n));case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return p.apply(this,arguments)})},{key:"updateVideoBandwidthRestriction",value:function(e,t,n){var i="AS";ew&&(i="TIAS",t*=1e3);var r=0,o=-1;return n===FC?r=1:n===jC&&(r=2),e=e.replace(/m=video (.*)\r\nc=IN (.*)\r\n/g,(function(e){return++o===r?"".concat(e,"b=").concat(i,":").concat(t,"\r\n"):e})),e}},{key:"updateAudioBandwidthRestriction",value:function(e,t){var n="AS";return ew&&(n="TIAS",t*=1e3),e.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,"m=audio $1\r\nc=IN $2\r\nb="+n+":"+t+"\r\n")}},{key:"removeBandwidthRestriction",value:function(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}},{key:"removeVideoOrientation",value:function(e){return e.replace(/urn:3gpp:video-orientation/,"")}},{key:"connect",value:(l=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.exchangeSDP();case 3:return e.next=5,this.waitForPeerConnectionConnected();case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),this.closePeerConnection(!0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"exchangeSDP",value:(c=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.isSDPExchanging_=!0,e.next=4,this.createOffer();case 4:return this.log_.info("createOffer success, sending offer to remote server"),e.next=7,this.doExchangeSDP();case 7:this.isSDPExchanging_=!1,e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),this.isSDPExchanging_=!1,e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return c.apply(this,arguments)})},{key:"createOffer",value:(o=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection_.createOffer(wK);case 3:return t=e.sent,e.next=6,this.peerConnection_.setLocalDescription(t);case 6:this.updateSSRC(t.sdp),uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:_E,kind:"offer"}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),uO.logFailedEvent({userId:this.client_.getUserId(),eventType:_E,kind:"offer",error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return o.apply(this,arguments)})},{key:"doExchangeSDP",value:function(){var e=this;return new Promise((function(t,n){e.exchangeSDPTimeout_=setTimeout((function(){e.signalChannel_.off(QR.PUBLISH_RESULT,r),e.clearExchangeSDPTimeout();var t=new IL({code:yL.API_CALL_TIMEOUT,message:aD({key:jb})});n(t)}),1e4);var r=function(){var r=a(i().mark((function r(o){var a,s,c;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,e.clearExchangeSDPTimeout(),a=o.data,s=a.code,c=a.message,0!==s){i.next=9;break}return i.next=6,e.acceptAnswer(o.data.data);case 6:t(),i.next=10;break;case 9:e.checkPublishResultCode(s,c);case 10:i.next=15;break;case 12:i.prev=12,i.t0=i.catch(0),n(i.t0);case 15:case"end":return i.stop()}}),r,null,[[0,12]])})));return function(e){return r.apply(this,arguments)}}(),o={type:e.peerConnection_.localDescription.type,sdp:e.removeVideoOrientation(e.peerConnection_.localDescription.sdp),screen:(e.publishingStream_||e.localStream_).hasScreenTrack(),state:e.publishState,constraintConfig:e.mediaSettings_};e.signalChannel_.once(QR.PUBLISH_RESULT,r),e.log_.debug("sending sdp offer: "+o.sdp),e.signalChannel_.send(oL,o)}))}},{key:"setSDPDirection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all",i=wO(e);return i.media.forEach((function(e){"all"!==n&&e.type!==n||(e.direction=t)})),DO(i)}},{key:"acceptAnswer",value:(r=a(i().mark((function e(t){var n,r,o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=this.removeVideoOrientation(t.sdp),!(r=this.publishingStream_||this.localStream_)){e.next=15;break}if(o=r.getVideoBitrate(),a=r.getAudioBitrate(),!o){e.next=11;break}return s=this.isPublishingAuxStream_?jC:BC,e.next=10,this.setBandwidth({bandwidth:o,type:GC,sdp:n,videoType:s});case 10:n=e.sent;case 11:if(!a){e.next=15;break}return e.next=14,this.setBandwidth({bandwidth:a,type:UC,sdp:n});case 14:n=e.sent;case 15:if(!this.client_.getIsEnableSmallStream()){e.next=20;break}return c=this.client_.smallStreamConfig,e.next=19,this.setBandwidth({bandwidth:c.bitrate,type:GC,videoType:FC,sdp:n});case 19:n=e.sent;case 20:return u={type:t.type,sdp:n},e.next=23,this.peerConnection_.setRemoteDescription(u);case 23:this.log_.debug("accepted answer: "+n),uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:vE,kind:"answer"}),e.next=32;break;case 27:throw e.prev=27,e.t0=e.catch(0),uO.logFailedEvent({userId:this.client_.getUserId(),eventType:vE,kind:"answer",error:e.t0}),this.log_.error("failed to accept remote answer "+e.t0),e.t0;case 32:case"end":return e.stop()}}),e,this,[[0,27]])}))),function(e){return r.apply(this,arguments)})},{key:"sendMutedFlag",value:function(e,t){if(t!==this.localAuxStream_){var n={audio:e.audio,bigVideo:e.video,auxVideo:e.auxVideo};this.log_.info("send muted state: ".concat(JSON.stringify(n))),this.signalChannel_.send(rL,n)}}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"reconnect",value:(n=a(i().mark((function e(){var t,n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.reconnectionTimer_){e.next=3;break}return this.log_.warn("reconnect() uplink is reconnecting, ignore current reconnection"),e.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){e.next=12;break}return this.log_.warn("SDK has tried reconnect uplink for ".concat(30," times, but all failed, please check your network")),this.stopReconnection(),t=new IL({code:yL.UPLINK_RECONNECTION_FAILED,message:aD({key:zb})}),uO.logFailedEvent({userId:this.client_.getUserId(),eventType:pE,error:t}),this.addEventInternal(XL,"uplink-connection reconnect fail"),this.emitConnectionStateChangedEvent(HS),this.emitter_.emit(UN.ERROR,t),e.abrupt("return");case 12:if(this.signalChannel_.getCurrentState()===JR){e.next=16;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(HR,this.reconnect,this),e.abrupt("return");case 16:if(this.reconnectionCount_++,e.prev=17,this.log_.warn("reconnect() try to reconnect uplink [".concat(this.reconnectionCount_,"/").concat(30,"]")),n=pD(this.reconnectionCount_),this.reconnectionTimer_=setTimeout((function(){r.log_.warn("reconnect() uplink reconnect timeout(".concat(n/1e3,"s), try again")),r.clearReconnectionTimer(),r.reconnect()}),n),!(this.isSDPExchanging_||this.peerConnection_&&this.peerConnection_.connectionState===JS)){e.next=23;break}return e.abrupt("return");case 23:return e.next=25,this.signalChannel_.sendWaitForResponse({command:aL,responseCommand:QR.UNPUBLISH_RESULT,enableLog:!1});case 25:if(this.reset(),this.initialize(),!this.localStream_){e.next=30;break}return e.next=30,this.publish(this.localStream_);case 30:if(!this.localAuxStream_){e.next=33;break}return e.next=33,this.publish(this.localAuxStream_,!0);case 33:uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:pE}),this.log_.warn("reconnect() uplink reconnect successfully"),this.addEventInternal(ZL,"uplink-connection reconnect success"),this.stopReconnection(),this.localStream_.syncMuteState(),e.next=42;break;case 40:e.prev=40,e.t0=e.catch(17);case 42:case"end":return e.stop()}}),e,this,[[17,40]])}))),function(){return n.apply(this,arguments)})},{key:"clearExchangeSDPTimeout",value:function(){-1!==this.exchangeSDPTimeout_&&(clearTimeout(this.exchangeSDPTimeout_),this.exchangeSDPTimeout_=-1)}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"handleError",value:function(e){e.getCode()===yL.ICE_TRANSPORT_ERROR&&(this.isFirstConnection_&&(this.isFirstConnection_=!1,uO.logFailedEvent({userId:this.client_.getUserId(),eventType:hE,error:e})),this.isReconnecting_||this.startReconnection())}},{key:"handleConnectionStateChange",value:function(e){e.state===WS&&this.isFirstConnection_&&(this.isFirstConnection_=!1,uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:hE}),this.addEventInternal(HL,"uplink-connection is connected"))}},{key:"updateSSRC",value:function(e){var t=this;try{wO(e).media.forEach((function(e,n){if(e.type===UC){var i=e.ssrcs[0];i&&(t.ssrc_.audio=i.id)}else{if(t.sdpSemantics_===RE)return void e.ssrcGroups.forEach((function(e,n){var i=Number(e.ssrcs.split(" ")[0]);0===n?t.ssrc_.video=i:1===n&&(t.ssrc_.small=i)}));var r=e.ssrcs[0];if(!r)return;switch(n){case 1:t.ssrc_.video=r.id;break;case 2:t.ssrc_.small=r.id;break;case 3:t.ssrc_.auxiliary=r.id}}}))}catch(qY){}}},{key:"getVideoTrackId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:GC;if(this.peerConnection_){var t=this.peerConnection_.getSenders();if(e===GC&&t[1]&&t[1].track)return t[1].track.id;if(e===FC&&t[2]&&t[2].track)return t[2].track.id;if(e===jC&&t[3]&&t[3].track)return t[3].track.id}if(this.localStream_&&e===GC){var n=this.localStream_.getVideoTrack();if(n)return n.id}if(this.localAuxStream_&&e===jC){var i=this.localAuxStream_.getVideoTrack();if(i)return i.id}return""}},{key:"getSSRC",value:function(){return this.ssrc_}},{key:"checkPublishResultCode",value:function(e,t){if(0!==e)throw 1028===e?(this.log_.error(Pk.NOT_SUPPORTED_H264ENCODE),new IL({code:yL.NOT_SUPPORTED_H264,message:aD({key:pk})})):new IL({code:yL.UNKNOWN,message:aD({key:Tk,data:{signalResponse:QR.PUBLISH_RESULT,code:e,message:t}})})}},{key:"getLocalStream",value:function(){return this.localStream_}},{key:"sendSEI",value:function(e,t){this.sei_.push(e,t)}},{key:"mixAudioTrack",value:function(e,t){this.log_.info("mix audio track"),this.mixedAudioTrack_=function(e){var t=AD(),n=t.createMediaStreamDestination(),i=[];e.forEach((function(e){var r=new MediaStream;r.addTrack(e);var o=t.createMediaStreamSource(r);o.connect(n),i.push(o)}));var r=n.stream.getAudioTracks()[0];return nK.set(r,{destination:n,track:r,mediaStreamSourceList:i}),r}([e,t])}},{key:"destroyMixedAudioTrack",value:function(){this.mixedAudioTrack_&&(this.log_.info("destroy audio track"),function(e){if(nK.has(e)){var t=nK.get(e),n=t.destination,i=t.track,r=t.mediaStreamSourceList;i.stop(),n.disconnect(),r.forEach((function(e){e.disconnect()})),nK.delete(e)}}(this.mixedAudioTrack_),this.mixedAudioTrack_=null)}}]),R}(yz),M(SK.prototype,"publish",[CK],Object.getOwnPropertyDescriptor(SK.prototype,"publish"),SK.prototype),SK),AK=te,RK=el,LK=ec.exports.getWeakData,OK=ku,NK=ln,xK=se,PK=Ie,UK=Eu,GK=gt,VK=ai.set,FK=ai.getterFor,BK=Xd.find,jK=Xd.findIndex,qK=AK([].splice),HK=0,zK=function(e){return e.frozen||(e.frozen=new KK)},KK=function(){this.entries=[]},WK=function(e,t){return BK(e.entries,(function(e){return e[0]===t}))};KK.prototype={get:function(e){var t=WK(this,e);if(t)return t[1]},has:function(e){return!!WK(this,e)},set:function(e,t){var n=WK(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=jK(this.entries,(function(t){return t[0]===e}));return~t&&qK(this.entries,t,1),!!~t}};var YK,JK={getConstructor:function(e,t,n,i){var r=e((function(e,r){OK(e,o),VK(e,{type:t,id:HK++,frozen:void 0}),xK(r)||UK(r,e[i],{that:e,AS_ENTRIES:n})})),o=r.prototype,a=FK(t),s=function(e,t,n){var i=a(e),r=LK(NK(t),!0);return!0===r?zK(i).set(t,n):r[i.id]=n,e};return RK(o,{delete:function(e){var t=a(this);if(!PK(e))return!1;var n=LK(e);return!0===n?zK(t).delete(e):n&&GK(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!PK(e))return!1;var n=LK(e);return!0===n?zK(t).has(e):n&&GK(n,t.id)}}),RK(o,n?{get:function(e){var t=a(this);if(PK(e)){var n=LK(e);return!0===n?zK(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),r}},ZK=D,XK=te,QK=el,$K=ec.exports,eW=Qu,tW=JK,nW=Ie,iW=Sc,rW=ai.enforce,oW=Bn,aW=!ZK.ActiveXObject&&"ActiveXObject"in ZK,sW=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},cW=eW("WeakMap",sW,tW);if(oW&&aW){YK=tW.getConstructor(sW,"WeakMap",!0),$K.enable();var uW=cW.prototype,lW=XK(uW.delete),dW=XK(uW.has),hW=XK(uW.get),pW=XK(uW.set);QK(uW,{delete:function(e){if(nW(e)&&!iW(e)){var t=rW(this);return t.frozen||(t.frozen=new YK),lW(this,e)||t.frozen.delete(e)}return lW(this,e)},has:function(e){if(nW(e)&&!iW(e)){var t=rW(this);return t.frozen||(t.frozen=new YK),dW(this,e)||t.frozen.has(e)}return dW(this,e)},get:function(e){if(nW(e)&&!iW(e)){var t=rW(this);return t.frozen||(t.frozen=new YK),dW(this,e)?hW(this,e):t.frozen.get(e)}return hW(this,e)},set:function(e,t){if(nW(e)&&!iW(e)){var n=rW(this);n.frozen||(n.frozen=new YK),dW(this,e)?pW(this,e,t):n.frozen.set(e,t)}else pW(this,e,t);return this}})}var fW=br,gW=jI,_W=R,vW=Ee,mW=ve,yW=Uy,IW=AC,TW=Si,CW=gW&&gW.prototype;if(fW({target:"Promise",proto:!0,real:!0,forced:!!gW&&_W((function(){CW.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=yW(this,vW("Promise")),n=mW(e);return this.then(n?function(n){return IW(t,e()).then((function(){return n}))}:e,n?function(n){return IW(t,e()).then((function(){throw n}))}:e)}}),mW(gW)){var SW=vW("Promise").prototype.finally;CW.finally!==SW&&TW(CW,"finally",SW,{unsafe:!0})}var EW,bW,MW,kW,wW,DW=new WeakMap;function AW(){return function(e,n,i){var r=i.value,o=function e(n){var i=n.fn,r=n.args,o=n.context,a=n.resolve,s=n.reject;i.apply(o,r).then(a,s).finally((function(){var n=DW.get(o);n&&(n.shift(),n[0]&&e(t({},n[0])))}))};return i.value=function(){for(var e=this,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return new Promise((function(t,a){if(DW.has(e)){var s=DW.get(e),c=s.length;s.push({fn:r,args:i,context:e,resolve:t,reject:a,name:n}),0===c&&o({fn:r,args:i,context:e,resolve:t,reject:a})}else DW.set(e,[{fn:r,args:i,context:e,resolve:t,reject:a,name:n}]),o({fn:r,args:i,context:e,resolve:t,reject:a})}))},i}}var RW=(EW=AW(),bW=Gz({retries:1,timeout:0,onRetrying:function(e){this.log_.warn("connection timeout, retrying [".concat(e,"]"))},onError:function(e,t,n){e.message.includes("timeout")?t():n(e)}}),MW=AW(),kW=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return function(t,n,i){var r=i.value;return i.value=function(){for(var t=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return new Promise((function(i,a){var s=setTimeout((function(){return a(new Error("".concat(n," timeout")))}),e);r.apply(t,o).then(i,a).finally((function(){clearTimeout(s)}))}))},i}}(),wW=function(e){d(v,e);var n,o,c,l,p,f,g,_=m(v);function v(e){var t;return s(this,v),(t=_.call(this,e)).remoteStreams_=new Map,t.autoSubscribe=e.autoSubscribe,t.trackState_={audio:e.trackState.audio,video:e.trackState.video,auxiliary:e.trackState.auxiliary,smallVideo:e.trackState.smallVideo},t.ssrc_={audio:0,video:0,auxiliary:0},t.subscribeState_={audio:e.autoSubscribe,video:e.autoSubscribe,auxiliary:e.autoSubscribe,smallVideo:!1},t.isSDPExchanging_=!1,t.installEvents(),t}return u(v,[{key:"getMixUserList",value:function(){return this.mixUserList_?this.mixUserList_.map((function(e){var t=e.userId,n=e.flag;return{userId:t,hasAudio:!!(8&n),hasVideo:!!(1&n),hasAuxiliary:!!(4&n)}})):void 0}},{key:"setMixUserList",value:function(e){(!this.mixUserList_||ID(this.mixUserList_)&&!function(e,t){if(t.length===e.length){var n,i=b(t);try{var a=function(){var t=n.value,i=e.find((function(e){return e.userId===t.userId}));if(!i||i.flag!==t.flag)return{v:!1}};for(i.s();!(n=i.n()).done;){var s=a();if("object"===r(s))return s.v}}catch(o){i.e(o)}finally{i.f()}return!0}return!1}(this.mixUserList_,e))&&(this.mixUserList_=e,this.emitter_.emit(UN.STREAM_UPDATED,{stream:this.getMainStream()}))}},{key:"isMainStreamSubscribed",get:function(){return(this.subscribeState_.audio||this.subscribeState_.video||this.subscribeState_.smallVideo)&&(this.trackState_.audio||this.trackState_.video||this.trackState_.smallVideo)}},{key:"isAuxStreamSubscribed",get:function(){return this.subscribeState_.auxiliary&&this.trackState_.auxiliary}},{key:"isSmallStreamSubscribed",get:function(){return this.subscribeState_.smallVideo&&this.trackState_.smallVideo}},{key:"isBigStreamSubscribed",get:function(){return this.subscribeState_.video&&this.trackState_.video}},{key:"isStreamUnpublished",value:function(e){return e.getType()===rS?!this.trackState_.audio&&!this.trackState_.video:!this.trackState_.auxiliary}},{key:"initialize",value:function(){I(h(v.prototype),"initialize",this).call(this),this.peerConnection_.ontrack=this.onTrack.bind(this)}},{key:"close",value:function(){var e,t,n,i=this;I(h(v.prototype),"close",this).call(this),this.trackState_.audio=!1,this.trackState_.video=!1,this.trackState_.smallVideo=!1,this.trackState_.auxiliary=!1,this.emitConnectionStateChangedEvent(HS),e=this,t=function(e){e.fn;var t=e.args,n=e.resolve,r=e.reject,o=e.name;if("subscribe"===o){if(!i.client_.getIsJoined())return r(new IL({code:yL.API_CALL_ABORTED,message:aD({key:Nk,data:{message:"leave room",stream:t[0]}})}));if(i.isStreamUnpublished(t[0]))return r(new IL({code:yL.API_CALL_ABORTED,message:aD({key:Nk,data:{message:"remote user ".concat(i.userId_," unpublished stream"),stream:t[0]}})}))}else if("unsubscribe"===o)return n();n()},null===(n=DW.get(e))||void 0===n||n.forEach(t),DW.delete(e),this.remoteStreams_.forEach((function(e){var t=e;t.setConnection(null),t.uninstallEvents(),t.getIsStreamAddedEventEmitted()&&i.emitter_.emit(UN.STREAM_REMOVED,{stream:t})})),this.remoteStreams_.clear(),this.uninstallEvents()}},{key:"installEvents",value:function(){var e=this;VD.on(sA,this.onRemoteStreamUpdate,this),this.emitter_.on(UN.ERROR,(function(t){t.getCode()===yL.ICE_TRANSPORT_ERROR&&(e.isFirstConnection_&&(e.isFirstConnection_=!1,uO.logFailedEvent({userId:e.client_.getUserId(),eventType:fE,error:t})),e.isReconnecting_||e.startReconnection())})),this.emitter_.on(UN.CONNECTION_STATE_CHANGED,(function(t){t.state===WS&&e.isFirstConnection_&&(e.isFirstConnection_=!1,uO.logSuccessEvent({userId:e.client_.getUserId(),eventType:fE}),e.addEventInternal(zL,"downlink-connection is connected"))}))}},{key:"uninstallEvents",value:function(){VD.removeListener(sA,this.onRemoteStreamUpdate,this)}},{key:"onRemoteStreamUpdate",value:function(e){if(this.hitTest(e.tinyId)&&e.client===this.client_){this.updateTrackState(e.action,e.kind);var t=e.kind===jC?VS:GS,n=this.remoteStreams_.get(t);if(!n)return;e.action===FE.ADD?this.handleRemoteAddTrack(e.kind,n):this.handleRemoteRemoveTrack(e.kind,n)}}},{key:"handleRemoteAddTrack",value:function(e,t){this.log_.info("remote add ".concat(e," track")),e===UC?t.updateAudioPlayingState(this.subscribeState_.audio):t.updateVideoPlayingState(e===jC?this.subscribeState_.auxiliary:this.subscribeState_.video||this.subscribeState_.smallVideo),t.getIsStreamAddedEventEmitted()?this.emitter_.emit(UN.STREAM_UPDATED,{stream:t}):(this.emitter_.emit(UN.STREAM_ADDED,{stream:t}),this.currentState_===WS&&t.emitConnectionStateChanged({prevState:HS,state:WS}))}},{key:"handleRemoteRemoveTrack",value:function(e,t){t.getIsStreamAddedEventEmitted()&&(this.log_.info("remote remove ".concat(e," track")),e===jC||!this.trackState_.audio&&!this.trackState_.video?(this.log_.info("remote stream ".concat(t.getType()," removed")),this.currentState_===WS&&t.emitConnectionStateChanged({prevState:WS,state:HS}),this.emitter_.emit(UN.STREAM_REMOVED,{stream:t})):(e===UC?t.updateAudioPlayingState(!1):(e!==HC||this.isSmallStreamSubscribed)&&t.updateVideoPlayingState(!1),this.emitter_.emit(UN.STREAM_UPDATED,{stream:t})))}},{key:"updateTrackState",value:function(e,t){var n=e===FE.ADD;switch(t){case UC:this.trackState_.audio=n;break;case GC:this.trackState_.video=n;break;case jC:this.trackState_.auxiliary=n;break;case HC:this.trackState_.smallVideo=n}this.log_.info("trackState updated: ".concat(JSON.stringify(this.trackState_)))}},{key:"onTrack",value:function(e){var t=e.streams[0],n=e.track;if(this.log_.info("ontrack() kind: ".concat(n.kind," id: ").concat(n.id," streamId: ").concat(t.id)),this.sdpSemantics_===AE){var i=function(e){var t=_O.parse(e),n={audio:[],video:[]};return t.media.forEach((function(e){if(e.ssrcs){var t=e.ssrcs[0].id>>16&255;if(e.type===UC)n.audio.push(GS);else if(e.type==GC){var i=t===FS?GS:VS;n.video.push(i)}}})),n}(this.peerConnection_.remoteDescription.sdp);if(n.kind===UC){if(0===i.audio.length||t.id!==GS)return void this.log_.debug("skip this invalid audio track")}else if(-1===i.video.indexOf(t.id))return void this.log_.debug("skip this invalid video track: ".concat(n.id,"  msid: ").concat(t.id))}uO.logEvent({eventType:"ontrack",kind:n.kind});var r=!1,o=this.remoteStreams_.get(t.id),a=t.id===GS?BS:jS;if(gD(o)&&((o=new Zz({type:a,userId:this.userId_,client:this.client_})).setConnection(this),this.remoteStreams_.set(t.id,o),r=!0),o.setMediaStream(t),n.kind===UC?o.updateAudioPlayingState(this.subscribeState_.audio):a===BS?o.updateVideoPlayingState(this.subscribeState_.video||this.subscribeState_.smallVideo):o.updateVideoPlayingState(this.subscribeState_.auxiliary),(a!==jS||this.trackState_.auxiliary)&&(a!==BS||this.trackState_.audio||this.trackState_.video)){var s=this.client_.getSubscriptionManager();s&&s.hasAutoRecoveryFlag(this.userId_,a)||(r?this.emitter_.emit(UN.STREAM_ADDED,{stream:o}):this.emitter_.emit(UN.STREAM_UPDATED,{stream:o}))}}},{key:"addRRTRLine",value:function(e){var t=e.split("\r\n"),n=new Map;t.forEach((function(e,i){/^a=rtcp-fb:/.test(e)&&t[i+1]&&!/^a=rtcp-fb:/.test(t[i+1])&&n.set(i+1,e.match(/^a=rtcp-fb:\d+/)[0]+" rrtr")}));for(var i=C(n),r=0;r<i.length;r++){var o=T(i[r],2),a=o[0],s=o[1];t.splice(a+r,0,s)}return t.join("\r\n")}},{key:"addSPSDescription",value:function(e){var t=wO(e);return t.media.forEach((function(e){e.type===GC&&e.fmtp.forEach((function(e){e.config+=";sps-pps-idr-in-keyframe=1"}))})),DO(t)}},{key:"removeSDESDescription",value:function(e){var t=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"],n=wO(e);return n.media.forEach((function(e){e.ext=e.ext.filter((function(e){return!t.includes(e.uri)}))})),DO(n)}},{key:"isSubscriptionStateNotChanged",value:function(e,t){return e.getType()===BS?(null==t?void 0:t.audio)===this.subscribeState_.audio&&(null==t?void 0:t.video)===this.subscribeState_.video&&this.isSubscribeSmall(t):e.getType()===jS?!gD(t.video)&&this.subscribeState_.auxiliary===t.video:void 0}},{key:"isSubscribeSmall",value:function(e){return gD(e.smallVideo)&&!this.subscribeState_.smallVideo}},{key:"subscribe",value:(g=a(i().mark((function e(t,n){var r,o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=n.emitEvent,s=void 0===a||a,c=t.getType(),(null===(r=this.peerConnection_)||void 0===r?void 0:r.connectionState)!==YS&&(null===(o=this.peerConnection_)||void 0===o?void 0:o.connectionState)!==JS){e.next=6;break}return e.next=6,this.waitForPeerConnectionConnected();case 6:if(!this.isSubscriptionStateNotChanged(t,n)){e.next=13;break}if(this.peerConnection_){e.next=11;break}return this.initialize(),e.next=11,this.connect();case 11:return s&&gD(n.smallVideo)&&this.emitter_.emit(UN.STREAM_SUBSCRIBED,{stream:t,result:!0}),e.abrupt("return",t);case 13:if(c===rS?(gD(n.audio)||(this.subscribeState_.audio=n.audio),gD(n.video)||(this.subscribeState_.video=n.video),this.subscribeState_.smallVideo=(null==n?void 0:n.smallVideo)||!1,this.addEventInternal(this.subscribeState_.audio?DL:RL,this.subscribeState_.audio?"subscribe audio":"unsubscribe audio"),this.addEventInternal(this.subscribeState_.video?DL:RL,this.subscribeState_.video?"subscribe video":"unsubscribe video"),this.addEventInternal(this.subscribeState_.smallVideo?tO:nO,this.subscribeState_.smallVideo?"subscribe smallVideo":"unsubscribe smallVideo")):gD(n.video)||(this.subscribeState_.auxiliary=n.video),this.log_.info("subscribe ".concat(c," stream with options ").concat(JSON.stringify(n)," current state: ").concat(JSON.stringify(this.subscribeState_))),!this.peerConnection_&&!this.isSDPExchanging_){e.next=23;break}return u=DE,this.isMainStreamSubscribed||this.isAuxStreamSubscribed||(u=wE),e.next=20,this.sendSubscription(u);case 20:c===rS?(t.updateAudioPlayingState(this.subscribeState_.audio),t.updateVideoPlayingState(this.subscribeState_.video||this.subscribeState_.smallVideo)):t.updateVideoPlayingState(this.subscribeState_.auxiliary),e.next=26;break;case 23:return this.initialize(),e.next=26,this.connect();case 26:return s&&this.emitter_.emit(UN.STREAM_SUBSCRIBED,{stream:t,result:!0}),e.abrupt("return",t);case 30:if(e.prev=30,e.t0=e.catch(0),!this.client_.getIsJoined()||!this.isStreamUnpublished(t)){e.next=35;break}throw this.log_.warn("".concat(e.t0.message," ").concat(JSON.stringify(this.trackState_))),new IL({code:yL.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId_," unpublished stream")});case 35:throw e.t0;case 36:case"end":return e.stop()}}),e,this,[[0,30]])}))),function(e,t){return g.apply(this,arguments)})},{key:"unsubscribe",value:(f=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.getType())!==rS){e.next=10;break}if(this.isMainStreamSubscribed){e.next=5;break}return this.log_.info("main stream already unsubscribed"),e.abrupt("return",t);case 5:this.subscribeState_.audio=!1,this.subscribeState_.video=!1,this.subscribeState_.smallVideo=!1,e.next=14;break;case 10:if(this.isAuxStreamSubscribed){e.next=13;break}return this.log_.info("auxiliary stream already unsubscribed"),e.abrupt("return",t);case 13:this.subscribeState_.auxiliary=!1;case 14:return r=wE,(n===BS&&this.isAuxStreamSubscribed||n===jS&&this.isMainStreamSubscribed)&&(r=DE),this.log_.info("unsubscribe ".concat(n," stream with ").concat(JSON.stringify(this.subscribeState_))),e.next=19,this.sendSubscription(r);case 19:return t.updateVideoPlayingState(!1),t.updateAudioPlayingState(!1),r===wE&&((o=t.getMediaStream())&&o.getTracks().forEach((function(e){return o.removeTrack(e)})),this.closePeerConnection(),this.emitConnectionStateChangedEvent(HS)),this.addEventInternal(RL,"unsubscribe audio"),this.addEventInternal(AL,"unsubscribe video"),e.abrupt("return",t);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"sendSubscription",value:function(e){var t=this,n={srcTinyId:this.tinyId_,srcUserId:this.userId_},i=cL,r=QR.UNSUBSCRIBE_RESULT;return e===DE&&(n={audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary,smallVideo:this.subscribeState_.smallVideo,srcTinyId:this.tinyId_},i=uL,r=QR.SUBSCRIBE_CHANGE_RESULT),this.signalChannel_.sendWaitForResponse({command:i,data:n,responseCommand:r,timeout:1e4}).then((function(n){var i=n.data;if(0!==i.code){var r=new IL({code:i.code,message:aD({key:Bb,data:{type:e,message:i.message}})});throw t.log_.error(r),r}}))}},{key:"connect",value:(p=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.exchangeSDP();case 3:return e.next=5,this.waitForPeerConnectionConnected();case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),this.closePeerConnection(!0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"exchangeSDP",value:(l=a(i().mark((function e(){var t,n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.isSDPExchanging_=!0,e.next=4,this.createOffer();case 4:return this.log_.info("createOffer success, sending offer to remote server"),t=this.peerConnection_.localDescription,n=t.type,r=t.sdp,o={type:n,sdp:r,srcUserId:this.userId_,srcTinyId:this.tinyId_,audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary,smallVideo:this.subscribeState_.smallVideo},VD.emit(kA,{client:this.client_,connection:this,userId:this.userId_,tinyId:this.tinyId_,role:NS,subscribeState:this.subscribeState_,trackState:this.trackState_}),e.next=10,this.signalChannel_.sendWaitForResponse({command:sL,commandDesc:"exchange sdp",data:o,responseCommand:QR.SUBSCRIBE_RESULT,timeout:1e4});case 10:if(a=e.sent,this.peerConnection_){e.next=15;break}throw s=new IL({code:yL.INVALID_OPERATION,message:aD({key:Ek})}),this.log_.warn(s),s;case 15:return e.next=17,this.onSubscribeResult(a);case 17:this.isSDPExchanging_=!1,e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(0),this.isSDPExchanging_=!1,e.t0;case 24:case"end":return e.stop()}}),e,this,[[0,20]])}))),function(){return l.apply(this,arguments)})},{key:"createOffer",value:(c=a(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={voiceActivityDetection:!1},TN()&&this.sdpSemantics_===AE?(this.peerConnection_.addTransceiver(UC,{direction:"recvonly"}),this.peerConnection_.addTransceiver(GC,{direction:"recvonly"}),this.peerConnection_.addTransceiver(GC,{direction:"recvonly"})):(t.offerToReceiveAudio=!0,t.offerToReceiveVideo=!0),e.next=4,this.peerConnection_.createOffer(t);case 4:return n=e.sent,e.next=7,hN();case 7:return e.sent.isH264DecodeSupported||(this.log_.warn("remove h264 desc from sdp"),n.sdp=RO(n.sdp)),n.sdp=this.addRRTRLine(n.sdp),n.sdp=this.addSPSDescription(n.sdp),n.sdp=AO(n.sdp),this.sdpSemantics_===AE&&(n.sdp=this.removeSDESDescription(n.sdp)),e.next=16,this.peerConnection_.setLocalDescription(n);case 16:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"onSubscribeResult",value:(o=a(i().mark((function e(n){var r,o,a,s,c,u,l,d=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n&&n.data||{},o=r.code,a=r.message,s=void 0===a?"":a,c=n&&n.data&&n.data.data||{},u=c.type,l=c.sdp,77393!==o){e.next=5;break}throw this.log_.error(Pk.NOT_SUPPORTED_H264DECODE),new IL({code:yL.NOT_SUPPORTED_H264,message:aD({key:fk})});case 5:if(e.prev=5,0===o){e.next=8;break}throw new IL({code:o,message:aD({key:Hb,data:{errMsg:s}})});case 8:return this.log_.debug("accept remote answer: "+l),e.next=11,this.peerConnection_.setRemoteDescription({type:u,sdp:l});case 11:this.sei_&&(this.sei_.handleEncodedStreams(),this.sei_.onSEIMessage=function(e){d.emitter_.emit(UN.SEI_MESSAGE,t(t({},e),{},{userId:d.userId_}))}),this.updateSSRC(l),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),this.log_.error(e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[5,15]])}))),function(e){return o.apply(this,arguments)})},{key:"updateSSRC",value:function(e){var t=this;try{wO(e).media.forEach((function(e){if(e.type===UC){var n=e.ssrcs.find((function(e){return e.value.includes(GS)}));n&&(t.ssrc_.audio=n.id)}else{var i=e.ssrcs.find((function(e){return e.value.includes(GS)})),r=e.ssrcs.find((function(e){return e.value.includes(VS)}));i&&(t.ssrc_.video=i.id),r&&(t.ssrc_.auxiliary=r.id)}}))}catch(qY){}}},{key:"setRemoteStream",value:function(e,t){this.remoteStreams_.set(e,t)}},{key:"getSubscribeState",value:function(){return this.subscribeState_}},{key:"getTrackState",value:function(){return this.trackState_}},{key:"getSSRC",value:function(){return this.ssrc_}},{key:"getMainStream",value:function(){return this.remoteStreams_.get(GS)}},{key:"getAuxStream",value:function(){return this.remoteStreams_.get(VS)}},{key:"getMainStreamVideoTrackId",value:function(){var e=this.getMainStream();if(e){var t=e.getVideoTrack();if(t)return t.id}return""}},{key:"getAuxStreamVideoTrackId",value:function(){var e=this.getAuxStream();if(e){var t=e.getVideoTrack();if(t)return t.id}return""}},{key:"reconnect",value:(n=a(i().mark((function e(){var t,n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.reconnectionTimer_){e.next=3;break}return this.log_.warn("reconnect() downlink is reconnecting, ignore current reconnection"),e.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){e.next=12;break}return this.log_.warn("SDK has tried reconnect downlink [".concat(this.userId_,"] for ").concat(30," times, but all failed, please check your network")),this.stopReconnection(),t=new IL({code:yL.DOWNLINK_RECONNECTION_FAILED,message:aD({key:qb})}),uO.logFailedEvent({userId:this.client_.getUserId(),eventType:gE,error:t}),this.addEventInternal(eO,"downlink-connection reconnect fail"),this.emitConnectionStateChangedEvent(HS),this.emitter_.emit(UN.ERROR,t),e.abrupt("return");case 12:if(this.signalChannel_.getCurrentState()===JR){e.next=16;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(HR,this.reconnect,this),e.abrupt("return");case 16:if(this.reconnectionCount_++,this.log_.warn("reconnect() try to reconnect downlink [".concat(this.reconnectionCount_,"/").concat(30,"]")),n=pD(this.reconnectionCount_),this.reconnectionTimer_=setTimeout((function(){r.log_.warn("reconnect() downlink [".concat(r.userId_,"] reconnect timeout(").concat(n/1e3,"s), try again")),r.clearReconnectionTimer(),r.reconnect()}),n),!(this.isSDPExchanging_||this.peerConnection_&&this.peerConnection_.connectionState===JS)){e.next=22;break}return e.abrupt("return");case 22:return e.prev=22,this.closePeerConnection(),this.initialize(),e.next=27,this.connect();case 27:this.stopReconnection(),this.log_.warn("reconnect() downlink reconnect successfully"),uO.logSuccessEvent({userId:this.client_.getUserId(),eventType:gE}),this.addEventInternal($L,"downlink-connection reconnect success"),this.recoverSubscription(),e.next=36;break;case 34:e.prev=34,e.t0=e.catch(22);case 36:case"end":return e.stop()}}),e,this,[[22,34]])}))),function(){return n.apply(this,arguments)})},{key:"recoverSubscription",value:function(){var e=this,t=this.client_.getSubscriptionManager();t&&C(this.remoteStreams_.values()).forEach((function(n){t.hasAutoRecoveryFlag(e.userId_,n.getType())&&t.recover(n)}))}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"getSubscribedMainStream",value:function(){var e=null;return this.isMainStreamSubscribed&&(e=this.remoteStreams_.get(GS)),e}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"startReconnection",value:function(){var e=this.client_.getSubscriptionManager();if(e){var t,n=b(this.remoteStreams_.values());try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.getType();(r===BS&&(this.trackState_.audio||this.trackState_.video)||r===jS&&this.trackState_.auxiliary)&&e.setAutoRecoveryFlag(this.userId_,i.getType())}}catch(a){n.e(a)}finally{n.f()}}I(h(v.prototype),"startReconnection",this).call(this)}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"hasMainStream",value:function(){return this.trackState_.video||this.trackState_.audio||this.trackState_.smallVideo}},{key:"hasAuxStream",value:function(){return this.trackState_.auxiliary}}]),v}(yz),M(wW.prototype,"subscribe",[EW,bW],Object.getOwnPropertyDescriptor(wW.prototype,"subscribe"),wW.prototype),M(wW.prototype,"unsubscribe",[MW],Object.getOwnPropertyDescriptor(wW.prototype,"unsubscribe"),wW.prototype),M(wW.prototype,"exchangeSDP",[kW],Object.getOwnPropertyDescriptor(wW.prototype,"exchangeSDP"),wW.prototype),wW),LW=function(){function e(){s(this,e),this.startTime=0,this.endTime=0,this.start()}return u(e,[{key:"start",value:function(){0===this.startTime&&(this.startTime=ED())}},{key:"stop",value:function(){0===this.endTime&&(this.endTime=ED())}},{key:"getDuration",value:function(){return 0===this.endTime?ED()-this.startTime:this.endTime-this.startTime}}]),e}(),OW=function(){function e(t){s(this,e),this.client_=t.client,this.intervalId_=-1,this.statsCalculator_=t.stats,this.prevStats_=null,this.renderFreezeMap_=new Map,this.remoteStreamMap_=new Map,this.dataFreezeMap_=new Map,this.monitorFreezeData_=new Map}var t,n,r;return u(e,[{key:"installEvents",value:function(){VD.on(CA,this.handlePlayVideoStart,this),VD.on(mA,this.onVideoTrackMuted,this),VD.on(yA,this.onVideoTrackUnmuted,this),VD.on(pA,this.handleStreamStopped,this),VD.on(dA,this.handleStreamStopped,this),VD.on(oA,this.handleVideoPlaying,this)}},{key:"uninstallEvents",value:function(){VD.off(CA,this.handlePlayVideoStart,this),VD.off(mA,this.onVideoTrackMuted,this),VD.off(yA,this.onVideoTrackUnmuted,this),VD.off(pA,this.handleStreamStopped,this),VD.off(dA,this.handleStreamStopped,this),VD.off(oA,this.handleVideoPlaying,this)}},{key:"start",value:function(){var e=this;-1===this.intervalId_&&(this.installEvents(),this.intervalId_=tN.run(a(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.detectFPS();case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),t,null,[[0,5]])}))),{delay:1e3}))}},{key:"stop",value:function(){-1!==this.intervalId_&&(this.uninstallEvents(),tN.clearTask(this.intervalId_),this.intervalId_=-1,this.renderFreezeMap_.clear(),this.dataFreezeMap_.clear(),this.remoteStreamMap_.clear())}},{key:"onVideoTrackMuted",value:function(e){var t=e.stream;if(t.getClient()===this.client_&&t.isRemote()){var n=t.userId_,i=t.type_,r="".concat(n,"_").concat(i),o=this.dataFreezeMap_.get(r),a=new LW;o?o.durationItemList.push(a):this.dataFreezeMap_.set(r,{userId:n,type:i,durationItemList:[a],isFreezing:function(){var e=this.durationItemList[this.durationItemList.length-1];return e&&0===e.endTime}})}}},{key:"onVideoTrackUnmuted",value:function(e){var t=e.stream;if(t.getClient()===this.client_&&t.isRemote()){var n=t.userId_,i=t.type_,r="".concat(n,"_").concat(i);this.stopDataFreeze({key:r,userId:n,type:i})}}},{key:"handleStreamStopped",value:function(e){var t=e.client,n=e.stream;if(t===this.client_){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r);this.stopDataFreeze({key:o,userId:i,type:r})}}},{key:"stopDataFreeze",value:function(e){var t=e.key,n=e.userId,i=e.type,r=this.dataFreezeMap_.get(t);if(r&&r.isFreezing()){var o=r.durationItemList[r.durationItemList.length-1];o.stop();var a=o.getDuration();a>500?(uO.logEvent({eventType:"videoFrozenCount",delta:a}),this.monitorFreezeData_.set(t,{userId:n,type:i,duration:a})):r.durationItemList.pop()}}},{key:"getTotalDuration",value:function(e){return e.reduce((function(e,t){var n=t.getDuration();return e+Math.min(n,5e3)}),0)}},{key:"getStats",value:(r=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.client_.getConnections(),n={},r=b(t),e.prev=3,r.s();case 5:if((o=r.n()).done){e.next=20;break}if(a=T(o.value,2),s=a[0],(c=a[1]).getPeerConnection()){e.next=9;break}return e.abrupt("continue",18);case 9:return u=c.getSubscribeState(),l=c.getTrackState(),e.next=13,this.statsCalculator_.getReceiverStats(c);case 13:d=e.sent,(h={userId:d.userId,tinyId:s,hasVideo:l.video&&u.video,hasAuxiliary:l.auxiliary&&u.auxiliary,video:{framesDecoded:0},auxiliary:{framesDecoded:0}}).hasVideo&&(h.video.framesDecoded=d.video.framesDecoded),h.hasAuxiliary&&(h.auxiliary.framesDecoded=d.auxiliary.framesDecoded),n[d.userId]=h;case 18:e.next=5;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(3),r.e(e.t0);case 25:return e.prev=25,r.f(),e.finish(25);case 28:return e.abrupt("return",n);case 29:case"end":return e.stop()}}),e,this,[[3,22,25,28]])}))),function(){return r.apply(this,arguments)})},{key:"detectFPS",value:(n=a(i().mark((function e(){var t,n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStats();case 2:if(t=e.sent,this.prevStats_){e.next=6;break}return this.prevStats_=t,e.abrupt("return");case 6:e.t0=i().keys(t);case 7:if((e.t1=e.t0()).done){e.next=17;break}if(n=e.t1.value,this.prevStats_[n]){e.next=11;break}return e.abrupt("continue",7);case 11:r=t[n].tinyId,o=this.client_.getMutedStates(),t[n].hasVideo&&this.prevStats_[n].hasVideo&&o.has(r)&&!o.get(r).videoMuted&&(a=t[n].video.framesDecoded-this.prevStats_[n].video.framesDecoded,this.handleRenderFreeze({userId:n,type:BS,fps:a})),t[n].hasAuxiliary&&this.prevStats_[n].hasAuxiliary&&(s=t[n].auxiliary.framesDecoded-this.prevStats_[n].auxiliary.framesDecoded,this.handleRenderFreeze({userId:n,type:jS,fps:s})),e.next=7;break;case 17:this.prevStats_=t;case 18:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleRenderFreeze",value:(t=a(i().mark((function e(t){var n,r,o,a,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.userId,r=t.fps,o=t.type,a="".concat(n,"_").concat(o),s=this.renderFreezeMap_.get(a),r<=2?(c=ED(),s&&!s.isFreeze&&(s.freezeTimeline.push({startTime:c,endTime:void 0}),s.isFreeze=!0),s||this.renderFreezeMap_.set(a,{userId:n,type:o,isFreeze:!0,freezeTimeline:[{startTime:c,endTime:void 0}],renderFreezeTotal:0})):s&&s.isFreeze&&(s.isFreeze=!1,(u=s.freezeTimeline.pop()).endTime=ED(),l=u.endTime-u.startTime,s.freezeTimeline.push(u),s.renderFreezeTotal+=Math.min(5e3,l));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handlePlayVideoStart",value:function(e){var t=e.stream;if(t.getClient()===this.client_&&t.isRemote()&&t.hasVideo()){var n="".concat(t.getUserId(),"_").concat(t.getType());this.remoteStreamMap_.has(n)||this.remoteStreamMap_.set(n,{isPlayingFired:!1})}}},{key:"handleVideoPlaying",value:function(e){var t=e.stream;if(t.isRemote()&&t.getClient()===this.client_){var n="".concat(t.getUserId(),"_").concat(t.getType());this.remoteStreamMap_.has(n)&&(this.remoteStreamMap_.get(n).isPlayingFired=!0)}}},{key:"getDataFreezeDuration",value:function(e){var t={dataFreeze:0,count:0},n=this.dataFreezeMap_.get(e);if(n){if(n.isFreezing()){var i=n.durationItemList[n.durationItemList.length-1];i.stop(),i.getDuration()<500&&n.durationItemList.pop()}t.dataFreeze=this.getTotalDuration(n.durationItemList),t.count=n.durationItemList.length}return t}},{key:"getRenderFreezeDuration",value:function(e){var t=this.renderFreezeMap_.get(e),n=0,i=0;if(t)if(t.isFreeze){var r=ED()-t.freezeTimeline[t.freezeTimeline.length-1].startTime;n=t.renderFreezeTotal+Math.min(r,5e3),i=t.freezeTimeline.length}else n=t.renderFreezeTotal;return{renderFreeze:n,count:i}}},{key:"getMonitorFreeze",value:function(){return this.monitorFreezeData_}},{key:"isBlackStream",value:function(e){return!!this.remoteStreamMap_.has(e)&&!this.remoteStreamMap_.get(e).isPlayingFired}},{key:"resetMonitor",value:function(){this.monitorFreezeData_.clear()}}]),e}(),NW=u((function e(t){s(this,e),this.userId=t.userId,this.tinyId=t.tinyId,this.role=t.role===NS?PS:US})),xW={exports:{}};!function(e){!function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,i,r,o,a){return n((s=n(n(t,e),n(r,a)))<<(c=o)|s>>>32-c,i);var s,c}function r(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function o(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}function c(e,t){var i,c,u,l,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,p=-271733879,f=-1732584194,g=271733878;for(i=0;i<e.length;i+=16)c=h,u=p,l=f,d=g,h=r(h,p,f,g,e[i],7,-680876936),g=r(g,h,p,f,e[i+1],12,-389564586),f=r(f,g,h,p,e[i+2],17,606105819),p=r(p,f,g,h,e[i+3],22,-1044525330),h=r(h,p,f,g,e[i+4],7,-176418897),g=r(g,h,p,f,e[i+5],12,1200080426),f=r(f,g,h,p,e[i+6],17,-1473231341),p=r(p,f,g,h,e[i+7],22,-45705983),h=r(h,p,f,g,e[i+8],7,1770035416),g=r(g,h,p,f,e[i+9],12,-1958414417),f=r(f,g,h,p,e[i+10],17,-42063),p=r(p,f,g,h,e[i+11],22,-1990404162),h=r(h,p,f,g,e[i+12],7,1804603682),g=r(g,h,p,f,e[i+13],12,-40341101),f=r(f,g,h,p,e[i+14],17,-1502002290),h=o(h,p=r(p,f,g,h,e[i+15],22,1236535329),f,g,e[i+1],5,-165796510),g=o(g,h,p,f,e[i+6],9,-1069501632),f=o(f,g,h,p,e[i+11],14,643717713),p=o(p,f,g,h,e[i],20,-373897302),h=o(h,p,f,g,e[i+5],5,-701558691),g=o(g,h,p,f,e[i+10],9,38016083),f=o(f,g,h,p,e[i+15],14,-660478335),p=o(p,f,g,h,e[i+4],20,-405537848),h=o(h,p,f,g,e[i+9],5,568446438),g=o(g,h,p,f,e[i+14],9,-1019803690),f=o(f,g,h,p,e[i+3],14,-187363961),p=o(p,f,g,h,e[i+8],20,1163531501),h=o(h,p,f,g,e[i+13],5,-1444681467),g=o(g,h,p,f,e[i+2],9,-51403784),f=o(f,g,h,p,e[i+7],14,1735328473),h=a(h,p=o(p,f,g,h,e[i+12],20,-1926607734),f,g,e[i+5],4,-378558),g=a(g,h,p,f,e[i+8],11,-2022574463),f=a(f,g,h,p,e[i+11],16,1839030562),p=a(p,f,g,h,e[i+14],23,-35309556),h=a(h,p,f,g,e[i+1],4,-1530992060),g=a(g,h,p,f,e[i+4],11,1272893353),f=a(f,g,h,p,e[i+7],16,-155497632),p=a(p,f,g,h,e[i+10],23,-1094730640),h=a(h,p,f,g,e[i+13],4,681279174),g=a(g,h,p,f,e[i],11,-358537222),f=a(f,g,h,p,e[i+3],16,-722521979),p=a(p,f,g,h,e[i+6],23,76029189),h=a(h,p,f,g,e[i+9],4,-640364487),g=a(g,h,p,f,e[i+12],11,-421815835),f=a(f,g,h,p,e[i+15],16,530742520),h=s(h,p=a(p,f,g,h,e[i+2],23,-995338651),f,g,e[i],6,-198630844),g=s(g,h,p,f,e[i+7],10,1126891415),f=s(f,g,h,p,e[i+14],15,-1416354905),p=s(p,f,g,h,e[i+5],21,-57434055),h=s(h,p,f,g,e[i+12],6,1700485571),g=s(g,h,p,f,e[i+3],10,-1894986606),f=s(f,g,h,p,e[i+10],15,-1051523),p=s(p,f,g,h,e[i+1],21,-2054922799),h=s(h,p,f,g,e[i+8],6,1873313359),g=s(g,h,p,f,e[i+15],10,-30611744),f=s(f,g,h,p,e[i+6],15,-1560198380),p=s(p,f,g,h,e[i+13],21,1309151649),h=s(h,p,f,g,e[i+4],6,-145523070),g=s(g,h,p,f,e[i+11],10,-1120210379),f=s(f,g,h,p,e[i+2],15,718787259),p=s(p,f,g,h,e[i+9],21,-343485551),h=n(h,c),p=n(p,u),f=n(f,l),g=n(g,d);return[h,p,f,g]}function u(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function d(e){var t,n,i="0123456789abcdef",r="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),r+=i.charAt(t>>>4&15)+i.charAt(15&t);return r}function h(e){return unescape(encodeURIComponent(e))}function p(e){return function(e){return u(c(l(e),8*e.length))}(h(e))}function f(e,t){return function(e,t){var n,i,r=l(e),o=[],a=[];for(o[15]=a[15]=void 0,r.length>16&&(r=c(r,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^r[n],a[n]=1549556828^r[n];return i=c(o.concat(l(t)),512+8*t.length),u(c(a.concat(i),640))}(h(e),h(t))}function g(e,t,n){return t?n?f(t,e):d(f(t,e)):n?p(e):d(p(e))}e.exports?e.exports=g:t.md5=g}(k)}(xW);var PW=xW.exports,UW=function(){function e(t){s(this,e),this.client_=t.client,this.signalChannel_=t.signalChannel,this.log_=UA.createLogger({id:"mix|"+this.client_.getUserId(),userId:t.client.getUserId(),sdkAppId:t.client.getSDKAppId()}),this.isMixing_=!1,this.config_=null,this.data_=null,this.remoteStreamMap_=new Map,this.installEvents()}var t,n,r,o;return u(e,[{key:"isPresetLayoutMode",get:function(){return this.config_&&this.config_.mode===LE.PRESET_LAYOUT}},{key:"installEvents",value:function(){VD.on(lA,this.onStreamSubscribed,this),VD.on(dA,this.onStreamUnsubscribed,this),this.client_.on("stream-removed",this.onStreamRemoved,this)}},{key:"uninstallEvents",value:function(){VD.off(lA,this.onStreamSubscribed,this),VD.off(dA,this.onStreamUnsubscribed,this),this.client_.off("stream-removed",this.onStreamRemoved,this)}},{key:"reset",value:function(){this.uninstallEvents(),this.isMixing_=!1,this.config_=null}},{key:"onStreamSubscribed",value:function(e){var t=e.client,n=e.stream;t===this.client_&&(this.remoteStreamMap_.set(n.getId(),{remoteStream:n,isUsed:!1}),this.isMixing_&&this.hasAvailablePlaceHolder()&&this.startMixTranscode(this.config_))}},{key:"onStreamUnsubscribed",value:function(e){var t=e.client,n=e.stream;t===this.client_&&this.onStreamRemoved({stream:n})}},{key:"onStreamRemoved",value:function(e){var t=e.stream;if(this.remoteStreamMap_.has(t.getId())){var n=this.remoteStreamMap_.get(t.getId()).isUsed;this.remoteStreamMap_.delete(t.getId()),this.isMixing_&&this.isPresetLayoutMode&&n&&this.startMixTranscode(this.config_)}}},{key:"startMixTranscode",value:(o=a(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.resetIsUsedFlag(),this.config_=t,n=this.getInputParam(t,this.remoteStreamMap_),r=this.getOutputParam(t),o=this.getOutputSessionId({config:t,roomId:this.client_.getRoomId(),userId:this.client_.getUserId()}),!this.isMixing_||!this.data_||o===this.data_.outputSessionId){e.next=10;break}return this.log_.info("startMixTranscode() streamId changed, stop mixing before start"),e.next=10,this.doStopMixTranscode();case 10:return e.next=12,this.doStartMixTranscode({outputSessionId:o,inputParam:n,outputParam:r});case 12:e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),this.resetIsUsedFlag(),e.t0;case 18:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e){return o.apply(this,arguments)})},{key:"doStartMixTranscode",value:(r=a(i().mark((function e(t){var n,r,o,a,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outputSessionId,r=t.inputParam,o=t.outputParam,a={roomId:String(this.client_.getRoomId()),mcuRequestTime:Date.now(),outputSessionId:n,inputParam:r,outputParam:o},this.data_=a,this.log_.info("startMixTranscode: ".concat(JSON.stringify(a))),this.isMixing_=!0,e.prev=5,e.next=8,this.signalChannel_.sendWaitForResponse({command:fL,data:a,timeout:5e3,responseCommand:QR.START_MIX_TRANSCODE_RES,commandDesc:"startMixTranscode"});case 8:if(s=e.sent,c=s.data,u=c.code,l=c.message,0===u){e.next=15;break}throw-102083===u&&(l="Please enable relayed-push in ".concat(cb," and try later, refer to ").concat(lb,"tutorial-26-advanced-publish-cdn-stream.html")),this.log_.error("startMixTranscode failed, errCode: ".concat(u," errMsg: ").concat(l)),this.isMixing_=!1,new IL({code:yL.START_MIX_TRANSCODE_FAILED,message:aD({key:WM,data:{message:l},link:{className:"Client",fnName:"startMixTranscode"}})});case 15:e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(5),this.isMixing_=!1,e.t0;case 21:case"end":return e.stop()}}),e,this,[[5,17]])}))),function(e){return r.apply(this,arguments)})},{key:"reStartMixTranscode",value:function(){this.isMixing_&&this.startMixTranscode(this.config_)}},{key:"stopMixTranscode",value:(n=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMixing_){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:JM})});case 2:return e.next=4,this.doStopMixTranscode();case 4:this.resetIsUsedFlag();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"doStopMixTranscode",value:(t=a(i().mark((function e(){var t,n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={mcuRequestTime:Date.now(),outputSessionId:this.data_.outputSessionId,streamType:this.data_.outputParam.streamType},this.log_.info("stopMixTranscode: ".concat(JSON.stringify(t))),e.next=4,this.signalChannel_.sendWaitForResponse({command:gL,data:t,timeout:5e3,responseCommand:QR.STOP_MIX_TRANSCODE_RES,commandDesc:"stopMixTranscode"});case 4:if(n=e.sent,r=n.data,o=r.code,a=r.message,0!==o){e.next=10;break}this.isMixing_=!1,e.next=12;break;case 10:throw this.log_.error("stopMixTranscode failed, errCode: ".concat(o," errMsg: ").concat(a)),new IL({code:yL.STOP_MIX_TRANSCODE_FAILED,message:aD({key:YM,data:{message:a},link:{className:"Client",fnName:"stopMixTranscode"}})});case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getOutputSessionId",value:function(e){var t=e.config,n=e.userId,i=e.roomId;return _D(t.streamId)&&t.streamId.length>0?t.streamId:PW("".concat(i,"_").concat(n,"_main"))}},{key:"getInputParam",value:function(e,t){var n=this,i=e.mixUsers.map((function(e){return{userId:e.userId,roomId:String(e.roomId||n.client_.getRoomId()),width:e.width||0,height:e.height||0,locationX:e.locationX||0,locationY:e.locationY||0,zOrder:e.zOrder,streamType:gD(e.streamType)||e.streamType!==jS?0:1,inputType:e.pureAudio?NE.IT_PURE_AUDIO:NE.IT_AUDIO_VIDEO,renderMode:e.renderMode||0}}));return e.mode===LE.PRESET_LAYOUT&&(i.forEach((function(e){if(e.userId===OE.REMOTE){var n=C(t.values()).find((function(e){return!e.isUsed}));n&&(e.userId=n.remoteStream.getUserId(),e.streamType=n.remoteStream.getType()===jS?1:0,n.isUsed=!0)}})),i=i.filter((function(e){return e.userId!==OE.REMOTE}))),i}},{key:"getOutputParam",value:function(e){var t=e.streamId||"";return{streamId:t,streamType:t.length>0?1:0,width:gD(e.videoWidth)?640:e.videoWidth,height:gD(e.videoHeight)?480:e.videoHeight,videoBps:e.videoBitrate||0,fps:e.videoFramerate||15,gop:e.videoGOP||2,audioSampleRate:e.audioSampleRate||48e3,audioBps:e.audioBitrate||64,audioChannels:e.audioChannels||1,backgroundColor:e.backgroundColor||0,backgroundImg:e.backgroundImage||"",extraInfo:"",videoCodec:2,audioCodec:0}}},{key:"hasAvailablePlaceHolder",value:function(){return!!this.isPresetLayoutMode&&this.data_.inputParam.length!==this.config_.mixUsers.length}},{key:"resetIsUsedFlag",value:function(){this.remoteStreamMap_.forEach((function(e){return e.isUsed=!1}))}}]),e}(),GW=function(){function e(t){s(this,e),this.client_=t.client,this.signalChannel_=t.signalChannel,this.publishTencentMainStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1},this.publishTencentAuxStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1},this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1}var t,n,r,o,c,l;return u(e,[{key:"setSignalChannel",value:function(e){this.signalChannel_=e.signalChannel}},{key:"getIsPublishingTencentCDN",value:function(){return this.publishTencentMainStreamObj_.isPublishing_||this.publishTencentAuxStreamObj_.isPublishing_}},{key:"getIsPublishingGivenCDN",value:function(){return this.isPublishingGivenCDN_}},{key:"generatePublishCDNStreamId",value:function(e,t){if(!e){var n="".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_").concat(t);return/^[A-Za-z\d_-]*$/.test(n)||(n=PW(n)),"".concat(this.client_.getSDKAppId(),"_").concat(n)}return e}},{key:"generatePublishCDNSessionId",value:function(e){return PW("".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_").concat(e))}},{key:"startPublishTencentCDN",value:(l=a(i().mark((function e(t){var n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.streamType===qC?(this.publishTencentAuxStreamObj_.params_=t,this.publishTencentAuxStreamObj_.isPublishing_=!0):(this.publishTencentMainStreamObj_.params_=t,this.publishTencentMainStreamObj_.isPublishing_=!0),this.client_.isJoined_){e.next=3;break}return e.abrupt("return");case 3:return n=this.generatePublishCDNStreamId(t.streamId,t.streamType),r=this.generatePublishCDNSessionId(t.streamType),o=t.streamType===qC?1:0,a={requestTime:Date.now(),sessionId:r,streamId:n,streamType:o},e.next=9,this.doStartPublishTencentCDN(a,t.streamType);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"doStartPublishTencentCDN",value:(c=a(i().mark((function e(t,n){var r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,UA.info("startPublishTencentCDN: "+JSON.stringify(t)),e.next=4,this.signalChannel_.sendWaitForResponseWithRetry({command:lL,data:t,timeout:2e3,responseCommand:QR.START_PUBLISH_TENCENT_CDN_RES,commandDesc:"startPublishCDNStream",retries:2});case 4:if(r=e.sent,o=r.data,a=o.code,s=o.message,0!==a){e.next=10;break}n===qC?this.publishTencentAuxStreamObj_.streamId_=t.streamId:this.publishTencentMainStreamObj_.streamId_=t.streamId,e.next=14;break;case 10:throw n===qC?this.publishTencentAuxStreamObj_.isPublishing_=!1:this.publishTencentMainStreamObj_.isPublishing_=!1,-102083===a&&(s="Please enable relayed-push in ".concat(cb," and try later, refer to ").concat(lb,"tutorial-26-advanced-publish-cdn-stream.html")),UA.error("startPublishTencentCDN failed, errCode: ".concat(a,", errMsg: ").concat(s)),new IL({code:yL.START_PUBLISH_CDN_FAILED,message:aD({key:yM,data:{message:s},link:{className:"Client",fnName:"startPublishCDNStream"}})});case 14:e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(0),n===qC?this.publishTencentAuxStreamObj_.isPublishing_=!1:this.publishTencentMainStreamObj_.isPublishing_=!1,e.t0;case 20:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e,t){return c.apply(this,arguments)})},{key:"resetPublishTencentParam",value:function(e){e===rS&&(this.publishTencentMainStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1}),e===qC&&(this.publishTencentAuxStreamObj_={params_:null,streamId_:void 0,isPublishing_:!1})}},{key:"stopPublishTencentCDN",value:(o=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client_.isJoined_){e.next=4;break}return this.resetPublishTencentParam(rS),this.resetPublishTencentParam(qC),e.abrupt("return");case 4:if(!this.publishTencentMainStreamObj_.isPublishing_){e.next=7;break}return e.next=7,this.doStopPublishTencentCDN(rS);case 7:if(!this.publishTencentAuxStreamObj_.isPublishing_){e.next=10;break}return e.next=10,this.doStopPublishTencentCDN(qC);case 10:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"doStopPublishTencentCDN",value:(r=a(i().mark((function e(t){var n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={requestTime:Date.now(),sessionId:PW("".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_").concat(t))},UA.info("stopPublishTencentCDN: "+JSON.stringify(n)),e.next=4,this.signalChannel_.sendWaitForResponse({command:dL,data:n,timeout:5e3,responseCommand:QR.STOP_PUBLISH_TENCENT_CDN_RES,commandDesc:"stopPublishCDNStream"});case 4:if(r=e.sent,o=r.data,a=o.code,s=o.message,0!==a){e.next=10;break}this.resetPublishTencentParam(t),e.next=17;break;case 10:if(-102069!==a){e.next=15;break}UA.warn("stopPublishTencentCDN failed, can not stopPublishTencentCDN in auto relayed-push mode"),this.resetPublishTencentParam(t),e.next=17;break;case 15:throw UA.error("stopPublishTencentCDN failed, errCode: ".concat(a," errMsg: ").concat(s)),new IL({code:yL.STOP_PUBLISH_CDN_FAILED,message:aD({key:IM,data:{message:s},link:{className:"Client",fnName:"stopPublishCDNStream"}})});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"startPublishGivenCDN",value:(n=a(i().mark((function e(t){var n,r,o,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.streamType===rS?this.publishTencentMainStreamObj_.streamId_:this.publishTencentAuxStreamObj_.streamId_,r={pushRequestTime:Date.now(),pushAppId:t.appId,pushBizId:t.bizId,pushCdnUrl:t.url,pushStreamType:t.streamType,pushStreamId:n},UA.info("startPublishGivenCDN: "+JSON.stringify(r)),this.publishGivenCDNData_=r,this.isPublishingGivenCDN_=!0,this.client_.isJoined_){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,this.signalChannel_.sendWaitForResponse({command:hL,data:r,timeout:5e3,responseCommand:QR.START_PUBLISH_GIVEN_CDN_RES,commandDesc:"startPublishCDNStream"});case 10:if(o=e.sent,a=o.data,s=a.code,c=a.message,0===s){e.next=17;break}throw UA.error("startPublishGivenCDN failed, errCode: ".concat(s,", errMsg: ").concat(c)),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,new IL({code:yL.START_PUBLISH_CDN_FAILED,message:aD({key:yM,data:{message:c},link:{className:"Client",fnName:"startPublishCDNStream"}})});case 17:e.next=24;break;case 19:throw e.prev=19,e.t0=e.catch(7),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,e.t0;case 24:case"end":return e.stop()}}),e,this,[[7,19]])}))),function(e){return n.apply(this,arguments)})},{key:"stopPublishGivenCDN",value:(t=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client_.isJoined_){e.next=4;break}return this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,e.abrupt("return");case 4:return t=this.publishGivenCDNData_,n=t.pushAppId,r=t.pushBizId,o=t.pushCdnUrl,a=t.pushStreamType,s={pushRequestTime:Date.now(),pushAppId:n,pushBizId:r,pushCdnUrl:o,pushStreamType:a},UA.info("stopPublishGivenCDN: "+JSON.stringify(s)),e.next=9,this.signalChannel_.sendWaitForResponse({command:pL,data:s,timeout:5e3,responseCommand:QR.STOP_PUBLISH_GIVEN_CDN_RES,commandDesc:"stopPublishCDNStream"});case 9:if(c=e.sent,u=c.data,l=u.code,d=u.message,0!==l){e.next=16;break}this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,e.next=18;break;case 16:throw UA.error("stopPublishGivenCDN failed, errCode: ".concat(l," errMsg: ").concat(d)),new IL({code:yL.STOP_PUBLISH_CDN_FAILED,message:aD({key:IM,data:{message:d},link:{className:"Client",fnName:"stopPublishCDNStream"}})});case 18:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleCDNConfigForJoinData",value:function(e){var t,n=e;if(this.publishTencentMainStreamObj_.isPublishing_||this.publishTencentAuxStreamObj_.isPublishing_){var i={};_D(n)&&(i=JSON.parse(n)),i.Str_uc_params||(i.Str_uc_params={}),this.publishTencentMainStreamObj_.isPublishing_&&(this.publishTencentMainStreamObj_.streamId_?i.Str_uc_params.userdefine_streamid_main=this.publishTencentMainStreamObj_.streamId_:this.publishTencentMainStreamObj_.params_&&(i.Str_uc_params.userdefine_streamid_main=this.generatePublishCDNStreamId(this.publishTencentMainStreamObj_.params_.streamId,rS))),this.publishTencentAuxStreamObj_.isPublishing_&&(this.publishTencentAuxStreamObj_.streamId_?i.Str_uc_params.userdefine_streamid_aux=this.publishTencentAuxStreamObj_.streamId_:this.publishTencentAuxStreamObj_.params_&&(i.Str_uc_params.userdefine_streamid_aux=this.generatePublishCDNStreamId(this.publishTencentAuxStreamObj_.params_.streamId,qC))),n=JSON.stringify(i)}if(this.isPublishingGivenCDN_){var r=this.publishGivenCDNData_,o=r.pushAppId,a=r.pushBizId,s=r.pushCdnUrl,c=r.pushStreamType,u=r.pushStreamId;t={pushRequestTime:Date.now(),pushAppId:o,pushBizId:a,pushCdnUrl:s,pushStreamType:c,pushStreamId:u}}return{bussinessInfo:n,pushUserCdnInfo:t}}},{key:"reset",value:function(){this.resetPublishTencentParam(rS),this.resetPublishTencentParam(qC),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1}}]),e}(),VW=function(){function e(t){s(this,e),this.client_=t.client,this.durationMap_=new Map,this.installEvents()}return u(e,[{key:"installEvents",value:function(){VD.on(lA,this.handleSubscribed,this),VD.on(sA,this.handleStreamTrackUpdated,this),VD.on(dA,this.handleStreamStopped,this),VD.on(pA,this.handleStreamStopped,this)}},{key:"uninstallEvents",value:function(){VD.off(lA,this.handleSubscribed,this),VD.off(sA,this.handleStreamTrackUpdated,this),VD.off(dA,this.handleStreamStopped,this),VD.off(pA,this.handleStreamStopped,this)}},{key:"handleSubscribed",value:function(e){var t=e.client,n=e.stream;if(t===this.client_){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r);if(n.hasAudio())if(n.isMainAudioSubscribed){var a=new LW,s=this.durationMap_.get(o);s?this.isRecording(s.audio)||s.audio.push(a):this.durationMap_.set(o,{userId:i,type:r,audio:[a],video:[]})}else this.stopDurationItem(o,UC);if(n.hasVideo())if(r===BS&&n.isMainVideoSubscribed||r===jS&&n.isAuxVideoSubscribed){var c=new LW,u=this.durationMap_.get(o);u?this.isRecording(u.video)||u.video.push(c):this.durationMap_.set(o,{userId:i,type:r,audio:[],video:[c]})}else this.stopDurationItem(o,GC)}}},{key:"handleStreamStopped",value:function(e){var t=e.client,n=e.stream;if(this.clientHitTest(t)){var i=n.getUserId(),r=n.getType(),o="".concat(i,"_").concat(r);this.stopDurationItem(o,UC),this.stopDurationItem(o,GC)}}},{key:"handleStreamTrackUpdated",value:function(e){var t=e.client,n=e.userId,i=e.tinyId,r=e.kind,o=e.action;if(this.clientHitTest(t)&&this.client_.getConnections().has(i)){var a=r===jC?r:BS,s="".concat(n,"_").concat(a);if(o===FE.ADD){var c=this.client_.getConnections().get(i).getSubscribeState();if(r===UC&&!c.audio||r===GC&&!c.video||r===jC&&!c.auxiliary)return;var u=new LW,l=this.durationMap_.get(s);l?(r!==UC||this.isRecording(l.audio)||l.audio.push(u),r===UC||this.isRecording(l.video)||l.video.push(u)):this.durationMap_.set(s,{userId:n,type:a,audio:r===UC?[u]:[],video:r===UC?[]:[u]})}else this.stopDurationItem(s,r===UC?UC:GC)}}},{key:"isRecording",value:function(e){return e.findIndex((function(e){return 0===e.endTime}))>=0}},{key:"stopDurationItem",value:function(e,t){if(this.durationMap_.has(e)){var n=this.durationMap_.get(e)[t].find((function(e){return 0===e.endTime}));n&&n.stop()}}},{key:"clientHitTest",value:function(e){return this.client_===e}},{key:"getDuration",value:function(e,t){return this.durationMap_.has(e)?this.durationMap_.get(e)[t].reduce((function(e,t){return e+t.getDuration()}),0):0}},{key:"getDurationMap",value:function(){return this.durationMap_}},{key:"reset",value:function(){this.durationMap_.clear()}},{key:"destroy",value:function(){this.client_=null,this.uninstallEvents()}}]),e}();function FW(){return function(e,t,n){var r=n.value,o=new Set;return n.value=a(i().mark((function e(){var n,a,s,c,u=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.has(this)){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:Lb,data:{name:t}})});case 2:for(e.prev=2,o.add(this),n=u.length,a=new Array(n),s=0;s<n;s++)a[s]=u[s];return e.next=7,r.apply(this,a);case 7:return c=e.sent,o.delete(this),e.abrupt("return",c);case 12:throw e.prev=12,e.t0=e.catch(2),o.delete(this),e.t0;case 16:case"end":return e.stop()}}),e,this,[[2,12]])}))),n}}function BW(e){return jW.apply(this,arguments)}function jW(){return jW=a(i().mark((function e(t){var n,r,o,a,s,c,u,l,d,h,p,f,g;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userId,r=t.sdkAppId,o=t.useStringRoomId,a=t.roomId,s=t.userSig,c={delta:0,count:[1,1],msg:[]},e.prev=2,(u=new FormData).append("userId",String(n)),u.append("sdkAppId",String(r)),u.append("isStrGroupId",o),u.append("groupId",String(a)),u.append("sdkVersion",Ko),u.append("userSig",String(s)),QE&&u.append("oversea",!0),l=ED(),e.next=14,WW(u,c,r);case 14:return d=e.sent,c.delta=ED()-l,qW({stat:c,userId:n}),e.abrupt("return",d);case 20:throw e.prev=20,e.t0=e.catch(2),h=ID(e.t0)?e.t0[0]:e.t0,p=vD(h.code)?h.code:0,f="get websocket url failed: ".concat(h.message.includes("timeout")?"timeout":h.message),g=new IL({code:yL.SCHEDULE_FAILED,extraCode:p,message:aD({key:tM,data:{error:f,code:p}})}),UA.error(g),qW({stat:c,userId:n,roomId:a,error:g}),g;case 29:case"end":return e.stop()}}),e,null,[[2,20]])}))),jW.apply(this,arguments)}function qW(e){var t=e.stat,n=e.userId,i=e.error;i?uO.logFailedEvent({eventType:kE,error:i,userId:n}):uO.logSuccessEvent({eventType:kE,delta:t.delta,userId:n}),uO.uploadEvent({log:"stat-schedule:"+JSON.stringify(t),userId:n})}function HW(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rS;return t=QE||(cD(e)?n===rS?ZE:XE:n===rS?YE:JE),"https://".concat(t,"/api/v1/config")}function zW(e,t,n){return new Promise((function(i,r){PD({url:e,body:t,timeout:n.timeout}).then((function(e){0===e.data.code?i(e.data.data):r({code:e.data.code,message:e.data.msg})})).catch(r)}))}var KW=function(e,t){return LA({retryFunction:zW,settings:{retries:3,timeout:0},onError:t,onRetrying:e})};function WW(e,t,n){return new Promise((function(i,r){var o,a=null;(o=[KW((function(e){return t.count[0]=e+1}),(function(e,n){t.msg[0]=e.message,a||n()}))(HW(n,rS),e,{get timeout(){return 1e3*hD(2+t.count[0])}}),KW((function(e){return t.count[1]=e+1}),(function(e,n){t.msg[1]=e.message,a||n()}))(HW(n,oS),e,{get timeout(){return 1e3*hD(2+t.count[1])}})],new Promise((function(e,t){var n=[];o.forEach((function(i){i.then(e).catch((function(e){n.push(e),n.length===o.length&&t(n)}))}))}))).then((function(e){i(a=e)})).catch(r)}))}var YW,JW,ZW,XW,QW,$W,eY,tY,nY,iY,rY,oY,aY,sY,cY,uY,lY,dY,hY,pY,fY,gY,_Y,vY,mY,yY,IY,TY,CY,SY,EY,bY,MY,kY,wY,DY,AY,RY,LY,OY,NY,xY,PY=function(){function e(){s(this,e)}return u(e,[{key:"call",value:function(e,t){return fD(this[e])?this[e](t):Promise.reject(new IL({code:yL.INVALID_PARAMETER,message:aD({key:Sk,data:{name:e}})}))}},{key:"updatePrivateMapKey",value:function(e){var t=e.privateMapKey;return e.client.setProperty("privateMapKey",t),Promise.resolve()}}]),e}(),UY=new PY,GY=(YW=FW(),JW=Dz(kz.CLIENT.join),ZW=FW(),XW=Gz({retries:3}),QW=FW(),$W=Dz.apply(void 0,C(kz.CLIENT.publish)),eY=Yz(tb),tY=FW(),nY=Dz(kz.CLIENT.unpublish),iY=Dz.apply(void 0,C(kz.CLIENT.subscribe)),rY=Dz(kz.CLIENT.unsubscribe),oY=FW(),aY=Dz(kz.CLIENT.switchRole),sY=Yz(tb),cY=Dz(kz.CLIENT.startPublishCDNStream),uY=Yz(tb),lY=Yz(tb),dY=Dz(kz.CLIENT.startMixTranscode),hY=Yz(tb),pY=Yz(tb),fY=Yz(tb),gY=Yz(tb),_Y=Yz(tb),vY=Yz(tb),mY=Yz(tb),yY=wz.apply(void 0,C(kz.CLIENT.sendSEIMessage)),IY=Yz(tb),bY={timesInSecond:30,maxSizeInSecond:8e3,getSize:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0].byteLength}},MY=bY.timesInSecond,kY=bY.maxSizeInSecond,wY=bY.getSize,TY=function(e,t,n){var i=n.value,r=new Map;return VD.on(eA,(function(e){var t=e.client;return r.delete(t)})),n.value=function(){var e=r.get(this);e||(e={callCountInSecond:0,timestamp:0,totalSizeInSecond:0},r.set(this,e)),0===e.timestamp?e.timestamp=Date.now():Date.now()-e.timestamp>1e3&&(e.timestamp=Date.now(),e.callCountInSecond=0,e.totalSizeInSecond=0);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];if(wY&&(e.totalSizeInSecond+=wY.apply(void 0,o)),0!==e.timestamp&&Date.now()-e.timestamp<1e3&&(e.callCountInSecond>=MY||e.totalSizeInSecond>kY))throw new IL({code:yL.INVALID_OPERATION,message:aD({key:Lk,data:{isTimes:e.callCountInSecond>=MY,isSize:e.totalSizeInSecond>kY,name:t,timesInSecond:MY,maxSizeInSecond:kY}})});return e.callCountInSecond++,i.apply(this,o)},n},CY=Yz(tb),SY=Yz(tb),EY=function(){function e(t){var n,i;s(this,e),this.name_=tb,this.mode_=t.mode,this.sdpSemantics_=RE,gD(t.sdpSemantics)?function(){var e;if(gD(window.RTCRtpTransceiver))return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=null,n=!1;try{(t=new RTCPeerConnection({sdpSemantics:AE})).addTransceiver(UC),n=!0}catch(qY){}return null===(e=t)||void 0===e||e.close(),n}()&&(this.sdpSemantics_=AE):this.sdpSemantics_=t.sdpSemantics,this.sdkAppId_=t.sdkAppId,this.userId_=t.userId,this.log_=UA.createLogger({id:"c".concat(t.seq,"|").concat(this.userId_),userId:this.userId_,sdkAppId:this.sdkAppId_}),this.userSig_=t.userSig,this.roomId_=0,this.useStringRoomId_=t.useStringRoomId||!1,this.pureAudioPushMode_=null,this.version_=t.version,this.log_.info("using sdpSemantics: "+this.sdpSemantics_),this.signalChannel_=null,this.role_=PS,this.privateMapKey_="",this.tinyId_=0,this.env_="",this.proxy_=null,this.unifiedProxy_=null,this.connections_=new Map,this.mutedStates_=new Map,this.userMap_=new Map,this.syncUserListInterval_=-1,this.localStream_=null,this.localAuxStream_=null,this.uplinkConnection_=null,this.emitter_=OD(new GD,this.name_),this.isJoined_=!1,this.heartbeat_=-1,this.lastHeartBeatTime_=-1,this.stats_=new KN(this),this.joinTimeout_=-1,this.changeBigSmallRecords_=new Map,this.networkQuality_=null,this.badCaseDetector_=null,this.networkType_=lD(),this.autoSubscribe_=!!gD(t.autoSubscribe)||t.autoSubscribe,this.joinedTimestamp_=0,this.joinOptions_={},this.basis_=(i={browser:iD().name+"/"+iD().version,os:DN(),displayResolution:AN(),isScreenShareSupported:vN(),isWebRTCSupported:sN(),isGetUserMediaSupported:RN(),isWebAudioSupported:LN(),isWebSocketsSupported:"WebSocket"in window&&2===window.WebSocket.CLOSING,isWebCodecSupported:(n={AudioDecoder:!1,AudioEncoder:!1,VideoDecoder:!1,VideoEncoder:!1,ImageDecoder:!1},gD(window.AudioDecoder)||(n.AudioDecoder=!0),gD(window.AudioEncoder)||(n.AudioEncoder=!0),gD(window.VideoDecoder)||(n.VideoDecoder=!0),gD(window.VideoEncoder)||(n.VideoEncoder=!0),gD(window.ImageDecoder)||(n.ImageDecoder=!0),n),isMediaSessionSupported:"mediaSession"in navigator&&!gD(navigator.mediaSession.setActionHandler),isWebTransportSupported:!gD(window.WebTransport)},navigator.userAgent.includes("miniProgram")&&(i.browser="mini/".concat(i.browser)),i),this.initBussinessInfo_(t),this.publishedCDN_=!1,this.publishCDNData_=null,this.mixedMCU_=!1,this.mixTranscodeData_=null,this.checkSystemResult_=null,this.enableAudioVolumeEvaluation_=!1,this.audioVolumeIntervalId_=null,this.mixTranscodeManager_=null,this.publishCDNManager_=new GW({client:this}),this.keyPointManager_=new Kz({client:this,frameWorkType:t.frameWorkType,component:t.component}),this.isPublishing_=!1,this.isEnableSmallStream_=!1,this.smallStreamConfig_={bitrate:100,frameRate:15,height:120,width:160},this.turnServers_=[],this.iceTransportPolicy_=t.iceTransportPolicy,this.schedule_={domains:null,iceServers:null,iceTransportPolicy:null,trtcCapability:null},this.enableAutoPlayDialog_=!!gD(t.enableAutoPlayDialog)||t.enableAutoPlayDialog,this.enableMultiAuxStream_=!gD(t.enableMultiAuxStream)&&t.enableMultiAuxStream,this.signalInfo_={},this.enableSEI_=!gD(t.enableSEI)&&t.enableSEI,this.isDestroyed_=!1}var n,r,o,c,l,d,h,p,f,g,_,v,m,y,I,S,E,M,k,w,D,A,R,L,O,N,x;return u(e,[{key:"initBussinessInfo_",value:function(e){this.bussinessInfo_=e.bussinessInfo;var t={};if(_D(e.bussinessInfo)&&(t=JSON.parse(e.bussinessInfo)),!gD(e.pureAudioPushMode)){if(!Number.isInteger(Number(e.pureAudioPushMode)))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Kb})});this.pureAudioPushMode_=e.pureAudioPushMode,t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.pure_audio_push_mod=this.pureAudioPushMode_}if(!gD(e.streamId)){if(!(_D(e.streamId)&&String(e.streamId)&&String(e.streamId).length<=64))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Wb})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_streamid_main=e.streamId}if(!gD(e.userDefineRecordId)){if(null===e.userDefineRecordId.match(/^[A-Za-z0-9_-]{1,64}$/gi))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Yb})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_record_id=e.userDefineRecordId}if(!gD(e.userDefinePushArgs)){if(!(_D(e.userDefinePushArgs)&&String(e.userDefinePushArgs)&&String(e.userDefinePushArgs).length<=256))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Jb})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_push_args=e.userDefinePushArgs}sO(t)||(this.bussinessInfo_=JSON.stringify(t))}},{key:"schedule",value:(x=a(i().mark((function e(n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,BW({userId:this.userId_,sdkAppId:this.sdkAppId_,roomId:n,useStringRoomId:this.useStringRoomId_,version:this.version_,userSig:this.userSig_});case 2:(r=e.sent)&&(this.log_.info("schedule: ".concat(JSON.stringify(r))),r.trtcCapability=null==r?void 0:r.trtcAutoConf,this.schedule_=t(t({},this.schedule_),r),VD.emit(tA,this.schedule_));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"getSignalChannelUrl",value:function(){var e={mainUrl:"",backupUrl:""},t=sD();return t?e.mainUrl=e.backupUrl="wss://".concat(t,".rtc.qq.com"):this.proxy_?e.mainUrl=e.backupUrl=this.proxy_:this.unifiedProxy_?e.mainUrl=e.backupUrl="wss://".concat(this.unifiedProxy_):Array.isArray(this.schedule_.domains)&&this.schedule_.domains.length>0&&(e.mainUrl=e.backupUrl="wss://".concat(this.schedule_.domains[0]),this.schedule_.domains[1]&&(e.backupUrl="wss://".concat(this.schedule_.domains[1]))),e}},{key:"getUserId",value:function(){return this.userId_}},{key:"getUserSig",value:function(){return this.userSig_}},{key:"getRole",value:function(){return this.role_}},{key:"getSignalInfo",value:function(){return this.signalInfo_}},{key:"getRoomId",value:function(){return this.roomId_}},{key:"getSDKAppId",value:function(){return this.sdkAppId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"getIceTransportPolicy",value:function(){return this.iceTransportPolicy_||this.schedule_.iceTransportPolicy||"all"}},{key:"initialize",value:function(e){var t=this;this.log_.info("setup signal channel");var n=this.getSignalChannelUrl(),i=n.mainUrl,r=n.backupUrl;return this.signalChannel_=new lO({sdkAppId:this.sdkAppId_,userId:this.userId_,userSig:this.userSig_,roomId:e.roomId,url:i,backupUrl:r,signalDomainWhenUnifiedProxy:this.unifiedProxy_?this.schedule_.domains[0]:void 0,client:this}),this.networkQuality_||(this.networkQuality_=new WN({connections:this.connections_,signalChannel:this.signalChannel_,userId:this.userId_,client:this}),this.networkQuality_.on(GN.NETWORK_QUALITY,(function(e){t.emitter_.emit(GN.NETWORK_QUALITY,e)}))),this.deviceDetector_||(this.deviceDetector_=new YN({client:this})),this.subscriptionManager_||(this.subscriptionManager_=new Xz({client:this})),this.badCaseDetector_||(this.badCaseDetector_=new OW({client:this,stats:this.stats_})),this.callDurationCalculator_||(this.callDurationCalculator_=new VW({client:this})),this.mixTranscodeManager_||(this.mixTranscodeManager_=new UW({client:this,signalChannel:this.signalChannel_})),this.publishCDNManager_&&this.publishCDNManager_.setSignalChannel({signalChannel:this.signalChannel_}),this.signalChannel_.on(qR,(function(e){t.log_.info("SignalChannel state changed from ".concat(e.prevState," to ").concat(e.state)),t.emitter_.emit(GN.CONNECTION_STATE_CHANGED,e)})),this.signalChannel_.on(zR,(function(e){t.reset(),t.emitter_.emit(GN.ERROR,e)})),this.signalChannel_.once(BR,(function(e){t.tinyId_=e.signalInfo.tinyId,VD.emit(QD,{client:t})})),this.signalChannel_.on(QR.PEER_JOIN,this.onPeerJoin,this),this.signalChannel_.on(QR.PEER_LEAVE,this.onPeerLeave,this),this.signalChannel_.on(QR.UPDATE_REMOTE_MUTE_STAT,(function(e){Date.now()-t.lastHeartBeatTime_>=1e4&&t.doHeartbeat(),VD.emit(JD,{client:t,data:e.data}),t.onPublishedUserList(e.data),t.onUpdateRemoteMuteStat(e.data)})),this.signalChannel_.on(QR.CLIENT_BANNED,(function(e){var n,i=e.data.data.reason;if(uO.uploadEvent({log:"stat-banned:".concat(i),userId:t.userId_}),i===aS)n="you got banned by the admin";else if(i===sS)n="duplicated userId joining the room";else if(i===uS)n="the room has been disbanded by the admin",i=i.replace("_","-");else if(i===cS)return t.log_.warn("".concat(i," last heart beat time: ").concat(t.lastHeartBeatTime_," interval: ").concat(Date.now()-t.lastHeartBeatTime_,", visibility: ").concat(document.visibilityState)),void t.reJoin();t.log_["kick"===i?"error":"info"]("user was banned because of [".concat(i,"]")),t.reset(),t.emitter_.emit(GN.CLIENT_BANNED,{reason:i,message:aD({key:gM,data:{message:n,reason:i}})||i})})),VD.emit(XD,{client:this}),this.signalChannel_.connect()}},{key:"preJoin",value:(N=a(i().mark((function e(t){var n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.joinOptions_=t,e.next=3,fN();case 3:if(this.checkSystemResult_=e.sent,this.checkDestroy(),(n=sD())||(n=SS,this.proxy_&&(this.proxy_.startsWith(TS)?n=ES:this.proxy_.startsWith(CS)&&(n=bS))),this.env_=n,uO.setConfig({env:n,sdkAppId:this.sdkAppId_,userId:this.userId_,roomId:t.roomId}),this.uploadTrtcStats(),r=this.checkSystemResult_.detail,o=r.isH264EncodeSupported,a=r.isVp8EncodeSupported,sN()&&(o||a)){e.next=13;break}throw new IL({code:yL.NOT_SUPPORTED,message:aD({key:dk})});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"join",value:(O=a(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomId_=t.roomId,gD(t.role)||(this.role_=t.role),gD(t.privateMapKey)||(this.privateMapKey_=t.privateMapKey),n=ED(),VD.emit(FD,{client:this}),rO(this.userId_,{eventId:FL,eventDesc:"joining room",timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_}),e.next=8,this.preJoin(t);case 8:return e.abrupt("return",new Promise(function(){var e=a(i().mark((function e(o,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.joinReject_=a,e.prev=1,r.proxy_||r.schedule_.domains){e.next=5;break}return e.next=5,r.schedule(t.roomId);case 5:return r.checkDestroy(),e.next=8,r.initialize(t);case 8:return e.next=10,r.doJoin(t);case 10:r.signalInfo_=r.signalChannel_.getSignalInfo(),VD.emit(qD,{client:r}),r.joinedTimestamp_=ED(),uO.logSuccessEvent({userId:r.userId_,eventType:iE,delta:r.joinedTimestamp_-n}),uO.logSuccessEvent({userId:r.userId_,eventType:nE}),uO.uploadEvent({log:"stat-autoplay-dialog:".concat(r.enableAutoPlayDialog_),userId:r.userId_}),uO.uploadEvent({log:"stat-conv-".concat(eD,"-").concat(location.hostname),userId:r.userId_}),o(),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(1),VD.emit(HD,{client:r,error:e.t0}),uO.logFailedEvent({userId:r.userId_,eventType:nE,error:e.t0}),r.reset(),a(e.t0);case 26:r.joinReject_=null;case 27:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(t,n){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"checkDestroy",value:function(){if(this.isDestroyed_)throw new IL({code:yL.INVALID_OPERATION,message:aD({key:KM,data:{funName:"join"}})})}},{key:"uploadTrtcStats",value:(L=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d,h,p,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jY.getMicrophones();case 3:r=e.sent,t=r&&r.length,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:return e.prev=9,e.next=12,jY.getCameras();case 12:o=e.sent,n=o&&o.length,e.next=18;break;case 16:e.prev=16,e.t1=e.catch(9);case 18:a={microphone:t,camera:n},s=this.checkSystemResult_.detail,c=s.isH264EncodeSupported,u=s.isVp8EncodeSupported,l=s.isH264DecodeSupported,d=s.isVp8DecodeSupported,h={webRTC:this.basis_.isWebRTCSupported,getUserMedia:this.basis_.isGetUserMediaSupported,webSocket:this.basis_.isWebSocketsSupported,screenShare:this.basis_.isScreenShareSupported,webAudio:this.basis_.isWebAudioSupported,h264Encode:c,h264Decode:l,vp8Encode:u,vp8Decode:d},p={browser:this.basis_.browser,os:this.basis_.os,trtc:h,devices:a},f={isWebCodecSupported:this.basis_.isWebCodecSupported,isMediaSessionSupported:this.basis_.isMediaSessionSupported,isWebTransportSupported:this.basis_.isWebTransportSupported},uO.uploadEvent({log:"trtcstats-"+JSON.stringify(p),userId:this.userId_}),this.log_.info("TrtcStats-"+JSON.stringify(p)),uO.uploadEvent({log:"trtcadvancedstats-"+JSON.stringify(f),userId:this.userId_});case 26:case"end":return e.stop()}}),e,this,[[0,7],[9,16]])}))),function(){return L.apply(this,arguments)})},{key:"doJoin",value:function(e){var t=this;return new Promise((function(e,n){t.log_.info("Join() => joining room: ".concat(t.roomId_," useStringRoomId: ").concat(t.useStringRoomId_," mode: ").concat(t.mode_," role: ").concat(t.role_));var i={roomId:String(t.roomId_),useStringRoomId:t.useStringRoomId_,privateMapKey:t.privateMapKey_,trtcRole:t.role_===PS?NS:xS,trtcScene:t.mode_===OS?LS:RS,sdpSemantics:t.sdpSemantics_,version:xD(t.version_),ua:navigator&&navigator.userAgent||"",autoSubscribe:t.autoSubscribe_,terminalType:$k?4:Zk?2:Yk?3:Mw?12:bw?5:kw?13:1,netType:BE[lD()],bussinessInfo:t.bussinessInfo_,receiveMix:!0};if(t.publishCDNManager_){var r=t.publishCDNManager_.handleCDNConfigForJoinData(t.bussinessInfo_),o=r.bussinessInfo,a=r.pushUserCdnInfo;Object.assign(i,{bussinessInfo:o,pushUserCdnInfo:a})}t.log_.debug("join room signal data: ".concat(JSON.stringify(i))),t.joinTimeout_=setTimeout((function(){t.log_.error("join room timeout observed"),n(new IL({code:yL.JOIN_ROOM_FAILED,message:aD({key:eM})}))}),5e3),VD.emit(BD,{client:t}),t.signalChannel_.once(jR,(function(e){t.clearJoinTimeout(),VD.emit(QD,{client:t,error:e}),n(e)})),t.signalChannel_.send(tL,i),t.signalChannel_.once(QR.JOIN_ROOM_RESULT,(function(i){t.clearJoinTimeout();var r=i.data,o=r.code,a=r.message,s=r.data;t.onPublishedUserList({data:{userList:s.publishers}}),VD.emit(jD,{client:t,code:o}),0===o?(t.isJoined_=!0,t.log_.info("Join room success, start heartbeat"),t.startHeartbeat(),t.badCaseDetector_&&t.badCaseDetector_.start(),t.syncUserList(),t.startSyncUserListInterval(),e()):(t.log_.error("Join room failed result: "+o+" error: "+a),n(new IL({code:yL.JOIN_ROOM_FAILED,extraCode:o,message:aD({key:tM,data:{error:a,code:o}})})))}))}))}},{key:"reJoin",value:(R=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_){e.next=3;break}return this.log_.warn("reJoin abort"),e.abrupt("return");case 3:return this.isJoined_=!1,e.prev=4,this.log_.warn("reJoin pending: ".concat(this.joinOptions_.roomId)),this.subscriptionManager_&&this.subscriptionManager_.markAllStream(),this.signalChannel_.close(),e.next=10,this.signalChannel_.connect();case 10:return e.next=12,this.doJoin(t(t({},this.joinOptions_),{},{role:this.role_,privateMapKey:this.privateMapKey_}));case 12:this.log_.warn("reJoin success"),uO.logSuccessEvent({userId:this.userId_,eventType:rE}),this.checkConnectionsToReconnect(),this.uplinkConnection_&&!this.uplinkConnection_.getIsReconnecting()&&this.uplinkConnection_.startReconnection(),this.mixTranscodeManager_&&this.mixTranscodeManager_.reStartMixTranscode(),e.next=25;break;case 19:e.prev=19,e.t0=e.catch(4),this.log_.warn("reJoin fail "+e.t0),this.reset(),uO.logFailedEvent({userId:this.userId_,eventType:rE,error:e.t0}),this.emitter_.emit(GN.ERROR,new IL({code:yL.JOIN_ROOM_FAILED,message:aD({key:nM,data:{roomId:this.joinOptions_.roomId}})}));case 25:case"end":return e.stop()}}),e,this,[[4,19]])}))),function(){return R.apply(this,arguments)})},{key:"leave",value:(A=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return VD.emit(zD,{client:this}),rO(this.userId_,{eventId:BL,eventDesc:"leaving room",timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_}),e.prev=2,e.next=5,this.doHeartbeat();case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:this.doLeave(),VD.emit(WD,{client:this}),uO.logSuccessEvent({userId:this.userId_,eventType:oE}),t=Math.floor((ED()-this.joinedTimestamp_)/1e3),uO.logSuccessEvent({userId:this.userId_,eventType:aE,delta:t});case 14:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(){return A.apply(this,arguments)})},{key:"doLeave",value:function(){this.isJoined_&&(VD.emit(KD,{client:this}),this.log_.info("leave() => leaving room"),this.signalChannel_.send(nL),this.reset())}},{key:"clearNetworkQuality",value:function(){this.networkQuality_&&(this.networkQuality_.stop(),this.networkQuality_=null)}},{key:"closeConnections",value:function(){var e=this;this.connections_.forEach((function(t){e.closeDownLink(t.getTinyId())}))}},{key:"clearJoinTimeout",value:function(){clearTimeout(this.joinTimeout_),this.joinTimeout_=-1}},{key:"destroy",value:function(){var e,t,n;if(this.isJoined_)throw this.log_.warn(Pk.INVALID_DESTROY),new IL({code:yL.INVALID_OPERATION,message:aD({key:iM})});this.isDestroyed_||(this.log_.info("destroy client"),this.joinReject_&&(this.joinReject_(new IL({code:yL.INVALID_OPERATION,message:aD({key:KM,data:{funName:"join"}})})),this.clearJoinTimeout(),this.reset()),this.off("*"),null===(e=this.callDurationCalculator_)||void 0===e||e.destroy(),null===(t=this.keyPointManager_)||void 0===t||t.destroy(),null===(n=this.deviceDetector_)||void 0===n||n.destroy(),this.callDurationCalculator_=null,this.keyPointManager_=null,this.deviceDetector_=null,this.badCaseDetector_=null,this.publishCDNManager_=null,this.isDestroyed_=!0,VD.emit(eA,{client:this}))}},{key:"reset",value:function(){this.isJoined_=!1,this.keyPointManager_&&this.keyPointManager_.prepareReport(),this.mixTranscodeManager_&&(this.mixTranscodeManager_.reset(),this.mixTranscodeManager_=null),this.publishCDNManager_&&this.publishCDNManager_.reset(),this.userMap_.clear(),this.stopSyncUserListInterval(),this.stopHeartbeat(),this.closeConnections(),this.mutedStates_.clear(),this.clearNetworkQuality(),this.badCaseDetector_&&this.callDurationCalculator_&&this.uploadAllCallStats(),this.closeUplink(),this.signalChannel_&&(this.log_.info("destroying SignalChannel"),this.signalChannel_.close(),this.signalChannel_=null),this.stats_.reset()}},{key:"startSyncUserListInterval",value:function(){-1===this.syncUserListInterval_&&(this.syncUserListInterval_=tN.run(mb,this.syncUserList.bind(this)))}},{key:"stopSyncUserListInterval",value:function(){tN.clearTask(this.syncUserListInterval_),this.syncUserListInterval_=-1}},{key:"syncUserList",value:(D=a(i().mark((function e(){var t,n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserList();case 3:t=e.sent,0!==this.userMap_.size&&this.userMap_.forEach((function(e){t.findIndex((function(t){return t.userId===e.userId}))<0&&(n.log_.info("peer leave detected: ".concat(e.userId)),n.cleanUser({userId:e.userId,tinyId:e.tinyId}))})),t.forEach((function(e){var t=e.userId;n.userMap_.has(t)||t===n.userId_||(n.userMap_.set(t,e),n.emitter_.emit(GN.PEER_JOIN,{userId:t}))})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.log_.warn("sync user list failed: "+e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return D.apply(this,arguments)})},{key:"getUserList",value:function(){return this.signalChannel_?this.signalChannel_.sendWaitForResponse({command:_L,responseCommand:QR.USER_LIST_RES,enableLog:!1,timeout:2e3}).then((function(e){var t=e.data,n=t.code,i=t.message;if(0===n)return(t.data&&t.data.userList||[]).map((function(e){var t=e.userId,n=e.srcTinyId,i=e.role;return new NW({userId:t,tinyId:n,role:i})}));throw aD({key:Tk,data:{signalResponse:QR.USER_LIST_RES,code:n,message:i}})})):[]}},{key:"publish",value:(w=a(i().mark((function e(t){var n,r,o,a,s,c,u,l,d=this,h=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:{isAuxiliary:!1},t.setPublishState(qE),this.isPublishing_=!0,r=ED(),VD.emit(ZD,{client:this,stream:t}),o=n.isAuxiliary,a=o?jC:rS,s=t.getScreen(),this.log_.info("publish() => publishing ".concat(s?VC+" ":"").concat(a," stream ").concat(t.getId())),c=this.uplinkConnection_,e.prev=10,c||((c=new DK({userId:this.userId_,tinyId:this.tinyId_,client:this,isUplink:!0,signalChannel:this.signalChannel_,enableSEI:this.enableSEI_})).initialize(),c.on(UN.ERROR,(function(e){var t=e.getCode();t!==yL.ICE_TRANSPORT_ERROR&&(t===yL.UPLINK_RECONNECTION_FAILED&&d.closeUplink(),d.emitter_.emit(GN.ERROR,e))}))),t.setConnection(c),e.next=15,c.publish(t,o);case 15:this.log_.info("local ".concat(s?VC+" ":"").concat(a," stream is published")),this.isPublishing_=!1,o?this.localAuxStream_=t:(this.localStream_=t,this.deviceDetector_&&this.deviceDetector_.setLocalStream(this.localStream_),this.localStream_.getBeautyStatus()&&this.log_.info("beauty stream is published successfully")),t.setPublishState(HE),t.setClient(this,o),this.uplinkConnection_=c,u=ED(),l=u-r,uO.logSuccessEvent({userId:this.userId_,eventType:sE}),uO.logSuccessEvent({userId:this.userId_,eventType:cE,delta:l}),t.hasAudio()&&rO(this.userId_,{eventId:CL,eventDesc:"publish audio track",timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_}),t.hasVideo()&&rO(this.userId_,{eventId:TL,eventDesc:"publish video track",timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_}),this.networkQuality_&&this.networkQuality_.setUplinkConnection(this.uplinkConnection_),VD.emit(fA,{localStream:t,isAuxiliary:o,client:this}),this.notPublishWithoutH264Supported_=!1,t.isAIDenoiser&&Wz.handleFunctionState({fnName:"AI_DENOISER"}),e.next=42;break;case 33:throw e.prev=33,e.t0=e.catch(10),e.t0 instanceof IL&&e.t0.getCode()===yL.NOT_SUPPORTED_H264&&(this.notPublishWithoutH264Supported_=!0),t.setPublishState(jE),c.close(),this.log_.error("failed to publish stream "+e.t0),this.isPublishing_=!1,uO.logFailedEvent({userId:this.userId_,eventType:sE,error:e.t0}),e.t0;case 42:case"end":return e.stop()}}),e,this,[[10,33]])}))),function(e){return w.apply(this,arguments)})},{key:"unpublish",value:(k=a(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uplinkConnection_){e.next=2;break}return e.abrupt("return");case 2:return n=t===this.localAuxStream_,r=t.getScreen(),this.log_.info("unpublish() => unpublishing local ".concat(r?VC+" ":"").concat(n?jC:rS," stream")),e.prev=5,e.next=8,this.uplinkConnection_.unpublish(t);case 8:t.setClient(null),t.setConnection(null),n?this.localAuxStream_=null:(this.localStream_=null,t.hasAudio()&&rO(this.userId_,{eventId:EL,eventDesc:"unpublish audio track",timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_}),t.hasVideo()&&rO(this.userId_,{eventId:SL,eventDesc:"unpublish video track",timestamp:iv(),userId:this.userId_,tinyId:this.tinyId_})),this.localStream_||this.localAuxStream_||this.closeUplink(),uO.logSuccessEvent({userId:this.userId_,eventType:uE}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),uO.logFailedEvent({userId:this.userId_,eventType:uE,error:e.t0}),e.t0;case 19:case"end":return e.stop()}}),e,this,[[5,15]])}))),function(e){return k.apply(this,arguments)})},{key:"closeUplink",value:function(){this.uplinkConnection_&&(this.uplinkConnection_.close(),this.uplinkConnection_=null,this.networkQuality_&&this.networkQuality_.setUplinkConnection(null),this.localStream_&&(this.localStream_.setClient(null),this.localStream_.setConnection(null),this.localStream_=null),this.localAuxStream_&&(this.localAuxStream_.setClient(null),this.localAuxStream_.setConnection(null),this.localAuxStream_=null),this.deviceDetector_&&this.deviceDetector_.setLocalStream(null))}},{key:"closeDownLink",value:function(e){var t=this.connections_.get(e);t&&(t.getIsReconnecting()&&t.stopReconnection(),this.subscriptionManager_&&this.subscriptionManager_.delete(t.getUserId()),t.close(),this.connections_.delete(e),this.mutedStates_.delete(e))}},{key:"subscribe",value:(M=a(i().mark((function e(t,n){var r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log_.info("subscribe() => subscribe to [".concat(t.getUserId(),"] ").concat(t.getType()," stream with options: ").concat(JSON.stringify(n))),gD(n)&&(n={audio:!0,video:!0}),gD(n.audio)&&(n.audio=!0),gD(n.smallVideo)?gD(n.video)&&(n.video=!0):n.smallVideo?gD(n.video)?(n.video=!1,n.smallVideo=!0):n.video&&(n.video=!0,delete n.smallVideo,this.log_.warn("options.video and options.smallVideo can't be both true")):gD(n.video)&&(n.video=!0,delete n.smallVideo),n.video&&this.changeBigSmallRecords_.delete(t.getUserId()),r=t.getConnection(),n.smallVideo&&(r.getTrackState().smallVideo||(this.setRemoteVideoStreamType(t,"small"),n.video=!0,delete n.smallVideo)),e.prev=7,VD.emit(uA,{client:this,stream:t}),e.next=11,r.subscribe(t,n);case 11:this.subscriptionManager_&&this.subscriptionManager_.addSubscriptionRecord(t.getUserId(),t,n),this.notSubscribeWithoutH264Supported_=!1,uO.logSuccessEvent({userId:this.userId_,eventType:lE}),e.next=24;break;case 16:throw e.prev=16,e.t0=e.catch(7),(o=e.t0 instanceof IL?e.t0.getCode():yL.UNKNOWN)===yL.NOT_SUPPORTED_H264&&(this.notSubscribeWithoutH264Supported_=!0),(a=new IL(o===yL.REMOTE_STREAM_NOT_EXIST?{code:yL.API_CALL_ABORTED,message:aD({key:Nk,data:{message:e.t0.message,stream:t}})}:{code:o,message:aD({key:lM,data:{message:e.t0.message,stream:t}})})).getCode()===yL.API_CALL_ABORTED?this.log_.warn(a):this.log_.error(a),uO.logFailedEvent({userId:this.userId_,eventType:lE,error:a}),a;case 24:case"end":return e.stop()}}),e,this,[[7,16]])}))),function(e,t){return M.apply(this,arguments)})},{key:"unsubscribe",value:(E=a(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log_.info("unsubscribe() => unsubscribe to [".concat(t.getUserId(),"] ").concat(t.getType()," stream")),e.prev=1,n=t.getConnection(),e.next=5,n.unsubscribe(t);case 5:this.subscriptionManager_&&this.subscriptionManager_.addUnsubscriptionRecord(t.getUserId(),t),VD.emit(dA,{client:this,stream:t}),uO.logSuccessEvent({userId:this.userId_,eventType:dE}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),uO.logFailedEvent({userId:this.userId_,eventType:dE,error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(e){return E.apply(this,arguments)})},{key:"switchRole",value:(S=a(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.role_!==t){e.next=2;break}return e.abrupt("return");case 2:return t===US&&this.uplinkConnection_&&this.closeUplink(),this.log_.info("switchRole() => switch role to: "+t),e.next=6,this.doSwitchRole(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"doSwitchRole",value:function(e){var t,n,i=this,r={command:vL,data:{role:e===PS?NS:xS,privateMapKey:this.privateMapKey_},responseCommand:QR.SWITCH_ROLE_RES,retries:(null===(t=this.schedule_.config)||void 0===t||null===(n=t.retries)||void 0===n?void 0:n.switchRole)||1};return this.log_.info("switchRole signal data: "+JSON.stringify(r.data)),this.signalChannel_.sendWaitForResponseWithRetry(r).then((function(t){var n=t.data,r=n.code,o=n.message;if(0!==r)throw new IL({code:yL.SWITCH_ROLE_FAILED,message:aD({key:fM,data:{errMsg:o,errCode:r}})});i.role_=e})).catch((function(e){throw e instanceof IL&&e.getCode()===yL.API_CALL_TIMEOUT&&(e=new IL({code:yL.SWITCH_ROLE_FAILED,message:aD({key:pM})})),i.log_.error(e),e}))}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"off",value:function(e,t,n){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,n)}},{key:"getRemoteMutedState",value:function(){var e=this,n=[];return this.mutedStates_.forEach((function(i,r,o){var a=e.connections_.get(r);a&&n.push(t({userId:a.getUserId()},i))})),n}},{key:"getTransportStats",value:(I=a(i().mark((function e(){var t,n,r,o,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={rtt:0,downlinksRTT:{}},!this.uplinkConnection_){e.next=6;break}return e.next=4,this.stats_.getSenderStats(this.uplinkConnection_);case 4:n=e.sent,t.rtt=n.rtt;case 6:r=b(this.connections_),e.prev=7,r.s();case 9:if((o=r.n()).done){e.next=17;break}return(a=T(o.value,2))[0],s=a[1],e.next=13,this.stats_.getReceiverStats(s);case 13:c=e.sent,t.downlinksRTT[c.userId]=c.rtt;case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:return e.abrupt("return",t);case 26:case"end":return e.stop()}}),e,this,[[7,19,22,25]])}))),function(){return I.apply(this,arguments)})},{key:"getLocalAudioStats",value:(y=a(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t={})[this.userId_]={bytesSent:0,packetsSent:0},!this.uplinkConnection_){e.next=7;break}return e.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:n=e.sent,t[this.userId_]={bytesSent:n.audio.bytesSent,packetsSent:n.audio.packetsSent};case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getLocalVideoStats",value:(m=a(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t={})[this.userId_]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},!this.uplinkConnection_){e.next=7;break}return e.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:n=e.sent,t[this.userId_]={bytesSent:n.video.bytesSent,packetsSent:n.video.packetsSent,framesEncoded:n.video.framesEncoded,framesSent:n.video.framesSent,frameWidth:n.video.frameWidth,frameHeight:n.video.frameHeight};case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"getRemoteAudioStats",value:(v=a(i().mark((function e(){var t,n,r,o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=b(this.connections_),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=13;break}return(o=T(r.value,2))[0],a=o[1],s=a.getDelay(),c=s.audioDelay,e.next=9,this.stats_.getReceiverStats(a);case 9:(u=e.sent).hasAudio&&(t[u.userId]={bytesReceived:u.audio.bytesReceived,packetsReceived:u.audio.packetsReceived,packetsLost:u.audio.packetsLost,end2EndDelay:c});case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(){return v.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(_=a(i().mark((function e(){var t,n,r,o,a,s,c,u,l,d=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.length>0&&void 0!==d[0]?d[0]:BS,n={},r=b(this.connections_),e.prev=3,r.s();case 5:if((o=r.n()).done){e.next=15;break}return(a=T(o.value,2))[0],s=a[1],e.next=9,this.stats_.getReceiverStats(s);case 9:c=e.sent,u=s.getDelay(),l=u.videoDelay,t===BS&&c.hasVideo&&(n[c.userId]={bytesReceived:c.video.bytesReceived,packetsReceived:c.video.packetsReceived,packetsLost:c.video.packetsLost,framesDecoded:c.video.framesDecoded,frameWidth:c.video.frameWidth,frameHeight:c.video.frameHeight,end2EndDelay:l}),t===jS&&c.hasAuxiliary&&(n[c.userId]={bytesReceived:c.auxiliary.bytesReceived,packetsReceived:c.auxiliary.packetsReceived,packetsLost:c.auxiliary.packetsLost,framesDecoded:c.auxiliary.framesDecoded,frameWidth:c.auxiliary.frameWidth,frameHeight:c.auxiliary.frameHeight,end2EndDelay:l});case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(){return _.apply(this,arguments)})},{key:"getSdpSemantics",value:function(){return this.sdpSemantics_}},{key:"getIceServers",value:function(){return 0===this.turnServers_.length&&this.schedule_.iceServers?this.schedule_.iceServers:this.turnServers_}},{key:"getConnections",value:function(){return this.connections_}},{key:"getMutedStates",value:function(){return this.mutedStates_}},{key:"startHeartbeat",value:function(){-1===this.heartbeat_&&(this.log_.info("startHeartbeat..."),this.heartbeat_=tN.run(mb,this.doHeartbeat.bind(this),{delay:2e3}))}},{key:"stopHeartbeat",value:function(){-1!==this.heartbeat_&&(this.log_.info("stopHeartbeat"),tN.clearTask(this.heartbeat_),this.heartbeat_=-1,this.lastHeartBeatTime_=-1)}},{key:"doHeartbeat",value:(g=a(i().mark((function e(){var n,r,o,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.badCaseDetector_.getMonitorFreeze(),e.next=3,this.stats_.getStatsReport({uplinkConnection:this.uplinkConnection_,downlinkConnections:this.connections_,freezeMap:r});case 3:if(o=e.sent,VD.emit(YD,{client:this,stats:o}),null===(n=this.badCaseDetector_)||void 0===n||n.resetMonitor(),this.signalChannel_){e.next=8;break}return e.abrupt("return");case 8:a=this.signalChannel_.isConnected()?oO(this.userId_):[],s=t(t({str_sdk_version:this.version_,uint64_datetime:(new Date).getTime(),msg_user_info:{str_identifier:this.userId_,uint64_tinyid:this.tinyId_},msg_device_info:{uint32_terminal_type:15,str_device_name:navigator.platform,str_os_version:"",uint32_net_type:BE[this.networkType_]}},o),{},{msg_event_msg:a}),this.signalChannel_.send(iL,s),c=Date.now(),this.lastHeartBeatTime_>0&&c-this.lastHeartBeatTime_>1e4&&this.log_.warn("heartbeat took ".concat(c-this.lastHeartBeatTime_)),this.lastHeartBeatTime_=c,!this.isRelayChanged_&&this.isRelayMaybeFailed()&&(this.reJoin(),this.isRelayChanged_=!0);case 15:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"onRemoteStreamAdded",value:function(e){var t=e.content,n=t.userId,i=t.tinyId,r=t.audio,o=t.bigVideo,a=t.auxVideo,s=t.smallVideo;if(null!==n){this.userMap_.has(n)||(this.userMap_.set(n,new NW({userId:n,tinyId:i,role:PS})),this.emitter_.emit(GN.PEER_JOIN,{userId:n}));var c=this.connections_.get(i);if(c){if(c.getIsReconnecting())return;this.log_.warn("duplicated stream-added observed, rebuild the connection"),c.close(),this.connections_.delete(i)}var u={audio:r,video:o,auxiliary:a,smallVideo:s};this.log_.info("remote peer [".concat(n,"] published stream. trackState: ").concat(JSON.stringify(u))),this.createDownlinkConnection({userId:n,tinyId:i,trackState:u})}else this.log_.warn("received null userId on stream added")}},{key:"createDownlinkConnection",value:function(e){var t=this,n=e.userId,i=e.tinyId,r=e.trackState,o=new RW({userId:n,tinyId:i,client:this,isUplink:!1,signalChannel:this.signalChannel_,autoSubscribe:this.autoSubscribe_,trackState:r,enableSEI:this.enableSEI_});this.connections_.set(i,o),this.installDownlinkEvents(o,n,i),this.autoSubscribe_?(o.initialize(),o.connect().catch((function(){!o.getMainStream()&&o.hasMainStream()&&t.initRemoteStream({type:BS,userId:n,downlinkConnection:o}),!o.getAuxStream()&&o.hasAuxStream()&&t.initRemoteStream({type:jS,userId:n,downlinkConnection:o})}))):(o.hasMainStream()&&this.initRemoteStream({type:BS,userId:n,downlinkConnection:o}),o.hasAuxStream()&&this.initRemoteStream({type:jS,userId:n,downlinkConnection:o}))}},{key:"initRemoteStream",value:function(e){var t=e.type,n=e.userId,i=e.downlinkConnection,r=new Zz({type:t,userId:n,client:this});r.setConnection(i),i.setRemoteStream(t===BS?GS:VS,r),r.setIsStreamAddedEventEmitted(!0),VD.emit(cA,{client:this,stream:r}),this.emitter_.emit(GN.STREAM_ADDED,{stream:r})}},{key:"installDownlinkEvents",value:function(e,t,n){var i=this;e.on(UN.SEI_MESSAGE,(function(e){i.emitter_.emit(GN.SEI_MESSAGE,e)})),e.on(UN.STREAM_ADDED,(function(e){e.stream.setIsStreamAddedEventEmitted(!0),VD.emit(cA,{client:i,stream:e.stream}),i.emitter_.emit(GN.STREAM_ADDED,{stream:e.stream})})),e.on(UN.STREAM_REMOVED,(function(e){i.changeBigSmallRecords_.delete(e.stream.getUserId()),e.stream.stop(),e.stream.setIsStreamAddedEventEmitted(!1),i.subscriptionManager_&&i.subscriptionManager_.deleteAutoRecoveryFlag(e.stream.getUserId(),e.stream.getType()),VD.emit(pA,{client:i,stream:e.stream}),i.emitter_.emit(GN.STREAM_REMOVED,{stream:e.stream})})),e.on(UN.STREAM_UPDATED,(function(t){VD.emit(hA,{client:i,stream:t.stream});var n=e.getMixUserList();n&&(t.mixUserList=n),i.emitter_.emit(GN.STREAM_UPDATED,t)})),e.on(UN.STREAM_SUBSCRIBED,(function(e){VD.emit(lA,{client:i,stream:e.stream}),i.emitter_.emit(GN.STREAM_SUBSCRIBED,{stream:e.stream})})),e.on(UN.ERROR,(function(e){var t=e.getCode();t!==yL.ICE_TRANSPORT_ERROR&&(t===yL.DOWNLINK_RECONNECTION_FAILED&&i.closeDownLink(n),i.emitter_.emit(GN.ERROR,e))}))}},{key:"onPeerJoin",value:function(e){var t=e.data.data,n=t.srcTinyId,i=t.userId,r=t.role;this.userMap_.has(i)||(this.userMap_.set(i,new NW({userId:i,tinyId:n,role:r})),this.emitter_.emit(GN.PEER_JOIN,{userId:i}))}},{key:"onPeerLeave",value:function(e){var t=e.data.data,n=t.srcTinyId,i=t.userId,r=t.reason,o=void 0===r?0:r;this.log_.info("peer leave [".concat(i,"]: ").concat(_b[o])),this.cleanUser({userId:i,tinyId:n})}},{key:"cleanUser",value:function(e){var t=e.userId,n=e.tinyId;this.userMap_.delete(t),this.closeDownLink(n),this.emitter_.emit(GN.PEER_LEAVE,{userId:t})}},{key:"onPublishedUserList",value:function(e){var t=this;try{var n=C(e.data.userList);e.data.mixRobotList&&n.push.apply(n,C(e.data.mixRobotList));var i=n.map((function(e){return e.userId}));this.connections_.forEach((function(e){var n=e.getUserId(),r=e.getTinyId();i.findIndex((function(e){return e===n}))<0&&(t.log_.info("peer unpublished detected [".concat(n,"]")),t.closeDownLink(r))})),n.forEach((function(e){var n=e.userId,i=e.srcTinyId,r=e.flag,o=e.mixUserList;if(n!==t.userId_){var a=!!(1&r),s=!!(8&r),c=!!(4&r),u=!!(2&r),l=t.connections_.get(i);if((u||a)&&t.checkSubscribeBigSmallVideo(l,u),l){var d=l.getTrackState(),h=d.audio,p=d.video,f=d.auxiliary,g=d.smallVideo;ID(o)&&l.setMixUserList(o),!p&&a&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.ADD,kind:GC}),!h&&s&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.ADD,kind:UC}),!f&&c&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.ADD,kind:jC}),!g&&u&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.ADD,kind:HC}),p&&!a&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.REMOVE,kind:GC}),h&&!s&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.REMOVE,kind:UC}),f&&!c&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.REMOVE,kind:jC}),g&&!u&&VD.emit(sA,{client:t,tinyId:i,userId:n,action:FE.REMOVE,kind:HC})}else t.log_.info("peer published detected [".concat(n,"]")),t.onRemoteStreamAdded({content:{audio:s,bigVideo:a,auxVideo:c,smallVideo:u,userId:n,tinyId:i}})}}))}catch(qY){}}},{key:"onUpdateRemoteMuteStat",value:function(e){var t=this,n=e.data;(n&&n.userList||[]).forEach((function(e){var n=e.srcTinyId,i=e.userId;if(0!==n&&n!==t.tinyId_){var r=t.connections_.get(n);if(r){var o=r.getMainStream();if(o&&o.getIsStreamAddedEventEmitted()){var a=!!(1&e.flag),s=!!(8&e.flag),c=!!(2&e.flag),u=!!(64&e.flag),l=!!(16&e.flag),d=t.mutedStates_.get(n);if(void 0===d)return t.mutedStates_.set(n,{hasAudio:s,hasVideo:a,hasSmall:c,audioMuted:u,videoMuted:l}),a?l?t.emitter_.emit(GN.MUTE_VIDEO,{userId:i}):t.emitter_.emit(GN.UNMUTE_VIDEO,{userId:i}):t.emitter_.emit(GN.MUTE_VIDEO,{userId:i}),void(s?u?t.emitter_.emit(GN.MUTE_AUDIO,{userId:i}):t.emitter_.emit(GN.UNMUTE_AUDIO,{userId:i}):t.emitter_.emit(GN.MUTE_AUDIO,{userId:i}));var h=!d.audioMuted&&d.hasAudio,p=!u&&s,f=!d.videoMuted&&d.hasVideo,g=!l&&a;t.mutedStates_.set(n,{hasAudio:s,hasVideo:a,hasSmall:c,audioMuted:u,videoMuted:l}),h!==p&&(p?t.emitter_.emit(GN.UNMUTE_AUDIO,{userId:i}):t.emitter_.emit(GN.MUTE_AUDIO,{userId:i})),f!==g&&(g?t.emitter_.emit(GN.UNMUTE_VIDEO,{userId:i}):t.emitter_.emit(GN.MUTE_VIDEO,{userId:i}))}}else t.mutedStates_.delete(n)}}))}},{key:"getEnv",value:function(){return this.env_}},{key:"getSubscriptionManager",value:function(){return this.subscriptionManager_}},{key:"startPublishCDNStream",value:(f=a(i().mark((function e(){var t,n=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this.log_.info("startPublishCDNStream with params: ".concat(JSON.stringify(t),"; isJoined: ").concat(this.isJoined_,"; hasMainStream: ").concat(!!this.localStream_,"; hasAuxStream: ").concat(!!this.localAuxStream_,";")),t.streamType=t.streamType||rS,t.streamType===jC&&(t.streamType=qC),t.streamId=t.streamId||"",!this.isJoined_){e.next=10;break}if(t.streamType!==rS||this.localStream_){e.next=8;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:_M})});case 8:if(t.streamType!==qC||this.localAuxStream_){e.next=10;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:_M})});case 10:return e.next=12,this.publishCDNManager_.startPublishTencentCDN(t);case 12:if(!(t.appId&&t.bizId&&t.url)){e.next=15;break}return e.next=15,this.publishCDNManager_.startPublishGivenCDN(t);case 15:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"stopPublishCDNStream",value:(p=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publishCDNManager_.getIsPublishingTencentCDN()){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:vM})});case 2:return this.log_.info("stopPublishCDNStream"),e.next=5,this.publishCDNManager_.stopPublishTencentCDN();case 5:if(!this.publishCDNManager_.getIsPublishingGivenCDN()){e.next=8;break}return e.next=8,this.publishCDNManager_.stopPublishGivenCDN();case 8:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"startMixTranscode",value:(h=a(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_&&this.mixTranscodeManager_){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:TM})});case 2:return gD(t.mode)&&(t.mode=LE.MANUAL),e.prev=3,this.log_.info("startMixTranscode with config ".concat(JSON.stringify(t))),uO.uploadEvent({log:"mix-transcode-mode:".concat(t.mode),userId:this.userId_}),e.next=8,this.mixTranscodeManager_.startMixTranscode(t);case 8:uO.logSuccessEvent({userId:this.userId_,eventType:EE}),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(3),uO.logFailedEvent({userId:this.userId_,eventType:EE,error:e.t0}),e.t0;case 15:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e){return h.apply(this,arguments)})},{key:"stopMixTranscode",value:(d=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_&&this.mixTranscodeManager_){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:CM})});case 2:return e.prev=2,e.next=5,this.mixTranscodeManager_.stopMixTranscode();case 5:uO.logSuccessEvent({userId:this.userId_,eventType:bE}),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),uO.logFailedEvent({userId:this.userId_,eventType:bE,error:e.t0}),e.t0;case 12:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return d.apply(this,arguments)})},{key:"getSystemResult",value:function(){return this.checkSystemResult_}},{key:"enableAudioVolumeEvaluation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!vD(t))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:SM})});if(this.log_.info("enableAudioVolumeEvaluation with interval: "+t),t<=0)return this.enableAudioVolumeEvaluation_=!1,tN.clearTask(this.audioVolumeIntervalId_),void(this.audioVolumeIntervalId_=null);t=Math.floor(Math.max(t,16)),VD.emit(nA,{interval:t}),this.audioVolumeIntervalId_&&(tN.clearTask(this.audioVolumeIntervalId_),this.audioVolumeIntervalId_=null),this.enableAudioVolumeEvaluation_=!0,this.audioVolumeIntervalId_=tN.run(yb,(function(){var t=[];if(e.localStream_){var n=Math.floor(100*e.localStream_.getAudioLevel());t.push({userId:e.userId_,audioVolume:n,stream:e.localStream_})}e.connections_.forEach((function(e){var n=e.getSubscribedMainStream();if(n){var i=Math.floor(100*n.getAudioLevel());t.push({userId:e.getUserId(),audioVolume:i,stream:n})}})),e.emitter_.emit(GN.AUDIO_VOLUME,{result:t})}),{fps:1e3/t,backgroundTask:n})}},{key:"callExperimentalAPI",value:function(e,n){return UY.call(e,t({client:this},n))}},{key:"setProperty",value:function(e,t){var n="".concat(e,"_");gD(this[n])||(this[n]=t)}},{key:"uploadAllCallStats",value:function(){var e=this;this.callDurationCalculator_.getDurationMap().forEach((function(t,n){var i={userId:t.userId,type:t.type,duration:e.callDurationCalculator_.getDuration(n,GC),dataFreeze:e.badCaseDetector_.getDataFreezeDuration(n).dataFreeze,renderFreeze:e.badCaseDetector_.getRenderFreezeDuration(n).renderFreeze};uO.uploadEvent({log:"callStats-"+JSON.stringify(i),userId:e.userId_})})),this.badCaseDetector_.stop(),this.callDurationCalculator_.reset()}},{key:"enableSmallStream",value:(l=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPublished()&&!this.isPublishing_){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:EM})});case 2:if(!ON()){e.next=7;break}this.setIsEnableSmallStream(!0),this.log_.info("SmallStream successfully enabled"),e.next=8;break;case 7:throw new IL({code:yL.INVALID_OPERATION,message:aD({key:MM})});case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"disableSmallStream",value:(c=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPublished()&&!this.isPublishing_){e.next=2;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:bM})});case 2:this.setIsEnableSmallStream(!1),this.log_.info("SmallStream successfully disabled");case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"setSmallStreamProfile",value:function(e){var t=this;e&&e.framerate&&(e.frameRate=e.framerate),e.width*e.height>307200&&(e.width=320,e.height=240,this.log_.info("Small stream resolution is beyond limitation, which is invalid. Reset to 320 * 240")),Object.keys(this.smallStreamConfig_).forEach((function(n){e[n]&&(t.smallStreamConfig_[n]=e[n])}));var n=this.smallStreamConfig_,i=n.width,r=n.height,o=n.bitrate,a=n.frameRate;if(this.log_.info("setSmallStreamProfile: bitrate=".concat(o,", frameRate=").concat(a,", height=").concat(r,", width=").concat(i)),i<0||r<0||o<0||a<0)throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:kM})})}},{key:"setRemoteVideoStreamType",value:(o=a(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Zz){e.next=2;break}throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:wM})});case 2:if(t.getConnection()){e.next=4;break}throw new IL({code:yL.INVALID_OPERATION,message:aD({key:uM})});case 4:if(t.getType()!==jS){e.next=6;break}return e.abrupt("return");case 6:e.t0=n,e.next=e.t0===zE||e.t0===KE?9:12;break;case 9:return e.next=11,this.changeVideoType(t,n);case 11:case 12:return e.abrupt("break",13);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"changeVideoType",value:(r=a(i().mark((function e(t,n){var r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getUserId(),o={stream:t,options:{video:n===zE,smallVideo:n===KE},isSubscribing:!1,reSubscribeCount:10},this.changeBigSmallRecords_.set(r,o),this.log_.info("set [".concat(r,"] ").concat(t.getType()," stream video prefer type: ").concat(n));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"checkSubscribeBigSmallVideo",value:(n=a(i().mark((function e(t,n){var r,o,a,s,c,u,l,d,h,p,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.isBigStreamSubscribed||null!=t&&t.isSmallStreamSubscribed){e.next=2;break}return e.abrupt("return");case 2:if(r=t.getUserId(),this.changeBigSmallRecords_.has(r)){e.next=5;break}return e.abrupt("return");case 5:if(o=this.changeBigSmallRecords_.get(r),a=t.getSubscribeState(),s=a.video,c=a.smallVideo,u=o.stream,l=o.options,d=o.isSubscribing,h=o.reSubscribeCount,!(l.video&&s||l.smallVideo&&c&&n)){e.next=10;break}return e.abrupt("return");case 10:if(p={video:l.video,smallVideo:l.smallVideo},!(n&&t.isBigStreamSubscribed||t.isSmallStreamSubscribed)){e.next=31;break}if(e.prev=12,!(l&&u&&!d&&h>=1)){e.next=24;break}return o.isSubscribing=!0,o.reSubscribeCount=h-1,f=u.getConnection(),!n&&f.isSmallStreamSubscribed&&(p={video:!0,smallVideo:!1}),p.emitEvent=!1,e.next=21,null==f?void 0:f.subscribe(u,p);case 21:this.log_.info("change [".concat(r,"] to ").concat(p.smallVideo?"small":"big"," video successfully. count ").concat(10-o.reSubscribeCount,".")),o.isSubscribing=!1,o.reSubscribeCount=10;case 24:e.next=31;break;case 26:e.prev=26,e.t0=e.catch(12),this.log_.info("change [".concat(r,"] to ").concat(p.smallVideo?"small":"big"," video failed. count ").concat(10-o.reSubscribeCount,".")),o.isSubscribing=!1,0===h&&this.changeBigSmallRecords_.delete(r);case 31:case"end":return e.stop()}}),e,this,[[12,26]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setIsEnableSmallStream",value:function(e){this.isEnableSmallStream_=e}},{key:"getIsEnableSmallStream",value:function(){return this.isEnableSmallStream_}},{key:"smallStreamConfig",get:function(){return this.smallStreamConfig_}},{key:"isPublished",value:function(){return!!this.localStream_}},{key:"getUplinkConnection",value:function(){return this.uplinkConnection_}},{key:"getLocalStream",value:function(){return this.localStream_}},{key:"getMode",value:function(){return this.mode_}},{key:"getBadCaseDetector",value:function(){return this.badCaseDetector_}},{key:"getCallDurationCalculator",value:function(){return this.callDurationCalculator_}},{key:"getIsJoined",value:function(){return this.isJoined_}},{key:"getAllConnections",value:function(){var e=C(this.connections_.values());return this.uplinkConnection_&&e.push(this.uplinkConnection_),e}},{key:"isRelayMaybeFailed",value:function(){if(!this.signalChannel_.isOnline)return!1;var e=this.getAllConnections();if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(e[t].getReconnectionCount()<6)return!1;return!0}},{key:"getUseStringRoomId",value:function(){return this.useStringRoomId_}},{key:"checkConnectionsToReconnect",value:function(){var e=this;this.getAllConnections().forEach((function(t){if(!t.getIsReconnecting()){var n=t.getPeerConnection();n&&n.connectionState===XS&&(e.log_.warn("[".concat(t.getUserId(),"] pc is closed but not reconnect")),t.startReconnection())}}))}},{key:"getEnableAutoPlayDialog",value:function(){return this.enableAutoPlayDialog_}},{key:"sendSEIMessage",value:function(e,t){this.uplinkConnection_.sendSEI(e,t)}},{key:"setProxyServer",value:function(e){if(this.log_.info("set proxy server: ".concat(JSON.stringify(e))),_D(e)){if(!e.startsWith("wss://"))throw new IL({code:yL.INVALID_PARAMETER,message:aD({key:Zb})});this.proxy_=e}else if(dD(e)){var t=e.websocketProxy,n=e.loggerProxy,i=e.scheduleProxy,r=e.unifiedProxy;t&&(this.proxy_=t),n&&AS(n),i&&$E(i),r&&(this.unifiedProxy_=r,AS("https://".concat(r)),$E(r))}}},{key:"setTurnServer",value:function(e){this.log_.info("set turn server: "+JSON.stringify(e));var t=[];Array.isArray(e)?e.forEach((function(e){return t.push(SD(e))})):dD(e)&&t.push(SD(e)),this.turnServers_=t}},{key:"get2k4kFlag",value:function(){var e,t;return null===(e=this.schedule_)||void 0===e||null===(t=e.trtcCapability)||void 0===t?void 0:t["2k4k"]}}]),e}(),M(EY.prototype,"join",[YW,JW],Object.getOwnPropertyDescriptor(EY.prototype,"join"),EY.prototype),M(EY.prototype,"leave",[ZW],Object.getOwnPropertyDescriptor(EY.prototype,"leave"),EY.prototype),M(EY.prototype,"getUserList",[XW],Object.getOwnPropertyDescriptor(EY.prototype,"getUserList"),EY.prototype),M(EY.prototype,"publish",[QW,$W,eY],Object.getOwnPropertyDescriptor(EY.prototype,"publish"),EY.prototype),M(EY.prototype,"unpublish",[tY,nY],Object.getOwnPropertyDescriptor(EY.prototype,"unpublish"),EY.prototype),M(EY.prototype,"subscribe",[iY],Object.getOwnPropertyDescriptor(EY.prototype,"subscribe"),EY.prototype),M(EY.prototype,"unsubscribe",[rY],Object.getOwnPropertyDescriptor(EY.prototype,"unsubscribe"),EY.prototype),M(EY.prototype,"switchRole",[oY,aY,sY],Object.getOwnPropertyDescriptor(EY.prototype,"switchRole"),EY.prototype),M(EY.prototype,"startPublishCDNStream",[cY,uY],Object.getOwnPropertyDescriptor(EY.prototype,"startPublishCDNStream"),EY.prototype),M(EY.prototype,"stopPublishCDNStream",[lY],Object.getOwnPropertyDescriptor(EY.prototype,"stopPublishCDNStream"),EY.prototype),M(EY.prototype,"startMixTranscode",[dY,hY],Object.getOwnPropertyDescriptor(EY.prototype,"startMixTranscode"),EY.prototype),M(EY.prototype,"stopMixTranscode",[pY],Object.getOwnPropertyDescriptor(EY.prototype,"stopMixTranscode"),EY.prototype),M(EY.prototype,"enableAudioVolumeEvaluation",[fY],Object.getOwnPropertyDescriptor(EY.prototype,"enableAudioVolumeEvaluation"),EY.prototype),M(EY.prototype,"enableSmallStream",[gY],Object.getOwnPropertyDescriptor(EY.prototype,"enableSmallStream"),EY.prototype),M(EY.prototype,"disableSmallStream",[_Y],Object.getOwnPropertyDescriptor(EY.prototype,"disableSmallStream"),EY.prototype),M(EY.prototype,"setSmallStreamProfile",[vY],Object.getOwnPropertyDescriptor(EY.prototype,"setSmallStreamProfile"),EY.prototype),M(EY.prototype,"setRemoteVideoStreamType",[mY],Object.getOwnPropertyDescriptor(EY.prototype,"setRemoteVideoStreamType"),EY.prototype),M(EY.prototype,"sendSEIMessage",[yY,IY,TY],Object.getOwnPropertyDescriptor(EY.prototype,"sendSEIMessage"),EY.prototype),M(EY.prototype,"setProxyServer",[CY],Object.getOwnPropertyDescriptor(EY.prototype,"setProxyServer"),EY.prototype),M(EY.prototype,"setTurnServer",[SY],Object.getOwnPropertyDescriptor(EY.prototype,"setTurnServer"),EY.prototype),EY),VY=0,FY=0,BY=(DY=Yz(eb),AY=Yz(eb),RY=Yz(eb),LY=wz(kz.TRTC.createClient),OY=Yz(eb),NY=wz(kz.TRTC.createStream),xY=function(){function e(){s(this,e),this.name_=eb,this.VERSION=Ko,this.Logger={loggerManager:UA,LogLevel:fb,setLogLevel:function(e){UA.setLogLevel(e),e<=1&&oD()},enableUploadLog:function(){Wz.handleFunctionState({fnName:"TRTC.enableUploadLog"}),UA.enableUploadLog()},disableUploadLog:function(){UA.warn("disableUploadLog"),Wz.handleFunctionState({fnName:"TRTC.disableUploadLog"}),UA.disableUploadLog()}}}var n;return u(e,[{key:"checkSystemRequirements",value:(n=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fN();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"isScreenShareSupported",value:function(){return vN()}},{key:"isSmallStreamSupported",value:function(){return ON()}},{key:"getDevices",value:function(){return $N()}},{key:"getCameras",value:function(){return function(){return JN.apply(this,arguments)}()}},{key:"getMicrophones",value:function(){return tx()}},{key:"getSpeakers",value:function(){return function(){return ix.apply(this,arguments)}()}},{key:"createClient",value:function(e){GA&&(GA=!1,UA.getLogLevel()!=jY.Logger.LogLevel.NONE&&(console.info("******************************************************************************"),console.info("*   TRTC Web SDK"),console.info("*   API Document: "+"".concat(lb,"index.html")),console.info("*   Changelog: https://cloud.tencent.com/document/product/647/38958"),console.info("*   Report issues: https://github.com/LiteAVSDK/TRTC_Web/issues"),console.info("******************************************************************************")),UA.info("TRTC Web SDK Version: 4.15.8"),UA.info("UserAgent: "+navigator.userAgent),UA.info("URL of current page: "+location.href));var n={version:this.VERSION},i=new GY(t(t(t({},n),e),{},{seq:++VY}));return VD.emit($D,{client:i}),i}},{key:"createStream",value:function(e){return new kK(t(t({},e),{},{seq:++FY}))}}]),e}(),M(xY.prototype,"checkSystemRequirements",[DY],Object.getOwnPropertyDescriptor(xY.prototype,"checkSystemRequirements"),xY.prototype),M(xY.prototype,"isScreenShareSupported",[AY],Object.getOwnPropertyDescriptor(xY.prototype,"isScreenShareSupported"),xY.prototype),M(xY.prototype,"isSmallStreamSupported",[RY],Object.getOwnPropertyDescriptor(xY.prototype,"isSmallStreamSupported"),xY.prototype),M(xY.prototype,"createClient",[LY,OY],Object.getOwnPropertyDescriptor(xY.prototype,"createClient"),xY.prototype),M(xY.prototype,"createStream",[NY],Object.getOwnPropertyDescriptor(xY.prototype,"createStream"),xY.prototype),xY),jY=new BY;return jY}))},472:function(e,t,n){n(7658),n(1439),n(7585),n(5315),function(t,i){e.exports=i(n(944))}(window,(function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";n.d(t,"e",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"b",(function(){return g})),n.d(t,"d",(function(){return _})),n.d(t,"a",(function(){return y})),n.d(t,"h",(function(){return I}));const i="undefined"!=typeof window,r=("undefined"!=typeof wx&&wx.getSystemInfoSync,i&&window.navigator&&window.navigator.userAgent||""),o=/AppleWebKit\/([\d.]+)/i.exec(r),a=(o&&parseFloat(o.pop()),/iPad/i.test(r)),s=(/iPhone/i.test(r),/iPod/i.test(r),function(){const e=r.match(/OS (\d+)_/i);e&&e[1]&&e[1]}(),/Android/i.test(r)),c=(function(){const e=r.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}(),s&&/webkit/i.test(r),/Firefox/i.test(r),/Edge/i.test(r)),u=(!c&&/Chrome/i.test(r),function(){const e=r.match(/Chrome\/(\d+)/);e&&e[1]&&parseFloat(e[1])}(),/MSIE/.test(r),/MSIE\s8\.0/.test(r),function(){const e=/MSIE\s(\d+)\.\d/.exec(r);let t=e&&parseFloat(e[1]);!t&&/Trident\/7.0/i.test(r)&&/rv:11.0/.test(r)&&(t=11)}(),/Safari/i.test(r),/TBS\/\d+/i.test(r));(function(){const e=r.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]})(),!u&&/MQQBrowser\/\d+/i.test(r),!u&&/ QQBrowser\/\d+/i.test(r),/(micromessenger|webbrowser)/i.test(r),/Windows/i.test(r),/MAC OS X/i.test(r),/MicroMessenger/i.test(r),n(2),n(1);const l=function(e){return"map"===v(e)},d=function(e){return"set"===v(e)},h=function(e){return"file"===v(e)},p=function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},f=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===v(e)},g=function(e){return f(e)||function(e){return null!==e&&"object"==typeof e}(e)},_=function(e){return e instanceof Error},v=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()};let m=0;Date.now||(Date.now=function(){return(new Date).getTime()});const y={now:function(){0===m&&(m=Date.now()-1);const e=Date.now()-m;return e>4294967295?(m+=4294967295,Date.now()-m):e},utc:function(){return Math.round(Date.now()/1e3)}},I=function(e){return JSON.stringify(e,["message","code"])}},function(e,t,n){"use strict";n.r(t);var i=n(3),r=n(0);let o=0;const a=new Map;function s(){const e=new Date;return"TSignaling "+e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())+":"}const c={_data:[],_length:0,_visible:!1,arguments2String(e){let t;if(1===e.length)t=s()+e[0];else{t=s();for(let n=0,i=e.length;n<i;n++)Object(r.b)(e[n])?Object(r.d)(e[n])?t+=Object(r.h)(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug:function(){if(o<=-1){const e=this.arguments2String(arguments);c.record(e,"debug"),i.a.debug(e)}},log:function(){if(o<=0){const e=this.arguments2String(arguments);c.record(e,"log"),i.a.log(e)}},info:function(){if(o<=1){const e=this.arguments2String(arguments);c.record(e,"info"),i.a.info(e)}},warn:function(){if(o<=2){const e=this.arguments2String(arguments);c.record(e,"warn"),i.a.warn(e)}},error:function(){if(o<=3){const e=this.arguments2String(arguments);c.record(e,"error"),i.a.error(e)}},time:function(e){a.set(e,r.a.now())},timeEnd:function(e){if(a.has(e)){const t=r.a.now()-a.get(e);return a.delete(e),t}return i.a.warn(`未找到对应label: ${e}, 请在调用 logger.timeEnd 前，调用 logger.time`),0},setLevel:function(e){e<4&&i.a.log(s()+"set level from "+o+" to "+e),o=e},record:function(e,t){1100===c._length&&(c._data.splice(0,100),c._length=1e3),c._length++,c._data.push(`${e} [${t}] \n`)},getLog:function(){return c._data}};t.default=c},function(e,t,n){"use strict";n.r(t),t.default={MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",ENTER_ROOM_SUCCESS:"JoinedSuccess",ALREADY_IN_ROOM:"AlreadyInGroup"}},function(e,t,n){"use strict";(function(e){let n,i;n="undefined"!=typeof console?console:void 0!==e&&e.console?e.console:"undefined"!=typeof window&&window.console?window.console:{};const r=function(){},o=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let a=o.length;for(;a--;)i=o[a],console[i]||(n[i]=r);t.a=n}).call(this,n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NEW_INVITATION_RECEIVED:"ts_new_invitation_received",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",SDK_READY:"ts_im_ready",SDK_NOT_READY:"ts_im_not_ready",TEXT_MESSAGE_RECEIVED:"ts_text_message_received",CUSTOM_MESSAGE_RECEIVED:"ts_custom_message_received",REMOTE_USER_JOIN:"ts_remote_user_join",REMOTE_USER_LEAVE:"ts_remote_user_leave",KICKED_OUT:"ts_kicked_out",NET_STATE_CHANGE:"ts_net_state_change",MESSAGE_SENT_BY_ME:"ts_message_sent_by_me"}},function(e,t,n){"use strict";var i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=t.BusinessID=t.ActionType=void 0,function(e){e[e.INVITE=1]="INVITE",e[e.CANCEL_INVITE=2]="CANCEL_INVITE",e[e.ACCEPT_INVITE=3]="ACCEPT_INVITE",e[e.REJECT_INVITE=4]="REJECT_INVITE",e[e.INVITE_TIMEOUT=5]="INVITE_TIMEOUT"}(i||(i={})),t.ActionType=i,function(e){e[e.SIGNAL=1]="SIGNAL"}(r||(r={})),t.BusinessID=r,function(e){e[e.ERR_INVALID_PARAMETERS=6017]="ERR_INVALID_PARAMETERS",e[e.ERR_SDK_SIGNALING_INVALID_INVITE_ID=8010]="ERR_SDK_SIGNALING_INVALID_INVITE_ID",e[e.ERR_SDK_SIGNALING_NO_PERMISSION=8011]="ERR_SDK_SIGNALING_NO_PERMISSION"}(o||(o={})),t.ErrorCode=o},function(t,n){t.exports=e},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),c=n(8),u=n(4),l=n(2),d=n(1),h=n(10),p=n(11),f=n(12),g=n(13),_=n(6),v=n(15).version,m=n(16),y={messageControlInfo:{excludedFromContentModeration:!0}},I=function(){function e(e){if(this._outerEmitter=null,this._safetyCallbackFactory=null,this._tim=null,this._imSDKAppID=0,this._userID=null,this._groupID="",this._isHandling=!1,this._inviteInfoMap=new Map,this._isRejectNotifyAll=!1,this.offlineSupport=!0,d.default.info("TSignaling version:"+v),h.default(e.SDKAppID))return d.default.error("TSignaling 请传入 SDKAppID !!!"),null;h.default(e.offlineSupport)||"boolean"!=typeof e.offlineSupport?this.offlineSupport=!0:this.offlineSupport=e.offlineSupport,this._outerEmitter=new c.default,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],i=[n,{name:e[0],data:e[1]}];this._outerEmitter._emit.apply(this._outerEmitter,a(i))}.bind(this),this._safetyCallbackFactory=new f.default,e.tim?this._tim=e.tim:this._tim=_.create({SDKAppID:e.SDKAppID,scene:"TSignaling"}),e.isRejectNotifyAll&&(this._isRejectNotifyAll=!0),this.messageClient=new m.default({tim:this._tim}),this._imSDKAppID=e.SDKAppID,this._tim.on(_.EVENT.SDK_READY,this._onIMReady.bind(this)),this._tim.on(_.EVENT.SDK_NOT_READY,this._onIMNotReady.bind(this)),this._tim.on(_.EVENT.KICKED_OUT,this._onKickedOut.bind(this)),this._tim.on(_.EVENT.NET_STATE_CHANGE,this._onNetStateChange.bind(this)),this._tim.on(_.EVENT.MESSAGE_RECEIVED,this._onMessageReceived.bind(this))}return e.prototype.setLogLevel=function(e){d.default.setLevel(e),this._tim.setLogLevel(e)},e.prototype.login=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return d.default.log("TSignaling.login",e),this._userID=e.userID,[2,this._tim.login(e)]}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return d.default.log("TSignaling.logout"),this._userID="",this._inviteInfoMap.clear(),[2,this._tim.logout()]}))}))},e.prototype.on=function(e,t,n){d.default.log("TSignaling.on eventName:"+e),this._outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)},e.prototype.off=function(e,t){d.default.log("TSignaling.off eventName:"+e);var n=this._safetyCallbackFactory.find(e,t);null!==n&&(this._outerEmitter.off(e,n),this._safetyCallbackFactory.delete(e,t))},e.prototype.joinGroup=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return d.default.log("TSignaling.joinGroup groupID:"+e),this._groupID=e,[2,this._tim.joinGroup({groupID:e})]}))}))},e.prototype.quitGroup=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return d.default.log("TSignaling.quitGroup groupID:"+e),[2,this._tim.quitGroup(e)]}))}))},e.prototype.sendTextMessage=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=this._tim.createTextMessage({to:e.to,conversationType:!0===e.groupFlag?_.TYPES.CONV_GROUP:_.TYPES.CONV_C2C,priority:e.priority||_.TYPES.MSG_PRIORITY_NORMAL,payload:{text:e.text}}),[2,this._tim.sendMessage(t,y)]}))}))},e.prototype.sendCustomMessage=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=this._tim.createCustomMessage({to:e.to,conversationType:!0===e.groupFlag?_.TYPES.CONV_GROUP:_.TYPES.CONV_C2C,priority:e.priority||_.TYPES.MSG_PRIORITY_NORMAL,payload:{data:e.data||"",description:e.description||"",extension:e.extension||""}}),[2,this._tim.sendMessage(t,y)]}))}))},e.prototype.invite=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,c,u;return o(this,(function(o){switch(o.label){case 0:return t=g.generate(),d.default.log("TSignaling.invite",e,"inviteID="+t),h.default(e)||h.default(e.userID)?[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_INVALID_PARAMETERS,message:"userID is invalid"}))]:(n=e.userID,i=e.data,r=e.timeout,a=e.offlinePushInfo,c={businessID:s.BusinessID.SIGNAL,inviteID:t,inviter:this._userID,actionType:s.ActionType.INVITE,inviteeList:[n],data:i,timeout:h.default(r)?0:r,groupID:""},[4,this._sendCustomMessage(n,c,a)]);case 1:return 0===(u=o.sent()).code?(d.default.log("TSignaling.invite ok"),this._inviteInfoMap.set(t,c),this._startTimer(c,!0),[2,{inviteID:t,code:u.code,data:u.data}]):[2,u]}}))}))},e.prototype.inviteSync=function(e,t,n){var i=g.generate();d.default.log("TSignaling.inviteSync",e,"inviteID="+i),(h.default(e)||h.default(e.userID))&&n&&n(s.ErrorCode.ERR_INVALID_PARAMETERS,"userID is missing");var r=e.userID,o=e.data,a=e.timeout,c=e.offlinePushInfo,u={businessID:s.BusinessID.SIGNAL,inviteID:i,inviter:this._userID,actionType:s.ActionType.INVITE,inviteeList:[r],data:o,timeout:h.default(a)?0:a,groupID:""};return this._sendCustomMessageSync(r,u,(function(){d.default.log("TSignaling.inviteSync ok"),t&&t()}),(function(e,t){n&&n(e,t)}),c),i},e.prototype.inviteInGroup=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,c,u,l;return o(this,(function(o){switch(o.label){case 0:return t=g.generate(),d.default.log("TSignaling.inviteInGroup",e,"inviteID="+t),h.default(e)||h.default(e.groupID)?[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_INVALID_PARAMETERS,message:"groupID is invalid"}))]:(n=e.groupID,i=e.inviteeList,r=e.data,a=e.timeout,c=e.offlinePushInfo,u={businessID:s.BusinessID.SIGNAL,inviteID:t,inviter:this._userID,actionType:s.ActionType.INVITE,inviteeList:i,data:r,timeout:h.default(a)?0:a,groupID:n},[4,this._sendCustomMessage(n,u,c)]);case 1:return 0===(l=o.sent()).code?(d.default.log("TSignaling.inviteInGroup ok"),this._inviteInfoMap.set(t,u),this._startTimer(u,!0),[2,{inviteID:t,code:l.code,data:l.data}]):[2,l]}}))}))},e.prototype.inviteInGroupSync=function(e,t,n){var i=g.generate();d.default.log("TSignaling.inviteInGroupSync",e,"inviteID="+i),(h.default(e)||h.default(e.groupID))&&n&&n(s.ErrorCode.ERR_INVALID_PARAMETERS,"groupID is missing");var r=e.groupID,o=e.inviteeList,a=e.data,c=e.timeout,u=e.offlinePushInfo,l={businessID:s.BusinessID.SIGNAL,inviteID:i,inviter:this._userID,actionType:s.ActionType.INVITE,inviteeList:o,data:a,timeout:h.default(c)?0:c,groupID:r};return this._sendCustomMessageSync(r,l,(function(){d.default.log("TSignaling.inviteInGroupSync ok"),t&&t()}),(function(e,t){n&&n(e,t)}),u),i},e.prototype.cancel=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,c,u,l,f;return o(this,(function(o){switch(o.label){case 0:return d.default.log("TSignaling.cancel",e),h.default(e)||h.default(e.inviteID)||!this._inviteInfoMap.has(e.inviteID)||this._isHandling?[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,t=e.inviteID,n=e.data,i=this._inviteInfoMap.get(t),r=i.inviter,a=i.groupID,c=i.inviteeList,r!==this._userID?[3,2]:(u={businessID:s.BusinessID.SIGNAL,inviteID:t,inviter:r,actionType:s.ActionType.CANCEL_INVITE,inviteeList:c,data:n,timeout:0,groupID:a},l=a||c[0],[4,this._sendCustomMessage(l,u)]));case 1:return f=o.sent(),this._isHandling=!1,f&&0===f.code?(d.default.log("TSignaling.cancel ok"),this._deleteInviteInfoByID(t),[2,{inviteID:t,code:f.code,data:f.data}]):[2,f];case 2:return d.default.error("TSignaling.cancel unmatched inviter="+r+" and userID="+this._userID),this._isHandling=!1,[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_SDK_SIGNALING_NO_PERMISSION,message:"信令请求无权限，比如取消非自己发起的邀请，接受或则拒绝非发给自己的邀请"}))]}}))}))},e.prototype.accept=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,c,u,l;return o(this,(function(o){switch(o.label){case 0:return d.default.log("TSignaling.accept",e),h.default(e)||h.default(e.inviteID)||!this._inviteInfoMap.has(e.inviteID)||this._isHandling?[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,t=e.inviteID,n=e.data,i=this._inviteInfoMap.get(t),r=i.inviter,a=i.groupID,i.inviteeList.includes(this._userID)?(c={businessID:s.BusinessID.SIGNAL,inviteID:t,inviter:r,actionType:s.ActionType.ACCEPT_INVITE,inviteeList:[this._userID],data:n,timeout:0,groupID:a},u=a||r,[4,this._sendCustomMessage(u,c)]):[3,2]);case 1:return l=o.sent(),this._isHandling=!1,l&&0===l.code?(d.default.log("TSignaling.accept ok"),this._updateLocalInviteInfo(c),[2,{inviteID:t,code:l.code,data:l.data}]):[2,l];case 2:return d.default.error("TSignaling.accept inviteeList do not include userID="+this._userID+". inviteID="+t+" groupID="+a),this._isHandling=!1,[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]}}))}))},e.prototype.reject=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,c,u,l;return o(this,(function(o){switch(o.label){case 0:return d.default.log("TSignaling.reject",e),h.default(e)||h.default(e.inviteID)||!this._inviteInfoMap.has(e.inviteID)||this._isHandling?[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,t=e.inviteID,n=e.data,i=this._inviteInfoMap.get(t),r=i.inviter,a=i.groupID,i.inviteeList.includes(this._userID)?(c={businessID:s.BusinessID.SIGNAL,inviteID:t,inviter:r,actionType:s.ActionType.REJECT_INVITE,inviteeList:[this._userID],data:n,timeout:0,groupID:a},u=a||r,[4,this._sendCustomMessage(u,c)]):[3,2]);case 1:return l=o.sent(),this._isHandling=!1,l&&0===l.code?(d.default.log("TSignaling.reject ok"),this._updateLocalInviteInfo(c),[2,{inviteID:t,code:l.code,data:l.data}]):[2,l];case 2:return d.default.error("TSignaling.reject inviteeList do not include userID="+this._userID+". inviteID="+t+" groupID="+a),this._isHandling=!1,[2,Promise.reject(new p.default({code:s.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]}}))}))},e.prototype._onIMReady=function(e){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return d.default.log("TSignaling._onIMReady"),this._outerEmitter.emit(u.default.SDK_READY),!0!==this.offlineSupport?[3,2]:[4,this.messageClient.getHistoricalSignaling()];case 1:e=t.sent(),!h.default(e)&&this._onMessageReceived({data:e}),t.label=2;case 2:return[2]}}))}))},e.prototype._onIMNotReady=function(e){d.default.log("TSignaling.onSdkNotReady"),this._outerEmitter.emit(u.default.SDK_NOT_READY)},e.prototype._onKickedOut=function(e){d.default.log("TSignaling._onKickedOut"),this._outerEmitter.emit(u.default.KICKED_OUT,e.data)},e.prototype._onNetStateChange=function(e){d.default.log("TSignaling._onNetStateChange"),this._outerEmitter.emit(u.default.NET_STATE_CHANGE,e.data)},e.prototype._onMessageReceived=function(e){var t=this;d.default.log("TSignaling._onMessageReceived inviteID="+JSON.stringify(e));var n=e.data,i=n.filter((function(e){return e.type===_.TYPES.MSG_TEXT}));d.default.log("TSignaling._onMessageReceived textMessages"+JSON.stringify(i)),h.default(i)||this._outerEmitter.emit(u.default.TEXT_MESSAGE_RECEIVED,i);var r=n.filter((function(e){return e.type===_.TYPES.MSG_GRP_TIP&&e.payload.operationType===_.TYPES.GRP_TIP_MBR_JOIN}));h.default(r)||this._outerEmitter.emit(u.default.REMOTE_USER_JOIN,r);var o=n.filter((function(e){return e.type===_.TYPES.MSG_GRP_TIP&&e.payload.operationType===_.TYPES.GRP_TIP_MBR_QUIT}));h.default(o)||this._outerEmitter.emit(u.default.REMOTE_USER_LEAVE,o);var a=n.filter((function(e){return e.type===_.TYPES.MSG_CUSTOM})),c=[];a.forEach((function(e){var n,i=e.payload.data,r=!0;try{n=JSON.parse(i)}catch(e){r=!1}if(r){var o=n.businessID,a=n.actionType;if(1===o)switch(a){case s.ActionType.INVITE:t._onNewInvitationReceived(n);break;case s.ActionType.REJECT_INVITE:t._onInviteeRejected(n);break;case s.ActionType.ACCEPT_INVITE:t._onInviteeAccepted(n);break;case s.ActionType.CANCEL_INVITE:t._onInvitationCancelled(n);break;case s.ActionType.INVITE_TIMEOUT:t._onInvitationTimeout(n)}else{if("av_call"===o)return!0;d.default.warn("TSignaling._onMessageReceived unknown businessID="+o),c.push(e)}}else c.push(e)})),h.default(c)||this._outerEmitter.emit(u.default.CUSTOM_MESSAGE_RECEIVED,c)},e.prototype._hasLocalInviteInfo=function(e,t){var n=e.inviteID,i=e.groupID;if(d.default.log("TSignaling._hasLocalInviteInfo inviteID="+n+" groupID="+i),!this._inviteInfoMap.has(n))return!1;var r=this._inviteInfoMap.get(n).inviteeList;return!i||(t?r.length>0:r.length>0&&r.includes(this._userID))},e.prototype._startTimer=function(e,t){var n=this;void 0===t&&(t=!0);var i=e.timeout;if(d.default.log("TSignaling._startTimer timeout="+i+" isInvitator="+t+" timeoutStatus="+(0===i)),0!==i)var r=t?i+5:i,o=1,a=setInterval((function(){var i=n._hasLocalInviteInfo(e,t);d.default.log("TSignaling.setInterval hasInviteInfo="+i),o<r&&i?++o:(i&&n._sendTimeoutNotice(e,t),clearInterval(a))}),1e3)},e.prototype._sendTimeoutNotice=function(e,t){return r(this,void 0,void 0,(function(){var n,i,r,a,c,l,h,p;return o(this,(function(o){switch(o.label){case 0:return n=e.inviteID,i=e.groupID,r=e.inviteeList,a=e.inviter,c=e.data,l=t?i||r[0]:i||a,d.default.log("TSignaling._sendTimeoutNotice inviteID="+n+" to="+l+" isInvitator="+t),h={businessID:s.BusinessID.SIGNAL,inviteID:n,inviter:a,actionType:s.ActionType.INVITE_TIMEOUT,inviteeList:t?r:[this._userID],data:c,timeout:0,groupID:i},[4,this._sendCustomMessage(l,h)];case 1:return(p=o.sent())&&0===p.code&&(this._outerEmitter.emit(u.default.INVITATION_TIMEOUT,{inviter:a,inviteID:n,groupID:i,inviteeList:h.inviteeList,isSelfTimeout:!0}),t?this._deleteInviteInfoByID(n):this._updateLocalInviteInfo(h)),[2,p]}}))}))},e.prototype._onNewInvitationReceived=function(t){var n=t.inviteID,i=t.inviter,r=t.inviteeList,o=t.groupID,a=r.includes(this._userID);d.default.log("TSignaling._onNewInvitationReceived",t,"myselfIncluded="+a),(o&&a||!o)&&(this._inviteInfoMap.has(n)||this._inviteInfoMap.set(n,t),this._outerEmitter.emit(e.EVENT.NEW_INVITATION_RECEIVED,{inviteID:n,inviter:i,groupID:o,inviteeList:r,data:t.data||""}),this._startTimer(t,!1))},e.prototype._onInviteeRejected=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=this._inviteInfoMap.has(t);d.default.log("TSignaling._onInviteeRejected inviteID="+t+" hasInviteID="+r+" inviter="+n+" groupID="+i+" _isRejectNotifyAll="+this._isRejectNotifyAll),(i&&r||!i||this._isRejectNotifyAll)&&(this._updateLocalInviteInfo(e),this._outerEmitter.emit(u.default.INVITEE_REJECTED,{inviteID:t,inviter:n,groupID:i,invitee:e.inviteeList[0],data:e.data||""}))},e.prototype._onInviteeAccepted=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=this._inviteInfoMap.has(t);d.default.log("TSignaling._onInviteeAccepted inviteID="+t+" hasInviteID="+r+" inviter="+n+" groupID="+i),(i&&r||!i)&&(this._updateLocalInviteInfo(e),this._outerEmitter.emit(u.default.INVITEE_ACCEPTED,{inviteID:t,inviter:n,groupID:i,invitee:e.inviteeList[0],data:e.data||""}))},e.prototype._onInvitationCancelled=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=this._inviteInfoMap.has(t);d.default.log("TSignaling._onInvitationCancelled inviteID="+t+" hasInviteID="+r+" inviter="+n+" groupID="+i),(i&&r||!i)&&(this._deleteInviteInfoByID(t),this._outerEmitter.emit(u.default.INVITATION_CANCELLED,{inviteID:t,inviter:n,groupID:i,data:e.data||""}))},e.prototype._onInvitationTimeout=function(e){var t=e.inviteID,n=e.inviter,i=e.groupID,r=e.data,o=this._inviteInfoMap.has(t);d.default.log("TSignaling._onInvitationTimeout inviteID="+t+" hasInviteID="+o+" inviter="+n+" groupID="+i),d.default.log("TSignaling._onInvitationTimeout data="+e.data);var a=JSON.parse(r),s=i&&(0===a.call_end||h.default(a.room_id));h.default(a.room_id)&&a.call_end>0||s||(i&&o||!i)&&(this._updateLocalInviteInfo(e),this._outerEmitter.emit(u.default.INVITATION_TIMEOUT,{inviteID:t,inviter:n,groupID:i,inviteeList:e.inviteeList,isSelfTimeout:!1}))},e.prototype._updateLocalInviteInfo=function(e){var t=e.inviteID,n=e.inviter,i=e.inviteeList,r=e.groupID;if(d.default.log("TSignaling._updateLocalInviteInfo inviteID="+t+" inviter="+n+" groupID="+r),r){if(this._inviteInfoMap.has(t)){var o=i[0],a=this._inviteInfoMap.get(t).inviteeList;a.includes(o)&&(a.splice(a.indexOf(o),1),d.default.log("TSignaling._updateLocalInviteInfo remove "+o+" from localInviteeList. "+a.length+" invitees left")),0===a.length&&this._deleteInviteInfoByID(t)}}else this._deleteInviteInfoByID(t)},e.prototype._deleteInviteInfoByID=function(e){this._inviteInfoMap.has(e)&&(d.default.log("TSignaling._deleteInviteInfoByID remove "+e+" from inviteInfoMap."),this._inviteInfoMap.delete(e))},e.prototype._sendCustomMessage=function(e,t,n){var a,c,l,h;return r(this,void 0,void 0,(function(){var r,p,f,g,v,m;return o(this,(function(o){switch(o.label){case 0:return r=t.groupID,p=this._tim.createCustomMessage({to:e,conversationType:r?_.TYPES.CONV_GROUP:_.TYPES.CONV_C2C,priority:_.TYPES.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(t)}}),t.actionType!==s.ActionType.INVITE?[3,2]:(g={title:(f=n||{}).title||"",description:f.description||"您有一个通话请求",androidOPPOChannelID:f.androidOPPOChannelID||"",extension:this._handleOfflineInfo(t,f.extension||"")},d.default.log("TSignaling.offlinePushInfo "+JSON.stringify(g)),[4,this._tim.sendMessage(p,i({offlinePushInfo:{title:g.title,description:g.description,androidOPPOChannelID:g.androidOPPOChannelID,extension:g.extension}},y))]);case 1:return v=o.sent(),(null===(a=null==v?void 0:v.data)||void 0===a?void 0:a.message)&&this._outerEmitter.emit(u.default.MESSAGE_SENT_BY_ME,null===(c=null==v?void 0:v.data)||void 0===c?void 0:c.message),[2,v];case 2:return[4,this._tim.sendMessage(p,y)];case 3:return m=o.sent(),(null===(l=null==m?void 0:m.data)||void 0===l?void 0:l.message)&&this._outerEmitter.emit(u.default.MESSAGE_SENT_BY_ME,null===(h=null==m?void 0:m.data)||void 0===h?void 0:h.message),[2,m]}}))}))},e.prototype._sendCustomMessageSync=function(e,t,n,i,a){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return[4,this._sendCustomMessage(e,t,a)];case 1:return 0===(r=o.sent()).code?(this._inviteInfoMap.set(t.inviteID,t),this._startTimer(t,!0),n()):i(r.code,r.message||""),[2]}}))}))},e.prototype._handleOfflineInfo=function(e,t){var n=JSON.parse(e.data),i={action:e.actionType,call_type:n.call_type,room_id:n.room_id,call_id:e.inviteID,timeout:n.timeout,version:4,invited_list:e.inviteeList};e.groupID&&(i.group_id=e.groupID);var r={entity:{action:2,chatType:e.groupID?2:1,content:JSON.stringify(i),sendTime:parseInt(Date.now()/1e3+""),sender:e.inviter,version:1},userData:t||""},o=JSON.stringify(r);return d.default.log("TSignaling._handleOfflineInfo "+o),o},e.EVENT=u.default,e.TYPES=l.default,e}();t.default=I},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));const i=Function.prototype.apply,r=new WeakMap;function o(e){return r.has(e)||r.set(e,{}),r.get(e)}class a{constructor(e=null,t=console){const n=o(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,i){return this._getCallbacks(e).push({callback:t,context:n,weight:i}),this._getCallbacks(e).sort(((e,t)=>e.weight>t.weight)),this}_getCallbacks(e){return o(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex((e=>e.callback===t)):null}_achieveMaxListener(e){return null!==o(this)._maxListeners&&o(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const i=this._getCallbackIndex(e,t),r=-1!==i?this._getCallbacks(e)[i]:void 0;return-1!==i&&r&&r.context===n}_has(e){return o(this)._events.has(e)}on(e,t,n=null,i=1){const r=o(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&r._console.warn(`Max listeners (${r._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&r._console.warn(`Event "${e}" already has the callback ${t}.`)):(r._events.add(e),r._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const o=(...r)=>(this.off(e,o),i.call(t,n,r));return this.on(e,o,n,r)}off(e,t=null){const n=o(this);let i;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):(i=this._getCallbackIndex(e,t),-1!==i&&(n._callbacks[e].splice(i,1),this.off(...arguments)))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach((e=>i.call(e.callback,e.context,t))),this}clear(){const e=o(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);var i=n(0);const r=Object.prototype.hasOwnProperty;t.default=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(Object(i.f)(e)){for(const t in e)if(r.call(e,t))return!1;return!0}return!!(Object(i.e)(e)||Object(i.g)(e)||Object(i.c)(e))&&0===e.size}},function(e,t,n){"use strict";n.r(t);class i extends Error{constructor(e){super(),this.code=e.code,this.message=e.message,this.data=e.data||{}}}t.default=i},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(4),o=n.n(r);t.default=class{constructor(){this._funcMap=new Map}defense(e,t,n){if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);let i=null;return this._funcMap.get(e).has(t)?i=this._funcMap.get(e).get(t):(i=this._pack(e,t,n),this._funcMap.get(e).set(t,i)),i}defenseOnce(e,t,n){return"function"!=typeof t?null:this._pack(e,t,n)}find(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)?this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(i.default.log(`SafetyCallback.find: 找不到 func —— ${e}/${""!==t.name?t.name:"[anonymous]"}`),null):(i.default.log(`SafetyCallback.find: 找不到 eventName-${e} 对应的 func`),null)}delete(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}_pack(e,t,n){return function(){try{t.apply(n,Array.from(arguments))}catch(t){const r=Object.values(o.a).indexOf(e),a=Object.keys(o.a)[r];i.default.error(`接入侧事件 EVENT.${a} 对应的回调函数逻辑存在问题，请检查！`,t)}}}}},function(e,t,n){
/**
     * UUID.js - RFC-compliant UUID Generator for JavaScript
     *
     * @file
     * @author  LiosK
     * @version v4.2.12
     * @license Apache License 2.0: Copyright (c) 2010-2022 LiosK
     */
var i;i=function(t){"use strict";function i(){var e=r._getRandomInt;this.timestamp=0,this.tick=0,this.sequence=e(14),this.node=1099511627776*(1|e(8))+e(40)}function r(){}return r.generate=function(){var e=r._getRandomInt,t=r._hexAligner;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)},r._getRandomInt=function(e){if(e<0||e>53)return NaN;var t=0|1073741824*Math.random();return e>30?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e},r._hexAligner=function(e,t){for(var n=e.toString(16),i=t-n.length,r="0";i>0;i>>>=1,r+=r)1&i&&(n=r+n);return n},r.overwrittenUUID=t,function(){var e=r._getRandomInt;r.useMathRandom=function(){r._getRandomInt=e};var t=null,i=e;"undefined"!=typeof window&&(t=window.crypto||window.msCrypto)?t.getRandomValues&&"undefined"!=typeof Uint32Array&&(i=function(e){if(e<0||e>53)return NaN;var n=new Uint32Array(e>32?2:1);return n=t.getRandomValues(n)||n,e>32?n[0]+4294967296*(n[1]>>>64-e):n[0]>>>32-e}):(t=n(14))&&t.randomBytes&&(i=function(e){if(e<0||e>53)return NaN;var n=t.randomBytes(e>32?8:4),i=n.readUInt32BE(0);return e>32?i+4294967296*(n.readUInt32BE(4)>>>64-e):i>>>32-e}),r._getRandomInt=i}(),r.FIELD_NAMES=["timeLow","timeMid","timeHiAndVersion","clockSeqHiAndReserved","clockSeqLow","node"],r.FIELD_SIZES=[32,16,16,8,8,48],r.genV4=function(){var e=r._getRandomInt;return(new r)._init(e(32),e(16),16384|e(12),128|e(6),e(8),e(48))},r.parse=function(e){var t;if(t=/^\s*(urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(\})?\s*$/i.exec(e)){var n=t[1]||"",i=t[8]||"";if(n+i===""||"{"===n&&"}"===i||"urn:uuid:"===n.toLowerCase()&&""===i)return(new r)._init(parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16),parseInt(t[7],16))}return null},r.prototype._init=function(){var e=r.FIELD_NAMES,t=r.FIELD_SIZES,n=r._binAligner,i=r._hexAligner;this.intFields=new Array(6),this.bitFields=new Array(6),this.hexFields=new Array(6);for(var o=0;o<6;o++){var a=parseInt(arguments[o]||0);this.intFields[o]=this.intFields[e[o]]=a,this.bitFields[o]=this.bitFields[e[o]]=n(a,t[o]),this.hexFields[o]=this.hexFields[e[o]]=i(a,t[o]>>>2)}return this.version=this.intFields.timeHiAndVersion>>>12&15,this.bitString=this.bitFields.join(""),this.hexNoDelim=this.hexFields.join(""),this.hexString=this.hexFields[0]+"-"+this.hexFields[1]+"-"+this.hexFields[2]+"-"+this.hexFields[3]+this.hexFields[4]+"-"+this.hexFields[5],this.urn="urn:uuid:"+this.hexString,this},r._binAligner=function(e,t){for(var n=e.toString(2),i=t-n.length,r="0";i>0;i>>>=1,r+=r)1&i&&(n=r+n);return n},r.prototype.toString=function(){return this.hexString},r.prototype.equals=function(e){if(!(e instanceof r))return!1;for(var t=0;t<6;t++)if(this.intFields[t]!==e.intFields[t])return!1;return!0},r.NIL=(new r)._init(0,0,0,0,0,0),r.genV1=function(){null==r._state&&r.resetState();var e=(new Date).getTime(),t=r._state;e!=t.timestamp?(e<t.timestamp&&t.sequence++,t.timestamp=e,t.tick=r._getRandomInt(12)):t.tick<9992?t.tick+=1+r._getRandomInt(3):t.sequence++;var n=r._getTimeFieldValues(t.timestamp),i=n.low+t.tick,o=4095&n.hi|4096;t.sequence&=16383;var a=t.sequence>>>8|128,s=255&t.sequence;return(new r)._init(i,n.mid,o,a,s,t.node)},r.resetState=function(){r._state=new i},r._tsRatio=1/4,r._state=null,r._getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}},"object"==typeof e.exports&&(e.exports=r),r}(i)},function(e,t){},function(e){e.exports=JSON.parse('{"name":"tsignaling","version":"1.0.6","description":"腾讯云 Web 信令 SDK","main":"./src/index.ts","scripts":{"lint":"./node_modules/.bin/eslint ./src","fix":"./node_modules/.bin/eslint --fix ./src","ts2js":"tsc src/index.ts --outDir build/ts2js","doc":"npm run ts2js && npm run doc:clean && npm run doc:build","doc:build":"./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","build:wx":"cross-env NODE_ENV=wx webpack --config webpack.prod.config.js","build:web":"node node_modules/cross-env/src/bin/cross-env.js NODE_ENV=web node_modules/webpack/bin/webpack.js --config webpack.prod.config.js","build:package":"node build/package-bundle.js","prerelease":"npm run changelog && npm run build:web && npm run build:wx && npm run build:package && node ./build/copy.js","start:wx":"cross-env NODE_ENV=wx  webpack-dev-server --config webpack.config.js","start:web":"node node_modules/cross-env/src/bin/cross-env.js NODE_ENV=web node_modules/webpack-dev-server/bin/webpack-dev-server.js --config webpack.dev.config.js","build_withcopy":"npm run build:web && cp dist/npm/tsignaling-js.js ../TIM-demo-web/node_modules/tsignaling/tsignaling-js.js","build_withcopy:mp":"npm run build:wx && cp dist/npm/tsignaling-wx.js ../TIM-demo-mini/static/component/TRTCCalling/utils/tsignaling-wx.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/CHANGELOG.md"},"husky":{"hooks":{"pre-commit":"npm run lint"}},"lint-staged":{"*.{.ts,.tsx}":["eslint","git add"]},"keywords":["腾讯云","即时通信","信令"],"author":"","license":"ISC","devDependencies":{"conventional-changelog-cli":"^2.1.1","cross-env":"^7.0.2","fs-extra":"^9.0.1","html-webpack-plugin":"^4.3.0","ts-loader":"^7.0.5","typescript":"^3.9.9","webpack":"^4.43.0","@types/node":"18.11.9","webpack-cli":"^3.3.11","webpack-dev-server":"^3.11.0"},"dependencies":{"@typescript-eslint/eslint-plugin":"^4.22.1","@typescript-eslint/parser":"^4.22.1","EventEmitter":"^1.0.0","docdash-blue":"1.1.9","eslint":"^5.16.0","eslint-config-google":"^0.13.0","eslint-plugin-classes":"^0.1.1","jsdoc":"^3.6.4","jsdoc-plugin-typescript":"^2.0.5","pretty":"^2.0.0","replace":"^1.2.0","uuidjs":"^4.2.5"}}')},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),c=n(6),u=function(){function e(){Object.defineProperty(this,"currentTime",{get:function(){return(new Date).getTime()}})}return e.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e}(),l=function(){function e(){this.filterList=[],this.result=[]}return e.prototype.register=function(e){this.filterList.push(e)},e.prototype.run=function(e){return void 0===e&&(e=[]),o(this,void 0,void 0,(function(){var t,n;return a(this,(function(i){switch(i.label){case 0:this.result=e,t=0,i.label=1;case 1:return t<this.filterList.length?(n=this,[4,this.filterList[t].doFilter(this.result)]):[3,4];case 2:n.result=i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2,this.result]}}))}))},e}(),d=function(e){function t(t){var n=e.call(this)||this;return n.tim=null,n.expiredTime=3e4,n.maxCircleLength=20,n.tim=t.tim,n}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){var e,t,n,i,r,o,s,c;return a(this,(function(a){switch(a.label){case 0:return e=[],[4,this.tim.getConversationList()];case 1:if(t=a.sent(),n=t.code,i=t.data,r=i.conversationList.length,o=r<=20?r:this.maxCircleLength,0===n)for(s=0;s<o;s++)(c=i.conversationList[s]).unreadCount>0&&c.lastMessage.lastTime&&1e3*c.lastMessage.lastTime>this.currentTime-this.expiredTime&&e.push(c);return[2,e]}}))}))},t}(u),h=function(e){function t(t){var n=e.call(this)||this;return n.tim=null,n.expiredTime=3e4,n.tim=t.tim,n}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){var t,n,i,r,o,s,u,l,d=this;return a(this,(function(a){switch(a.label){case 0:t=[],n=0,a.label=1;case 1:return n<e.length?(i=e[n],r=i.conversationID,o=i.unreadCount,[4,this.tim.getMessageList({conversationID:r,count:o<=15?o:15})]):[3,4];case 2:s=a.sent(),u=s.code,l=s.data,0===u&&t.push(l.messageList.filter((function(e){return e.type===c.TYPES.MSG_CUSTOM&&e.time&&1e3*e.time>d.currentTime-d.expiredTime}))),a.label=3;case 3:return n++,[3,1];case 4:return[2,t.flat().sort((function(e,t){return e.time-t.time}))]}}))}))},t}(u),p=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,e.filter((function(e){var t=!1;try{t=JSON.parse(e.payload.data).businessID===s.BusinessID.SIGNAL}catch(e){}return t}))]}))}))},t}(u),f=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.doFilter=function(e){return o(this,void 0,void 0,(function(){var t,n,i;return a(this,(function(r){return Array.isArray(e)?0===e.length?[2,[]]:(t=new Map,e.forEach((function(e,n){var i=JSON.parse(e.payload.data),r=i.inviteID,o=i.actionType;!t.has(r)||t.get(r).actionType!==s.ActionType.INVITE||o!==s.ActionType.CANCEL_INVITE&&o!==s.ActionType.ACCEPT_INVITE&&o!==s.ActionType.REJECT_INVITE&&o!==s.ActionType.INVITE_TIMEOUT?t.set(r,{index:n,actionType:o}):t.delete(r)})),n=[],t.forEach((function(e){e.actionType===s.ActionType.INVITE&&n.push(e.index)})),0===n.length?[2,[]]:(i=[],n.sort((function(e,t){return e-t})).forEach((function(t){i.push(e[t])})),[2,i])):[2,[]]}))}))},t}(u),g=function(){function e(e){this.tim=null;var t=e.tim;this.tim=t}return e.prototype.getHistoricalSignaling=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){return(e=new l).register(new d({tim:this.tim})),e.register(new h({tim:this.tim})),e.register(new p),e.register(new f),[2,e.run()]}))}))},e}();t.default=g}]).default}))},1344:function(e,t,n){n(7658),n(2062),n(2801),function(t,i){e.exports=i(n(2741),n(1816),n(944),n(472))}(window,(function(e,t,n,i){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=29)}([function(e,t,n){"use strict";n.r(t),n.d(t,"isMap",(function(){return o})),n.d(t,"isSet",(function(){return a})),n.d(t,"isFile",(function(){return s})),n.d(t,"isNumber",(function(){return c})),n.d(t,"isString",(function(){return u})),n.d(t,"isObject",(function(){return l})),n.d(t,"isBoolean",(function(){return d})),n.d(t,"isPlainObject",(function(){return h})),n.d(t,"isArray",(function(){return p})),n.d(t,"isUndefined",(function(){return f})),n.d(t,"isNativeClass",(function(){return _})),n.d(t,"isArrayOrObject",(function(){return v})),n.d(t,"isFunction",(function(){return m})),n.d(t,"isInstanceOfError",(function(){return y})),n.d(t,"getType",(function(){return I})),n.d(t,"TimeUtil",(function(){return C})),n.d(t,"stringifyError",(function(){return S})),n.d(t,"map2String",(function(){return E})),n.d(t,"randomString",(function(){return k})),n.d(t,"isValidType",(function(){return w})),n.d(t,"mapKeys",(function(){return D})),n.d(t,"mapValues",(function(){return A})),n.d(t,"generateRandomRoomID",(function(){return R})),n.d(t,"formatDuration",(function(){return O})),n.d(t,"compareVersion",(function(){return N})),n.d(t,"date2ISOString",(function(){return x})),n.d(t,"getHostType",(function(){return P})),n.d(t,"isCallSignaling",(function(){return U}));var i=n(7),r=n(2);const o=function(e){return I(e)===r.NAME.MAP},a=function(e){return I(e)===r.NAME.SET},s=function(e){return I(e)===r.NAME.FILE},c=function(e){return null!==e&&(typeof e===r.NAME.NUMBER&&!isNaN(e-0)||typeof e===r.NAME.OBJECT&&e.constructor===Number)},u=function(e){return typeof e===r.NAME.STRING},l=function(e){return null!==e&&typeof e===r.NAME.OBJECT},d=function(e){return typeof e===r.NAME.BOOLEAN},h=function(e){if(typeof e!==r.NAME.OBJECT||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},p=function(e){return typeof Array.isArray===r.NAME.FUNCTION?Array.isArray(e):I(e)===r.NAME.ARRAY},f=function(e){return typeof e===r.NAME.UNDEFINED},g=/^class\s/,_=function(e){return typeof e===r.NAME.FUNCTION&&g.test(e.toString())},v=function(e){return p(e)||l(e)},m=function(e){return typeof e===r.NAME.FUNCTION},y=function(e){return e instanceof Error},I=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()};let T=0;Date.now||(Date.now=function(){return(new Date).getTime()});const C={now(){0===T&&(T=Date.now()-1);const e=Date.now()-T;return e>4294967295?(T+=4294967295,Date.now()-T):e},utc:()=>Math.round(Date.now()/1e3)},S=function(e){return JSON.stringify(e,["message","code"])},E=function(e){if(!o(e))return"not a map!!!";let t="";for(const[n,i]of e.entries()){if(o(i))return`[k=${n} -> ${E(i)}`;t+=`[k=${n} v=${i}] `}return t},b="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",M=b.length,k=function(){let e="";for(let t=32;t>0;--t)e+=b[Math.floor(Math.random()*M)];return e},w=function(e,t){for(const n in e)if(e[n]===t)return!0;return!1};function D(e,t){const n={};return Object.keys(e).forEach((i=>{n[t(e[i],i)]=e[i]})),n}function A(e,t){const n={};return Object.keys(e).forEach((i=>{n[i]=t(e[i],i)})),n}function R(){return Math.round(1e8*Math.random())}function L(e){return e<10?"0"+e:e}function O(e){if(e<60)return"00:00:"+L(e);if(e<3600){const t=parseInt(e/60),n=e-60*t;return`00:${L(t)}:${L(n)}`}const t=parseInt(e/3600),n=e-3600*t,i=parseInt(n/60),r=n-60*i;return`${L(t)}:${L(i)}:${L(r)}`}function N(e,t){e=e.split("."),t=t.split(".");const n=Math.max(e.length,t.length);for(;e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(let i=0;i<n;i++){const n=parseInt(e[i]),r=parseInt(t[i]);if(n>r)return 1;if(n<r)return-1}return 0}const x=function(){const e=new Date,t=e.toISOString(),n=e.getTimezoneOffset()/60;let i="";return i=n<0?n>-10?"+0"+Math.abs(100*n):"+"+Math.abs(100*n):n>=10?"-"+100*n:"-0"+100*n,t.replace("Z",i)};function P(){let e="unknown";return i.IS_MAC&&(e="mac"),i.IS_WIN&&(e="windows"),i.IS_IOS&&(e="ios"),i.IS_ANDROID&&(e="android"),e}function U(e){return e===r.NAME.AV_CALL}},function(e,t,n){"use strict";n.r(t);var i=n(6),r=n(0);let o=0;const a=new Map;function s(){const e=new Date;return`TUICallEngine ${e.toLocaleTimeString("en-US",{hour12:!1})}.${function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}:`}const c={_data:[],_length:0,_visible:!1,arguments2String(e){let t;if(1===e.length)t=s()+e[0];else{t=s();for(let n=0,{length:i}=e;n<i;n++)Object(r.isArrayOrObject)(e[n])?Object(r.isInstanceOfError)(e[n])?t+=Object(r.stringifyError)(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug(){if(o<=-1){const e=this.arguments2String(arguments);c.record(e,"debug"),i.a.debug(e)}},log(){if(o<=0){const e=this.arguments2String(arguments);c.record(e,"log"),i.a.log(e)}},info(){if(o<=1){const e=this.arguments2String(arguments);c.record(e,"info"),i.a.info(e)}},warn(){if(o<=2){const e=this.arguments2String(arguments);c.record(e,"warn"),i.a.warn(e)}},error(){if(o<=3){const e=this.arguments2String(arguments);c.record(e,"error"),i.a.error(e)}},time(e){a.set(e,r.TimeUtil.now())},timeEnd(e){if(a.has(e)){const t=r.TimeUtil.now()-a.get(e);return a.delete(e),t}return i.a.warn(`未找到对应label: ${e}, 请在调用 logger.timeEnd 前，调用 logger.time`),0},setLevel(e){e<4&&i.a.log(`${s()}set level from ${o} to ${e}`),o=e},getLevel:()=>o,record(e,t){1100===c._length&&(c._data.splice(0,100),c._length=1e3),c._length++,c._data.push(`${e} [${t}] \n`)},getLog:()=>c._data};t.default=c},function(e,t,n){"use strict";n.r(t),n.d(t,"mainUrl",(function(){return i})),n.d(t,"backupUrl",(function(){return r})),n.d(t,"Mode",(function(){return o})),n.d(t,"Role",(function(){return a})),n.d(t,"VIDEO_STAT_BIT",(function(){return s})),n.d(t,"AUDIO_STAT_BIT",(function(){return c})),n.d(t,"AUDIO_MUTE_BIT",(function(){return u})),n.d(t,"VIDEO_MUTE_BIT",(function(){return l})),n.d(t,"VIDEO_MUTED_MASK",(function(){return d})),n.d(t,"AUX_VIDEO_MUTED_MASK",(function(){return h})),n.d(t,"AUDIO_MUTED_MASK",(function(){return p})),n.d(t,"MAIN_STREAM_MSID",(function(){return f})),n.d(t,"AUX_STREAM_MSID",(function(){return g})),n.d(t,"StreamType",(function(){return _})),n.d(t,"TRTC_QUALITY_UNKNOWN",(function(){return v})),n.d(t,"TRTC_QUALITY_EXCELLENT",(function(){return m})),n.d(t,"TRTC_QUALITY_GOOD",(function(){return y})),n.d(t,"TRTC_QUALITY_POOR",(function(){return I})),n.d(t,"TRTC_QUALITY_BAD",(function(){return T})),n.d(t,"TRTC_QUALITY_VBAD",(function(){return C})),n.d(t,"TRTC_QUALITY_DISCONNECTED",(function(){return S})),n.d(t,"DTLS_STATE_UNKNOWN",(function(){return E})),n.d(t,"SuccessRate",(function(){return b})),n.d(t,"MTA_API_PENDING",(function(){return M})),n.d(t,"MTA_API_SUCCESS",(function(){return k})),n.d(t,"ConnectionState",(function(){return w})),n.d(t,"UPLINK_RECONNECTION_COUNT",(function(){return D})),n.d(t,"DOWNLINK_RECONNECTION_COUNT",(function(){return A})),n.d(t,"SIGNAL_RECONNECTION_COUNT",(function(){return R})),n.d(t,"KIBANA_EVENT",(function(){return L})),n.d(t,"SIGNAL_PING_TIMEOUT",(function(){return O})),n.d(t,"SIGNAL_PING_PONG_INTERVAL",(function(){return N})),n.d(t,"INNER_EVENT",(function(){return x})),n.d(t,"AI_NOISE_REDUCE_ASSETS_PATH",(function(){return P})),n.d(t,"MAX_NUMBER_ROOM_ID",(function(){return U})),n.d(t,"NAME",(function(){return G}));const i="wss://qcloud.rtc.qq.com:8687",r="wss://bk.rtc.qq.com:8687",o={RTC:1,LIVE:2},a={HOST:20,AUDIENCE:21},s=1,c=8,u=64,l=16,d=1,h=2,p=4,f="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",g="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",_={NONE:0,AUDIO:1,MAIN:2,AUX:7},v=0,m=1,y=2,I=3,T=4,C=5,S=6,E="unknown",b={JOIN:"join",PUBLISH:"publish",UNPUBLISH:"unpublish",LOCAL_STREAM_INITIALIZE:"local_stream_initialize",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscibe",UPLINK_CONNECTION:"uplink_connection",UPLINK_RECONNECTION:"uplink_reconnection",DOWNLINK_CONNECTION:"downlink_connection",DOWNLINK_RECONNECTION:"downlink_reconnection",SIGNAL_CONNECTION:"signal_connection",SIGNAL_RECONNECTION:"signal_reconnection",UPDATE_STREAM:"update_stream"},M="pending",k="success",w={CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected"},D=30,A=30,R=30,L={SDK_CONSTRUCT:"sdkConstruct",SDK_LOGIN:"sdkLogin",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",SET_LOCAL_DESCRIPTION:"setLocalDescription",SET_REMOTE_DESCRIPTION:"setRemoteDescription",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_SUBSCRIPTION:"recover-subscription"},O=6e3,N=1e4,x={SET_REMOTE_OFFER_FINISHED:"set-remote-offer-finished"},P="https://web.sdk.qcloud.com/trtc/webrtc/download/aiNoiseReduce/",U=2147483647,G={DEFAULT:"default",BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object",ARRAY:"array",FUNCTION:"function",FILE:"file",MAP:"map",SET:"set",UNDEFINED:"undefined",VIDEO:"video",AUDIO:"audio",ON_ERROR:"onError",MAIN:"main",RTC:"rtc",LIVE:"live",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",INVITER:"inviter",INVITEE:"invitee",VIDEO_INPUT:"videoinput",AUDIO_INPUT:"audioinput",LOCAL:"local",REMOTE:"remote",TRTC:"TRTC",WEB:"web",NORMAL:"normal",REJECT:"reject",IGNORE:"ignore",TIMEOUT:"timeout",CANCEL:"cancel",BUSYLINE:"busyline",UNKNOWN:"unknown",SINGLE_CALL:"SingleCall",GROUP_CALL:"groupCall",CALLER:"caller",CALLEE:"callee",COVER:"cover",CONTAIN:"contain",FILL:"fill",AV_CALL:"av_call"}},function(e,t,n){"use strict";var i=n(18),r=Object.prototype.toString;function o(e){return"[object Array]"===r.call(e)}function a(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===r.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:c,isUndefined:a,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:u,isStream:function(e){return s(e)&&u(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function n(n,i){c(t[i])&&c(n)?t[i]=e(t[i],n):c(n)?t[i]=e({},n):o(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)l(arguments[i],n);return t},extend:function(e,t,n){return l(t,(function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={UNKNOWN:65535,NO_SDK_APPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USER_SIG:2003,NO_TINY_ID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,NOT_MICROPHONE_LIST:60003,NOT_CAMERA_LIST:60004,NOT_MEDIA_ACCESS:60005,NOT_SUPPORT:60006,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,ERROR_SIGNALING_SEND_FAIL:-1401,ERROR_INVALID_INVITEID:8010,ERROR_INVALID_SEND_FAIL:20003,ERROR_HTTP:3e4}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_CN_MESSAGE=t.ERROR_MESSAGE=void 0,t.ERROR_MESSAGE={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无 accountType",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"switch to audio call error",FAILURE_SWITCH_TO_VIDEO:"switch to video call error",NOT_MICROPHONE_LIST:"No microphone or microphone permission denied",NOT_CAMERA_LIST:"No camera or camera permission denied",ERROR_NULL:"success",ERROR_PACKAGE_NOT_PURCHASED:"You do not currently have TUICallKit package, please open the free experience in the console or purchase the official package",ERROR_PACKAGE_NOT_SUPPORTED:'The package you purchased does not support this ability. You can refer to "Activate TRTC and IM": https://www.tencentcloud.com/document/product/647/50993#step-1.-activate-trtc-and-im',ERROR_TIM_VERSION_OUTDATED:"TIM SDK version is too old, Please upgrade version",ERROR_PERMISSION_DENIED:"camera permission refused / microphone permission refused. You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls",ERROR_GET_DEVICE_LIST_FAIL:"Failed to get device list",ERROR_INIT_FAIL:"init or login is not complete, this API needs to be used after init. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"The API is support use in the state of. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"The current method is being executed, please do not call it repeatedly",ERROR_REQUEST_REPEATED_SWITCH:"Consistent with the current call type, please do not switch repeatedly",ERROR_SCENE_NOT_SUPPORTED:"In the current call scene, this function is not supported",ERROR_SIGNALING_SEND_FAIL:"signaling failed to send",ERROR_INVALID_INVITEID:"inviteID is invalid or invitation has been processed. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"Invalid sender or receiver identifier! To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"invalid parameter",ERROR_HTTP:"The current page is detected to be using the http protocol. To ensure smooth access and experience of all functions of TUICallEngine SDK for production environment users, please use the https protocol to access the audio and video application page. More Info: https://web.sdk.qcloud.com/trtc/webrtc/doc/en/tutorial-05-info-browser.html#h2-3",NOT_SUPPORT:"The current page does not have webRTC capability. You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls"},t.ERROR_CN_MESSAGE={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无帐户类型",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"切换语音通话失败",FAILURE_SWITCH_TO_VIDEO:"切换视频通话失败",NOT_MICROPHONE_LIST:"没有麦克风权限",NOT_CAMERA_LIST:"没有摄像头权限",ERROR_NULL:"成功",ERROR_PACKAGE_NOT_PURCHASED:"您目前没有 TUICallKit 包，请在控制台开启免费体验或购买官方包",ERROR_PACKAGE_NOT_SUPPORTED:"您购买的套餐不支持该功能。可参考开通方式：https://cloud.tencent.com/document/product/647/84363#ff45b4ad-f605-42b8-a0af-b2397c8f3e1a",ERROR_TIM_VERSION_OUTDATED:"TIM SDK 版本太旧,请升级版本",ERROR_PERMISSION_DENIED:"摄像头/麦克风权限被拒绝，可以前往: https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html 进行 trtc 能力测试，查看当前环境是否支持音视频通话",ERROR_GET_DEVICE_LIST_FAIL:"获取设备列表失败",ERROR_INIT_FAIL:"TUICallEngine 初始化登录未完成，需要在 init 或 login 完成后使用此 API 。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"当前通话状态无法使用该 API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"当前方法正在执行中，请勿重复调用",ERROR_REQUEST_REPEATED_SWITCH:"与当前通话类型一致，请勿重复切换",ERROR_SCENE_NOT_SUPPORTED:"当前通话场景不支持该功能",ERROR_SIGNALING_SEND_FAIL:"信令发送失败",ERROR_INVALID_INVITEID:"邀请 ID 无效或邀请已处理。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"消息发送方或接收方 UserID 无效或不存在。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"参数错误",ERROR_HTTP:"检测到当前页面正处于 http 协议下，为确保生产环境用户顺畅接入和体验 TUICallEngine SDK 的全部功能，请使用 https 协议访问音视频应用页面。详情请前往：https://web.sdk.qcloud.com/trtc/webrtc/doc/zh-cn/tutorial-05-info-browser.html#h2-3",NOT_SUPPORT:"当前页面不具备 webRTC 能力。可以前往: https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html 进行 trtc 能力测试，查看当前环境是否支持音视频通话"}},function(e,t,n){"use strict";(function(e){let n,i;n="undefined"!=typeof console?console:void 0!==e&&e.console?e.console:"undefined"!=typeof window&&window.console?window.console:{};const r=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let{length:a}=o;for(;a--;)i=o[a],console[i]||(n[i]=r);n.methods=o,t.a=n}).call(this,n(33))},function(e,t,n){"use strict";n.r(t),n.d(t,"IN_Browser",(function(){return i})),n.d(t,"IN_WXMiniProgram",(function(){return r})),n.d(t,"USER_AGENT",(function(){return o})),n.d(t,"IS_IPAD",(function(){return c})),n.d(t,"IS_IPHONE",(function(){return u})),n.d(t,"IS_IPOD",(function(){return l})),n.d(t,"IS_IOS",(function(){return d})),n.d(t,"IOS_VERSION",(function(){return h})),n.d(t,"IS_ANDROID",(function(){return p})),n.d(t,"ANDROID_VERSION",(function(){return f})),n.d(t,"IS_OLD_ANDROID",(function(){return g})),n.d(t,"IS_NATIVE_ANDROID",(function(){return _})),n.d(t,"IS_FIREFOX",(function(){return v})),n.d(t,"FIREFOX_VERSION",(function(){return m})),n.d(t,"IS_EDGE",(function(){return y})),n.d(t,"IS_EDG",(function(){return I})),n.d(t,"EDG_VERSION",(function(){return T})),n.d(t,"IS_CHROME",(function(){return C})),n.d(t,"CHROME_MAJOR_VERSION",(function(){return S})),n.d(t,"CHROME_VERSION",(function(){return E})),n.d(t,"IS_IE8",(function(){return b})),n.d(t,"IE_VERSION",(function(){return M})),n.d(t,"IS_SAFARI",(function(){return k})),n.d(t,"IS_ANY_SAFARI",(function(){return w})),n.d(t,"SAFARI_VERSION",(function(){return D})),n.d(t,"IS_TBS",(function(){return A})),n.d(t,"TBS_VERSION",(function(){return R})),n.d(t,"IS_MQQB",(function(){return L})),n.d(t,"IS_QQB",(function(){return O})),n.d(t,"IS_WECHAT",(function(){return N})),n.d(t,"IS_WIN",(function(){return x})),n.d(t,"IS_MAC",(function(){return P})),n.d(t,"IS_LINUX",(function(){return U})),n.d(t,"IS_WX",(function(){return G})),n.d(t,"IS_UCBROWSER",(function(){return V})),n.d(t,"IS_MIUIBROWSER",(function(){return F})),n.d(t,"IS_HUAWEIBROWSER",(function(){return B})),n.d(t,"BROWSER_VERSION",(function(){return j})),n.d(t,"IS_LOCAL",(function(){return q}));const i="undefined"!=typeof window,r="undefined"!=typeof wx,o=window.navigator&&window.navigator.userAgent||"",a=/AppleWebKit\/([\d.]+)/i.exec(o),s=a?parseFloat(a.pop()):null,c=/iPad/i.test(o),u=/iPhone/i.test(o)&&!c,l=/iPod/i.test(o),d=u||c||l,h=function(){const e=o.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),p=/Android/i.test(o),f=function(){const e=o.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(`${e[1]}.${e[2]}`):t||null}(),g=p&&/webkit/i.test(o)&&f<2.3,_=p&&f<5&&s<537,v=/Firefox/i.test(o),m=function(){const e=o.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),y=/Edge\//i.test(o),I=/Edg\//i.test(o),T=function(){const e=o.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),C=!y&&/Chrome/i.test(o),S=function(){const e=o.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),E=function(){const e=o.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),b=/MSIE\s8\.0/.test(o),M=function(){const e=/MSIE\s(\d+)\.\d/.exec(o);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(o)&&/rv:11.0/.test(o)&&(t=11),t}(),k=/Safari/i.test(o)&&!C&&!p&&!y,w=k||d,D=function(){const e=o.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),A=/TBS\/\d+/i.test(o),R=function(){const e=o.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),L=!A&&/MQQBrowser\/\d+/i.test(o),O=!A&&/ QQBrowser\/\d+/i.test(o),N=/(micromessenger|webbrowser)/i.test(o),x=/Windows/i.test(o),P=/MAC OS X/i.test(o),U=/Linux/i.test(o),G=/MicroMessenger/i.test(o),V=/UCBrowser/i.test(o),F=/MiuiBrowser/i.test(o),B=/HuaweiBrowser/i.test(o),j=C?"Chrome/"+E:k?"Safari/"+D:"NotSupportedBrowser",q="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICEID_TYPE=t.DEVICE_TYPE=t.CALL_EXPERMENTEL_API_TYPE=t.MODE_TYPE=t.VALID_VIDEO_PROFILE_LIST=t.BUSINESS_ID=t.ACTION_TYPE=t.CALL_ROLE=t.CALL_STATUS=t.CMD_TYPE=t.CMD_TYPE_LIST=t.CALL_TYPE=void 0;var i=n(13);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.AUDIO_CALL=1]="AUDIO_CALL",e[e.VIDEO_CALL=2]="VIDEO_CALL"}(t.CALL_TYPE||(t.CALL_TYPE={})),t.CMD_TYPE_LIST=["","audioCall","videoCall"],function(e){e.AUDIO_CALL="audioCall",e.VIDEO_CALL="videoCall",e.HANG_UP="hangup",e.SWITCH_TO_AUDIO="switchToAudio",e.SWITCH_TO_AUDIO_CALL="switch_to_audio_call",e.SWITCH_TO_VIDEO="switchToVideo"}(t.CMD_TYPE||(t.CMD_TYPE={})),function(e){e.IDLE="idle",e.CALLING="calling",e.CONNECTED="connected"}(t.CALL_STATUS||(t.CALL_STATUS={})),function(e){e.UNKNOWN="",e.INVITER="inviter",e.INVITEE="invitee"}(t.CALL_ROLE||(t.CALL_ROLE={})),function(e){e[e.INVITE=1]="INVITE",e[e.CANCEL_INVITE=2]="CANCEL_INVITE",e[e.ACCEPT_INVITE=3]="ACCEPT_INVITE",e[e.REJECT_INVITE=4]="REJECT_INVITE",e[e.INVITE_TIMEOUT=5]="INVITE_TIMEOUT"}(t.ACTION_TYPE||(t.ACTION_TYPE={})),function(e){e[e.SIGNAL=1]="SIGNAL"}(t.BUSINESS_ID||(t.BUSINESS_ID={})),t.VALID_VIDEO_PROFILE_LIST=Object.keys(i.TUICommonDefine.VideoEncoderParams),function(e){e.AUDIO="audio",e.VIDEO="video"}(t.MODE_TYPE||(t.MODE_TYPE={})),function(e){e[e.BASE=Math.pow(2,16)]="BASE",e[e.PRO=Math.pow(2,17)]="PRO",e[e.ULTIMATE=Math.pow(2,18)]="ULTIMATE"}(t.CALL_EXPERMENTEL_API_TYPE||(t.CALL_EXPERMENTEL_API_TYPE={})),function(e){e.AUDIO="audio",e.VIDEO="video",e.CAMERA="camera",e.MICROPHONES="microphones"}(t.DEVICE_TYPE||(t.DEVICE_TYPE={})),function(e){e.audio="microphoneId",e.video="cameraId"}(t.DEVICEID_TYPE||(t.DEVICEID_TYPE={}))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(5),s=function(e){function t(t){var n=t.message,i=t.code,r=void 0===i?o.default.UNKNOWN:i,s=e.call(this,n+" "+function(e){for(var t in a.ERROR_CN_MESSAGE)if(o.default[t]===e)return a.ERROR_CN_MESSAGE[t];return"UNKNOWN"}(r)+" <"+function(e){for(var t in o.default)if(o.default[t]===e)return t;return"UNKNOWN"}(r)+": "+r+">")||this;return s.code=r,s.name="TUICallEngineError",s.message_=n,s}return r(t,e),t.prototype.getCode=function(){return this.code},t}(Error);t.default=s},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(1),o=n(4),a=n.n(o),s=n(5);class c{constructor(e){this.sdkappid="",this.version="",this.userid="",this.platform="",this.useragent="",this.method=e,this.codeint=1,this.calltype=1,this.talktime=0,this.message="",this.text="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.time="",this.networktype="",this.host=Object(i.getHostType)()}static bindController(e){c.prototype._eventStatController=e}setCommonInfo(e){const{SDKAppID:t,version:n,userID:r,platform:o,scene:a}=e;this.sdkappid=t,this.version=""+n,this.userid=r,this.platform=o,this.scene=a,this.time=Object(i.date2ISOString)(),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}setEnd(e=!1){this.endts=Date.now(),e?this._eventStatController.pushIn(this):setTimeout((()=>{this._eventStatController.pushIn(this)}),0)}setError(e,t,n){return this.setNetworkType(n),t?(e.code&&this.setCode(e.code),e.message&&this.setMessage(e.message)):(this.setCode(a.a.NO_NETWORK),this.setMessage(s.ERROR_MESSAGE.NO_NETWORK)),this}setCode(e){return"ECONNABORTED"===e&&(this.codeint=103),Object(i.isNumber)(e)?this.codeint=e:r.default.warn("SSOLogData.setCode value not a number, please check!",e,typeof e),this}setMessage(e){return Object(i.isString)(e)?(this.message=e,this):this}setText(e){return Object(i.isNumber)(e)?this.text=e.toString():Object(i.isString)(e)&&(this.text=e),this}setTalkTime(e){return this.talktime=e,this}setMessageType(e){return this.msgType=e,this}setCallType(e){return this.calltype=e,this}setNetworkType(e){return Object(i.isUndefined)(e)?r.default.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networktype=e,this}}t.default=c},function(e,t,n){"use strict";n.r(t),t.default={SDK_CONSTRUCT:"sdkConstruct",SDK_READY:"sdkReady",SDK_NOT_READY:"sdkNotReady",LOGIN:"login",LOGOUT:"logout",CALL:"call",GROUP_CALL:"groupCall",ACCEPT:"accept",REJECT:"reject",HANGUP:"hangup",START_REMOTE_VIEW:"startRemoteView",STOP_REMOTE_VIEW:"stopRemoteView",START_LOCAL_VIEW:"startLocalView",STOP_LOCAL_VIEW:"stopLocalView",OPEN_CAMERA:"openCamera",CLOSE_CAMERA:"closeCamera",SET_MIC_MUTE:"setMicMute",SET_VIDEO_QUALITY:"setVideoQuality",SWITCH_TO_AUDIO_CALL:"switchToAudioCall",SWITCH_TO_VIDEO_CALL:"switchToVideoCall",CHANGE_CALL_STATUS:"changeCallStatus",TALK_TIME:"talktime",ERROR:"error",INVITED:"invited",GROUP_CALL_INVITEE_LIST_UPDATE:"group_call_invitee_list_update",USER_ENTER:"user_enter",USER_LEAVE:"user_leave",NO_RESP:"no_resp",LINE_BUSY:"line_busy",CALLING_CANCEL:"calling_cancel",KICKED_OUT:"kicked_out",CALLING_TIMEOUT:"calling_timeout",CALLING_END:"calling_end",USER_VIDEO_AVAILABLE:"user_video_available",USER_AUDIO_AVAILABLE:"user_audio_available",USER_VOICE_VOLUME:"user_voice_volume",CALL_TYPE_CHANGED:"call_type_changed",DEVICED_UPDATED:"deviced_updated",QUALITY_REPORT:"quality_report"}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var i=n(1),r=n(0);class o{constructor(){this._table="timweb-trtccalling",this._report=[]}pushIn(e){i.default.debug("SSOLogBody.pushIn",this._report.length,e),this._report.push(e)}backfill(e){Object(r.isArray)(e)&&0!==e.length&&(i.default.debug("SSOLogBody.backfill",this._report.length,e.length),this._report.unshift(...e))}getLogsNumInMemory(){return this._report.length}isEmpty(){return 0===this._report.length}_reset(){this._report.length=0,this._report=[]}getTable(){return this._table}getLogsInMemory(){const e=this._report.slice();return this._reset(),e}}var a=n(10),s=n(16),c=n(27),u=n.n(c);const l={CURRENT:{COMMON:"https://webim.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com"},OVERSEA_PRODUCTION:{COMMON:"https://api.im.qcloud.com"},SANDBOX:{COMMON:"https://events.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com"}},d={IM_OPEN_STAT:"imopenstat"},h={TIM_WEB_TRTCCALLING_REPORT:"tweb_trtccalling_report"},p={imopenstat:"v4"};class f{constructor(){this.TAG="trtccalling-ssolog-event",this._reportBody=new o,this._version=s.version||"",this.MIN_THRESHOLD=20,this.MAX_THRESHOLD=100,this.WAITING_TIME=6e4,this.INTERVAL=2e4,this._timerID=0,this._resetLastReportTime(),this._startReportTimer(),this._retryCount=0,this.MAX_RETRY_COUNT=3}reportAtOnce(){i.default.debug("EventStatController.reportAtOnce"),this._report()}pushIn(e){e instanceof a.default&&(e.setCommonInfo({SDKAppID:Number(sessionStorage.getItem("sdkAppId")),version:this._version,userID:sessionStorage.getItem("userId")}),this._reportBody.pushIn(e),this._report())}_resetLastReportTime(){this._lastReportTime=Date.now()}_startReportTimer(){this._timerID=setInterval((()=>{Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}),this.INTERVAL)}_stopReportTimer(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}_report(){if(this._reportBody.isEmpty())return;const e=Math.ceil(+new Date/1e3),t=sessionStorage.getItem("sdkAppId"),n=this._reportBody.getLogsInMemory(),o={table:this._reportBody.getTable(),report:n},a=`${l.CURRENT.COMMON}/${p.imopenstat}/${d.IM_OPEN_STAT}/${h.TIM_WEB_TRTCCALLING_REPORT}/?sdkappid=${t}&reqtime=${e}`;u.a.post(a,JSON.stringify(o)).then((()=>{this._resetLastReportTime(),this._retryCount>0&&(i.default.debug("EventStatController.report retry success"),this._retryCount=0)})).catch((e=>{i.default.warn("EventStatController.report, error:"+Object(r.stringifyError)(e)),this._reportBody.backfill(n),this._reportBody.getLogsNumInMemory()>this.MAX_THRESHOLD||this._retryCount===this.MAX_RETRY_COUNT||0===this._timerID?this._retryCount=0:this._retryCount+=1}))}reset(){i.default.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICommonDefine=t.TUICallType=void 0,t.TUICallType={AUDIO_CALL:1,VIDEO_CALL:2,DEVCIED_CAMERA:"camera",DEVCIED_MICROPHONES:"microphones"},t.TUICommonDefine={VideoEncoderParams:{"120p":"120p","120p_2":"120p_2","180p":"180p","180p_2":"180p_2","240p":"240p","360p":"360p","360p_2":"360p_2","480p":"480p","480p_2":"480p_2","720p":"720p","1080p":"1080p","1440p":"1440p","4K":"4K"}}},function(e,t,n){"use strict";(function(t){var i=n(3),r=n(41),o=n(20),a={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(c=n(21)),c),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(i.isString(e))try{return(t||JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||r&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw o(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){u.headers[e]=i.merge(a)})),e.exports=u}).call(this,n(40))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEvent=void 0,t.TUICallEvent={ERROR:"onError",SDK_READY:"sdkReady",INVITED:"onInvited",USER_ACCEPT:"onUserAccept",USER_ENTER:"onUserEnter",USER_LEAVE:"onUserLeave",REJECT:"onReject",NO_RESP:"onNoResp",LINE_BUSY:"onLineBusy",CALLING_CANCEL:"onCallingCancel",KICKED_OUT:"onKickedOut",CALLING_TIMEOUT:"onCallingTimeout",CALL_END:"onCallEnd",CALLING_END:"onCallEnd",USER_VIDEO_AVAILABLE:"onUserVideoAvailable",USER_AUDIO_AVAILABLE:"onUserAudioAvailable",USER_VOICE_VOLUME:"onUserVoiceVolume",GROUP_CALL_INVITEE_LIST_UPDATE:"onGroupCallInviteeListUpdate",CALL_TYPE_CHANGED:"onCallTypeChanged",DEVICED_UPDATED:"onDeviceUpdated",MESSAGE_SENT_BY_ME:"onMessageSentByMe"}},function(e){e.exports=JSON.parse('{"name":"tuicall-engine-webrtc","version":"1.4.4","description":"腾讯云 tuicall-engine-webrtc","main":"index","private":true,"dependencies":{"rtc-ai-denoiser":"^1.1.3","EventEmitter":"^1.0.0","axios":"^0.21.0","dayjs":"^1.11.7"},"peerDependencies":{"trtc-js-sdk":"^4.15.7","tim-js-sdk":"^2.27.2","tsignaling":"^1.0.5"},"devDependencies":{"@babel/preset-typescript":"^7.12.7","@tencent/eslint-config-tencent":"^0.16.1","@typescript-eslint/eslint-plugin":"^4.33.0","@typescript-eslint/parser":"^4.33.0","docdash-blue":"^1.1.9","eslint":"^7.27.0","eslint-config-google":"^0.14.0","eslint-plugin-prettier":"^4.0.0","fs-extra":"^9.0.1","jsdoc":"^3.6.11","prettier":"^2.5.0","pretty":"^2.0.0","replace":"^1.2.2","rimraf":"^4.1.2","ts-loader":"^8.4.0","typescript":"^3.9.7","watch":"^1.0.2","webpack":"^4.44.1","webpack-cli":"^3.3.12"},"scripts":{"watch":"watch \'npm run build_withcopy3\' src","dev":"npm run watch","build":"webpack --config webpack.config.js","build_withcopy":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../../github/TUICalling/Web/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy2":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../sdk/trtc-calling-webrtc-demo/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy3":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ./example-js/tuicall-engine-webrtc.js","build:package":"node build/package-bundle.js","lint":"./node_modules/.bin/eslint ./src; exit 0","fix":"./node_modules/.bin/eslint --fix ./src; exit 0","prerelease":"npm run lint && npm run build && npm run doc && npm run build:package","doc":"npm run doc:clean && tsc  --target ESNEXT && npm run doc:build","doc:build":"npm run changelog && npm run main && ./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/20-CHANGELOG.md","main":"cp README.md build/jsdoc/main.md"},"repository":{"type":"git","url":"https://github.com/tencentyun/TUICallKit/tree/main/Web"},"author":"Tencent Cloud Terminal R&D Center","license":"ISC"}')},function(t,n){t.exports=e},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){"use strict";var i=n(3);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(i.isURLSearchParams(t))o=t.toString();else{var a=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(r(t)+"="+r(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var i=n(3),r=n(42),o=n(43),a=n(19),s=n(44),c=n(47),u=n(48),l=n(22);e.exports=function(e){return new Promise((function(t,n){var d=e.data,h=e.headers,p=e.responseType;i.isFormData(d)&&delete h["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var g=e.auth.username||"",_=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(g+":"+_)}var v=s(e.baseURL,e.url);function m(){if(f){var i="getAllResponseHeaders"in f?c(f.getAllResponseHeaders()):null,o={data:p&&"text"!==p&&"json"!==p?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:i,config:e,request:f};r(t,n,o),f=null}}if(f.open(e.method.toUpperCase(),a(v,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,"onloadend"in f?f.onloadend=m:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(m)},f.onabort=function(){f&&(n(l("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){n(l("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},i.isStandardBrowserEnv()){var y=(e.withCredentials||u(v))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;y&&(h[e.xsrfHeaderName]=y)}"setRequestHeader"in f&&i.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),p&&"json"!==p&&(f.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),n(e),f=null)})),d||(d=null),f.send(d)}))}},function(e,t,n){"use strict";var i=n(20);e.exports=function(e,t,n,r,o){var a=new Error(e);return i(a,t,n,r,o)}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";var i=n(3);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],o=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function c(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function u(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=c(void 0,e[r])):n[r]=c(e[r],t[r])}i.forEach(r,(function(e){i.isUndefined(t[e])||(n[e]=c(void 0,t[e]))})),i.forEach(o,u),i.forEach(a,(function(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=c(void 0,e[r])):n[r]=c(void 0,t[r])})),i.forEach(s,(function(i){i in t?n[i]=c(e[i],t[i]):i in e&&(n[i]=c(void 0,e[i]))}));var l=r.concat(o).concat(a).concat(s),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return i.forEach(d,u),n}},function(e,t,n){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateBusiness=t.businessValidate=void 0;var o=n(9),a=n(4),s=n(5),c=n(8);function u(e,t,n){return i(this,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.tim.callExperimentalAPI("isCommercialAbilityEnabled",e)];case 1:if(i.sent().data.enabled)return[2,t.apply(this,n)];try{e===c.CALL_EXPERMENTEL_API_TYPE.BASE&&(this._callDataReport.setCodeAndMessage(a.default.ERROR_PACKAGE_NOT_SUPPORTED,s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED),this._callDataReport.uploadToKibana())}catch(e){console.warn("base ability check failed, userId:"+this.getUserID()+", error: "+e)}throw new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new o.default({message:s.ERROR_MESSAGE.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:a.default.ERROR_TIM_VERSION_OUTDATED}):new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}t.businessValidate=function(e){return function(t,n,o){var a=o.value;return o.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,u.call(this,e,a,t)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},o}},t.validateBusiness=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.callExperimentalAPI("isCommercialAbilityEnabled",t)];case 1:if((n=i.sent()).data.enabled)return[2,Promise.resolve(n.data.enabled)];throw new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new o.default({message:s.ERROR_MESSAGE.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:a.default.ERROR_TIM_VERSION_OUTDATED}):new o.default({message:s.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}},function(e,t,n){e.exports=n(35)},function(e,t,n){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",i="second",r="minute",o="hour",a="day",s="week",c="month",u="quarter",l="year",d="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},_=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},v={s:_,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+_(i,2,"0")+":"+_(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,c),o=n-r<0,a=t.clone().add(i+(o?-1:1),c);return+(-(i+(n-r)/(o?r-a:a-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:l,w:s,d:a,D:d,h:o,m:r,s:i,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},m="en",y={};y[m]=g;var I=function(e){return e instanceof E},T=function e(t,n,i){var r;if(!t)return m;if("string"==typeof t){var o=t.toLowerCase();y[o]&&(r=o),n&&(y[o]=n,r=o);var a=t.split("-");if(!r&&a.length>1)return e(a[0])}else{var s=t.name;y[s]=t,r=s}return!i&&r&&(m=r),r||!i&&m},C=function(e,t){if(I(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new E(n)},S=v;S.l=T,S.i=I,S.w=function(e,t){return C(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function g(e){this.$L=T(e.locale,null,!0),this.parse(e)}var _=g.prototype;return _.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(p);if(i){var r=i[2]-1||0,o=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},_.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},_.$utils=function(){return S},_.isValid=function(){return!(this.$d.toString()===h)},_.isSame=function(e,t){var n=C(e);return this.startOf(t)<=n&&n<=this.endOf(t)},_.isAfter=function(e,t){return C(e)<this.startOf(t)},_.isBefore=function(e,t){return this.endOf(t)<C(e)},_.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},_.unix=function(){return Math.floor(this.valueOf()/1e3)},_.valueOf=function(){return this.$d.getTime()},_.startOf=function(e,t){var n=this,u=!!S.u(t)||t,h=S.p(e),p=function(e,t){var i=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?i:i.endOf(a)},f=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,_=this.$M,v=this.$D,m="set"+(this.$u?"UTC":"");switch(h){case l:return u?p(1,0):p(31,11);case c:return u?p(1,_):p(0,_+1);case s:var y=this.$locale().weekStart||0,I=(g<y?g+7:g)-y;return p(u?v-I:v+(6-I),_);case a:case d:return f(m+"Hours",0);case o:return f(m+"Minutes",1);case r:return f(m+"Seconds",2);case i:return f(m+"Milliseconds",3);default:return this.clone()}},_.endOf=function(e){return this.startOf(e,!1)},_.$set=function(e,t){var s,u=S.p(e),h="set"+(this.$u?"UTC":""),p=(s={},s[a]=h+"Date",s[d]=h+"Date",s[c]=h+"Month",s[l]=h+"FullYear",s[o]=h+"Hours",s[r]=h+"Minutes",s[i]=h+"Seconds",s[n]=h+"Milliseconds",s)[u],f=u===a?this.$D+(t-this.$W):t;if(u===c||u===l){var g=this.clone().set(d,1);g.$d[p](f),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},_.set=function(e,t){return this.clone().$set(e,t)},_.get=function(e){return this[S.p(e)]()},_.add=function(n,u){var d,h=this;n=Number(n);var p=S.p(u),f=function(e){var t=C(h);return S.w(t.date(t.date()+Math.round(e*n)),h)};if(p===c)return this.set(c,this.$M+n);if(p===l)return this.set(l,this.$y+n);if(p===a)return f(1);if(p===s)return f(7);var g=(d={},d[r]=e,d[o]=t,d[i]=1e3,d)[p]||1,_=this.$d.getTime()+n*g;return S.w(_,this)},_.subtract=function(e,t){return this.add(-1*e,t)},_.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=S.z(this),o=this.$H,a=this.$m,s=this.$M,c=n.weekdays,u=n.months,l=function(e,n,r,o){return e&&(e[n]||e(t,i))||r[n].slice(0,o)},d=function(e){return S.s(o%12||12,e,"0")},p=n.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:S.s(s+1,2,"0"),MMM:l(n.monthsShort,s,u,3),MMMM:l(u,s),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:l(n.weekdaysMin,this.$W,c,2),ddd:l(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(o),HH:S.s(o,2,"0"),h:d(1),hh:d(2),a:p(o,a,!0),A:p(o,a,!1),m:String(a),mm:S.s(a,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:r};return i.replace(f,(function(e,t){return t||g[e]||r.replace(":","")}))},_.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},_.diff=function(n,d,h){var p,f=S.p(d),g=C(n),_=(g.utcOffset()-this.utcOffset())*e,v=this-g,m=S.m(this,g);return m=(p={},p[l]=m/12,p[c]=m,p[u]=m/3,p[s]=(v-_)/6048e5,p[a]=(v-_)/864e5,p[o]=v/t,p[r]=v/e,p[i]=v/1e3,p)[f]||v,h?m:S.a(m)},_.daysInMonth=function(){return this.endOf(c).$D},_.$locale=function(){return y[this.$L]},_.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=T(e,t,!0);return i&&(n.$L=i),n},_.clone=function(){return S.w(this.$d,this)},_.toDate=function(){return new Date(this.valueOf())},_.toJSON=function(){return this.isValid()?this.toISOString():null},_.toISOString=function(){return this.$d.toISOString()},_.toString=function(){return this.$d.toUTCString()},g}(),b=E.prototype;return C.prototype=b,[["$ms",n],["$s",i],["$m",r],["$H",o],["$W",a],["$M",c],["$y",l],["$D",d]].forEach((function(e){b[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),C.extend=function(e,t){return e.$i||(e(t,E,C),e.$i=!0),C},C.locale=T,C.isDayjs=I,C.unix=function(e){return C(1e3*e)},C.en=y[m],C.Ls=y,C.p={},C}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),r=n(15),o=n(13);t.default={TUICallEngine:i.default,TUICallEvent:r.TUICallEvent,TUICallType:o.TUICallType}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var u=n(31),l=n(0),d=n(32),h=n(17),p=n(55),f=n(56),g=n(58),_=n(10),v=n(11),m=n(12),y=n(7),I=n(59),T=n(1),C=n(8),S=n(9),E=n(4),b=n(5),M=n(2),k=n(60),w=n(67),D=h,A=p,R=n(16),L="TUICallEngine",O=function(){function e(e){this._localPlayOptions={mirror:!1,muted:!0,objectFit:M.NAME.COVER},this._remotePlayOptions={mirror:!1,muted:!1,objectFit:M.NAME.COVER},this._permission={audio:!1,video:!1},this._sdkAppID=e.SDKAppID,this._isLogin=!1,this._trtcClient=null,this._userID="",this._userSig="",this._switchCallModeStatus=!0,this._timExternal=!1,this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._callTimeout=30,this._callStatus=C.CALL_STATUS.IDLE,this._callType=C.CALL_TYPE.UNKNOWN,this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this._groupCallStatus=!1,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],sessionStorage.setItem("sdkAppId",""+this._sdkAppID),this._localViewId="",this._netMonitor=new I.default,this._outerEmitter=new u.default,this._delegate=new g.default(this._outerEmitter),this._callDataReport=new w.CallDataReport({version:R.version,sdkAppId:e.SDKAppID}),this._dataReportObserver=new w.TUICallEngineObserver(this._outerEmitter,this._callDataReport),this._connectStartTime=0,e.tim&&(this._timExternal=!0),this.tim=e.tim||A.create(e),this._tsignalingClient=new f.default(this,i(i({tim:this.tim},e),{isRejectNotifyAll:!0})),this._quality="480p";var t=new _.default(v.default.SDK_CONSTRUCT);this._eventStatController=new m.default,_.default.bindController(this._eventStatController),t.setText("version="+R.version+"-ua="+y.USER_AGENT).setEnd(),T.default.info(L+" SDK Version:"+R.version+", SDKAppID:"+e.SDKAppID+", UserAgent:"+y.USER_AGENT)}return e.prototype.getDevicePermission=function(){return this._permission},e.prototype.setDevicePermission=function(e,t){this._permission[e]=t},e.prototype.getTrtcClient=function(){var e;return null===(e=this._trtcClient)||void 0===e?void 0:e.getClient()},e.prototype.getUserID=function(){return this._userID},e.prototype.setRoomID=function(e){this._roomID=e},e.prototype.getRoomID=function(){return this._roomID},e.prototype.getCallType=function(){return this._callType},e.prototype.setCallType=function(e){this._callType=e},e.prototype.isInviter=function(){return this._isInviter},e.prototype.setConnectStartTime=function(e){this._connectStartTime=e},e.prototype.getConnectStartTime=function(){return this._connectStartTime},e.prototype.getInviteeList=function(){return this._inviteeList},e.prototype.setInviteeList=function(e){this._inviteeList=c(e)},e.prototype.getCallDataReport=function(){return this._callDataReport},e.prototype.getUnHandledInviteeList=function(){return this._unHandledInviteeList||[]},e.prototype.setUnHandledInviteeList=function(e){this._unHandledInviteeList=c(e),T.default.log(L+".setUnHandledInviteeList",this._unHandledInviteeList)},e.prototype.addUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._unHandledInviteeList.indexOf(e)&&t._unHandledInviteeList.push(e)}))},e.prototype.deleteUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._unHandledInviteeList=t._unHandledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.getHandledInviteeList=function(){return this._handledInviteeList||[]},e.prototype.setHandledInviteeList=function(e){this._handledInviteeList=c(e),T.default.log(L+".setHandledInviteeList",this._handledInviteeList)},e.prototype.addHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._handledInviteeList.indexOf(e)&&t._handledInviteeList.push(e)}))},e.prototype.deleteHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._handledInviteeList=t._handledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.isGroupCall=function(){return this._isGroupCall},e.prototype.setIsGroupCall=function(e){this._isGroupCall=e},e.prototype.getGroupID=function(){return this._groupID},e.prototype.setGroupID=function(e){this._groupID=e},e.prototype.setLocalPlayOptions=function(e){void 0===e&&(e={}),this._localPlayOptions=i(i({},this._localPlayOptions),e)},e.prototype.getLocalPlayOptions=function(){return this._localPlayOptions||{}},e.prototype.setRemotePlayOptions=function(e){void 0===e&&(e={}),this._remotePlayOptions=i(i({},this._remotePlayOptions),e)},e.prototype.getRemotePlayOptions=function(){return this._remotePlayOptions||{}},e.prototype.addAcceptedUserList=function(e,t){var n=this;if(0!==t.length)if(e)0===(this._acceptedUserObject[e]||[]).length?this._acceptedUserObject[e]=t:t.forEach((function(t){-1===n._acceptedUserObject[e].indexOf(t)&&n._acceptedUserObject[e].push(t)}));else for(var i=this.getInviterInviteIdList(),r=function(e){var r=i[e],a=o.getInviterInviteIdUserList(r),s=t.filter((function(e){return-1!==a.indexOf(e)}));0===(o._acceptedUserObject[r]||[]).length?o._acceptedUserObject[r]=s:s.forEach((function(e){-1===n._acceptedUserObject[r].indexOf(e)&&n._acceptedUserObject[r].push(e)}))},o=this,a=0;a<i.length;a++)r(a)},e.prototype.getAcceptedUserList=function(e){return this._acceptedUserObject[e]||[]},e.prototype.setIsLogin=function(e){this._isLogin=e},e.prototype.getIsLogin=function(){return this._isLogin},e.createInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.destroyInstance=function(){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.getIsLogin()?this._timExternal?[4,this.logout()]:[3,2]:[3,4];case 1:return t.sent(),[3,4];case 2:return[4,this.tim.destroy()];case 3:t.sent(),t.label=4;case 4:return this._callDataReport.reset(),this._dataReportObserver.removeLister(),e.instance=null,[2]}}))}))},e.prototype.setLogLevel=function(e){T.default.setLevel(e),this._tsignalingClient.setLogLevel(e),D.Logger.setLogLevel(1)},e.prototype.on=function(e,t,n){this._outerEmitter.on(e,t,n||this)},e.prototype.off=function(e,t,n){this._outerEmitter.off(e,t,n||this)},e.prototype.init=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.login(e)]}))}))},e.prototype.login=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,o;return s(this,(function(a){switch(a.label){case 0:if(this.getIsLogin())return T.default.warn(L+".login - userId has been login"),[2];a.label=1;case 1:return a.trys.push([1,3,,4]),T.default.debug(L+".login - params:",e),this._netMonitor.start(),t=e.userID,n=e.userSig,i=e.assetsPath,this._userID=t,this._callDataReport.setUserID(t),this._userSig=n,this._trtcClient=new d.default({sdkAppID:this._sdkAppID,userID:t,userSig:n,tuiCallEngine:this,assetsPath:i}),sessionStorage.setItem("userId",""+this._userID),[4,this._tsignalingClient.login({userID:t,userSig:n})];case 2:return r=a.sent(),this.setIsLogin(!0),this._setInterfaceUpLoad(v.default.LOGIN).setText("userId: "+this._userID+" login succeeded, assetsPath: "+i).setEnd(),[2,r];case 3:throw o=a.sent(),this._setInterfaceUpLoad(v.default.LOGIN).setText("userId: "+this._userID+" login failed, error: "+o).setEnd(),new Error(L+".login - userId: "+this._userID+" login failed, error: "+o+" ");case 4:return[2]}}))}))},e.prototype.logout=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:T.default.debug(L+".logout"),this._setInterfaceUpLoad(v.default.LOGOUT).setText("userId: "+this._userID+" logout").setEnd(),this._userID="",this._userSig="",t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this._resetTUICallEngine()];case 2:return t.sent(),this._trtcClient.removeTRTCEvents(),this._trtcClient=null,this.setIsLogin(!1),this._timExternal?[3,4]:[4,this._tsignalingClient.logout()];case 3:t.sent(),t.label=4;case 4:return[2,!0];case 5:throw e=t.sent(),new Error(L+".logout failed, error: "+e+" ");case 6:return[2]}}))}))},e.prototype.call=function(e){var t,n;return a(this,void 0,void 0,(function(){var r,o,a,c,u,d,h,p,f,g,_;return s(this,(function(s){switch(s.label){case 0:T.default.log(L+".call - params:",e),this._callDataReport.setAbilityBit(!0),this._callDataReport.setCallScene(M.NAME.SINGLE_CALL),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({audio:!0})];case 2:return s.sent(),[3,4];case 3:throw r=s.sent(),this._delegate.onError(E.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),this._callDataReport.setCodeAndMessage(E.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),this._callDataReport.uploadToKibana(),new Error(L+".call failed. error: "+r);case 4:if(o=e.userID,a=e.type,c=e.offlinePushInfo,u=e.roomID,d=e.timeout,h=e.userData,this.getUserID()===o)throw T.default.log(L+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+o),new Error(L+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+o);this._callStatus=C.CALL_STATUS.CALLING,this._callType=a,this._isInviter=!0,this._inviterID=this._userID,this._inviteeID=o,this._isGroupCall=!1,this._groupID="",this._roomID=u||l.generateRandomRoomID(),this._callTimeout=d||this._callTimeout,T.default.info("roomID:"+this._roomID),s.label=5;case 5:return s.trys.push([5,11,,13]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.join(this._roomID)];case 6:return s.sent(),this._callDataReport.setEnterRoomTime((new Date).getTime()),this._tsignalingClient.setTSignalingIsJoined(!0),p=this._callDataReport.getCallData(),p=i(i({},p),{roomID:this._roomID,callRole:C.CALL_ROLE.INVITER,callType:this._callType,inviteeList:[o]}),this._callDataReport.setCallData(p),[4,this._tsignalingClient.invite({userID:o,type:a,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:c,userIDList:[o],userData:h})];case 7:return f=s.sent(),this._callDataReport.setSendSignalingTime((new Date).getTime()),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList([o]),g="callType: "+(a+1)+",\n        conversationType: "+f.data.message.conversationType+", \n        userId:{ "+f.data.message.from+" } invite userId:{ "+f.data.message.to+" }",0!==f.code?[3,8]:(this.addInviterInviteId(f.inviteID,[this._userID,o]),this._callDataReport.setInviteID(f.inviteID),this._setInterfaceUpLoad(v.default.CALL).setCallType(a+1).setText(g+" succeeded").setEnd(),[3,10]);case 8:return this._callDataReport.setCodeAndMessage(f.code,f.message),this._callDataReport.uploadToKibana(),this._setInterfaceUpLoad(v.default.CALL).setCallType(a+1).setText(g+" failed").setEnd(),[4,this._resetTUICallEngine()];case 9:s.sent(),s.label=10;case 10:return[2,f];case 11:return(_=s.sent()).getCode?this._callDataReport.setCodeAndMessage(_.getCode(),_.message):this._callDataReport.setCodeAndMessage(E.default.UNKNOWN,JSON.stringify(_)),this._callDataReport.uploadToKibana(),[4,this._resetTUICallEngine()];case 12:throw s.sent(),new S.default({message:L+"<call>: failed "+_.message,code:_.code});case 13:return[2]}}))}))},e.prototype.addAudioVideoSwitchIdList=function(e){e&&this._audioVideoSwitchIdList.push(e)},e.prototype.getAudioVideoSwitchIdList=function(){return this._audioVideoSwitchIdList||[]},e.prototype.addInviterInviteId=function(e,t){0!==t.length&&(0===(this._inviterInviteID[e]||[]).length?this._inviterInviteID[e]=t:this._inviterInviteID[e]=c(this._inviterInviteID[e],t))},e.prototype.getInviterInviteIdList=function(){return Object.keys(this._inviterInviteID||{})},e.prototype.getTotalInviterInviteIdList=function(){var e=this.getInviterInviteIdList();return c(this._audioVideoSwitchIdList,e)},e.prototype.getInviterInviteIdUserList=function(e){return this._inviterInviteID[e]||[]},e.prototype._setInterfaceUpLoad=function(e){return T.default.time(e),new _.default(e)},e.prototype.getInviterID=function(){return this._inviterID},e.prototype.setInviterID=function(e){this._inviterID=e},e.prototype.groupCall=function(e){var t,n;return a(this,void 0,void 0,(function(){var i,r,o,a,u,d,h,p,f,g,_;return s(this,(function(s){switch(s.label){case 0:if(0===(null===(t=null==e?void 0:e.userIDList)||void 0===t?void 0:t.length))throw new S.default({message:L+"<groupCall>: userIDList don'\t empty ",code:E.default.ERROR_PARAM_INVALID});if(this._groupCallStatus)throw new Error(L+".groupCall - CALL_STATUS: "+this._callStatus);this._groupCallStatus=!0,T.default.debug(L+".groupCall - params:",e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.getMediaDevicesAuth({audio:!0})];case 2:return s.sent(),[3,4];case 3:throw i=s.sent(),this._delegate.onError(E.default.NOT_MEDIA_ACCESS,JSON.stringify(i)),new Error(L+".groupCall failed. error: "+i);case 4:if(r=e.userIDList,o=e.type,a=e.groupID,u=e.offlinePushInfo,d=e.roomID,h=e.timeout,p=e.userData,-1!==(r=c(r)).indexOf(this.getUserID()))throw T.default.log(L+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+r),new Error(L+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+r);this._callType=o,this._isInviter=!0,this._isGroupCall=!0,this._inviterID=this._userID,this._groupID=a||"",this.setInviteeList(r),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList(r),this._roomID||(this._roomID=d||l.generateRandomRoomID(),this._callStatus=C.CALL_STATUS.CALLING),this._callTimeout=h||this._callTimeout,this._callDataReport.setCallScene(M.NAME.GROUP_CALL),s.label=5;case 5:return s.trys.push([5,8,,10]),[4,this._trtcClient.join(this._roomID)];case 6:return s.sent(),this._tsignalingClient.setTSignalingIsJoined(!0),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:r,type:o,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:u,userData:p})];case 7:return f=s.sent(),T.default.log("groupCall res",f),a&&(g="callType: "+(o+1)+",\n        conversationType: "+f.data.message.conversationType+",\n        userId:{ "+f.data.message.from+" } invite { "+f.data.message.to+": "+r+" }",0===f.code?(this.addInviterInviteId(f.inviteID,c([this._userID],r)),this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(o+1).setText(g+"  succeeded").setEnd()):this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(o+1).setText(g+"  failed").setEnd()),this._groupCallStatus=!1,[2,f];case 8:return _=s.sent(),[4,this._resetTUICallEngine()];case 9:throw s.sent(),new S.default({message:L+"<groupCall>: failed "+_.message,code:_.code});case 10:return[2]}}))}))},e.prototype.joinInGroupCall=function(e){var t,n;return a(this,void 0,void 0,(function(){var i,r,o,a,c;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({audio:!0})];case 1:return s.sent(),[3,3];case 2:throw i=s.sent(),new Error(L+".joinInGroupCall failed, error: "+i);case 3:return s.trys.push([3,5,,7]),r=e.roomID,o=e.type,a=e.groupID,this._callType=o,this._groupID=a,this._roomID=r,this._isGroupCall=!0,this._isInviter=!1,this.addHandledInviteeList([this.getUserID()]),this.changeCallStatus(C.CALL_STATUS.CALLING),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.join(r)];case 4:return s.sent(),T.default.log(L+".joinInGroupCall roomID:"+r+",type:"+o+",userID:"+this.getUserID()),[3,7];case 5:return c=s.sent(),[4,this._resetTUICallEngine()];case 6:throw s.sent(),new Error(L+".joinInGroupCall failed error: "+c);case 7:return[2]}}))}))},e.prototype.inviteUser=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,o,a,u,l,d,h,p,f=this;return s(this,(function(s){switch(s.label){case 0:if(!this.isGroupCall())throw T.default.error(L+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType),new Error(L+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType);if(!this.isInviter()&&this._callStatus!==C.CALL_STATUS.CONNECTED)throw T.default.error(L+".inviteUser failed - current status:"+this._callStatus+" not support"),new Error(L+".inviteUser failed - current status:"+this._callStatus+" not support");if(t=e.userIDList,n=void 0===t?[]:t,i=e.offlinePushInfo,0===n.length)throw T.default.error(L+".inviteUser failed - userIDList is empty"),new Error(L+".inviteUser failed - userIDList is empty");if(r=this.getHandledInviteeList(),o=this.getUnHandledInviteeList(),a=c(r,o),0===(u=n.filter((function(e){return-1===a.indexOf(e)}))).length)return T.default.error(L+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(a)),[2,Promise.reject(L+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(a))];n=u,s.label=1;case 1:return s.trys.push([1,3,,4]),l=this._handledInviteeList.filter((function(e){return e!==f._userID})),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:n,type:this._callType,roomID:this._roomID,timeout:this._callTimeout,inCallUserIDs:c(this._unHandledInviteeList,l),offlinePushInfo:i})];case 2:return d=s.sent(),T.default.log("inviteUser res",d),h="callType: "+(this._callType+1)+",\n      conversationType: "+d.data.message.conversationType+",\n      userId:{ "+d.data.message.from+" } invite { "+d.data.message.to+": "+n+" }",0===d.code?(this.addUnHandledInviteeList(n),this.addInviterInviteId(d.inviteID,c([this._userID],n)),this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(this._callType+1).setText(h+"  succeeded").setEnd()):this._setInterfaceUpLoad(v.default.GROUP_CALL).setCallType(this._callType+1).setText(h+"  failed").setEnd(),[2,d];case 3:throw p=s.sent(),new Error(L+".inviteUser failed, userId:"+this.getUserID()+", inviteeIdList:"+n+", error: "+p);case 4:return[2]}}))}))},e.prototype.accept=function(){var e,t,n,r,o,c;return a(this,void 0,void 0,(function(){var a,u,l,d,h,p,f,g,_,m,y;return s(this,(function(s){switch(s.label){case 0:if(T.default.debug(L+".accept"),this.getCallStatus()===C.CALL_STATUS.CONNECTED)return T.default.warn(L+".accept - already connected, avoid repeat accept"),[2];if(!this._tsignalingClient.getInviteData())return T.default.warn(L+".accept - there are no calls to accept"),[2];this._callDataReport.setCallAcceptTime((new Date).getTime()),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,null===(e=this._trtcClient)||void 0===e?void 0:e.getMediaDevicesAuth({audio:!0})];case 2:return s.sent().audio?[3,4]:[4,this._resetTUICallEngine()];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:throw a=s.sent(),this.isGroupCall()&&(this._callDataReport.setCodeAndMessage(E.default.NOT_MEDIA_ACCESS,JSON.stringify(a)),this._callDataReport.uploadToKibana()),new Error(L+".accept failed, error: "+a);case 6:u=this._tsignalingClient.getInviteData(),l=u.inviteID,d=u.inviteData,h=d.roomID,p=d.callType,T.default.debug(L+".accept - params","inviteID: "+l+",callType: "+p+",roomID: "+h+"."),this._callType=p,this._callStatus=C.CALL_STATUS.CALLING,console.log("accept roomId: "+h),f={},s.label=7;case 7:return s.trys.push([7,9,,11]),this._callDataReport.setEnterRoomTime((new Date).getTime()),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.join(h)];case 8:return f=s.sent(),this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(l,[this.getUserID()]),this._tsignalingClient.setInviteData(null),this.changeCallStatus(C.CALL_STATUS.CONNECTED),[3,11];case 9:return g=s.sent(),this.isGroupCall()||(g.getCode?this._callDataReport.setCodeAndMessage(g.getCode(),g.message):this._callDataReport.setCodeAndMessage(E.default.UNKNOWN,JSON.stringify(g)),this._callDataReport.uploadToKibana()),[4,this._resetTUICallEngine()];case 10:throw s.sent(),new Error(L+".accept failed, error: "+g);case 11:f=i(i({},f),{roomID:h,callType:p}),s.label=12;case 12:return s.trys.push([12,14,,16]),[4,this._tsignalingClient.accept({inviteID:l,callType:p})];case 13:return _=s.sent(),y="callType: "+(p+1)+",\n      conversationType: "+_.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+_.data.message.to+" } succeeded",this._setInterfaceUpLoad(v.default.ACCEPT).setCallType(p+1).setText(""+y).setEnd(),[3,16];case 14:return m=s.sent(),T.default.error(m),[4,this._resetTUICallEngine()];case 15:throw s.sent(),y="callType: "+(p+1)+",\n      conversationType: "+(null===(r=null===(n=null==_?void 0:_.data)||void 0===n?void 0:n.message)||void 0===r?void 0:r.conversationType)+",\n      userId:{ "+this._userID+" } accept userId:{ "+(null===(c=null===(o=null==_?void 0:_.data)||void 0===o?void 0:o.message)||void 0===c?void 0:c.to)+" } failed",this._setInterfaceUpLoad(v.default.ACCEPT).setCallType(p+1).setText(""+y).setEnd(),this.isGroupCall()||(this._callDataReport.setCodeAndMessage(E.default.UNKNOWN,JSON.stringify(m)),this._callDataReport.uploadToKibana()),new S.default({message:L+"<accept>: failed "+m.message,code:m.code});case 16:return this.isGroupCall()&&(y="callType: "+(p+1)+",\n      conversationType: "+_.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+_.data.message.to+" } succeeded",this._setInterfaceUpLoad(v.default.ACCEPT).setCallType(p+1).setText(y).setEnd()),[2,i(i({},f),_)]}}))}))},e.prototype.reject=function(){return a(this,void 0,void 0,(function(){var e,t,n,i,r,o,a,c;return s(this,(function(s){switch(s.label){case 0:if(!this._tsignalingClient.getInviteData())return T.default.warn(L+".reject - there are no calls to reject"),[2];e=this._callStatus===C.CALL_STATUS.CONNECTED,t=this._tsignalingClient.getInviteData(),n=t.inviteID,i=t.inviteData,r=i.callType,T.default.warn(L+".reject - params","inviteID: "+n+",callType: "+r+",isBusy: "+e+"."),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,this._tsignalingClient.reject({inviteID:n,callType:r,isBusy:e})];case 2:return o=s.sent(),a="callType: "+(r+1)+",\n      conversationType: "+o.data.message.conversationType+",\n      userId:{ "+this._userID+" } reject userId:{ "+o.data.message.to+" } succeeded",this._setInterfaceUpLoad(v.default.REJECT).setCallType(r+1).setText(a).setEnd(),e?[3,4]:[4,this._resetTUICallEngine()];case 3:s.sent(),this._delegate.onCallingCancel(this._userID),s.label=4;case 4:return[2,o];case 5:throw c=s.sent(),new S.default({message:L+"<reject>: failed "+c.message,code:c.code});case 6:return[2]}}))}))},e.prototype.hangup=function(){var e;return a(this,void 0,void 0,(function(){var t,n,i,r,o,a,u,l,d,h,p,f,g,_,m,y,I,S,E;return s(this,(function(b){switch(b.label){case 0:if(T.default.warn(L+". - callStatus:"+this._callStatus+" _inviterInviteID:"+JSON.stringify(this._acceptedUserObject)),this._callStatus===C.CALL_STATUS.IDLE)throw new Error(L+".hangup failed. current status:"+this._callStatus);if(this._callStatus===C.CALL_STATUS.CALLING&&0===this.getInviterInviteIdList().length)throw new Error(L+".call/groupCall incomplete。please wait cancel");if(t=this.isGroupCall(),n=this.isInviter(),i=this.getUserID(),r=Math.round((Date.now()-this.getConnectStartTime())/1e3),o=this.getCallType(),u=this.getInviterInviteIdList(),this._callStatus!==C.CALL_STATUS.CONNECTED)return[3,8];b.label=1;case 1:return b.trys.push([1,5,,7]),[4,null===(e=this._trtcClient)||void 0===e?void 0:e.leave()];case 2:return b.sent(),0!==u.length?[3,4]:(p=this.generateCallEndData({callMediaType:o,totalTime:r}),this._delegate.onCallEnd(p),[4,this._resetTUICallEngine()]);case 3:b.sent(),b.label=4;case 4:return[3,7];case 5:return l=b.sent(),[4,this._resetTUICallEngine()];case 6:throw b.sent(),new Error(l);case 7:this._setInterfaceUpLoad(v.default.REJECT).setText("userId: "+this._userID+" hangup succeeded").setEnd(),b.label=8;case 8:d=this.getHandledInviteeList(),h=this.getUnHandledInviteeList(),b.label=9;case 9:return b.trys.push([9,31,,32]),t?[3,16]:(p=this.generateCallEndData(),n?1!==h.length?[3,11]:[4,this._cancel()]:[3,13]);case 10:return a=b.sent(),this._delegate.onCallingCancel(i),[3,12];case 11:this._delegate.onCallEnd(p),b.label=12;case 12:return[3,14];case 13:this._delegate.onCallEnd(p),b.label=14;case 14:return[4,this._resetTUICallEngine()];case 15:return b.sent(),[3,30];case 16:return f=this.getCallStatus(),g={callType:o,userIDList:c(d.filter((function(e){return e!==i})),h),callEnd:r},n?f!==C.CALL_STATUS.CALLING?[3,19]:[4,this._cancel(this.getInviterInviteIdList())]:[3,24];case 17:return a=b.sent(),[4,this._resetTUICallEngine()];case 18:b.sent(),this._delegate.onCallingCancel(i),b.label=19;case 19:if(f!==C.CALL_STATUS.CONNECTED)return[3,23];_=function(e){var t,n,r,o,l,p;return s(this,(function(s){switch(s.label){case 0:return t=u[e],n=m.getInviterInviteIdUserList(t),(r=m.getAcceptedUserList(t)).length>0?(o=r.filter((function(e){return-1!==d.indexOf(e)})),l=n.filter((function(e){return-1!==h.indexOf(e)})),g.userIDList=c(o,l).filter((function(e){return e!==i})),T.default.warn("inviter emit hangup signal, notify userIDList:"+JSON.stringify(g.userIDList)),[4,m._tsignalingClient.hangup(g)]):[3,2];case 1:return a=s.sent(),[3,4];case 2:return p=m.getUnHandledInviteeList(),n.filter((function(e){return-1!==p.indexOf(e)})).length>0?(T.default.warn("inviter emit cancel signal, userIdList:"+n),[4,m._cancel([t])]):[3,4];case 3:a=s.sent(),s.label=4;case 4:return[2]}}))},m=this,S=0,b.label=20;case 20:return S<u.length?[5,_(S)]:[3,23];case 21:b.sent(),b.label=22;case 22:return S++,[3,20];case 23:return[3,28];case 24:y=function(e){var t,n,r,o,l,p;return s(this,(function(s){switch(s.label){case 0:return t=u[e],n=I.getInviterInviteIdUserList(t),(r=I.getAcceptedUserList(t)).length>0?(o=r.filter((function(e){return-1!==d.indexOf(e)})),l=n.filter((function(e){return-1!==h.indexOf(e)})),g.userIDList=c(o,l).filter((function(e){return e!==i})),T.default.warn("invitee emit hangup signal, notify userIDList:"+JSON.stringify(g.userIDList)),[4,I._tsignalingClient.hangup(g)]):[3,2];case 1:return a=s.sent(),[3,4];case 2:return p=I.getUnHandledInviteeList(),n.filter((function(e){return-1!==p.indexOf(e)})).length>0?(T.default.warn("invitee emit cancel signal, inviteID:"+t),[4,I._cancel([t])]):[3,4];case 3:a=s.sent(),s.label=4;case 4:return[2]}}))},I=this,S=0,b.label=25;case 25:return S<u.length?[5,y(S)]:[3,28];case 26:b.sent(),b.label=27;case 27:return S++,[3,25];case 28:return[4,this._resetTUICallEngine()];case 29:b.sent(),b.label=30;case 30:return[2,a];case 31:throw E=b.sent(),T.default.warn(L+".hangup failed, error: "+E),new Error(L+".hangup failed, error: "+E);case 32:return[2]}}))}))},e.prototype._cancel=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,o,a;return s(this,(function(s){switch(s.label){case 0:T.default.log("_cancel _inviterInviteID",this._inviterInviteID),t=[],s.label=1;case 1:s.trys.push([1,6,,7]),0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),n=0,s.label=2;case 2:return n<e.length?(i=e[n],[4,this._tsignalingClient.cancel({inviteID:i})]):[3,5];case 3:r=s.sent(),t.push(r),s.label=4;case 4:return n++,[3,2];case 5:return[3,7];case 6:throw o=s.sent(),new S.default({message:L+"<_cancel>: failed "+o.message,code:o.code});case 7:return a="cancel "+JSON.stringify(t)+" succeeded",T.default.log(L+"._cancel "+a),this._setInterfaceUpLoad(v.default.CALLING_CANCEL).setText(a).setEnd(),[2,t]}}))}))},e.prototype.startRemoteView=function(e){var t;return a(this,void 0,void 0,(function(){var n,i,r;return s(this,(function(o){return T.default.debug(L+".startRemoteView - params:",e),n=e.userID,i=e.videoViewDomID,r=e.options,this._setInterfaceUpLoad(v.default.START_REMOTE_VIEW).setText("remote userId:{ "+n+" } startRemoveView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.playRemoteVideo({videoViewDomID:i,userID:n,options:r})]}))}))},e.prototype.stopRemoteView=function(e){var t;return a(this,void 0,void 0,(function(){var n;return s(this,(function(i){return T.default.debug(L+".stopRemoteView - params:",e),n=e.userID,this._setInterfaceUpLoad(v.default.STOP_REMOTE_VIEW).setText("remote userId:{ "+n+" } stopRemoveView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.stopRemoteVideo({userID:n})]}))}))},e.prototype.startLocalView=function(e){var t;return a(this,void 0,void 0,(function(){var n,i,r,o;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),T.default.debug(L+".startLocalView - params:",e),n=e.userID,i=e.videoViewDomID,r=e.options,this._localViewId=i,this._setInterfaceUpLoad(v.default.START_LOCAL_VIEW).setText("remote userId:{ "+n+" } startLocalView succeeded").setEnd(),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.playLocalVideo({videoViewDomID:i,userID:n,options:r})];case 1:return a.sent(),[3,3];case 2:throw o=a.sent(),new Error(L+".startLocalView failed. error: "+o);case 3:return[2]}}))}))},e.prototype.stopLocalView=function(e){var t;return a(this,void 0,void 0,(function(){var n;return s(this,(function(i){return T.default.debug(L+".stopLocalView - params:",e),n=e.userID,this._localViewId="",this._setInterfaceUpLoad(v.default.STOP_LOCAL_VIEW).setText("remote userId:{ "+n+" } stopLocalView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.stopLocalVideo()]}))}))},e.prototype.openCamera=function(e){var t;return a(this,void 0,void 0,(function(){var n,i,r;return s(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,2,,3]),n=e,!e){if(!this._localViewId)return T.default.error(L+".openCamera failed. error: A DOM parameter is required to render the camera data"),[2];T.default.warn(L+".openCamera warning. warn: A DOM parameter is required to render the camera data. "+L+".startLocalView() will be deprecated soon."),n=this._localViewId}return i={videoViewDomID:n,userID:this.getUserID()},[4,null===(t=this._trtcClient)||void 0===t?void 0:t.playLocalVideo(i)];case 1:return o.sent(),[3,3];case 2:throw r=o.sent(),T.default.error(L+".openCamera failed. error: "+r),new Error(L+".openCamera failed. error: "+r);case 3:return[2]}}))}))},e.prototype.closeCamera=function(){var e;return a(this,void 0,void 0,(function(){return s(this,(function(t){try{return this._setInterfaceUpLoad(v.default.CLOSE_CAMERA).setText("close camera").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.stopLocalVideo()]}catch(e){throw new Error(L+".closeCamera failed. error: "+e)}return[2]}))}))},e.prototype.openMicrophone=function(){var e;return a(this,void 0,void 0,(function(){return s(this,(function(t){return this._setInterfaceUpLoad(v.default.SET_MIC_MUTE).setText("openMicrophone").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.unMuteLocalAudio()]}))}))},e.prototype.closeMicrophone=function(){var e;return a(this,void 0,void 0,(function(){return s(this,(function(t){return this._setInterfaceUpLoad(v.default.SET_MIC_MUTE).setText("closeMicrophone").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.muteLocalAudio()]}))}))},e.prototype.setVideoQuality=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return T.default.debug(L+".setVideoQuality - quality:"+JSON.stringify(e)),e===this.getVideoQuality()?(T.default.warn(L+".setVideoQuality failed - profile not change"),[2]):(this._setInterfaceUpLoad(v.default.SET_VIDEO_QUALITY).setText("setVideoQuality: "+JSON.stringify(e)).setEnd(),this._quality=e,this._trtcClient?[4,this._trtcClient._setVideoProfile(this._trtcClient.getLocalStream(),e)]:[3,2]);case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.getVideoQuality=function(){return this._quality},e.prototype.setVideoRenderParams=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._trtcClient?[4,this._trtcClient._setVideoRenderParams(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.switchCallMediaType=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(this._callType===e)throw new S.default({message:L+"<switchCallMediaType>: "+b.ERROR_MESSAGE.ERROR_REQUEST_REPEATED_SWITCH,code:E.default.ERROR_REQUEST_REPEATED});if(!this._switchCallModeStatus)throw new Error(L+" audio and video call switching.");T.default.log(L+".switchCallMediaType",this._inviterID,this._inviteeID),this._setInterfaceUpLoad(v.default.SWITCH_TO_AUDIO_CALL).setText("switchCallMediaType").setEnd(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._tsignalingClient.switchCallMode({userID:this._isInviter?this._inviteeID:this._inviterID,callType:this._callType,roomID:this._roomID,timeout:this._callTimeout,mode:e===C.CALL_TYPE.AUDIO_CALL?C.MODE_TYPE.AUDIO:C.MODE_TYPE.VIDEO})];case 2:return n.sent(),this.setSwitchCallModeStatus(!1),[3,4];case 3:throw t=n.sent(),new Error(L+".switchCallMediaType failed, error: "+t);case 4:return[2]}}))}))},e.prototype.setSwitchCallModeStatus=function(e){this._switchCallModeStatus=e},e.prototype.getSwitchCallModeStatus=function(){return this._switchCallModeStatus},e.prototype.getDeviceList=function(e){var t,n;return a(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:if(e!==C.DEVICE_TYPE.CAMERA)return[3,5];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({video:!0,isThrowVideoError:!0})];case 2:return i.sent(),[4,D.getCameras()];case 3:return[2,i.sent()];case 4:throw i.sent(),new S.default({message:L+"<getDeviceList>: "+b.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:E.default.ERROR_PERMISSION_DENIED});case 5:if(e!==C.DEVICE_TYPE.MICROPHONES)return[3,10];i.label=6;case 6:return i.trys.push([6,9,,10]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.getMediaDevicesAuth({audio:!0})];case 7:return i.sent(),[4,D.getMicrophones()];case 8:return[2,i.sent()];case 9:throw i.sent(),new S.default({message:L+"<getDeviceList>: "+b.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:E.default.ERROR_PERMISSION_DENIED});case 10:return[2]}}))}))},e.prototype.switchDevice=function(e){var t;return a(this,void 0,void 0,(function(){var n,i;return s(this,(function(r){return n=e.deviceType,i=e.deviceId,T.default.debug(L+".switchDevice -params: deviceType:"+n+",deviceID:"+i),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.switchDevice(n,i)]}))}))},e.prototype.setSelfInfo=function(e){return a(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(r){return t=e.nickName,n=e.avatar,i={nick:t,avatar:n},!t&&delete i.nick,!n&&delete i.avatar,T.default.log(L+".setSelfInfo -params: nickName:"+i.nick+",avatar:"+i.avatar),[2,this.tim.updateMyProfile(i)]}))}))},e.prototype.generateCallEndData=function(e){var t=e||{},n=t.roomId,i=t.callMediaType,r=t.callRole,o=t.totalTime,a=t.userId;return n=n||this.getRoomID(),i=i||this.getCallType(),r||(r=this.isInviter()?C.CALL_ROLE.INVITER:C.CALL_ROLE.INVITEE),{roomID:n,callMediaType:i,callRole:r,totalTime:o=l.isUndefined(o)?Math.round((Date.now()-this.getConnectStartTime())/1e3):o,userID:a=a||this.getUserID()}},e.prototype.enableAIVoice=function(e){var t;return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this._trtcClient?[4,null===(t=this._trtcClient)||void 0===t?void 0:t.enableAIVoice(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._resetTUICallEngine=function(){var e;return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return T.default.debug(L+"._resetTUICallEngine"),this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this.setSwitchCallModeStatus(!0),this._groupID="",this._callStatus=C.CALL_STATUS.IDLE,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._connectStartTime=0,this._switchCallModeStatus=!0,this._localViewId="",[4,null===(e=this._trtcClient)||void 0===e?void 0:e.reset()];case 1:return n.sent(),this._tsignalingClient.setInviteData(null),this._tsignalingClient.resetJoined(),(t=document.getElementById("_trtc_calling_layer"))&&(t.innerHTML=""),[2]}}))}))},e.prototype.getCallStatus=function(){return this._callStatus},e.prototype.changeCallStatus=function(e){this._callStatus!==e&&(T.default.debug(L+".changeCallStatus from "+this._callStatus+" to "+e),this._setInterfaceUpLoad(v.default.CHANGE_CALL_STATUS).setText("changeCallStatus from "+this._callStatus+" to "+e).setEnd(),this._callStatus=e)},e.prototype.extractCallingInfoFromMessage=function(e){if(!e)return"";if("TIMCustomElem"!==e.type)return"";var t=JSON.parse(e.payload.data);if(T.default.debug(L+".extractCallingInfoFromMessage - signalingData:",e.payload.data),t.businessID!==C.BUSINESS_ID.SIGNAL)return"";switch(t.actionType){case C.ACTION_TYPE.INVITE:var n=JSON.parse(t.data);return n.call_end>0?"结束通话，通话时长："+l.formatDuration(n.call_end):0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case C.ACTION_TYPE.CANCEL_INVITE:return"取消通话";case C.ACTION_TYPE.ACCEPT_INVITE:return"已接听";case C.ACTION_TYPE.REJECT_INVITE:return"拒绝通话";case C.ACTION_TYPE.INVITE_TIMEOUT:return"无应答";default:return""}},e.CALL_TYPE=C.CALL_TYPE,r([k.paramValidate(k.VALIDATE_PARAMS.login),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"init",null),r([k.paramValidate(k.VALIDATE_PARAMS.login),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"login",null),r([k.avoidRepeatedCall(),k.paramValidate(k.VALIDATE_PARAMS.call),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.IDLE]}),k.businessValidate(C.CALL_EXPERMENTEL_API_TYPE.BASE),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"call",null),r([k.avoidRepeatedCall(),k.paramValidate(k.VALIDATE_PARAMS.groupCall),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.IDLE]}),k.businessValidate(C.CALL_EXPERMENTEL_API_TYPE.PRO),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"groupCall",null),r([k.paramValidate(k.VALIDATE_PARAMS.joinInGroupCall),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.IDLE]}),k.businessValidate(C.CALL_EXPERMENTEL_API_TYPE.PRO),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"joinInGroupCall",null),r([k.paramValidate(k.VALIDATE_PARAMS.inviteUser),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),k.businessValidate(C.CALL_EXPERMENTEL_API_TYPE.PRO),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"inviteUser",null),r([k.avoidRepeatedCall(),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"accept",null),r([k.avoidRepeatedCall(),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"reject",null),r([k.avoidRepeatedCall(),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"hangup",null),r([k.paramValidate(k.VALIDATE_PARAMS.startRemoteView),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"startRemoteView",null),r([k.paramValidate(k.VALIDATE_PARAMS.stopRemoteView),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"stopRemoteView",null),r([k.paramValidate(k.VALIDATE_PARAMS.startLocalView),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),k.apiCallQueue(),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"startLocalView",null),r([k.paramValidate(k.VALIDATE_PARAMS.stopLocalView),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),k.apiCallQueue(),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"stopLocalView",null),r([k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"openCamera",null),r([k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"closeCamera",null),r([k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"openMicrophone",null),r([k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],e.prototype,"closeMicrophone",null),r([k.paramValidate(k.VALIDATE_PARAMS.setVideoQuality),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"setVideoQuality",null),r([k.paramValidate(k.VALIDATE_PARAMS.setVideoRenderParams),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"setVideoRenderParams",null),r([k.paramValidate(k.VALIDATE_PARAMS.switchCallMediaType),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CONNECTED,C.CALL_STATUS.CALLING],scene:!0}),o("design:type",Function),o("design:paramtypes",[Number]),o("design:returntype",Promise)],e.prototype,"switchCallMediaType",null),r([k.paramValidate(k.VALIDATE_PARAMS.getDeviceList),k.statusValidate({init:!0}),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],e.prototype,"getDeviceList",null),r([k.paramValidate(k.VALIDATE_PARAMS.switchDevice),k.statusValidate({init:!0,callStatus:[C.CALL_STATUS.CALLING,C.CALL_STATUS.CONNECTED]}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"switchDevice",null),r([k.paramValidate(k.VALIDATE_PARAMS.setSelfInfo),k.statusValidate({init:!0}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"setSelfInfo",null),r([k.statusValidate({init:!0}),o("design:type",Function),o("design:paramtypes",[Boolean]),o("design:returntype",Promise)],e.prototype,"enableAIVoice",null),r([k.paramValidate(k.VALIDATE_PARAMS.createInstance),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",void 0)],e,"createInstance",null),e}();t.default=O},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));const i=Function.prototype.apply,r=new WeakMap;function o(e){return r.has(e)||r.set(e,{}),r.get(e)}class a{constructor(e=null,t=console){const n=o(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,i){return this._getCallbacks(e).push({callback:t,context:n,weight:i}),this._getCallbacks(e).sort(((e,t)=>e.weight>t.weight)),this}_getCallbacks(e){return o(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex((e=>e.callback===t)):null}_achieveMaxListener(e){return null!==o(this)._maxListeners&&o(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const i=this._getCallbackIndex(e,t),r=-1!==i?this._getCallbacks(e)[i]:void 0;return-1!==i&&r&&r.context===n}_has(e){return o(this)._events.has(e)}on(e,t,n=null,i=1){const r=o(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&r._console.warn(`Max listeners (${r._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&r._console.warn(`Event "${e}" already has the callback ${t}.`)):(r._events.add(e),r._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const o=(...r)=>(this.off(e,o),i.call(t,n,r));return this.on(e,o,n,r)}off(e,t=null){const n=o(this);let i;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):(i=this._getCallbackIndex(e,t),-1!==i&&(n._callbacks[e].splice(i,1),this.off(...arguments)))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach((e=>i.call(e.callback,e.context,t))),this}clear(){const e=o(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=n(17),s=n(1),c=n(34),u=n(8),l=n(0),d=n(10),h=n(11),p=n(12),f=n(9),g=n(4),_=n(5),v=n(8),m=n(54),y=n(26),I=n(2),T=n(2),C=n(7),S="TRTCClient",E=a,b=function(){function e(e){var t,n=this;this._sdkAppID=e.sdkAppID,this._userID=e.userID,this._userSig=e.userSig,this._tuiCallEngine=e.tuiCallEngine,this._videoAvailableMap=new Map,this._isJoined=!1,this._isPublished=!1,this._unPublishing=!1,this._localStream=null,this._remoteStreams=[],this._userIdDomMap=new Map,this._device={video:null,audio:null,microphoneList:[],cameraList:[]},this._prevDevices=[],this._assetsPath=e.assetsPath,this._eventStatController=new p.default,d.default.bindController(this._eventStatController),this._isAiNoiseSuppress=!0;var i=E.VERSION;l.compareVersion(i,"4.7.0")>=0?E.checkSystemRequirements().then((function(e){if(!e.result)throw n._tuiCallEngine._delegate.onError(g.default.NOT_SUPPORT,JSON.stringify(e)),new f.default({message:_.ERROR_MESSAGE.NOT_SUPPORT+" "+JSON.stringify(e),code:g.default.NOT_SUPPORT})})):E.checkSystemRequirements().then((function(e){if(!e)throw n._tuiCallEngine._delegate.onError(g.default.NOT_SUPPORT,e),new f.default({message:_.ERROR_MESSAGE.NOT_SUPPORT+" "+JSON.stringify(e),code:g.default.NOT_SUPPORT})})),this._frameWorkType=32,l.compareVersion(i,"4.15.1")>=0?(this._frameWorkType=30,this._component=14,((null===(t=null===window||void 0===window?void 0:window.localStorage)||void 0===t?void 0:t.getItem("_isTIMCallKit"))||(null===window||void 0===window?void 0:window._isTIMCallKit))&&(this._component=15)):this._component=3,this.init()}return e.prototype.init=function(){this._client=E.createClient({mode:T.NAME.RTC,sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig,frameWorkType:this._frameWorkType,component:this._component}),this.addTRTCEvents()},e.prototype.getClient=function(){return this._client},e.prototype.getRemoteStreams=function(){return this._remoteStreams},e.prototype.getLocalStream=function(){return this._localStream},e.prototype.getMicrophoneList=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,E.getMicrophones()];case 1:return e=t.sent(),this._device.microphoneList=e,[2]}}))}))},e.prototype.getCamerasList=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,E.getCameras()];case 1:return e=t.sent(),this._device.cameraList=e,[2]}}))}))},e.prototype.getDevices=function(e){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(n){switch(n.label){case 0:return[4,this.getMicrophoneList()];case 1:return n.sent(),0!==this._device.microphoneList.length?[3,3]:[4,this._tuiCallEngine._resetTUICallEngine()];case 2:return n.sent(),this._tuiCallEngine._delegate.onError(g.default.NOT_MICROPHONE_LIST,_.ERROR_MESSAGE.NOT_MICROPHONE_LIST),[2];case 3:return this._device.audio=JSON.parse(JSON.stringify(this._device.microphoneList[0])),e===u.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video?[4,this.getCamerasList()]:[3,5];case 4:n.sent(),this._device.video=JSON.parse(JSON.stringify(this._device.cameraList[0])),n.label=5;case 5:return this._prevDevices.length>0||(this._prevDevices=o(this._device.microphoneList,this._device.cameraList),navigator.mediaDevices.addEventListener("devicechange",(function(){return i(t,void 0,void 0,(function(){var e,t,n,i,a,s=this;return r(this,(function(r){switch(r.label){case 0:return[4,E.getMicrophones()];case 1:return e=r.sent(),[4,E.getCameras()];case 2:return t=r.sent(),n=o(e,t),this.setDevcies(n),i=n.filter((function(e){return s._prevDevices.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),a=this._prevDevices.filter((function(e){return n.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),i.length>0&&this.handleDevices(i),a.length>0&&this.handleDevicesRemoved(a),this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),this._prevDevices=n,[2]}}))}))}))),[2]}}))}))},e.prototype.setDevcies=function(e){this._device.microphoneList=e.filter((function(e){return e.kind===T.NAME.AUDIO_INPUT}))||[],this._device.cameraList=e.filter((function(e){return e.kind===T.NAME.VIDEO_INPUT}))||[]},e.prototype.handleDevices=function(e,t){var n=this;e.forEach((function(e){e.kind===T.NAME.AUDIO_INPUT?n.switchDevice(u.DEVICE_TYPE.AUDIO,e.deviceId):e.kind===T.NAME.VIDEO_INPUT&&t&&n.switchDevice(u.DEVICE_TYPE.VIDEO,e.deviceId)}))},e.prototype.handleDevicesRemoved=function(e){var t=this;e.forEach((function(e){e.kind===T.NAME.AUDIO_INPUT?t.isCurrentMicrophoneRemoved(e.deviceId)&&t.handleDevices(t._prevDevices):e.kind===T.NAME.VIDEO_INPUT&&t.isCurrentCameraRemoved(e.deviceId)&&t.handleDevices(t._prevDevices,!0)}))},e.prototype.isCurrentMicrophoneRemoved=function(e){var t=this._localStream.getAudioTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.isCurrentCameraRemoved=function(e){var t=this._localStream.getVideoTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.switchDevice=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return s.default.log(S+".switchDevice - params: deviceType:"+e+",deviceID:"+t),this._localStream?[4,this._localStream.switchDevice(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return n={deviceType:e,deviceId:t},this._device[e]=n,this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),[2]}}))}))},e.prototype.join=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o;return r(this,(function(r){switch(r.label){case 0:return(t=this.getCallType())!==u.CALL_TYPE.VIDEO_CALL||this._tuiCallEngine.getDevicePermission().video?[3,2]:[4,this.getMediaDevicesAuth({video:!0})];case 1:r.sent(),r.label=2;case 2:return[4,this.getDevices(t)];case 3:if(r.sent(),this._isJoined)return s.default.warn(S+".join - duplicate RtcClient.join() observed"),[2];r.label=4;case 4:return r.trys.push([4,6,,7]),[4,this._client.join({roomId:e})];case 5:return r.sent(),this._isJoined=!0,s.default.log(S+".join - join room success, callType:"+t),[3,7];case 6:throw n=r.sent(),s.default.error(S+".join - join room failed! "+n),new Error(S+".join - join room failed! "+n);case 7:if(this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.IDLE)return s.default.warn(S+".join - early hangup"),[2,this._tuiCallEngine.hangup()];i={audio:!0,video:!1,userId:this._userID},t===u.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video&&(i.video=!0),r.label=8;case 8:return r.trys.push([8,15,,16]),this._localStream=E.createStream(i),[4,this._setVideoProfile(this._localStream)];case 9:return r.sent(),[4,this._localStream.initialize()];case 10:return r.sent(),this._tuiCallEngine.tim?[4,this._addAiNoiseReduce(this._tuiCallEngine.tim)]:[3,12];case 11:r.sent(),r.label=12;case 12:return s.default.log(S+".join - initialize local stream success"),this._tuiCallEngine.isInviter()?[3,14]:[4,this.publish()];case 13:r.sent(),r.label=14;case 14:return this._joinedTimestamp=new Date,[2,{audio:i.audio,video:i.video,userId:i.userId}];case 15:throw o=r.sent(),s.default.error(S+".join - failed to initialize local stream - "+o),new f.default({message:S+"<join>: "+_.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:g.default.ERROR_PERMISSION_DENIED});case 16:return[2]}}))}))},e.prototype._addAiNoiseReduce=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,6,,7]),[4,y.validateBusiness(e,v.CALL_EXPERMENTEL_API_TYPE.PRO)];case 1:return t=r.sent(),s.default.info(S+"._addAiNoiseReduce - aiNoiseReduceSupport."+t),t&&m?(this._assetsPath||s.default.warn(S+"._addAiNoiseReduce - please pass validate assetsPath"),this._aiNoiseSuppression=new m({assetsPath:this._assetsPath||I.AI_NOISE_REDUCE_ASSETS_PATH}),n=this,[4,this._aiNoiseSuppression.createProcessor({sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig})]):[3,5];case 2:return n._aiNoiseSuppressionProcessor=r.sent(),[4,this._aiNoiseSuppressionProcessor.process(this._localStream)];case 3:return r.sent(),[4,this.enableAIVoice(this._isAiNoiseSuppress)];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return i=r.sent(),s.default.warn(S+"._addAiNoiseReduce - error."+i),[3,7];case 7:return[2]}}))}))},e.prototype.playLocalVideo=function(e){var t;return i(this,void 0,void 0,(function(){var n,i,o,a,c,u;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),s.default.debug(S+".playLocalVideo - params:",e),n=e.videoViewDomID,i=e.userID,e.options&&this._tuiCallEngine.setLocalPlayOptions(e.options),o=this._tuiCallEngine.getLocalPlayOptions(),a=n,typeof n===T.NAME.STRING&&(a=document.getElementById(n)),this._userIdDomMap.set(i,a),!this._localStream||this._localStream.hasVideo()?[3,2]:(c=this._localStream.getVideoTrack(),[4,this.addTrack(c)]);case 1:r.sent(),r.label=2;case 2:return a?[4,null===(t=null==this?void 0:this._localStream)||void 0===t?void 0:t.play(a,o)]:[3,4];case 3:r.sent(),r.label=4;case 4:return[3,6];case 5:throw u=r.sent(),s.default.error(S+".playLocalVideo - failed, error:"+u),new Error(S+".playLocalVideo - failed, error:"+u);case 6:return[2]}}))}))},e.prototype.stopLocalVideo=function(){return i(this,void 0,void 0,(function(){var e,t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),this._localStream?this._localStream.hasAudio()?(e=this._localStream.getVideoTrack())?[4,this._localStream.removeTrack(e)]:[3,2]:[3,3]:[3,5];case 1:n.sent(),e.stop(),n.label=2;case 2:return[3,5];case 3:return[4,this.unpublish()];case 4:n.sent(),this._localStream.stop(),this._localStream.close(),this._localStream=null,this._userIdDomMap.delete(this._tuiCallEngine.getUserID()),n.label=5;case 5:return[3,7];case 6:throw t=n.sent(),s.default.error(S+".stopLocalVideo - failed to play local video "+t),new Error(S+".stopLocalVideo - failed to play local video "+t);case 7:return[2]}}))}))},e.prototype.playRemoteVideo=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,c;return r(this,(function(r){switch(r.label){case 0:s.default.debug(S+".playRemoteVideo - params:",e),t=e.videoViewDomID,n=e.userID,e.options&&this._tuiCallEngine.setRemotePlayOptions(e.options),i=this._tuiCallEngine.getRemotePlayOptions(),o=t,typeof t===T.NAME.STRING&&(o=document.getElementById(t)),this._userIdDomMap.set(n,o),r.label=1;case 1:if(r.trys.push([1,5,,6]),!(a=this._remoteStreams.find((function(e){return e.getUserId()===n}))))throw new Error("currentRemoteUserStream is empty");if(!o)throw new Error("domID is empty");return document.getElementById("_trtc_calling_audio_call-"+n)?[4,a.stop()]:[3,3];case 2:r.sent(),document.getElementById("_trtc_calling_audio_call-"+n).remove(),r.label=3;case 3:return[4,null==a?void 0:a.play(o,i)];case 4:return r.sent(),[3,6];case 5:throw c=r.sent(),s.default.error(S+".playRemoteVideo - failed to play remote video reason: "+c),new Error(S+".playRemoteVideo - failed to play remote video reason: "+c);case 6:return[2]}}))}))},e.prototype.stopRemoteVideo=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){s.default.debug(S+".stopRemoteVideo - params:",e),t=e.userID;try{(n=this._remoteStreams.find((function(e){return e.getUserId()===t})))&&n.hasVideo()&&n.getVideoTrack().stop()}catch(e){throw s.default.error(S+".stopRemoteVideo - failed to stop remote video "+e),new Error(S+".stopRemoteVideo - failed to stop remote video "+e)}return[2]}))}))},e.prototype.getCallType=function(){return this._tuiCallEngine.getCallType()},e.prototype.leave=function(){var e,t;return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return s.default.log(S+"-leave._isJoined:"+this._isJoined),this._isJoined?[4,this.unpublish()]:(s.default.warn(S+".leave - please join() firstly"),[2]);case 1:return i.sent(),this._tuiCallEngine.getCallDataReport().setExitRoomTime((new Date).getTime()),[4,this._client.leave()];case 2:return i.sent(),this._isJoined=!1,this._isPublished=!1,null===(e=null==this?void 0:this._localStream)||void 0===e||e.close(),this._localStream=null,this._remoteStreams=[],this._userIdDomMap.clear(),this._videoAvailableMap.clear(),this._leaveTimestamp=new Date,this._client.enableAudioVolumeEvaluation(-1),null===(t=null==this?void 0:this._aiNoiseSuppressionProcessor)||void 0===t||t.destroy(),this._aiNoiseSuppressionProcessor=null,this._isAiNoiseSuppress=!0,n=Math.floor((this._leaveTimestamp-this._joinedTimestamp)/1e3),new d.default(h.default.TALK_TIME).setTalkTime(n).setText("talkTime record").setEnd(),[2]}}))}))},e.prototype.publish=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:if(!this._isJoined)return s.default.warn(S+".publish - please join() firstly"),[2];if(this._isPublished)return s.default.warn(S+".publish - duplicate RtcClient.publish() observed"),[2];if(this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.IDLE)return s.default.warn(S+".join - early hangup"),this._tuiCallEngine.hangup(),[2];if(!this._localStream)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._client.publish(this._localStream)];case 2:return t.sent(),this._isPublished=!0,s.default.log(S+".publish success"),[3,4];case 3:return e=t.sent(),s.default.error(S+".publish - failed to publish local stream "+e),this._isPublished=!1,[3,4];case 4:return[2]}}))}))},e.prototype.unpublish=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._isPublished?this._localStream?this._unPublishing?(s.default.log(S+".unpublish - _unPublishing"),[2]):(this._unPublishing=!0,[4,this._client.unpublish(this._localStream)]):(s.default.warn(S+".unpublish - RtcClient._localStream is null"),[2]):(s.default.warn(S+".unpublish - RtcClient.unpublish() called but not published yet"),[2]);case 1:return e.sent(),s.default.log(S+".unpublish - complete"),this._unPublishing=!1,this._isPublished=!1,[2]}}))}))},e.prototype.playAudioStream=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o;return r(this,(function(r){return t=e.getUserId(),n="_trtc_calling_audio_call-"+t,(i=document.getElementById("_trtc_calling_layer"))||((i=document.createElement("div")).setAttribute("id","_trtc_calling_layer"),i.style.display="none",document.body.appendChild(i)),(o=document.createElement("div")).setAttribute("id",n),i.appendChild(o),e&&(e.play(n),e.on("error",(function(t){if(16451===t.getCode()){var n=document.createElement("button");n.onclick=function(){s.default.log(S+".remoteStream - resume"),e.resume()},n.style.display="none",document.body.appendChild(n);var i=setTimeout((function(){n.click(),clearTimeout(i),document.body.removeChild(n)}),0)}}))),[2]}))}))},e.prototype.delegateVideoAvailableState=function(e,t){e&&this._videoAvailableMap.get(e)!==t&&(this._videoAvailableMap.set(e,t),this._tuiCallEngine._delegate.onUserVideoAvailable({userID:e,isVideoAvailable:t}))},e.prototype.querySubscribeSuccess=function(e){return void 0!==this._videoAvailableMap.get(e)},e.prototype.addTRTCEvents=function(){var e=this;this._client.on("error",(function(t){s.default.error(S+".handleEvents - client on error "+t);var n=t.getCode(),i=JSON.stringify({name:T.NAME.TRTC,error:t});e._tuiCallEngine._delegate.onError(n,i)})),this._client.on("client-banned",(function(t){return i(e,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return s.default.error(S+".handleEvents - client has been banned for "+t),this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.CONNECTED&&(e=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(e)),this._tuiCallEngine.getCallStatus()!==u.CALL_STATUS.CALLING?[3,2]:(this._tuiCallEngine._delegate.onCallingCancel(this._tuiCallEngine.getUserID()),[4,this._tuiCallEngine._cancel()]);case 1:n.sent(),n.label=2;case 2:return[4,this._tuiCallEngine._resetTUICallEngine()];case 3:return n.sent(),[2]}}))}))})),this._client.on("peer-join",(function(t){return i(e,void 0,void 0,(function(){var e,n,i;return r(this,(function(r){switch(r.label){case 0:return e=t.userId,this._isPublished||!this._tuiCallEngine.isInviter()?[3,2]:[4,this.publish()];case 1:r.sent(),r.label=2;case 2:return s.default.log(S+".handleEvents - peer-join "+e),this._tuiCallEngine.getConnectStartTime()||(this._tuiCallEngine.setConnectStartTime(Date.now()),this._client.enableAudioVolumeEvaluation(1e3)),this._tuiCallEngine._delegate.onUserEnter(e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.addHandledInviteeList([e]),this._tuiCallEngine.deleteUnHandledInviteeList([e]),this._tuiCallEngine.addAcceptedUserList(null,[e]),this._tuiCallEngine.changeCallStatus(u.CALL_STATUS.CONNECTED),n&&(i=this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i)),[2]}}))}))})),this._client.on("peer-leave",(function(t){return i(e,void 0,void 0,(function(){var e,n,i,o,a,c,l,d;return r(this,(function(r){switch(r.label){case 0:return this._tuiCallEngine.getCallStatus()===u.CALL_STATUS.IDLE?[2]:(e=t.userId,s.default.log(S+".handleEvents - peer-leave:"+e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.deleteHandledInviteeList([e]),this._videoAvailableMap.delete(e),this._tuiCallEngine._delegate.onUserLeave(e),n?(i=this._tuiCallEngine.getHandledInviteeList(),o=this._tuiCallEngine.getUnHandledInviteeList(),0!==i.length&&this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i),a=this._tuiCallEngine.getUserID(),1!==i.length||i[0]!==a||0!==o.length?[3,2]:(c=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(c),[4,this._tuiCallEngine._resetTUICallEngine()])):[3,3]);case 1:r.sent(),r.label=2;case 2:return[3,6];case 3:return l=this._tuiCallEngine.getHandledInviteeList(),d={callType:this._tuiCallEngine.getCallType(),userIDList:[e],callEnd:Math.round((Date.now()-this._tuiCallEngine.getConnectStartTime())/1e3)},1!==l.length?[3,6]:[4,this._tuiCallEngine._tsignalingClient.hangup(d)];case 4:return r.sent(),[4,this._tuiCallEngine._resetTUICallEngine()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))})),this._client.on("stream-added",(function(t){return i(e,void 0,void 0,(function(){var e,n,i,o,a,c;return r(this,(function(r){switch(r.label){case 0:e=t.stream,n=e.getId(),i=e.getUserId(),s.default.log(S+".handleEvents - remote stream added, userID:"+i+" streamID:"+n+" type:"+e.getType()),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this._client.subscribe(e)];case 2:return r.sent(),[3,5];case 3:return o=r.sent(),a=o.getCode(),c=JSON.stringify({name:"TRTC",error:o}),[4,this._tuiCallEngine._resetTUICallEngine()];case 4:return r.sent(),this._tuiCallEngine._delegate.onError(a,c),[3,5];case 5:return[2]}}))}))})),this._client.on("stream-subscribed",(function(t){return i(e,void 0,void 0,(function(){var e,n;return r(this,(function(i){return e=t.stream,n=e.getUserId(),s.default.log(S+".handleEvents - stream subscribed, _remoteStreams:"+this._remoteStreams+", userID:"+n+", video: "+e.hasVideo()),this._remoteStreams.push(e),this._tuiCallEngine.getCallType()===u.CALL_TYPE.VIDEO_CALL&&this.delegateVideoAvailableState(n,e.hasVideo()),(this.getCallType()===u.CALL_TYPE.AUDIO_CALL||this._tuiCallEngine.getCallType()===u.CALL_TYPE.VIDEO_CALL&&!e.hasVideo())&&this.playAudioStream(e),[2]}))}))})),this._client.on("stream-removed",(function(t){var n=t.stream,i=n.getId(),r=n.getUserId(),o="_trtc_calling_audio_call-"+r;if(s.default.log(S+".handleEvents - remote stream-removed, streamID:"+i+" type:"+n.getType()),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:r,isAudioAvailable:!1}),e._tuiCallEngine._delegate.onUserVideoAvailable({userID:r,isVideoAvailable:!1}),n.stop(),n.close(),e._remoteStreams=e._remoteStreams.filter((function(e){return e.getId()!==i})),e.getCallType()===u.CALL_TYPE.AUDIO_CALL){var a=document.getElementById("_trtc_calling_layer"),c=document.getElementById(o);a&&c&&a.removeChild(c)}e._videoAvailableMap.delete(r)})),this._client.on("stream-updated",(function(t){var n=t.stream,i=n.getUserId(),r=n.getType(),o=n.hasAudio(),a=n.hasVideo();s.default.log(S+".handleEvents - stream-updated, type:"+r+" hasAudio:"+o+" hasVideo:"+a),e.querySubscribeSuccess(i)&&e.delegateVideoAvailableState(i,!!a)})),this._client.on("mute-audio",(function(t){s.default.debug(S+".handleEvents - "+t.userId+" mute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!1})})),this._client.on("unmute-audio",(function(t){s.default.debug(S+".handleEvents - "+t.userId+" unmute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!0})})),this._client.on("mute-video",(function(t){s.default.debug(S+".handleEvents - "+t.userId+" mute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!1)})),this._client.on("unmute-video",(function(t){s.default.debug(S+".handleEvents - "+t.userId+" unmute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!0)})),this._client.on("audio-volume",(function(t){s.default.debug(S+".handleEvents - "+t+" audio volume"),e._tuiCallEngine._delegate.onUserVoiceVolume(t.result)})),this._client.on("connection-state-changed",(function(e){s.default.log(S+".handleEvents - RtcClient state changed from "+e.prevState+" to "+e.state)}))},e.prototype.removeTRTCEvents=function(){this._client.off("*")},e.prototype.muteLocalAudio=function(){var e;null===(e=this._localStream)||void 0===e||e.muteAudio()},e.prototype.unMuteLocalAudio=function(){var e;null===(e=this._localStream)||void 0===e||e.unmuteAudio()},e.prototype.switchCallMode=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:switch(s.default.log(S+".switchCallMode - type",e),t=this._localStream.getVideoTrack(),e){case u.CALL_TYPE.VIDEO_CALL:return[3,1];case u.CALL_TYPE.AUDIO_CALL:return[3,2]}return[3,6];case 1:try{this.removeTrack(t),this._tuiCallEngine.setCallType(u.CALL_TYPE.AUDIO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(u.CALL_TYPE.VIDEO_CALL,u.CALL_TYPE.AUDIO_CALL)}catch(e){this._tuiCallEngine._delegate.onError(g.default.FAILURE_SWITCH_TO_AUDIO,_.ERROR_MESSAGE.FAILURE_SWITCH_TO_AUDIO)}return[3,6];case 2:return n.trys.push([2,4,,5]),[4,this.addTrack(t)];case 3:return n.sent(),this._tuiCallEngine.setCallType(u.CALL_TYPE.VIDEO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(u.CALL_TYPE.AUDIO_CALL,u.CALL_TYPE.VIDEO_CALL),[3,5];case 4:return n.sent(),this._tuiCallEngine._delegate.onError(g.default.FAILURE_SWITCH_TO_VIDEO,_.ERROR_MESSAGE.FAILURE_SWITCH_TO_VIDEO),[3,5];case 5:return[3,6];case 6:return[2]}}))}))},e.prototype.removeTrack=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:if(s.default.log(S+".removeTrack ",!!e),!e)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._localStream.removeTrack(e)];case 2:return n.sent(),e.stop(),[3,4];case 3:throw t=n.sent(),s.default.error(S+".removeTrack - failed to removeTrack local stream "+t),new Error(t);case 4:return[2]}}))}))},e.prototype.addTrack=function(e){var t;return i(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:return s.default.log(S+".addTrack ",!e),e?[3,7]:(n=E.createStream({userId:this._tuiCallEngine.getUserID(),audio:!1,video:!0}),[4,this._setVideoProfile(n)]);case 1:return r.sent(),[4,n.initialize()];case 2:r.sent(),i=n.getVideoTrack(),r.label=3;case 3:return r.trys.push([3,6,,7]),i?[4,null===(t=this._localStream)||void 0===t?void 0:t.addTrack(i)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:throw o=r.sent(),s.default.error(S+".addTrack - failed to addTrack local stream "+o),new Error(o);case 7:return[2]}}))}))},e.prototype.reset=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._isJoined?[4,this.leave()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.getMediaDevicesAuth=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o;return r(this,(function(r){switch(r.label){case 0:if(!c.checkProtocols())throw new f.default({message:""+_.ERROR_MESSAGE.ERROR_HTTP,code:g.default.ERROR_HTTP});if(t=this._tuiCallEngine.getDevicePermission(),!e.audio)return[3,4];if(C.IS_IOS&&t.audio)return[2,t];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!1})];case 2:return i=r.sent(),this.releaseStream(i),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.AUDIO,!0),[3,4];case 3:throw n=r.sent(),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.AUDIO,!1),new Error(n);case 4:if(!e.video)return[3,8];if(C.IS_IOS&&t.video)return[2,t];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 6:return i=r.sent(),this.releaseStream(i),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.VIDEO,!0),[3,8];case 7:if(o=r.sent(),this._tuiCallEngine.setDevicePermission(u.DEVICE_TYPE.VIDEO,!1),s.default.error(S+".getMediaDevicesAuth - failed to get user video steam - "+o),e.isThrowVideoError)throw new Error(o);return[3,8];case 8:return[2,this._tuiCallEngine.getDevicePermission()]}}))}))},e.prototype.enableAIVoice=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this._isAiNoiseSuppress=e,this._aiNoiseSuppressionProcessor?(s.default.info(S+".enableAIVoice "+e),e?[4,this._aiNoiseSuppressionProcessor.enable()]:[3,2]):[2];case 1:return t.sent(),[3,4];case 2:return[4,this._aiNoiseSuppressionProcessor.disable()];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},e.prototype.releaseStream=function(e){for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()},e.prototype._setVideoProfile=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,7]),e?(t=t||this._tuiCallEngine.getVideoQuality(),e?[4,e.setVideoProfile(t)]:[3,2]):(s.default.warn(S+"._setVideoProfile - stream is empty"),[2]);case 1:i.sent(),i.label=2;case 2:return[3,7];case 3:return"OverconstrainedError"!==i.sent().name?[3,5]:(console.error("当前摄像头不支持该 profile"),[4,(n=E.createStream({video:!0,audio:!1})).initialize()]);case 4:return i.sent(),this._localStream.replaceTrack(n.getVideoTrack()),[3,6];case 5:console.error("当前浏览器不支持动态调用该接口"),i.label=6;case 6:return[3,7];case 7:return[2]}}))}))},e.prototype._setVideoRenderParams=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o,a,c,u,d,h,p,f,g,_,v,m;return r(this,(function(y){switch(y.label){case 0:return y.trys.push([0,11,,12]),n=(t=e||{}).userID,i=t.objectFit,o=void 0===i?"":i,n&&!this._userIdDomMap.has(n)?(s.default.warn(S+"._setVideoRenderParams - failed the userID: "+n+" does not have a play node"),[2]):(a={},o!==T.NAME.CONTAIN&&o!==T.NAME.COVER&&o!==T.NAME.FILL||(a.objectFit=e.objectFit),l.isBoolean(e.muted)&&(a.muted=e.muted),l.isBoolean(e.mirror)&&(a.mirror=e.mirror),c=this._tuiCallEngine.getUserID(),n!==c&&n?[3,3]:(this._tuiCallEngine.setLocalPlayOptions(a),u=this._tuiCallEngine.getLocalPlayOptions(),_=this._userIdDomMap.get(c),this._localStream?[4,this._localStream.play(_,u)]:[3,2]));case 1:y.sent(),y.label=2;case 2:y.label=3;case 3:if(n)return[3,7];this._tuiCallEngine.setRemotePlayOptions(a),g=this._tuiCallEngine.getRemotePlayOptions(),d=(d=Array.from(this._userIdDomMap,(function(e){return e[0]}))).filter((function(e){return e!==c})),h=function(e){var t,n;return r(this,(function(i){switch(i.label){case 0:return t=p._userIdDomMap.get(d[e]),n=p._remoteStreams.find((function(t){return t.getUserId()===d[e]})),n?[4,n.play(t,g)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))},p=this,f=0,y.label=4;case 4:return f<d.length?[5,h(f)]:[3,7];case 5:y.sent(),y.label=6;case 6:return f++,[3,4];case 7:return n&&n!==c?(this._tuiCallEngine.setRemotePlayOptions(a),g=this._tuiCallEngine.getRemotePlayOptions(),_=this._userIdDomMap.get(n),v=this._remoteStreams.find((function(e){return e.getUserId()===n})),v?[4,v.play(_,g)]:[3,9]):[3,10];case 8:y.sent(),y.label=9;case 9:y.label=10;case 10:return[3,12];case 11:return m=y.sent(),s.default.warn(S+"._setVideoRenderParams - failed call stream.play error: "+m),[3,12];case 12:return[2]}}))}))},e}();t.default=b},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkProtocols=void 0,t.checkProtocols=function(){if(!window)return!1;if(!window.location)return!1;var e=window.location,t=e.protocol,n=e.hostname;return"http:"!==t||"localhost"===n||"127.0.0.1"===n}},function(e,t,n){"use strict";var i=n(3),r=n(18),o=n(36),a=n(24);function s(e){var t=new o(e),n=r(o.prototype.request,t);return i.extend(n,o.prototype,t),i.extend(n,t),n}var c=s(n(14));c.Axios=o,c.create=function(e){return s(a(c.defaults,e))},c.Cancel=n(25),c.CancelToken=n(51),c.isCancel=n(23),c.all=function(e){return Promise.all(e)},c.spread=n(52),c.isAxiosError=n(53),e.exports=c,e.exports.default=c},function(e,t,n){"use strict";var i=n(3),r=n(19),o=n(37),a=n(38),s=n(24),c=n(49),u=c.validators;function l(e){this.defaults=e,this.interceptors={request:new o,response:new o}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&c.assertOptions(t,{silentJSONParsing:u.transitional(u.boolean,"1.0.0"),forcedJSONParsing:u.transitional(u.boolean,"1.0.0"),clarifyTimeoutError:u.transitional(u.boolean,"1.0.0")},!1);var n=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var r,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!i){var l=[a,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(o),r=Promise.resolve(e);l.length;)r=r.then(l.shift(),l.shift());return r}for(var d=e;n.length;){var h=n.shift(),p=n.shift();try{d=h(d)}catch(e){p(e);break}}try{r=a(d)}catch(e){return Promise.reject(e)}for(;o.length;)r=r.then(o.shift(),o.shift());return r},l.prototype.getUri=function(e){return e=s(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,i){return this.request(s(i||{},{method:e,url:t,data:n}))}})),e.exports=l},function(e,t,n){"use strict";var i=n(3);function r(){this.handlers=[]}r.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){"use strict";var i=n(3),r=n(39),o=n(23),a=n(14);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=r.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=r.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=r.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var i=n(3),r=n(14);e.exports=function(e,t,n){var o=this||r;return i.forEach(n,(function(n){e=n.call(o,e,t)})),e}},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){var e=s(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";var i=n(3);e.exports=function(e,t){i.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))}},function(e,t,n){"use strict";var i=n(22);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";var i=n(3);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var i=n(45),r=n(46);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var i=n(3),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(i.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=i.trim(e.substr(0,o)).toLowerCase(),n=i.trim(e.substr(o+1)),t){if(a[t]&&r.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},function(e,t,n){"use strict";var i=n(3);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var i=n(50),r={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){r[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var o={},a=i.version.split(".");function s(e,t){for(var n=t?t.split("."):a,i=e.split("."),r=0;r<3;r++){if(n[r]>i[r])return!0;if(n[r]<i[r])return!1}return!1}r.transitional=function(e,t,n){var r=t&&s(t);function a(e,t){return"[Axios v"+i.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,s){if(!1===e)throw new Error(a(i," has been removed in "+t));return r&&!o[i]&&(o[i]=!0,console.warn(a(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,s)}},e.exports={isOlderVersion:s,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),r=i.length;r-- >0;){var o=i[r],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:r}},function(e){e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},function(e,t,n){"use strict";var i=n(25);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new i(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var c=n(57),u=n(1),l=n(8),d="TSignalClient",h=n(2),p=n(0),f=function(){function e(e,t){this._tuiCallEngine=e,this._tsignaling=new c(t),this._tsignalingReady=!1,this._joined=!1,this._newInvitationData=null,this._resolveMap=new Map,this.addTSignalEvents()}return e.prototype.setTSignalingIsJoined=function(e){this._joined=e},e.prototype.getTSignalingIsJoined=function(){return this._joined},e.prototype.setLogLevel=function(e){this._tsignaling.setLogLevel(e)},e.prototype.addTSignalEvents=function(){var e=this._tsignaling;e.on(c.EVENT.SDK_READY,this.onSdkReady,this),e.on(c.EVENT.SDK_NOT_READY,this.onSdkNotReady,this),e.on(c.EVENT.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),e.on(c.EVENT.INVITEE_ACCEPTED,this.onInviteeAccepted,this),e.on(c.EVENT.INVITEE_REJECTED,this.onInviteeRejected,this),e.on(c.EVENT.INVITATION_CANCELLED,this.onInvitationCancelled,this),e.on(c.EVENT.INVITATION_TIMEOUT,this.onInvitationTimeout,this),e.on(c.EVENT.KICKED_OUT,this.onKickedOut,this),e.on(c.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),c.EVENT.MESSAGE_SENT_BY_ME&&e.on(c.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)},e.prototype.onSdkReady=function(e){this._tsignalingReady=!0,this._tuiCallEngine._delegate.onSdkReady(e);var t=this._resolveMap.get("login");t&&(t.resolve(t.value),this._resolveMap.delete("login"))},e.prototype.onSdkNotReady=function(){this._tsignalingReady=!1},e.prototype.onNewInvitationReceived=function(e){var t,n;return r(this,void 0,void 0,(function(){var i,r,a,s,c,h,f,g,_,v;return o(this,(function(o){switch(o.label){case 0:return i=this._tuiCallEngine.getCallStatus(),u.default.log(d+".onNewInvitationReceived - params:",e,"currentCallStatus:"+i),r=e.data,a=r.inviter,s=r.inviteeList,c=r.data,h=r.inviteID,f=r.groupID,g=JSON.parse(c),p.isCallSignaling(null==g?void 0:g.businessID)?(g.room_id||(g.room_id=null===(t=null==g?void 0:g.data)||void 0===t?void 0:t.room_id),this._tuiCallEngine.getUserID()===a?[2]:(v={inviter:a,inviteeList:s,inviteID:h,isGroupCall:_=!!f,inviteData:g,groupID:f,currentCallStatus:i,inCallUserIDs:(null==g?void 0:g.inCallUserIDs)||[]},(null===(n=null==g?void 0:g.data)||void 0===n?void 0:n.cmd)!==l.CMD_TYPE.HANG_UP?[3,2]:(u.default.log(d+".hangup - params:",a,g,this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine.getUnHandledInviteeList(),i,_),i===l.CALL_STATUS.IDLE?[2]:[4,this.handleHangupSignal(v)]))):[2];case 1:return o.sent(),[2];case 2:return!f&&this.judgeSwitchCallMode(g)?(i!==l.CALL_STATUS.IDLE&&this._tuiCallEngine.getRoomID()===g.room_id&&(this.handleSwitchCallMode(h,g),this._tuiCallEngine.addAudioVideoSwitchIdList(h)),[2]):i!==l.CALL_STATUS.IDLE?(this.reject({inviteID:h,callType:g.call_type,isBusy:!0}),[2]):(this.handleInvitedSignal(v),[2])}}))}))},e.prototype.handleHangupSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,s,c,u,d;return o(this,(function(o){switch(o.label){case 0:if(t=e.inviter,n=e.inviteData,i=e.currentCallStatus,r=e.inviteeList,a=this._tuiCallEngine.isGroupCall(),s=this._tuiCallEngine.isInviter(),i===l.CALL_STATUS.CALLING){if(u=this._tuiCallEngine.getHandledInviteeList(),-1!==(d=this._tuiCallEngine.getUnHandledInviteeList()).indexOf(t)&&this._tuiCallEngine.deleteUnHandledInviteeList([t]),-1===u.indexOf(t))return[2]}else if(this._tuiCallEngine.deleteHandledInviteeList([t]),-1===(u=this._tuiCallEngine.getHandledInviteeList()).indexOf(t)&&u.length>1)return[2];return c=this._tuiCallEngine.generateCallEndData({totalTime:n.call_end||0}),a?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return o.sent(),this._tuiCallEngine._delegate.onCallEnd(c),[3,10];case 2:return this._tuiCallEngine.deleteHandledInviteeList([t]),u=this._tuiCallEngine.getHandledInviteeList(),d=this._tuiCallEngine.getUnHandledInviteeList(),s?1!==u.length||0!==d.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:o.sent(),this._tuiCallEngine._delegate.onCallEnd(c),o.label=4;case 4:return[3,10];case 5:return i!==l.CALL_STATUS.CALLING?[3,8]:(-1!==r.indexOf(this._tuiCallEngine.getUserID())&&this._tuiCallEngine._delegate.onUserLeave(t),0!==u.length||1!==d.length?[3,7]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 6:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(t),o.label=7;case 7:return[3,10];case 8:return 1!==u.length||0!==d.length?[3,10]:[4,this._tuiCallEngine._resetTUICallEngine()];case 9:o.sent(),this._tuiCallEngine._delegate.onCallEnd(c),o.label=10;case 10:return[2]}}))}))},e.prototype.handleInvitedSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,c,u,d,p,f,g;return o(this,(function(o){return t=e.inviter,n=e.inviteeList,r=e.isGroupCall,a=e.groupID,c=e.inviteID,u=e.inviteData,d=e.inCallUserIDs,p=void 0===d?[]:d,this._tuiCallEngine.changeCallStatus(l.CALL_STATUS.CALLING),this._tuiCallEngine.setInviterID(t),this._tuiCallEngine.setInviteeList(n),this._tuiCallEngine.setRoomID(u.room_id),this._tuiCallEngine.addUnHandledInviteeList(s(n,p)),this._tuiCallEngine.addHandledInviteeList([t]),this._tuiCallEngine.addAcceptedUserList(c,[t]),r&&(this._tuiCallEngine.setIsGroupCall(r),this._tuiCallEngine.setGroupID(a)),this._tuiCallEngine.addInviterInviteId(c,s([t],n)),f=p.filter((function(e){return-1===n.indexOf(e)})),this._newInvitationData={sponsor:t,userIDList:s(n,f),isFromGroup:r,inviteID:c,groupID:a,inviteData:{version:u.version,callType:u.call_type,roomID:u.room_id},userData:u.extInfo},g=this._tuiCallEngine.getCallDataReport().getCallData(),g=i(i({},g),{roomID:u.room_id,inviteID:c,callRole:l.CALL_ROLE.INVITEE,callType:u.call_type,inviteeList:n,callScene:a?h.NAME.GROUP_CALL:h.NAME.SINGLE_CALL}),this._tuiCallEngine.getCallDataReport().setCallData(g),this._tuiCallEngine._delegate.onInvited(this._newInvitationData),[2]}))}))},e.prototype.getInviteData=function(){return this._newInvitationData},e.prototype.setInviteData=function(e){this._newInvitationData=e},e.prototype.handleSwitchCallMode=function(e,t){var n={inviteID:e,callType:t.call_type,switch_to_audio_call:null},i={cmd:l.CMD_TYPE.SWITCH_TO_VIDEO};t.call_type===l.CALL_TYPE.VIDEO_CALL?(n.switch_to_audio_call=l.CMD_TYPE.SWITCH_TO_AUDIO_CALL,i.cmd=l.CMD_TYPE.SWITCH_TO_AUDIO):delete n.switch_to_audio_call;var r=this._tuiCallEngine.getCallStatus();if(this.accept(n,i),r===l.CALL_STATUS.CALLING){var o=t.call_type===l.CALL_TYPE.VIDEO_CALL?l.CALL_TYPE.AUDIO_CALL:l.CALL_TYPE.VIDEO_CALL;this._tuiCallEngine._delegate.onCallTypeChanged(t.call_type,o),this._newInvitationData.inviteData.callType=o,this._tuiCallEngine.setSwitchCallModeStatus(!1)}else r===l.CALL_STATUS.CONNECTED&&(this._tuiCallEngine.setSwitchCallModeStatus(!1),this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()))},e.prototype.judgeSwitchCallMode=function(e){var t=e.switch_to_audio_call&&e.switch_to_audio_call===l.CMD_TYPE.SWITCH_TO_AUDIO_CALL||e.data&&e.data.cmd===l.CMD_TYPE.SWITCH_TO_AUDIO||e.data&&e.data.cmd===l.CMD_TYPE.SWITCH_TO_VIDEO;return u.default.log(d+".switchCallMode:",e,"isSwitchCallMode-"+t),t},e.prototype.onInviteeAccepted=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return o(this,(function(o){switch(o.label){case 0:return u.default.log(d+".onInviteeAccepted - params:",e),t=JSON.parse(e.data.data),p.isCallSignaling(null==t?void 0:t.businessID)?(n=e.data.invitee,i=e.data.inviteID,-1===this._tuiCallEngine.getTotalInviterInviteIdList().indexOf(i)?[2]:this._tuiCallEngine.isGroupCall()||!this.judgeSwitchCallMode(t)||this._tuiCallEngine.getSwitchCallModeStatus()?(r=this._tuiCallEngine.getCallStatus(),n!==this._tuiCallEngine.getUserID()||r!==l.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]):(this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()),[2])):[2];case 1:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(n),[2];case 2:return this._tuiCallEngine.isInviter()&&this._tuiCallEngine.changeCallStatus(l.CALL_STATUS.CONNECTED),this._tuiCallEngine._delegate.onUserAccept(n),this._tuiCallEngine.addHandledInviteeList([n]),this._tuiCallEngine.deleteUnHandledInviteeList([n]),this._tuiCallEngine.addAcceptedUserList(i,[n]),[2]}}))}))},e.prototype.onInviteeRejected=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,a,s,c,h,f,g,_,v;return o(this,(function(o){switch(o.label){case 0:return u.default.log(d+".onInviteeRejected - params:",e),n=e.data.inviteID,i=JSON.parse(e.data.data),p.isCallSignaling(null==i?void 0:i.businessID)?this._tuiCallEngine.isGroupCall()||this._tuiCallEngine.getSwitchCallModeStatus()||-1===this._tuiCallEngine.getAudioVideoSwitchIdList().indexOf(n)?(r=e.data.invitee,a=e.data.inviter,s=this._tuiCallEngine.getUserID(),(c=this._tuiCallEngine.getCallStatus())===l.CALL_STATUS.IDLE?[2]:-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(n)?(this._tuiCallEngine.deleteUnHandledInviteeList([r]),[2]):s!==r||c!==l.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]):(u.default.log(d+".onInviteeRejected - Audio and video switching is not available"),this._tuiCallEngine.setSwitchCallModeStatus(!0),[2]):[2];case 1:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(r),[2];case 2:return h=this._tuiCallEngine.isGroupCall(),f=this._tuiCallEngine.isInviter(),this._tuiCallEngine.deleteUnHandledInviteeList([r]),g=this._tuiCallEngine.getUnHandledInviteeList(),_=this._tuiCallEngine.getHandledInviteeList(),c===l.CALL_STATUS.CONNECTED&&-1!==_.indexOf(r)?[2]:"line_busy"===i.line_busy||""===i.line_busy||(null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.message)&&"lineBusy"===i.data.message?h?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,7];case 3:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(r),[3,6];case 4:return 0!==g.length||1!==_.length?[3,6]:[4,this._tuiCallEngine._resetTUICallEngine()];case 5:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(r),o.label=6;case 6:return a===this._tuiCallEngine.getInviterID()&&this._tuiCallEngine._delegate.onLineBusy(r),[3,18];case 7:return h?[3,9]:[4,this._tuiCallEngine._resetTUICallEngine()];case 8:return o.sent(),this._tuiCallEngine._delegate.onCallingCancel(r),this._tuiCallEngine._delegate.onReject(r),[3,18];case 9:return c!==l.CALL_STATUS.CALLING?[3,15]:f?0!==g.length||1!==_.length?[3,11]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,12];case 10:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(r),o.label=11;case 11:return[3,14];case 12:return 1!==g.length||0!==_.length?[3,14]:[4,this._tuiCallEngine._resetTUICallEngine()];case 13:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(r),o.label=14;case 14:return[3,17];case 15:return 0!==g.length||1!==_.length?[3,17]:(v=this._tuiCallEngine.generateCallEndData({userId:r}),[4,this._tuiCallEngine._resetTUICallEngine()]);case 16:o.sent(),this._tuiCallEngine._delegate.onCallEnd(v),o.label=17;case 17:this._tuiCallEngine._delegate.onReject(r),o.label=18;case 18:return[2]}}))}))},e.prototype.onInvitationCancelled=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return u.default.log(d+".onInvitationCancelled - params:",e,this._tuiCallEngine.getCallStatus()),t=JSON.parse(e.data.data),p.isCallSignaling(null==t?void 0:t.businessID)?this._tuiCallEngine.getCallStatus()===l.CALL_STATUS.IDLE||-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(e.data.inviteID)?[2]:[4,this._tuiCallEngine._resetTUICallEngine()]:[2];case 1:return n.sent(),this._tuiCallEngine._delegate.onCallingCancel(this._tuiCallEngine.getUserID()),[2]}}))}))},e.prototype.onInvitationTimeout=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,a,s,c,h,p,f,g,_,v;return o(this,(function(o){switch(o.label){case 0:return n=e.data,i=n.inviter,r=n.inviteeList,a=void 0===r?[]:r,s=n.inviteID,c=this._tuiCallEngine.getUserID(),h=this._tuiCallEngine.isGroupCall(),p=this._tuiCallEngine.isInviter(),f=this._tuiCallEngine.getCallStatus(),this._tuiCallEngine.deleteUnHandledInviteeList(a),u.default.log(d+".onInvitationTimeout - params:",e,"currentUserID:"+c+" isInviter:"+p+" isGroupCall:"+h+" currentCallStatus:"+f+" inviteID:"+(null===(t=null==this?void 0:this._newInvitationData)||void 0===t?void 0:t.inviteID)),-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(s)||f===l.CALL_STATUS.IDLE?[2]:(g=this._tuiCallEngine.getHandledInviteeList(),_=this._tuiCallEngine.getUnHandledInviteeList(),h?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 1:return o.sent(),p?(this._tuiCallEngine._delegate.onCallingCancel(a[0]),this._tuiCallEngine._delegate.onNoResp(i,a)):this._tuiCallEngine._delegate.onCallingCancel(a[0]||""),[3,11];case 2:return f!==l.CALL_STATUS.CALLING?[3,9]:p?0!==_.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(a.join(",")),o.label=4;case 4:return this._tuiCallEngine._delegate.onNoResp(i,a),[3,8];case 5:return-1!==a.indexOf(c)?[3,6]:(this._tuiCallEngine._delegate.onNoResp(i,a),[3,8]);case 6:return[4,this._tuiCallEngine._resetTUICallEngine()];case 7:o.sent(),this._tuiCallEngine._delegate.onCallingCancel(c),o.label=8;case 8:return[3,11];case 9:return this._tuiCallEngine._delegate.onNoResp(i,a),1!==g.length||0!==_.length?[3,11]:(v=this._tuiCallEngine.generateCallEndData(),[4,this._tuiCallEngine._resetTUICallEngine()]);case 10:o.sent(),this._tuiCallEngine._delegate.onCallEnd(v),o.label=11;case 11:return[2]}}))}))},e.prototype.onKickedOut=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return u.default.log(d+".onKickedOut"),this._tuiCallEngine.setIsLogin(!1),this._tuiCallEngine._trtcClient.removeTRTCEvents(),[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return e.sent(),this._tuiCallEngine._delegate.onKickedOut(),[2]}}))}))},e.prototype.onNetStateChange=function(){u.default.debug(d+".onNetStateChange")},e.prototype.onMessageSentByMe=function(e){this._tuiCallEngine._delegate.onMessageSentByMe(e)},e.prototype.login=function(e){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return[2,new Promise((function(n,i){t._tsignaling.login(e).then((function(e){var i;if(null===(i=e.data)||void 0===i?void 0:i.repeatLogin)return u.default.warn(d+".login - success: The TIM login status has been inherited into Call. IM 登录状态已成功被 Call 继承。"),void n();t._resolveMap.set("login",{resolve:n,value:e})})).catch((function(e){i(e)}))}))]}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return this._joined=!1,[2,this._tsignaling.logout()]}))}))},e.prototype.invite=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c,u,l,d;return o(this,(function(o){switch(o.label){case 0:return t=e.userID,n=e.type,r=e.roomID,a=e.timeout,s=e.offlinePushInfo,c=e.userIDList,u=e.userData,l=void 0===u?"":u,[4,this._tsignaling.invite({userID:t,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:n,room_id:r},{userIDs:c},l)),timeout:a,offlinePushInfo:s})];case 1:return d=o.sent(),[2,i(i({},d),{roomID:r,userID:t})]}}))}))},e.prototype.inviteInGroup=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c,u,l,d,h;return o(this,(function(o){switch(o.label){case 0:return t=e.groupID,n=e.userIDList,r=e.roomID,a=e.type,s=e.timeout,c=e.offlinePushInfo,u=e.inCallUserIDs,l=e.userData,d=void 0===l?"":l,[4,this._tsignaling.inviteInGroup({groupID:t,inviteeList:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:a,room_id:r,inCallUserIDs:u},{},d)),timeout:s,offlinePushInfo:c})];case 1:return h=o.sent(),[2,i(i({},h),{roomID:r,groupID:t})]}}))}))},e.prototype.hangup=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,s,c,h;return o(this,(function(o){switch(o.label){case 0:return u.default.log(d+".hangup - params:",e),t=e.userIDList,n=e.callType,i=e.callEnd,a={version:0,call_type:n,call_end:r=void 0===i?0:i},s={cmd:l.CMD_TYPE.HANG_UP},c=JSON.stringify(this.handleNewSignaling(a,s)),this._tuiCallEngine.isGroupCall()&&this._tuiCallEngine.getGroupID()?[4,this._tsignaling.inviteInGroup({inviteeList:t,groupID:this._tuiCallEngine.getGroupID(),data:c,timeout:0})]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,this._tsignaling.invite({userID:t[0],data:c,timeout:0})];case 3:o.sent(),o.label=4;case 4:return this._joined=!1,h=this._tuiCallEngine.generateCallEndData({callMediaType:n,totalTime:r}),this._tuiCallEngine._delegate.onCallEnd(h),[2]}}))}))},e.prototype.accept=function(e,t){return r(this,void 0,void 0,(function(){var n,r,s;return o(this,(function(o){switch(o.label){case 0:return n=e.inviteID,r=e.callType,s=a(e,["inviteID","callType"]),[4,this._tsignaling.accept({inviteID:n,data:JSON.stringify(this.handleNewSignaling(i({version:0,call_type:r},s),t))})];case 1:return[2,o.sent()]}}))}))},e.prototype.reject=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return o(this,(function(o){return t=e.inviteID,n=e.callType,i=e.isBusy,r={version:0,call_type:n},i&&(r.line_busy="line_busy"),[2,this._tsignaling.reject({inviteID:t,data:JSON.stringify(this.handleNewSignaling(r,{message:i?"lineBusy":""}))})]}))}))},e.prototype.cancel=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(i){return t=e.inviteID,n=JSON.stringify(this.handleNewSignaling({version:4,businessID:h.NAME.AV_CALL,call_type:this._tuiCallEngine.getCallType()})),[2,this._tsignaling.cancel({inviteID:t,data:n})]}))}))},e.prototype.resetJoined=function(){this._joined=!1},e.prototype.switchCallMode=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,s,c,u;return o(this,(function(o){switch(o.label){case 0:return t=e.userID,n=e.callType,i=e.roomID,r=e.timeout,a=e.mode,s={version:0,call_type:n,room_id:i,switch_to_audio_call:null},c={cmd:l.CMD_TYPE.SWITCH_TO_VIDEO},a===l.MODE_TYPE.AUDIO?(s.switch_to_audio_call=l.CMD_TYPE.SWITCH_TO_AUDIO_CALL,c.cmd=l.CMD_TYPE.SWITCH_TO_AUDIO):delete s.switch_to_audio_call,[4,this._tsignaling.invite({userID:t,data:JSON.stringify(this.handleNewSignaling(s,c)),timeout:r})];case 1:return(u=o.sent()).inviteID&&this._tuiCallEngine.addAudioVideoSwitchIdList(u.inviteID),[2]}}))}))},e.prototype.handleNewSignaling=function(e,t,n){return i(i({extInfo:n||""},e),{version:4,businessID:h.NAME.AV_CALL,platform:"Web",data:i({cmd:l.CMD_TYPE_LIST[e.call_type],room_id:e.room_id,message:""},t)})},e}();t.default=f},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(15),o=n(1),a=n(10),s=n(11),c=n(12),u="TUICallObserver",l=function(){function e(e){this._eventEmitter=e,this._eventStatController=new c.default,a.default.bindController(this._eventStatController)}return e.prototype._setInterfaceUpLoad=function(e){return o.default.time(e),new a.default(e)},e.prototype.onError=function(e,t){o.default.debug(u+".onError code:"+e+" msg:"+t),this._eventEmitter.emit(r.TUICallEvent.ERROR,{code:e,msg:t}),this._setInterfaceUpLoad(s.default.ERROR).setText("").setEnd()},e.prototype.onSdkReady=function(e){o.default.debug(u+".onSdkReady params:"+e),this._eventEmitter.emit(r.TUICallEvent.SDK_READY,e),this._setInterfaceUpLoad(s.default.SDK_READY).setText("").setEnd()},e.prototype.onInvited=function(e){o.default.debug(u+".onInvited params:",e);var t=e.sponsor,n=e.userIDList,i=e.isFromGroup,a=e.inviteData,c=e.inviteID,l=e.userData,d=void 0===l?"":l;this._eventEmitter.emit(r.TUICallEvent.INVITED,{sponsor:t,userIDList:n,isFromGroup:i,inviteData:a,inviteID:c,userData:d}),this._setInterfaceUpLoad(s.default.INVITED).setText("TUICallEvent.INVITED emitted").setEnd()},e.prototype.onUserAccept=function(e){o.default.debug(u+".onUserAccept userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ACCEPT,{userID:e})},e.prototype.onUserEnter=function(e){o.default.debug(u+".onUserEnter userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ENTER,{userID:e}),this._setInterfaceUpLoad(s.default.USER_ENTER).setText("TUICallEvent.USER_ENTER emitted").setEnd()},e.prototype.onUserLeave=function(e){o.default.debug(u+".onUserLeave userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_LEAVE,{userID:e}),this._setInterfaceUpLoad(s.default.USER_LEAVE).setText("TUICallEvent.USER_LEAVE emitted").setEnd()},e.prototype.onReject=function(e){o.default.debug(u+".onReject userID:"+e),this._eventEmitter.emit(r.TUICallEvent.REJECT,{userID:e}),this._setInterfaceUpLoad(s.default.REJECT).setText("TUICallEvent.REJECT emitted").setEnd()},e.prototype.onNoResp=function(e,t){o.default.debug(u+".onNoResp userIDList:",e,t),this._eventEmitter.emit(r.TUICallEvent.NO_RESP,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(s.default.NO_RESP).setText("TUICallEvent.NO_RESP emitted").setEnd()},e.prototype.onLineBusy=function(e){o.default.debug(u+".onLineBusy userID:"+e),this._eventEmitter.emit(r.TUICallEvent.LINE_BUSY,{userID:e}),this._setInterfaceUpLoad(s.default.LINE_BUSY).setText("TUICallEvent.LINE_BUSY emitted").setEnd()},e.prototype.onCallingCancel=function(e){void 0===e&&(e=""),o.default.debug(u+".onCallingCancel ",e),this._eventEmitter.emit(r.TUICallEvent.CALLING_CANCEL,{userID:e}),this._setInterfaceUpLoad(s.default.CALLING_CANCEL).setText("TUICallEvent.CALLING_CANCEL emitted").setEnd()},e.prototype.onKickedOut=function(){o.default.debug(u+".onKickedOut"),this._eventEmitter.emit(r.TUICallEvent.KICKED_OUT,{}),this._setInterfaceUpLoad(s.default.KICKED_OUT).setText("TUICallEvent.KICKED_OUT emitted").setEnd()},e.prototype.onCallingTimeout=function(e,t){o.default.debug(u+".onCallingTimeout userIDList:",t),this._eventEmitter.emit(r.TUICallEvent.CALLING_TIMEOUT,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(s.default.CALLING_TIMEOUT).setText("TUICallEvent.CALLING_TIMEOUT emitted").setEnd()},e.prototype.onCallEnd=function(e){o.default.debug(u+".onCallEnd params:"+e),this._eventEmitter.emit(r.TUICallEvent.CALLING_END,i(i({},e),{callEnd:e.totalTime})),this._setInterfaceUpLoad(s.default.CALLING_END).setText("TUICallEvent.CALLING_END emitted").setEnd()},e.prototype.onUserVideoAvailable=function(e){o.default.debug(u+".onUserVideoAvailable params:",e);var t=e.userID,n=e.isVideoAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_VIDEO_AVAILABLE,{userID:t,isVideoAvailable:n});var i="TUICallEvent.USER_VIDEO_AVAILABLE emitted, userID: "+t+", video: "+n;this._setInterfaceUpLoad(s.default.USER_VIDEO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserAudioAvailable=function(e){o.default.debug(u+".onUserAudioAvailable params:",e);var t=e.userID,n=e.isAudioAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_AUDIO_AVAILABLE,{userID:t,isAudioAvailable:n});var i="TUICallEvent.USER_AUDIO_AVAILABLE emitted, userID: "+t+", mic: "+n;this._setInterfaceUpLoad(s.default.USER_AUDIO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserVoiceVolume=function(e){this._eventEmitter.emit(r.TUICallEvent.USER_VOICE_VOLUME,{volumeMap:e}),this._setInterfaceUpLoad(s.default.USER_VOICE_VOLUME).setText("TUICallEvent.USER_VOICE_VOLUME emitted").setEnd()},e.prototype.onGroupCallInviteeListUpdate=function(e){this._eventEmitter.emit(r.TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE,{userIDList:e}),this._setInterfaceUpLoad(s.default.GROUP_CALL_INVITEE_LIST_UPDATE).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onCallTypeChanged=function(e,t){this._eventEmitter.emit(r.TUICallEvent.CALL_TYPE_CHANGED,{oldCallType:e,newCallType:t}),this._setInterfaceUpLoad(s.default.CALL_TYPE_CHANGED).setText("TUICallEvent.CALL_TYPE_CHANGED "+t).setEnd()},e.prototype.onDeviceUpdated=function(e,t,n,i){this._eventEmitter.emit(r.TUICallEvent.DEVICED_UPDATED,{microphoneList:e,cameraList:t,currentMicrophone:n,currentCamera:i}),this._setInterfaceUpLoad(s.default.DEVICED_UPDATED).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onMessageSentByMe=function(e){this._eventEmitter.emit(r.TUICallEvent.MESSAGE_SENT_BY_ME,e)},e}();t.default=l},function(e,t,n){"use strict";n.r(t);var i=n(1);const r="none",o="online",a=function(){let e=window.location.protocol;return["http:","https:"].indexOf(e)<0&&(e="http:"),e};t.default=class{constructor(){this._networkType="",this.maxWaitTime=3e3}start(){this._networkType=o}_onNetworkStatusChange(e){this._networkType=e.networkType,e.isConnected?i.default.info("NetMonitor networkType:"+e.networkType):i.default.warn("NetMonitor no network, please check!")}probe(){return new Promise((e=>{if(window&&window.fetch)fetch(`${a()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`).then((t=>{t.ok?e([!0,o]):e([!1,r])})).catch((()=>{e([!1,r])}));else{const t=new XMLHttpRequest,n=setTimeout((()=>{i.default.warn("NetMonitor fetch timeout. Probably no network, please check!"),t.abort(),this._networkType=r,e([!1,r])}),this.maxWaitTime);t.onreadystatechange=function(){4===t.readyState&&(clearTimeout(n),200===t.status||304===t.status?(this._networkType=o,e([!0,o])):(i.default.warn(`NetMonitor fetch status:${t.status}. Probably no network, please check!`),this._networkType=r,e([!1,r])))},t.open("GET",`${a()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`),t.send()}}))}getNetworkType(){return this._networkType}reset(){this._networkType=""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=t.avoidRepeatedCall=t.statusValidate=t.deviceValidate=t.businessValidate=t.paramValidate=t.VALIDATE_PARAMS=void 0;var i=n(61);Object.defineProperty(t,"VALIDATE_PARAMS",{enumerable:!0,get:function(){return i.VALIDATE_PARAMS}});var r=n(62);Object.defineProperty(t,"paramValidate",{enumerable:!0,get:function(){return r.paramValidate}});var o=n(26);Object.defineProperty(t,"businessValidate",{enumerable:!0,get:function(){return o.businessValidate}});var a=n(63);Object.defineProperty(t,"deviceValidate",{enumerable:!0,get:function(){return a.deviceValidate}});var s=n(64);Object.defineProperty(t,"statusValidate",{enumerable:!0,get:function(){return s.statusValidate}});var c=n(65);Object.defineProperty(t,"avoidRepeatedCall",{enumerable:!0,get:function(){return c.avoidRepeatedCall}});var u=n(66);Object.defineProperty(t,"apiCallQueue",{enumerable:!0,get:function(){return u.apiCallQueue}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALIDATE_PARAMS=void 0;var i=n(13),r=n(2);t.VALIDATE_PARAMS={createInstance:{SDKAppID:{required:!0,rules:[r.NAME.NUMBER],allowEmpty:!1},tim:{required:!1,rules:[r.NAME.OBJECT],allowEmpty:!0}},login:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},userSig:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},call:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},type:{required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1},roomID:{required:!1,rules:[r.NAME.NUMBER],range:"1~"+r.MAX_NUMBER_ROOM_ID,allowEmpty:!1},timeout:{required:!1,rules:[r.NAME.NUMBER],allowEmpty:!1}},groupCall:{userIDList:{required:!0,rules:[r.NAME.ARRAY],allowEmpty:!1},type:{required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},roomID:{required:!1,rules:[r.NAME.NUMBER],range:"1~"+r.MAX_NUMBER_ROOM_ID,allowEmpty:!1},timeout:{required:!1,rules:[r.NAME.NUMBER],allowEmpty:!1}},joinInGroupCall:{type:{required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},roomID:{required:!0,rules:[r.NAME.NUMBER],allowEmpty:!1}},inviteUser:{userIDList:{required:!0,rules:[r.NAME.ARRAY],allowEmpty:!1}},startRemoteView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},stopRemoteView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},startLocalView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},stopLocalView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},switchDevice:{deviceType:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},deviceId:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},setVideoQuality:[{key:"profile",required:!0,rules:[r.NAME.STRING,r.NAME.OBJECT],range:Object.keys(i.TUICommonDefine.VideoEncoderParams),allowEmpty:!1}],switchCallMediaType:[{key:"newMediaType",required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1}],getDeviceList:[{key:"deviceType",required:!0,rules:[r.NAME.STRING],range:["camera","microphones"],allowEmpty:!1}],setSelfInfo:{nickName:{required:!1,rules:[r.NAME.STRING],allowEmpty:!1},avatar:{required:!1,rules:[r.NAME.STRING],allowEmpty:!1}},setVideoRenderParams:{objectFit:{require:!1,rules:[r.NAME.STRING],range:[r.NAME.CONTAIN,r.NAME.COVER,r.NAME.FILL],allowEmpty:!1},muted:{require:!1,rules:[r.NAME.BOOLEAN],allowEmpty:!1},mirror:{require:!1,rules:[r.NAME.BOOLEAN],allowEmpty:!1}}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.paramValidate=void 0;var r=n(0),o=n(9),a=n(4);function s(e,t,n){try{if(r.isArray(e))for(var o=0;o<e.length;o++)c.call(this,i(i({},e[o]),{value:t[o],name:n}));else for(var a in e)c.call(this,i(i({},e[a]),{value:t[0][a],name:n,key:a}))}catch(e){throw e}}function c(e){var t=e.required,n=e.rules,i=e.range,s=e.value,c=e.allowEmpty,u=e.name,l=e.key;if(r.isUndefined(s)){if(t)throw new o.default({message:"API<"+u+">: "+l+" is required.",code:a.default.ERROR_PARAM_INVALID})}else{var d="";if(!n.some((function(e){return e===r.getType(s)}))){for(var h=0;h<n.length;h++){var p=n[h];d+=(p=p.replace(p[0],p[0].toUpperCase()))+"/"}throw d=d.substring(0,d.length-1),new o.default({message:"API<"+u+">: "+l+" must be "+d+", current "+l+" is "+typeof s+".",code:a.default.ERROR_PARAM_INVALID})}if(!1===c&&r.isString(s)&&""===s.trim())throw new o.default({message:"API<"+u+">: "+l+" is blank.",code:a.default.ERROR_PARAM_INVALID});if(r.isArray(i)&&i&&-1===i.indexOf(s))throw new o.default({message:"API<"+u+">: "+l+" error, only be "+i+", current "+l+" is "+s+".",code:a.default.ERROR_PARAM_INVALID});if(r.isString(i)&&-1!==i.indexOf("~")){var f=i.split("~");if(s<+f[0]||s>+f[1]||r.isNumber(s)&&Number.isNaN(s))throw new o.default({message:"API<"+u+">: "+l+" error, only be "+i+", current "+l+" is "+s+".",code:a.default.ERROR_PARAM_INVALID})}}}t.paramValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return s.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.deviceValidate=void 0;var o=n(9),a=n(4),s=n(5);function c(e,t,n){return i(this,void 0,void 0,(function(){var i,c;return r(this,(function(r){switch(r.label){case 0:if(this._permission[n])return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._trtcClient.getMediaDevicesAuth((c={},c[n]=!0,c.isThrowVideoError=!0,c))];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),this._delegate.onError(a.default.NOT_MEDIA_ACCESS,JSON.stringify(i)),new o.default({message:"<doValidate>: "+s.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:a.default.ERROR_PERMISSION_DENIED});case 4:return e.apply(this,t),[2]}}))}))}t.deviceValidate=function(e){return function(t,n,o){var a=o.value;return o.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,c.call(this,a,t,e)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.statusValidate=void 0;var i=n(9),r=n(4),o=n(5);function a(e,t,n){var a;if((null==e?void 0:e.init)&&!this._isLogin)throw new i.default({message:"API<"+n+">: "+o.ERROR_MESSAGE.ERROR_INIT_FAIL,code:r.default.ERROR_INIT_FAIL});if(-1===(null===(a=null==e?void 0:e.callStatus)||void 0===a?void 0:a.indexOf(this._callStatus)))throw new i.default({message:"API<"+n+">: "+o.ERROR_MESSAGE.ERROR_REQUEST_REFUSED+". support status: ["+e.callStatus.join(",")+"], current status: "+this._callStatus,code:r.default.ERROR_REQUEST_REFUSED});if((null==e?void 0:e.scene)&&this._isGroupCall)throw new i.default({message:"API<"+n+">: "+o.ERROR_MESSAGE.ERROR_SCENE_NOT_SUPPORTED,code:r.default.ERROR_SCENE_NOT_SUPPORTED})}t.statusValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return a.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.avoidRepeatedCall=void 0,t.avoidRepeatedCall=function(){return function(e,t,n){var o=n.value,a=new Set;return n.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:if(a.has(this))throw new Error("previous "+t+"() is ongoing, please avoid repeated calls");r.label=1;case 1:return r.trys.push([1,3,,4]),a.add(this),[4,o.apply(this,e)];case 2:return n=r.sent(),a.delete(this),[2,n];case 3:throw i=r.sent(),a.delete(this),i;case 4:return[2]}}))}))},n}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=void 0;var r=new WeakMap;t.apiCallQueue=function(){return function(e,t,n){var o=n.value,a=function(e){var t=e.fn,n=e.args,o=e.context,s=e.resolve,c=e.reject;t.apply(o,n).then(s,c).finally((function(){var e=r.get(o);e.shift(),e[0]&&a(i({},e[0]))}))};return n.value=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise((function(n,i){if(r.has(e)){var s=r.get(e),c=s.length;s.push({fn:o,args:t,context:e,resolve:n,reject:i}),0===c&&a({fn:o,args:t,context:e,resolve:n,reject:i})}else r.set(e,[{fn:o,args:t,context:e,resolve:n,reject:i}]),a({fn:o,args:t,context:e,resolve:n,reject:i})}))},n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEngineObserver=t.CallDataReport=void 0;var i=n(8),r=n(15),o=n(10),a=n(11),s=n(12),c=n(2),u=n(68),l=n(0),d=function(){function e(e){this._eventStatController=new s.default,o.default.bindController(this._eventStatController),this.initializeCallData(e),this._ssoLog=new o.default(a.default.QUALITY_REPORT)}return e.prototype.setCallData=function(e){this._callData=e},e.prototype.getCallData=function(){return this._callData},e.prototype.setInviteID=function(e){this._callData.inviteID=e},e.prototype.setTotalTime=function(e){this._callData.totalTime=e},e.prototype.setAbilityBit=function(e){this._callData.abilityBit=!!e},e.prototype.setEnterRoomTime=function(e){this._callData.enterRoomTime=u.convertTimeStampToString(e)},e.prototype.setSendSignalingTime=function(e){this._callData.sendSignalingTime=u.convertTimeStampToString(e)},e.prototype.setCallAcceptTime=function(e){this._callData.callAcceptTime=u.convertTimeStampToString(e)},e.prototype.setExitRoomTime=function(e){this._callData.exitRoomTime=u.convertTimeStampToString(e)},e.prototype.setCallEndTime=function(e){this._callData.callEndTime=e},e.prototype.setCodeAndMessage=function(e,t){this._callData.code=e||0,this._callData.message=t||""},e.prototype.setCallScene=function(e){this._callData.callScene=e||""},e.prototype.getResult=function(){return this._callData.result},e.prototype.setResult=function(e){this._callData.result=e||""},e.prototype.setUserID=function(e){this._callData.userID=e||""},e.prototype._callTypeMapping=function(e){var t=c.NAME.UNKNOWN;switch(e){case i.CALL_TYPE.AUDIO_CALL:t=c.NAME.AUDIO;break;case i.CALL_TYPE.VIDEO_CALL:t=c.NAME.VIDEO}return t},e.prototype._callRoleMapping=function(e){var t=e;return t===i.CALL_ROLE.INVITER?t=c.NAME.CALLER:t===i.CALL_ROLE.INVITEE&&(t=c.NAME.CALLEE),t},e.prototype.packageCallDataToKibana=function(){var e=this._callTypeMapping(this._callData.callType),t=this._callRoleMapping(this._callData.callRole);return"CallData{version='"+this._callData.version+", platform="+this._callData.platform+", framework="+this._callData.framework+", sdk_app_id="+this._callData.sdkAppId+", user_id="+this._callData.userID+", room_id="+this._callData.roomID+", invite_id="+this._callData.inviteID+", invitee_list="+this._callData.inviteeList+", media_type="+e+", role="+t+", call_scene="+this._callData.callScene+", result="+this._callData.result+", total_time="+this._callData.totalTime+", total_score="+this._callData.totalScore+", ability_bit="+this._callData.abilityBit+", enter_room="+this._callData.enterRoomTime+", send_signaling="+this._callData.sendSignalingTime+", call_accept="+this._callData.callAcceptTime+", exit_room="+this._callData.exitRoomTime+", call_end="+this._callData.callEndTime+", code="+this._callData.code+", message="+this._callData.message+", network="+this._callData.network+", audio="+this._callData.audio+", video="+this._callData.video+"}"},e.prototype.initializeCallData=function(e){var t=e||{},n=t.version,r=void 0===n?"":n,o=t.sdkAppId,a=void 0===o?0:o,s=t.userID,u=void 0===s?"":s,d=l.getHostType();this._callData={version:r,platform:d,framework:c.NAME.WEB,sdkAppId:a,userID:u,roomID:0,inviteID:"",callRole:i.CALL_ROLE.UNKNOWN,callScene:"",callType:i.CALL_TYPE.UNKNOWN,inviteeList:[],result:c.NAME.UNKNOWN,totalTime:0,totalScore:0,code:0,message:"",abilityBit:!1,enterRoomTime:"",sendSignalingTime:"",callAcceptTime:"",exitRoomTime:"",callEndTime:"",network:0,audio:0,video:0}},e.prototype.reset=function(){this.initializeCallData(),this._ssoLog=null},e.prototype.clearCallDataAfterUpload=function(){var e=this.getCallData(),t=e.version,n=e.sdkAppId,i=e.userID;this.initializeCallData({version:t,sdkAppId:n,userID:i})},e.prototype.uploadToKibana=function(){try{this._ssoLog.setText(this.packageCallDataToKibana()).setEnd(),this.clearCallDataAfterUpload()}catch(e){}},e}();t.CallDataReport=d;var h=function(){function e(e,t){this._eventEmitter=e,this._callDataReport=t,this.registerListener()}return e.prototype.registerListener=function(){this._eventEmitter.on(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.on(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.removeLister=function(){this._eventEmitter.off(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.off(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.off(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.off(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.off(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.onCallEnd=function(e){var t=e.totalTime,n=void 0===t?0:t;this._callDataReport.setTotalTime(n),this._callDataReport.setResult(c.NAME.NORMAL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onCallingCancel=function(){this._callDataReport.getResult()||this._callDataReport.setResult(c.NAME.CANCEL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onNoResponse=function(){this._callDataReport.setResult(c.NAME.TIMEOUT)},e.prototype.onLineBusy=function(){this._callDataReport.setResult(c.NAME.BUSYLINE)},e.prototype.onReject=function(){this._callDataReport.setResult(c.NAME.REJECT)},e}();t.TUICallEngineObserver=h},function(e,t,n){"use strict";n.r(t),n.d(t,"setBaseTime",(function(){return c})),n.d(t,"getCurrentTime",(function(){return u})),n.d(t,"getTimestamp",(function(){return l})),n.d(t,"convertTimeStampToString",(function(){return d}));var i=n(1),r=n(28),o=n.n(r);let a=(new Date).getTime(),s=0;const c=function(e){a=e,s=a-(new Date).getTime();const t=new Date;t.setTime(e),i.default.info("baseTime from server: "+t+" offset: "+s)},u=function(){return(new Date).getTime()+s},l=function(){const e=new Date;return e.setTime(u()),e.toLocaleString()},d=e=>e<=0?"":o()(e).format("YYYY-MM-DD HH:mm:ss")}]).default}))}}]);